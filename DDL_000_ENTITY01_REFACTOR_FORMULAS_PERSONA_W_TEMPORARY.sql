-- DROP TABLE PER_PERSONAS_FORMULAS PURGE;

CREATE TABLE "HAYA01"."PER_PERSONAS_FORMULAS" 
   (	"PER_ID" NUMBER(16,0) NOT NULL ENABLE, 
	"EST_CICLO_VIDA" VARCHAR2(50 CHAR), 
	"DIAS_VENC_RIESGO_DIRECTO" NUMBER, 
	"DIAS_VENC_RIESGO_INDIRECTO" NUMBER, 
	"RIESGO_TOTAL" NUMBER, 
	"RIESGO_TOTAL_DIRECTO" NUMBER, 
	"RIESGO_TOTAL_INDIRECTO" NUMBER, 
	"SITUACION_CLIENTE" VARCHAR2(50 CHAR), 
	"DIAS_VENCIDO" NUMBER, 
	"NUM_EXP_ACTIVOS" NUMBER, 
	"NUM_ASU_ACTIVOS" NUMBER, 
	"NUM_ASU_ACTIVOS_POR_PRC" NUMBER, 
	"SITUACION" VARCHAR2(50 CHAR), 
	"RELACION_EXP" VARCHAR2(10 BYTE), 
	"SERV_NOMINIA_PENSION" VARCHAR2(50 CHAR), 
	"ULTIMA_ACTUACION" VARCHAR2(50 CHAR), 
	"DISPUESTO_NO_VENCIDO" VARCHAR2(50 CHAR), 
	"DISPUESTO_VENCIDO" VARCHAR2(50 CHAR), 
	"DESC_CNAE" VARCHAR2(50 CHAR)
   );
   
CREATE INDEX IDX_PER_PERS_FORM_PER_ID ON PER_PERSONAS_FORMULAS(PER_ID);   

-- DROP TABLE TMP_PER_EST_CICLO_VIDA PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_EST_CICLO_VIDA (
   PER_ID                  NUMBER(16) NOT NULL
  ,EST_CICLO_VIDA          VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS ;

CREATE  INDEX IDX_TMP_PER_EST_CIC_VID_PER_ID ON TMP_PER_EST_CICLO_VIDA(PER_ID);

-- DROP TABLE TMP_PER_MOV PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_MOV (
   PER_ID                  NUMBER(16) NOT NULL
  ,MOV_ID          NUMBER(16) NOT NULL
  ,DD_TIN_TITULAR NUMBER(16)
)ON COMMIT PRESERVE ROWS ;

CREATE  INDEX IDX_TMP_PER_MOV_PER_ID ON TMP_PER_MOV(PER_ID);
--CREATE INDEX IDX_TMP_PER_MOV_MOV_ID ON TMP_PER_MOV(MOV_ID);
          
-- DROP TABLE TMP_PER_DVENC_RIES_DIREC PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_DVENC_RIES_DIREC (
  PER_ID                          NUMBER(16) NOT NULL
  ,MIN_MOV_FECHA_POS_VENCIDA      NUMBER 
)ON COMMIT DELETE ROWS ;

CREATE INDEX IDX_TMP_PER_DV_RIES_D_PER_ID ON TMP_PER_DVENC_RIES_DIREC(PER_ID);

-- DROP TABLE TMP_PER_DVENC_RIES_INDIREC PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_DVENC_RIES_INDIREC (
  PER_ID                          NUMBER(16) NOT NULL
  ,DIAS_VENC_RIESGO_INDIRECTO      NUMBER 
)ON COMMIT DELETE ROWS ;

CREATE INDEX IDX_TMP_PER_DV_RIES_I_PER_ID ON TMP_PER_DVENC_RIES_INDIREC(PER_ID);

-- DROP TABLE TMP_PER_RIESGO_TOTAL PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_RIESGO_TOTAL (
  PER_ID                          NUMBER(16) NOT NULL
  ,RIESGO_TOTAL      NUMBER 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_RIES_TOTAL_PER_ID ON TMP_PER_RIESGO_TOTAL(PER_ID);          

-- DROP TABLE TMP_PER_RIESGO_TOTAL_DIRECTO PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_RIESGO_TOTAL_DIRECTO (
  PER_ID                          NUMBER(16) NOT NULL
  ,RIESGO_TOTAL_DIRECTO      NUMBER 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_RIES_TOT_D_PER_ID ON TMP_PER_RIESGO_TOTAL_DIRECTO(PER_ID); 

-- DROP TABLE TMP_PER_RIESGO_TOTAL_INDIRECTO PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_RIESGO_TOTAL_INDIRECTO (
  PER_ID                          NUMBER(16) NOT NULL
  ,RIESGO_TOTAL_INDIRECTO      NUMBER 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_RIES_TOT_I_PER_ID ON TMP_PER_RIESGO_TOTAL_INDIRECTO(PER_ID); 

-- SITUACION_CLIENTE    
-- DROP TABLE TMP_PER_SITUACION_CLIENTE PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_SITUACION_CLIENTE (
  PER_ID                  NUMBER(16) NOT NULL
  ,SITUACION_CLIENTE      VARCHAR2(50 CHAR)  
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_SIT_CLIENTE_PER_ID ON TMP_PER_SITUACION_CLIENTE(PER_ID); 

--DIAS_VENCIDO
-- DROP TABLE TMP_PER_DIAS_VENCIDO PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_DIAS_VENCIDO (
  PER_ID                  NUMBER(16) NOT NULL
  ,DIAS_VENCIDO   NUMBER 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_DIAS_VENC_PER_ID ON TMP_PER_DIAS_VENCIDO(PER_ID);

-- NUM_EXP_ACTIVOS
-- DROP TABLE TMP_PER_NUM_EXP_ACTIVOS PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_NUM_EXP_ACTIVOS (
  PER_ID                  NUMBER(16) NOT NULL
  ,NUM_EXP_ACTIVOS   NUMBER 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_NUM_EXP_ACT_PER_ID ON TMP_PER_NUM_EXP_ACTIVOS(PER_ID);

-- NUM_ASU_ACTIVOS
-- DROP TABLE TMP_PER_NUM_ASU_ACTIVOS PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_NUM_ASU_ACTIVOS (
  PER_ID                  NUMBER(16) NOT NULL
  ,NUM_ASU_ACTIVOS   NUMBER 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_NUM_ASU_ACT_PER_ID ON TMP_PER_NUM_ASU_ACTIVOS(PER_ID);

-- NUM_ASU_ACTIVOS_POR_PRC
-- DROP TABLE TMP_PER_NUM_ASU_ACT_POR_PRC PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_NUM_ASU_ACT_POR_PRC(
  PER_ID                  NUMBER(16) NOT NULL
  ,NUM_ASU_ACTIVOS_POR_PRC   NUMBER 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_P_N_AS_A_P_PRC_PER_ID ON TMP_PER_NUM_ASU_ACT_POR_PRC(PER_ID);

-- SITUACION
-- DROP TABLE TMP_PER_SITUACION PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_SITUACION(
  PER_ID                  NUMBER(16) NOT NULL
  ,SITUACION   VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_SITUACION_PER_ID ON TMP_PER_SITUACION(PER_ID);

-- RELACION_EXP
-- DROP TABLE TMP_PER_RELACION_EXP PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_RELACION_EXP (
  PER_ID                  NUMBER(16) NOT NULL
  ,RELACION_EXP   VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_REL_EXP_PER_ID ON TMP_PER_RELACION_EXP(PER_ID);

-- SERV_NOMINIA_PENSION
-- DROP TABLE TMP_PER_SERV_NOMINIA_PENSION PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_SERV_NOMINIA_PENSION (
  PER_ID                  NUMBER(16) NOT NULL
  ,SERV_NOMINIA_PENSION   VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_TMP_PER_S_N_P_PER_ID ON TMP_PER_SERV_NOMINIA_PENSION(PER_ID);

-- ULTIMA_ACTUACION
-- DROP TABLE TMP_PER_ULTIMA_ACTUACION PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_ULTIMA_ACTUACION (
  PER_ID                  NUMBER(16) NOT NULL
  ,ULTIMA_ACTUACION   VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_ULTIMA_ACT_PER_ID ON TMP_PER_ULTIMA_ACTUACION(PER_ID);

-- DISPUESTO_NO_VENCIDO
-- DROP TABLE TMP_PER_DISPUESTO_NO_VENCIDO PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_DISPUESTO_NO_VENCIDO (
  PER_ID                  NUMBER(16) NOT NULL
  ,DISPUESTO_NO_VENCIDO   VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_DISP_NO_VEN_PER_ID ON TMP_PER_DISPUESTO_NO_VENCIDO(PER_ID);

-- DISPUESTO_VENCIDO
-- DROP TABLE TMP_PER_DISPUESTO_VENCIDO PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_DISPUESTO_VENCIDO (
  PER_ID                  NUMBER(16) NOT NULL
  ,DISPUESTO_VENCIDO   VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_DISP_VEN_PER_ID ON TMP_PER_DISPUESTO_VENCIDO(PER_ID);

-- DESC_CNAE
-- DROP TABLE TMP_PER_DESC_CNAE PURGE;

CREATE GLOBAL TEMPORARY TABLE TMP_PER_DESC_CNAE (
  PER_ID                  NUMBER(16) NOT NULL
  ,DESC_CNAE   VARCHAR2(50 CHAR) 
)ON COMMIT DELETE ROWS;

CREATE INDEX IDX_TMP_PER_DESC_CNAE_PER_ID ON TMP_PER_DESC_CNAE(PER_ID);