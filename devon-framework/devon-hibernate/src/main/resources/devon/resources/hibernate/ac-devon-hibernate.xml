<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jee="http://www.springframework.org/schema/jee"
  xmlns:p="http://www.springframework.org/schema/p"
  xmlns:util="http://www.springframework.org/schema/util"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
                           http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.5.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd"
    default-autowire="byName">

	<alias name="masterSessionFactory" alias="sessionFactory" />
    
    <!-- Default Hibernate additional mappings -->
    <util:list id="fwk.master.additionalMappings" />
    <bean id="master.additionalMappings" parent="fwk.master.additionalMappings"/>

    <!-- Default Hibernate properties -->
    <util:map id="fwk.master.hibernateProperties">
        <entry key="hibernate.dialect" value="org.hibernate.dialect.${master.dialect}"/>
        <entry key="hibernate.hbm2ddl.auto" value="no"/>
        <entry key="hibernate.show_sql" value="false"/>
        <entry key="hibernate.cache.provider_class" value="org.hibernate.cache.EhCacheProvider"/>
        <entry key="hibernate.cache.provider_configuration_file_resource_path" value="ehcache.xml"/>
        <entry key="hibernate.connection.pool_size" value="5"/>
        <entry key="hibernate.cache.use_query_cache" value="${master.use_query_cache}"/>
        <entry key="hibernate.cache.use_second_level_cache" value="${master.use_second_level_cache}"/>
    </util:map>
    <bean id="master.hibernateProperties" parent="fwk.master.hibernateProperties"/>
    
    <!-- Default base packages for scan @entity annotations -->
    <util:list id="fwk.master.annotatedPackageClasses">
        <value>${daoPackages}</value>
    </util:list>
    <bean id="master.annotatedPackageClasses" parent="fwk.master.annotatedPackageClasses"/>

    <!-- Default annotated classes -->
    <util:list id="fwk.master.annotatedClasses">
        <!-- Framework mappings -->
        <value>es.capgemini.devon.hibernate.events.defered.HibernateDeferedEvent</value>
    </util:list>
    <bean id="master.annotatedClasses" parent="fwk.master.annotatedClasses"/>
    
    <!-- Default Cache Strategies -->
    <util:properties id="fwk.master.entityCacheStrategies">
        <!-- Framework mappings -->
        <prop key="es.capgemini.devon.hibernate.events.defered.HibernateDeferedEvent">read-write</prop>
    </util:properties>
    <bean id="master.entityCacheStrategiess" parent="fwk.master.entityCacheStrategies"/>

    <!-- Hibernate Master Session factory -->
    <bean id="masterSessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean" p:dataSource-ref="masterDataSource">
        <property name="hibernateProperties" ref="master.hibernateProperties"/>
        <property name="packagesToScan" ref="master.annotatedPackageClasses"/>
        <property name="annotatedClasses" ref="master.annotatedClasses"/>
        <property name="entityCacheStrategies" ref="master.entityCacheStrategies"/>
        <property name="mappingLocations" ref="master.additionalMappings" />
    </bean>
    <bean id="masterTransactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
        <property name="sessionFactory" ref="masterSessionFactory" />
    </bean>

	<alias name="masterTransactionManager" alias="transactionManager" />

    <tx:annotation-driven transaction-manager="masterTransactionManager" proxy-target-class="true" />

    <!-- Expose the Hibernate Statistics -->
    <bean name="devon:type=MasterHibernateStatistics" class="org.hibernate.jmx.StatisticsService" autowire="byName">
        <property name="sessionFactory" ref="masterSessionFactory"/>
    </bean>

</beans>