<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

  <entry key="antecedentes.buscarAntecedente">
    <![CDATA[
      SELECT ANT_ID FROM per_personas WHERE PER_ID=?
    ]]>
  </entry>

  <entry key="antecedentes.buscarAntecedenteInterno">
    <![CDATA[
      SELECT AIN_ID FROM ain_antecedenteinternos WHERE CNT_ID=?
    ]]>
  </entry>

  <entry key="antecedentes.buscarUltimoAntecedente">
    <![CDATA[
      SELECT MAX(ANT_ID) FROM ant_antecedentes
    ]]>
  </entry>

  <entry key="antecedentes.incrementarAntecedente">
    <![CDATA[
      UPDATE ant_antecedentes
      SET ANT_REINCIDENCIA_INTERNOS=NVL(ANT_REINCIDENCIA_INTERNOS+1, 1),
          USUARIOMODIFICAR='${procesoRevisionJobUser}',
          FECHAMODIFICAR=${sql.function.now}
      WHERE ANT_ID IN (
        SELECT p.ant_id FROM cpe_contratos_personas cpe, per_personas p , dd_tin_tipo_intervencion tin
        WHERE p.per_id = cpe.per_id
        AND tin.DD_TIN_ID = cpe.DD_TIN_ID
        and tin.DD_TIN_TITULAR = 1 
        AND cpe.cnt_id IN(?))
    ]]>
  </entry>

  <entry key="antecedentes.insertarNuevoAntecedente.MySQLDialect">
    <![CDATA[
     INSERT INTO ant_antecedentes (ANT_OBSERVACIONES, ANT_FECHA_VERIFICACION, ANT_REINCIDENCIA_INTERNOS, USUARIOCREAR, FECHACREAR)
     VALUES (null, null, 0, '${procesoRevisionJobUser}', ${sql.function.now})
    ]]>
  </entry>
  
  <entry key="antecedentes.insertarNuevoAntecedente.Oracle10gDialect">
    <![CDATA[
     INSERT INTO ant_antecedentes (ANT_ID, ANT_OBSERVACIONES, ANT_FECHA_VERIFICACION, ANT_REINCIDENCIA_INTERNOS, USUARIOCREAR, FECHACREAR)
     VALUES (s_ant_antecedentes.nextVal, null, null, 0, '${procesoRevisionJobUser}', ${sql.function.now})
    ]]>
  </entry>

  <entry key="antecedentes.insertarNuevoAntecedenteInterno.MySQLDialect">
    <![CDATA[
      INSERT INTO ain_antecedenteinternos
      SET CNT_ID=?,
          AIN_POS_IRREGULAR_MAX=?,
          AIN_DIAS_MAX_IRREGULAR=?,
          AIN_FECHA_ULT_REGULARIZACION = ?,
          USUARIOCREAR='${procesoRevisionJobUser}',
          FECHACREAR=${sql.function.now}
    ]]>
  </entry>

  <entry key="antecedentes.insertarNuevoAntecedenteInterno.Oracle10gDialect">
    <![CDATA[
      INSERT INTO ain_antecedenteinternos (AIN_ID, CNT_ID, AIN_POS_IRREGULAR_MAX, AIN_DIAS_MAX_IRREGULAR, AIN_FECHA_ULT_REGULARIZACION, USUARIOCREAR, FECHACREAR)
      values (s_ain_antecedenteinternos.nextVal, ?, ?, ?, to_date(?, 'yyyy-MM-dd'), '${procesoRevisionJobUser}', ${sql.function.now}) 
    ]]>
  </entry>

  <entry key="antecedentes.updateAntecedenteEnPersona">
    <![CDATA[
      UPDATE per_personas SET ANT_ID=? WHERE PER_ID=?
    ]]>
  </entry>

  <entry key="antecedentes.updateAntecedenteInterno.MySQLDialect">
    <![CDATA[
      UPDATE ain_antecedenteinternos 
      SET AIN_POS_IRREGULAR_MAX=IF(ABS(AIN_POS_IRREGULAR_MAX ) > ABS(?), AIN_POS_IRREGULAR_MAX ,?),
          AIN_DIAS_MAX_IRREGULAR=IF(AIN_DIAS_MAX_IRREGULAR  > ?, AIN_DIAS_MAX_IRREGULAR ,?),
          AIN_FECHA_ULT_REGULARIZACION = ?,
          USUARIOMODIFICAR='${procesoRevisionJobUser}',
          FECHAMODIFICAR=${sql.function.now}
      WHERE CNT_ID=?
    ]]>
  </entry>

  <entry key="antecedentes.updateAntecedenteInterno.Oracle10gDialect">
    <![CDATA[
      UPDATE ain_antecedenteinternos
      SET AIN_POS_IRREGULAR_MAX=CASE WHEN(ABS(AIN_POS_IRREGULAR_MAX ) > ABS(?)) THEN AIN_POS_IRREGULAR_MAX ELSE ? END,
          AIN_DIAS_MAX_IRREGULAR=CASE WHEN(AIN_DIAS_MAX_IRREGULAR > ?) THEN AIN_DIAS_MAX_IRREGULAR ELSE ? END,
          AIN_FECHA_ULT_REGULARIZACION= to_date(?, 'yyyy-MM-dd'),
          USUARIOMODIFICAR='${procesoRevisionJobUser}',
          FECHAMODIFICAR=${sql.function.now}
      WHERE CNT_ID=?
    ]]>
  </entry>

</properties>
