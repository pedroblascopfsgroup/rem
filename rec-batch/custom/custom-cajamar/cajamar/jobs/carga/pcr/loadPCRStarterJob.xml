<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:p="http://www.springframework.org/schema/p" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd" default-autowire="byName"
   default-merge="true">

   <bean id="batch.task.UnZipi64Support" abstract="true" class="es.pfsgroup.recovery.batch.tasks.Unzip64SupportTasklet"/>

   <bean id="batch.task.PFSDataLoader" abstract="true" class="es.pfsgroup.recovery.batch.tasks.PFSDataLoaderTasklet"/>


   <bean id="loadPCRStarterJob" parent="batch.simpleJob" scope="prototype">
      <property name="steps">
         <list>
            <!-- Se comentan todos los pasos del STEP porque el Loader se ejecuta a través de ETLs -->
            <!-- 
            ** Descomprimir el fichero .TXT **
            <bean id="pcr.unzip" parent="batch.taskletStep" scope="prototype">
               <property name="tasklet">
                  <bean parent="batch.task.UnZipi64Support" p:bindings="zipFileName=zipFile,zipFilesToExtract=zipFilesToExtract,pathToExtract=pathToExtract" scope="prototype">
                    <property name="severidad" value="error"/>
                    <property name="message" value="unzip.errorUnziping"/>
                  </bean>                            
               </property>
            </bean>
**                                     CONTRATOS                                         **
            ** Convertir el fichero .TXT en .CSV  **
**
            <bean id="cargaContrato.convert" parent="batch.simpleStep" scope="prototype">
               <property name="itemReader" ref="cargaContratos.itemReader" />
               <property name="itemWriter" ref="cargaContratos.itemWriter" />
               <property name="commitInterval" value="5000" />
            </bean>
**
            ** Carga de datos **
            <bean id="cargaContrato.load" parent="batch.taskletStep" scope="prototype">
               <property name="tasklet">
                  <bean parent="batch.task.PFSDataLoader" scope="prototype"> 
         ** Parámetros Fijos del DataLoader **
                     <property name="dataSource" ref="entityDataSource" />
                     <property name="afterScript">
         ** UPDATE tmp_cnt_contratos SET tmp_cnt_fichero_carga = '${inFile}'; **
                        <value>
                                ANALYZE TABLE tmp_cnt_contratos ${sql.analyze};
                        </value>
                     </property>                      
                 ** Parámetros Fijos del DataLoader que vienen en los JobParameters **
                     <property name="bindings" value="fileSystemResource=csvFileContratos${batch.loaderParams}" />
                ** Parámetros Opcionales del DataLoader **
                     <property name="params">
                        <map> 
                           ** de MySQL **
                           <entry key="tableName" value="tmp_cnt_contratos" />
                           <entry key="columns"
                              value="@varFechaExtraccion,TMP_CNT_COD_ENTIDAD,TMP_CNT_COD_OFICINA,TMP_CNT_COD_CENTRO,TMP_CNT_CONTRATO,TMP_CNT_MONEDA,
                           @varPosVivaNoVenciada,@varPosViva,@varFechaPosVencida,@varSaldoDudoso,@varFechaDudoso,TMP_CNT_ESTADO_FINANCIERO,
                           TMP_CNT_ESTADO_FINANCIERO_ANT,@fechaEstadoFinaciero,@fechaEstadoFinancieroAnterior,@varProvision,TMP_ESTADO_CONTRATO,
                           @fechaEstadoContrato,TMP_CNT_TIPO_PRODUCTO,@varIntRemuneratorios,@varIntMoratorios,@varComisiones,@varGastos,@varFechaCreacion
                           TMP_CNT_LIMITE_INI,TMP_CNT_LIMITE_FIN,TMP_CNT_FINALIDAD_OFI,TMP_CNT_FINALIDAD_CON,TMP_CNT_GARANTIA_1,          
                           TMP_CNT_GARANTIA_2,TMP_CNT_CATALOGO_1,TMP_CNT_CATALOGO_2,TMP_CNT_CATALOGO_3,TMP_CNT_CATALOGO_4,TMP_CNT_CATALOGO_5,            
                           TMP_CNT_CATALOGO_6,@varFechaConstitucion,@varFechaVencimiento,TMP_CNT_RIESGO,TMP_CNT_DEUDA_IRREGULAR,    
                           TMP_CNT_DISPUESTO,TMP_CNT_SALDO_PASIVO,TMP_CNT_RIESGO_GARANT,TMP_CNT_SALDO_EXCE,TMP_CNT_LIMITE_DESC,TMP_CNT_EXTRA_1,                
                           TMP_CNT_EXTRA_2,TMP_CNT_LTV_INI,TMP_CNT_LTV_FIN,TMP_CNT_EXTRA_3_CODIGO,TMP_CNT_EXTRA_4_CODIGO,@varFechaExtra5,@varFechaExtra6,
                           TMP_CNT_FLAG_EXTRA1,TMP_CNT_FLAG_EXTRA2,TMP_CNT_FLAG_EXTRA3,TMP_CNT_FLAG_EXTRA4,
                           TMP_CNT_COD_EXTRA1,TMP_CNT_COD_EXTRA2,TMP_CNT_COD_EXTRA3,TMP_CNT_COD_EXTRA4,
                           TMP_CNT_INF_EXTRA1,TMP_CNT_INF_EXTRA2,TMP_CNT_INF_EXTRA3,TMP_CNT_INF_EXTRA4,TMP_CNT_INF_EXTRA5,TMP_CNT_INF_EXTRA6,
TMP_CNT_INF_EXTRA7, TMP_CNT_INF_EXTRA8, TMP_CNT_INF_EXTRA9, TMP_CNT_INF_EXTRA10, TMP_CNT_INF_EXTRA11, TMP_CNT_INF_EXTRA12, TMP_CNT_INF_EXTRA13, TMP_CNT_INF_EXTRA14, TMP_CNT_INF_EXTRA15, TMP_CNT_INF_EXTRA16, TMP_CNT_NUM_EXTRA11, TMP_CNT_NUM_EXTRA12, TMP_CNT_NUM_EXTRA13, TMP_CNT_NUM_EXTRA14, TMP_CNT_NUM_EXTRA15
                           " />
                           <entry key="sets"
                              value="TMP_CNT_FECHA_EXTRACCION = str_to_date(@varFechaExtraccion,'%d%m%Y'),TMP_CNT_FECHA_POS_VENCIDA = str_to_date(@varFechaPosVencida,'%d%m%Y'),TMP_CNT_FECHA_DUDOSO = str_to_date(trim(@varFechaDudoso),'%d%m%Y'),TMP_CNT_POS_VIVA_NO_VENCIDA = @varPosVivaNoVenciada/100,TMP_CNT_POS_VIVA_VENCIDA = @varPosViva/100,TMP_CNT_SALDO_DUDOSO = @varSaldoDudoso/100,TMP_CNT_PROVISION = @varProvision/100,TMP_CNT_INT_REMUNERATORIOS = @varIntRemuneratorios/100,TMP_CNT_INT_MORATORIOS = @varIntMoratorios/100,TMP_CNT_COMISIONES = @varComisiones/100,TMP_CNT_GASTOS = @varGastos/100,TMP_CNT_FECHA_ESTADO_FINANC = str_to_date(@fechaEstadoFinaciero,'%d%m%Y'),TMP_CNT_FECHA_ESTADO_FINAN_ANT = str_to_date(@fechaEstadoFinancieroAnterior,'%d%m%Y'),TMP_FECHA_ESTADO_CONTRATO = str_to_date(@fechaEstadoContrato,'%d%m%Y'),TMP_CNT_FECHA_CREA_CNT = str_to_date(@varFechaCreacion,'%d%m%Y'),
                           TMP_CNT_FECHA_CONSTITUCION= str_to_date(@varFechaConstitucion,'%d%m%Y'),
                           TMP_CNT_FECHA_VENC= str_to_date(@varFechaVencimiento,'%d%m%Y'),
                           TMP_CNT_EXTRA_5= str_to_date(@varFechaExtra5,'%d%m%Y'),
                           TMP_CNT_EXTRA_6= str_to_date(@varFechaExtra6,'%d%m%Y'),
                           USUARIOCREAR = 'BATCH_USER',FECHACREAR = curdate(),TMP_CNT_FECHA_CARGA = curdate(),BORRADO = '0'" />
                           ** de Oracle **
                           <entry key="pathToSqlLoader" value="${batch.pathToSqlLoader}" />
                           <entry key="controlFile" value="bankia/load/pcr/loadPCRContrato.ctl" />
                           <entry key="connectionInfo" value="${batch.connectionInfo}" />
                           <entry key="parameters" value="${batch.sqlLoaderParameters}" />
                        </map>
                     </property>
                     <property name="message" value="cargaContratos.dataLoad" />
                     <property name="severidad" value="error" />
                  </bean>
               </property>
            </bean> 
   
**                                              FIN CONTRATOS                                                    **
**                                              PERSONAS                                                         **
            ** Convertir el fichero de personas de .TXT en .CSV  **
**
            <bean id="cargaPersona.convert" parent="batch.simpleStep" scope="prototype">
               <property name="itemReader" ref="cargaPersonas.itemReader" />
               <property name="itemWriter" ref="cargaPersonas.itemWriter" />
               <property name="commitInterval" value="5000" />
            </bean>
**
            ** Data Load del fichero .CSV **
            <bean id="tmp_per_personas.BcpUpload" parent="batch.taskletStep" scope="prototype">
               <property name="tasklet">
                  <bean parent="batch.task.PFSDataLoader" scope="prototype">
                     ** Parámetros Fijos del DataLoader **
                     <property name="dataSource" ref="entityDataSource" />
                     <property name="afterScript">
         ** UPDATE tmp_per_personas SET tmp_per_fichero_carga = '${inFile}'; **
                        <value>                            
                            ANALYZE TABLE tmp_per_personas ${sql.analyze};
                        </value>
                     </property>
                        ** Parámetros Fijos del DataLoader que vienen en los JobParameters **
                     <property name="bindings" value="fileSystemResource=csvFilePersonas${batch.loaderParams}" />
                     <property name="params">
                        <map>
                                 ** de MySQL **
                           <entry key="tableName" value="tmp_per_personas" />
                           <entry key="columns"
                              value="@varFechaExtraccion, tmp_per_cod_entidad, tmp_per_cod_cliente_entidad,
                                 tmp_per_tipo_persona, tmp_per_tipo_documento, tmp_per_nif_cif, tmp_per_nombre, tmp_per_nom50, 
                                 tmp_per_segmento, tmp_per_apellido1, tmp_per_apellido2, tmp_per_ecv, @varFechaCreacionECV, 
                           tmp_per_telefono_1, tmp_per_telefono_2,   tmp_per_movil_1, tmp_per_movil_2, tmp_per_email,
                           TMP_PER_TELEFONO_5,                                                           
                           TMP_PER_TELEFONO_6,
                           TMP_PER_VR_OTRAS_ENT,                                   
                           TMP_PER_VR_DANIADO_OTRAS_ENT,
                           TMP_PER_NRO_SOCIOS,
                           TMP_PER_NRO_EMPLEADOS,
                           TMP_PER_RIESGO,          
                           TMP_PER_RIESGO_IND,          
                           TMP_PER_EXTRA_1,                                       
                           TMP_PER_EXTRA_2, 
                           TMP_PER_CONTACTO,                                      
                           TMP_PER_NACIONALIDAD,                                                                     
                           TMP_PER_PAIS_NACIMIENTO ,
                           TMP_PER_SEXO,                                  
                           TMP_DD_TIPO_TELEFONO_1,                                   
                           TMP_DD_TIPO_TELEFONO_2,                                   
                           TMP_DD_TIPO_TELEFONO_3,                                   
                           TMP_DD_TIPO_TELEFONO_4,                                   
                           TMP_DD_TIPO_TELEFONO_5,                                   
                           TMP_DD_TIPO_TELEFONO_6,
                           TMP_OFI_CODIGO,
                           TMP_ZON_NUM_CENTRO,                                   
                           TMP_PEF_ID,                                              
                           TMP_USU_USERNAME,
                           TMP_DD_GGE_CODIGO,                             
                           TMP_DD_POL_CODIGO,                         
                           TMP_DD_REX_CODIGO,                                           
                           TMP_DD_RAX_CODIGO,                                           
                           TMP_DD_PER_EXTRA_3_CODIGO,                                    
                           TMP_DD_PER_EXTRA_4_CODIGO,                                    
                           @varFechaConstitucion ,                                       
                           @varFechaExtra5,                                         
                           @varFechaExtra6 
                           " />
                           <entry key="sets"
                              value="tmp_per_fecha_extraccion = str_to_date(trim(@varFechaExtraccion),'%d%m%Y'),TMP_PER_FECHA_CREACION = str_to_date(trim(@varFechaCreacionECV),'%d%m%Y'),
                       TMP_PER_FECHA_CONSTITUCION = str_to_date(trim(@varFechaConstitucion),'%d%m%Y'),
                       TMP_PER_EXTRA_5 = str_to_date(trim(@varFechaExtra5),'%d%m%Y'),
                       TMP_PER_EXTRA_6 = str_to_date(trim(@varFechaExtra6),'%d%m%Y'),
                       tmp_per_fecha_carga = SYSDATE(), USUARIOCREAR = 'BATCH_USER', FECHACREAR = SYSDATE(), BORRADO = '0'" />
                                 ** de Oracle **
                           <entry key="pathToSqlLoader" value="${batch.pathToSqlLoader}" />
                           <entry key="parameters" value="${batch.sqlLoaderParameters}" />
                           <entry key="controlFile" value="bankia/load/pcr/loadPCRPersonas.ctl" />
                           <entry key="connectionInfo" value="${batch.connectionInfo}" />
                        </map>
                     </property>
                     <property name="message" value="cargaPersonas.dataLoad" />
                     <property name="severidad" value="warn" />
                  </bean>
               </property>
            </bean>
   
**                                              FIN PERSONAS                                                        **
**                                              RELACIONES                                                          **
              ** Convertir el fichero de relaciones .TXT en .CSV  **
**
            <bean id="cargaRelacion.convert" parent="batch.simpleStep" scope="prototype">
               <property name="itemReader" ref="cargaRelacion.itemReader" />
               <property name="itemWriter" ref="cargaRelacion.itemWriter" />
               <property name="commitInterval" value="5000" />
            </bean>
**
              ** Carga de datos **
            <bean id="cargaRelacion.load" parent="batch.taskletStep" scope="prototype">
               <property name="tasklet">
                  <bean parent="batch.task.PFSDataLoader" scope="prototype">
                     <property name="dataSource" ref="entityDataSource" />
                     <property name="afterScript">
         ** UPDATE tmp_cnt_per SET tmp_cnt_per_fichero_carga= '${inFile}'; **
                        <value>                            
                            ANALYZE TABLE tmp_cnt_per ${sql.analyze};
                        </value>
                     </property>
                     <property name="bindings" value="fileSystemResource=csvFileRelacion${batch.loaderParams}" />
                     <property name="params">
                        <map>
                           <entry key="tableName" value="tmp_cnt_per" />
                           <entry key="columns"
                              value="@varFechaExtraccionCntPer,TMP_CNT_PER_COD_ENTIDAD,TMP_CNT_PER_COD_OFICINA,TMP_CNT_PER_CONTRATO,TMP_CNT_PER_COD_CLIENTE,TMP_CNT_PER_TIPO_INTERVENCION,TMP_CNT_PER_ORDEN" />
                           <entry key="sets"
                              value="TMP_CNT_PER_FECHA_EXTRACCION = str_to_date(@varFechaExtraccionCntPer,'%d%m%Y'),USUARIOCREAR = 'BATCH_USER',FECHACREAR = SYSDATE()" />
                           <entry key="pathToSqlLoader" value="${batch.pathToSqlLoader}" />
                           <entry key="controlFile" value="bankia/load/pcr/loadPCRRelacionesContPer.ctl" />
                           <entry key="connectionInfo" value="${batch.connectionInfo}" />
                           <entry key="parameters" value="${batch.sqlLoaderParameters}" />
                        </map>
                     </property>
                     <property name="message" value="cargaRelacion.dataLoad" />
                     <property name="severidad" value="error" />
                  </bean>
               </property>
            </bean>
   
**                                            FIN RELACIONES                                                       **
**                                     DIRECCIONES                                         **
            ** Convertir el fichero .TXT en .CSV  **
**
            <bean id="cargaDirecciones.convert" parent="batch.simpleStep" scope="prototype">
               <property name="itemReader" ref="cargaDirecciones.itemReader" />
               <property name="itemWriter" ref="cargaDirecciones.itemWriter" />
               <property name="commitInterval" value="5000" />
            </bean>
**
** 
            <bean id="cargaDirecciones.load" parent="batch.taskletStep" scope="prototype">
               <property name="tasklet">
                  <bean parent="batch.task.PFSDataLoader" scope="prototype">
                     <property name="dataSource" ref="entityDataSource" />
                     <property name="afterScript">
                        <value>ANALYZE TABLE TMP_DIRECCIONES ${sql.analyze}</value>
                     </property>
                     <property name="bindings" value="fileSystemResource=csvFileDirecciones${batch.loaderParams}" />
                     <property name="params">
                        <map>
                           <entry key="tableName" value="TMP_DIRECCIONES" />
                           <entry key="columns"
                              value="@varFechaExtraccion,TMP_DIR_COD_ENTIDAD,TMP_DIR_COD_CLIENTE_ENTIDAD,TMP_DIR_COD_DIRECCION,@tipoVia,@domicilio,@numero,@portal,@piso,@escalera,@puerta,TMP_DIR_CODIGO_POSTAL,@provincia,@poblacion,@municipio,TMP_DIR_INE_PROV,TMP_DIR_INE_POB,TMP_DIR_INE_MUN,TMP_DIR_INE_VIA" />
                           <entry key="sets"
                              value="TMP_DIR_TIPOVIA = trim(@tipoVia),TMP_DIR_DOMICILIO = trim(@domicilio),TMP_DIR_DOM_N = trim(@numero),TMP_DIR_DOM_PORTAL = trim(@portal),TMP_DIR_DOM_PISO = trim(@piso),TMP_DIR_DOM_ESC = trim(@escalera),TMP_DIR_DOM_PUERTA = trim(@puerta),TMP_DIR_PROVINCIA = trim(@provincia),TMP_DIR_POBLACION = trim(@poblacion),TMP_DIR_MUNICIPIO = trim(@municipio),TMP_DIR_FECHA_EXTRACCION = str_to_date(trim(@varFechaExtraccion),'%d%m%Y'),USUARIOCREAR = 'BATCH_USER',FECHACREAR = curdate(),BORRADO = '0';" />
                           <entry key="pathToSqlLoader" value="${batch.pathToSqlLoader}" />
                           <entry key="controlFile" value="optionalConfiguration/load/pcr/direccionesDataLoad.ctl" />
                           <entry key="connectionInfo" value="${batch.connectionInfo}" />
                           <entry key="parameters" value="${batch.sqlLoaderParameters}" />
                        </map>
                     </property>
                     <property name="message" value="cargaDirecciones.dataLoad" />
                     <property name="severidad" value="error" />                          
                  </bean>
               </property>
            </bean>  **
**                                              FIN DIRECCIONES                                                    **

      -->
         </list>
      </property>
   </bean>
   
   <!-- No delimited reader -->
   <bean id="cargaContratos.itemReader" parent="batch.task.FlatFileItemReader" scope="prototype">
      <property name="bindings" value="fileSystemResource=txtFileContratos" />
      <property name="recordSeparatorPolicy">
         <bean class="org.springframework.batch.item.file.separator.SimpleRecordSeparatorPolicy"/>
      </property>      
      <property name="lineTokenizer">
         <bean parent="batch.transform.FixedLengthTokenizer"
         p:columns="1-8,9-12,13-16,17-22,23-32,33-36,37-50,51-64,65-72,73-86,87-94,95-96,97-98,99-106,107-114,115-128,129-130,131-138,
         139-1162,1163-1176,1177-1190,1191-1204,1205-1218,1219-1226,1227-1240,1241-1254,1255-1268,1269-1282,1283-1296,1297-1310,1311-1324,1325-1338,1339-1352,1353-1366,1367-1380,1381-1394,1395-1408,1409-1411,1412-1414,1415-1419,1420-1424,1425-1434,1435-1444,1445-1454,1455-1464,1465-1474,1475-1484,1485-1739,1740-1749,1750-1759,1760-1769,1770-1779,1780-1789,
         1790,1791,1792,1793,
         1794-1813,1814-1833,1834-1853,1854-1873,
         1874-1923,1924-1973,1974-2023,2024-2073,2074-2123,2124-2173,
                        2174-2223,2224-2273,2274-2323,2324-2373,2374-2423,2424-2473,2474-2523,2524-2573,2574-2623,2624-2673" />
       <!--
            p:columns="1-8,9-12,13-16,17-22,23-32,33-36,37-50,51-64,65-72,73-86,87-94,95-96,97-98,99-106,107-114,115-128,129-130,131-138,139-1162,1163-1176,1177-1190,1191-1204,1205-1218,1219-1226" />
         -->
         <!--
            p:columns="1-8,9-12,13-16,17-22,23-32,33-36,37-46,47-56,57-64,65-74,75-82,83-92,93-107,108-362,363-372,373-382,383-392,393-402,403-404,405-412,413-420"
            /
         -->
         <!--
            p:columns="1-8, 9-12, 13-16, 17-36, 37-39, 40-51, 52-63, 64-71, 72-83, 84-91, 92-103, 104-118, 119-130, 131-142, 143-154, 155-166,
            167-186, 187-187, 188-199, 200-200, 201-208, 206-216, 217-246, 247-258, 259-266" />
         -->
      </property>
      <property name="fieldSetMapper">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="message" value="cargaContratos.itemReader.tokenizerError" />
      <property name="severidad" value="error" />
   </bean>

   <!-- Custom delimited writer -->
   <bean id="cargaContratos.itemWriter" parent="batch.task.FlatFileItemWriter" scope="prototype">
      <property name="bindings" value="fileSystemResource=csvFileContratos" />
      <property name="fieldSetCreator">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="lineAggregator">
         <bean parent="batch.transform.DelimitedLineAggregator" p:stringFields="1,24,37,38,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107" />
      </property>
      <property name="message" value="cargaContratos.itemWriter" />
      <property name="severidad" value="error" />
      <property name="trim" value="true" />
   </bean>
   <!-- No delimited reader -->
   <bean id="cargaPersonas.itemReader" parent="batch.task.FlatFileItemReader" scope="prototype">   
      <property name="bindings" value="fileSystemResource=txtFilePersonas" />
      <property name="recordSeparatorPolicy">
         <bean class="org.springframework.batch.item.file.separator.SimpleRecordSeparatorPolicy"/>
      </property>      
      <property name="lineTokenizer">
         <bean parent="batch.transform.FixedLengthTokenizer"
            p:columns="1-8,9-12,13-32,33-33,34-53,54-73,74-173,174-223,224-1247,1248-1347,1348-1447,1448-1497,1498-1505,1506-1525,1526-1545,1546-1565,1566-1585,1586-1685,1686-1705,1706-1725,1726-1739,1740-1753,1754-1758,1759-1764,1765-1778,1779-1792,1793-1806,1807-1820,1821-1910,1911-1913,1914-1916,1917-1917,1918-1922,1923-1927,1928-1932,1933-1937,1938-1942,1943-1947,1948-1951,1952-1957,1958-1963,1964-1979,1980-1981,1982-1991,1992-2001,2002-2011,2012-2021,2022-2031,2032-2041,2042-2051,2052-2061" />
            <!--
         p:columns="1-8, 9-12, 13-32, 33, 34-53, 54-73, 74-173, 
               174-223, 224-1247, 1248-1347, 1348-1447, 1448-1497, 1498-1505, 1506-1517, 1518-1529, 1530-1541, 1542-1553, 1554-1653" />
               -->
     </property>
      <property name="fieldSetMapper">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="message" value="cargaPersonas.itemReader.tokenizerError" />
      <property name="severidad" value="error" />
   </bean>

   <!-- Custom delimited writer -->
   <bean id="cargaPersonas.itemWriter" parent="batch.task.FlatFileItemWriter" scope="prototype">
      <property name="bindings" value="fileSystemResource=csvFilePersonas" />
      <property name="fieldSetCreator">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="lineAggregator">
         <bean parent="batch.transform.DelimitedLineAggregator" p:stringFields="4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,28,29,30,31,42,43,44,45,46,47" />
      </property>
      <property name="message" value="cargaPersonas.itemWriter" />
      <property name="severidad" value="error" />
      <property name="trim" value="true" />
   </bean>
   <!-- No delimited reader -->
   <bean id="cargaRelacion.itemReader" parent="batch.task.FlatFileItemReader" scope="prototype">
      <property name="bindings" value="fileSystemResource=txtFileRelacion" />
      <property name="recordSeparatorPolicy">
         <bean class="org.springframework.batch.item.file.separator.SimpleRecordSeparatorPolicy"/>
      </property>      
      <property name="lineTokenizer">
         <bean parent="batch.transform.FixedLengthTokenizer" p:columns="1-8, 9-12, 13-16, 17-26, 27-46, 47-56, 57-60" />
      </property>
      <property name="fieldSetMapper">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="message" value="cargaRelacion.itemReader.tokenizerError" />
      <property name="severidad" value="error" />
   </bean>
   
   <!-- Custom delimited writer -->
   <bean id="cargaRelacion.itemWriter" parent="batch.task.FlatFileItemWriter" scope="prototype">
      <property name="bindings" value="fileSystemResource=csvFileRelacion" />
      <property name="fieldSetCreator">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="lineAggregator">
         <bean parent="batch.transform.DelimitedLineAggregator" p:stringFields="0,5" />
      </property>
      <property name="message" value="cargaRelacion.itemWriter" />
      <property name="severidad" value="error" />
      <property name="trim" value="true" />
   </bean>
   
   <!-- No delimited reader -->
   <bean id="cargaDirecciones.itemReader" parent="batch.task.FlatFileItemReader" scope="prototype">
      <property name="bindings" value="fileSystemResource=txtFileDirecciones" />
      <property name="recordSeparatorPolicy">
         <bean class="org.springframework.batch.item.file.separator.SimpleRecordSeparatorPolicy"/>
      </property>      
      <property name="lineTokenizer">
         <bean parent="batch.transform.FixedLengthTokenizer"
            p:columns="1-8,9-12,13-32,33-52,53-152,153-252,253-262,263-272,273-282,283-292,293-302,303-312,313-412,413-512,513-612,613-622,623-632,633-642,643-652" />
      </property>
      <property name="fieldSetMapper">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="message" value="cargaDireccion.itemReader.tokenizerError" />
      <property name="severidad" value="error" />
   </bean>
   
   <!-- Custom delimited writer -->
   <bean id="cargaDirecciones.itemWriter" parent="batch.task.FlatFileItemWriter" scope="prototype">
      <property name="bindings" value="fileSystemResource=csvFileDirecciones" />
      <property name="fieldSetCreator">
         <bean parent="batch.mapper.PassThroughFieldSetMapper" />
      </property>
      <property name="lineAggregator">
         <bean parent="batch.transform.DelimitedLineAggregator" p:stringFields="4,5,6,7,8,9,10,12,13,14" />
      </property>
      <property name="message" value="cargaDireccion.itemWriter" />
      <property name="severidad" value="error" />
      <property name="trim" value="true" />
   </bean>
</beans>
