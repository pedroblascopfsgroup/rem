<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:si="http://www.springframework.org/schema/integration"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd 
                        http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-1.0.xsd 
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd"
	default-merge="true" default-autowire="byName">

	<!-- Sobreescribimos el batch.simpleJob para heredar de PFSStoppableSimpleJob en lugar de StoppableSimpleJob -->
	<bean id="batch.simpleJob" class="es.capgemini.pfs.batch.PFSStoppableSimpleJob" abstract="true">
		<property name="jobRepository" ref="batch.jobRepository" />
		<property name="restartable" value="true" />
	</bean>

    <bean id="alertasFileSourceGenerator" parent="batch.FolderFileSourceGenerator">
        <property name="inDir" value="${batch.alertas.in}" />
        <property name="filePattern" value="${batch.alertas.semaphore}" />
        <property name="period" value="${batch.alertas.period}" />
        <property name="channel" value="alertasFileInputChannel" />
        <property name="fileHandlerBeanName" value="alertasFileHandler" />
        <property name="fileHandlerMethodName" value="handle" />
        <property name="entityConcurrent" value="true" />
    </bean>

	<bean id="alertasFileHandler" class="es.capgemini.pfs.batch.load.alertas.AlertasFileHandler" scope="prototype">
		<property name="cronExpression" value="0 0/1 * * * ?" />
		<property name="window" value="1" />
		<property name="channel" value="alertasFileInputChannel" />
	</bean>

	<!-- Reinsert files Subscriptor -->
	<bean id="validacionAlertasQueueSubscriptor"  parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="validacionAlertasChannel" />
		<property name="beanName" value="validacionAlertasHandler" />
		<property name="methodName" value="handle" />
	</bean>

	<bean id="validacionAlertasHandler" class="es.capgemini.pfs.batch.load.alertas.ValidacionAlertasHandler" scope="prototype">
		<property name="channel" value="validacionAlertasChannel" />
	</bean>

	<!-- Subscribir un bean "pasajeProduccionHandler" por cada entidad al canal "pasajeProduccionChannel" -->
	<bean id="pasajeAlertasQueueSubscriptor" parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="pasajeAlertasProduccionChannel" />
		<property name="beanName" value="pasajeAlertasProduccionHandler" />
		<property name="methodName" value="handle" />
	</bean>


	<bean id="pasajeAlertasProduccionHandler"
		class="es.capgemini.pfs.batch.load.alertas.PasajeProduccionAlertasHandler"
		scope="prototype">
		<property name="channel" value="pasajeAlertasProduccionChannel" />
	</bean>

	<bean id="analizeAlertasQueueSubscriptor"
		parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="analizeAlertasProduccionChannel" />
		<property name="beanName" value="analizeAlertasProduccionHandler" />
		<property name="methodName" value="handle" />
	</bean>

	<bean id="analizeAlertasProduccionHandler"
		class="es.capgemini.pfs.batch.load.alertas.AnalizeAlertasProduccionHandler"
		scope="prototype">
		<property name="channel" value="analizeAlertasProduccionChannel" />
	</bean>

  <bean id="scoringBatchManager" class="es.capgemini.pfs.batch.scoring.ScoringBatchManager" />

  <bean id="scoringBatchDao" class="es.capgemini.pfs.batch.scoring.dao.impl.ScoringBatchDaoImpl">
    <property name="dataSource" ref="entityDataSource" />
    <property name="desactivarTotalesQuery">
      <bean parent="sql" p:key="scoring.desactivarTotales" />
    </property>
    <property name="crearRegistrosEnTablasTotalesQuery">
      <bean parent="sql" p:key="scoring.crearRegistrosEnTablasTotales" />
    </property>
    <property name="crearRegistrosEnTablasParcialesQuery">
      <bean parent="sql" p:key="scoring.crearRegistrosEnTablasParciales" />
    </property> 
    <property name="calcularPuntuacionTotalQuery">
      <bean parent="sql" p:key="scoring.calcularPuntuacionTotal" />
    </property>
    <property name="calcularRatingQuery">
      <bean parent="sql" p:key="scoring.calcularRating" />
    </property>           
    <property name="calcularRangoQuery">
      <bean parent="sql" p:key="scoring.calcularRango" />
    </property> 
    <property name="metricasValidasQuery">
      <bean parent="sql" p:key="ale-32.metricaValidas" />
    </property> 
    <property name="existeRangoQuery">
      <bean parent="sql" p:key="ale-31.existeRango" />
    </property>
    <property name="insertIncidencia" >
     	<bean parent="sql" p:key="insertIncidenciaAlerta"/>
    </property>  
  </bean>
</beans>