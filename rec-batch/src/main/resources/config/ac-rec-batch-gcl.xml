<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:si="http://www.springframework.org/schema/integration"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd 
                        http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-1.0.xsd 
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd"
	default-merge="true" default-autowire="byName">

	<!-- Sobreescribimos el batch.simpleJob para heredar de PFSStoppableSimpleJob en lugar de StoppableSimpleJob -->
	<bean id="batch.simpleJob" class="es.capgemini.pfs.batch.PFSStoppableSimpleJob" abstract="true">
		<property name="jobRepository" ref="batch.jobRepository" />
		<property name="restartable" value="true" />
	</bean>
	
	<bean id="gruposClientesFileSourceGenerator" parent="batch.FolderFileSourceGenerator">
        <property name="inDir" value="${batch.gcl.in}" />
        <property name="filePattern" value="${batch.gcl.semaphore}" />
        <property name="period" value="${batch.gcl.period}" />
        <property name="channel" value="GCLFileInputChannel" />
        <property name="fileHandlerBeanName" value="gruposClientesFileHandler" />
        <property name="fileHandlerMethodName" value="handle" />
        <property name="entityConcurrent" value="true" />
    </bean>

	<bean id="gruposClientesFileHandler" class="es.capgemini.pfs.batch.load.gcl.GruposClientesFileHandler" scope="prototype">
		<property name="channel" value="GCLFileInputChannel" />
	</bean>

	<!-- Reinsert files Subscriptor -->
	<bean id="validacionGCLQueueSubscriptor"  parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="validacionGCLChannel" />
		<property name="beanName" value="validacionGCLHandler" />
		<property name="methodName" value="handle" />
	</bean>

	<bean id="validacionGCLHandler" class="es.capgemini.pfs.batch.load.gcl.ValidacionGruposClientesHandler" scope="prototype">
		<property name="channel" value="validacionGCLChannel" />
	</bean>

	<!-- Subscribir un bean "pasajeProduccionHandler" por cada entidad al canal "pasajeProduccionChannel" -->
	<bean id="pasajeGCLQueueSubscriptor" parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="pasajeGCLProduccionChannel" />
		<property name="beanName" value="pasajeGCLProduccionHandler" />
		<property name="methodName" value="handle" />
	</bean>


	<bean id="pasajeGCLProduccionHandler"
		class="es.capgemini.pfs.batch.load.gcl.PasajeGruposClientesProduccionHandler"
		scope="prototype">
		<property name="channel" value="pasajeGCLProduccionChannel" />
	</bean>

</beans>