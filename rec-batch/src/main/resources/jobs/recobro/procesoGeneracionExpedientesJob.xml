<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"
	default-autowire="byName" default-merge="true">

	<bean id="procesoGeneracionExpedientesJob" parent="batch.simpleJob"
		scope="prototype">
		<property name="steps">
			<list>
				<bean parent="batch.taskletStep" scope="prototype">
					<property name="tasklet">
						<bean parent="batch.task.MultipleSqlScript" p:dataSource-ref="entityDataSource">
							<property name="scripts">
								<!-- Lista de scripts SQL ha ejecutar -->
								<list>
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.idxdrop.jobGeneracionExpedientes.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.idxdrop.jobGeneracionExpedientes" />
										<entry key="severidad" value="error" />
									</map>
									
									<!-- PASO 1 - TRUNCADO DE TABLAS TEMPORALES Y DE INTERFACES DE SALIDA -->
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.truncate.batch_datos_salida.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.truncate.batch_datos_salida" />
										<entry key="severidad" value="error" />
									</map>
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.truncate.tmp_rec_cnt_libres_arq_rec_ext.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.truncate.tmp_rec_cnt_libres_arq_rec_ext" />
										<entry key="severidad" value="error" />
									</map>
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.borrado.tmp_per_arquetipo.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.borrado.tmp_per_arquetipo" />
										<entry key="severidad" value="error" />
									</map>	
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.borrado.tmp_per_filtradas.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.borrado.tmp_per_filtradas" />
										<entry key="severidad" value="error" />
									</map>	
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.borrado.tmp_cnt_per_validas.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.borrado.tmp_cnt_per_validas" />
										<entry key="severidad" value="error" />
									</map>											
							
										<!-- PASO 2 - CARGAMOS LA TABLA TMP_REC_CNT_LIBRES_ARQ_REC_EXT A PARTIR DE LA TABLA TMP_REC_CNT_LIBRES_ARQ_REC -->																	
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.insert.tmp_rec_cnt_libres_arq_rec_ext.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.insert.tmp_rec_cnt_libres_arq_rec_ext" />
										<entry key="severidad" value="error" />
									</map>
									
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.idxcreate.tmp_rec_cnt_libres_arq_rec_ext.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.idxcreate.tmp_rec_cnt_libres_arq_rec_ext" />
										<entry key="severidad" value="error" />
									</map>
									
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.insert.tmp_per_arquetipo.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.insert.tmp_per_arquetipo" />
										<entry key="severidad" value="error" />
									</map>
									
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.insert.tmp_per_filtradas.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.insert.tmp_per_filtradas" />
										<entry key="severidad" value="error" />
									</map>
									
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.idxcreate.tmp_per_filtradas.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.idxcreate.tmp_per_filtradas" />
										<entry key="severidad" value="error" />
									</map>
									
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.insert.tmp_cnt_per_validas.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.insert.tmp_cnt_per_validas" />
										<entry key="severidad" value="error" />
									</map>
									
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.idxcreate.tmp_cnt_per_validas.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.idxcreate.tmp_cnt_per_validas" />
										<entry key="severidad" value="error" />
									</map>
									
									<!-- PASO 3 - EJECUTAMOS EL PL/SQL DEL PROCESO DE CREACIÃ“N DE EXPEDIENTES -->									
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.insert.batch_datos_salida.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.insert.batch_datos_salida" />
										<entry key="severidad" value="error" />
									</map>
									<map>
										<entry key="sql">
											<bean parent="sql"
												p:key="recobro.idxcreate.batch_datos_salida.${entity.dialect}" />
										</entry>
										<entry key="message" value="recobro.idxcreate.batch_datos_salida" />
										<entry key="severidad" value="error" />
									</map>																			
								</list>
							</property>
						</bean>
					</property>
				</bean>
			</list>
		</property>
	</bean>
</beans>