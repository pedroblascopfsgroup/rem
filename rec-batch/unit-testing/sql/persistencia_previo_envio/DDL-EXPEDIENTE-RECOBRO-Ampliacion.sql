set verify off;

define MASTER_SCHEMA = &Introduce_el_master_schema;

CREATE TABLE DD_TPX_TIPO_EXPEDIENTE (
   DD_TPX_ID                    NUMBER(16)                 NOT NULL,        
   DD_TPX_CODIGO                VARCHAR2(20 CHAR)          NOT NULL,
   DD_TPX_DESCRIPCION           VARCHAR2(100 CHAR),
   DD_TPX_DESCRIPCION_LARGA     VARCHAR2(250 CHAR),
   VERSION                      INTEGER DEFAULT 0          NOT NULL,
   USUARIOCREAR                 VARCHAR2(10 CHAR)          NOT NULL,
   FECHACREAR                   TIMESTAMP(6)               NOT NULL,
   USUARIOMODIFICAR             VARCHAR2(10 CHAR),
   FECHAMODIFICAR               TIMESTAMP(6),
   USUARIOBORRAR                VARCHAR2(10 CHAR),
   FECHABORRAR                  TIMESTAMP(6),
   BORRADO                      NUMBER(1)  DEFAULT 0       NOT NULL,
   CONSTRAINT PK_DD_TPX PRIMARY KEY (DD_TPX_ID),
   CONSTRAINT UK_DD_TPX_CODIGO UNIQUE (DD_TPX_CODIGO)
);

ALTER TABLE EXP_EXPEDIENTES ADD (
 DD_TPX_ID NUMBER(16)
);

ALTER TABLE EXP_EXPEDIENTES ADD CONSTRAINT
    FK_EXP_TPX FOREIGN KEY (DD_TPX_ID) REFERENCES DD_TPX_TIPO_EXPEDIENTE (DD_TPX_ID);
    
    
CREATE TABLE EXP_EXPEDIENTES_REC (
  EXP_ID     NUMBER(16)                             NOT NULL,  
  CONSTRAINT PK_EXP_REC PRIMARY KEY (EXP_ID),
  CONSTRAINT FK_EXP_REC FOREIGN KEY (EXP_ID) REFERENCES EXP_EXPEDIENTES (EXP_ID)
);

CREATE TABLE CEX_CONTRATOS_EXPEDIENTE_REC  (
  CEX_ID     NUMBER(16)                             NOT NULL,  
  CONSTRAINT PK_CEX_REC PRIMARY KEY (CEX_ID),
  CONSTRAINT FK_CEX_REC FOREIGN KEY (CEX_ID) REFERENCES CEX_CONTRATOS_EXPEDIENTE (CEX_ID)
 );

CREATE TABLE PEX_PERSONAS_EXPEDIENTE_REC  (
  PEX_ID     NUMBER(16)                             NOT NULL,  
  CONSTRAINT PK_PEX_REC PRIMARY KEY (PEX_ID),
  CONSTRAINT FK_PEX_REC FOREIGN KEY (PEX_ID) REFERENCES PEX_PERSONAS_EXPEDIENTE (PEX_ID)
 );
 
CREATE TABLE CDE_CICLO_DEUDA_EXP (
  CDE_ID                    NUMBER(16)        NOT NULL,  
  EXP_ID                    NUMBER(16)        NOT NULL,  
  CDE_FECHA_ALTA            TIMESTAMP(6),
  CDE_FECHA_BAJA            TIMESTAMP(6),
  RCF_ESQ_ID                NUMBER(16)        NOT NULL,   
  RCF_ESC_ID                NUMBER(16)        NOT NULL,
  RCF_SCA_ID                NUMBER(16)        NOT NULL,  
  RCF_SUA_ID                NUMBER(16)        NOT NULL,  
  RCF_AGE_ID                NUMBER(16,2)      NOT NULL,  
  CDE_POS_VIVA_NO_VENCIDA   NUMBER(16,2),  
  CDE_POS_VIVA_VENCIDA      NUMBER(16,2),  
  CDE_INT_ORDIN_DEVEN       NUMBER(16,2),  
  CDE_INT_MORAT_DEVEN       NUMBER(16,2),  
  CDE_COMISIONES            NUMBER(16,2),  
  CDE_GASTOS                NUMBER(16,2),  
  CDE_IMPUESTOS             NUMBER(16,2),  
  VERSION                   INTEGER           DEFAULT 0 NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)           NOT NULL,
  FECHACREAR                TIMESTAMP(6)                NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)         DEFAULT 0 NOT NULL,
  CONSTRAINT PK_CDE PRIMARY KEY (CDE_ID),
  CONSTRAINT FK_CDE_EXP FOREIGN KEY (EXP_ID) REFERENCES EXP_EXPEDIENTES_REC (EXP_ID)
);

CREATE TABLE CDC_CICLO_DEUDA_CEX (
  CDC_ID                    NUMBER(16)        NOT NULL,  
  CEX_ID                    NUMBER(16)        NOT NULL,  
  CDE_ID                    NUMBER (16)       NOT NULL, 
  DD_MOB_ID                 NUMBER(16),   
  CDC_ID_ENVIO              NUMBER(16),
  EXC_ID                    NUMBER(16),
  CDC_FECHA_ALTA            TIMESTAMP(6),
  CDC_FECHA_BAJA            TIMESTAMP(6),
  CDC_POS_VIVA_NO_VENCIDA   NUMBER(16,2),  
  CDC_POS_VIVA_VENCIDA      NUMBER(16,2),  
  CDC_INT_ORDIN_DEVEN       NUMBER(16,2),  
  CDC_INT_MORAT_DEVEN       NUMBER(16,2),  
  CDC_COMISIONES            NUMBER(16,2),  
  CDC_GASTOS                NUMBER(16,2),  
  CDC_IMPUESTOS             NUMBER(16,2),  
  VERSION                   INTEGER           DEFAULT 0 NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)           NOT NULL,
  FECHACREAR                TIMESTAMP(6)                NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)         DEFAULT 0 NOT NULL,
  CONSTRAINT PK_CDC PRIMARY KEY (CDC_ID),
  CONSTRAINT FK_CDC_CEX FOREIGN KEY (CEX_ID) REFERENCES CEX_CONTRATOS_EXPEDIENTE_REC (CEX_ID),
  CONSTRAINT FK_CDC_CDE FOREIGN KEY (CDE_ID) REFERENCES CDE_CICLO_DEUDA_EXP (CDE_ID),
  CONSTRAINT FK_CDC_MOB FOREIGN KEY (DD_MOB_ID) REFERENCES &MASTER_SCHEMA..DD_MOB_MOTIVOS_BAJA (DD_MOB_ID),
  CONSTRAINT FK_CDC_EXC FOREIGN KEY (EXC_ID) REFERENCES EXC_EXCEPTUACION (EXC_ID)
);

CREATE TABLE CDP_CICLO_DEUDA_PEX (
  CDP_ID                    NUMBER(16)        NOT NULL,  
  PEX_ID                    NUMBER(16)        NOT NULL,  
  CDE_ID                    NUMBER (16)       NOT NULL, 
  DD_MOB_ID                 NUMBER(16),   
  EXC_ID                    NUMBER(16),
  CDP_FECHA_ALTA            TIMESTAMP(6),
  CDP_FECHA_BAJA            TIMESTAMP(6),
  CDP_RIESGO_DIRECTO        NUMBER(16,2),  
  CDP_RIESGO_INDIRECTO      NUMBER(16,2),  
  VERSION                   INTEGER           DEFAULT 0 NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)           NOT NULL,
  FECHACREAR                TIMESTAMP(6)                NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)         DEFAULT 0 NOT NULL,
  CONSTRAINT PK_CDP PRIMARY KEY (CDP_ID),
  CONSTRAINT FK_CDP_PEX FOREIGN KEY (PEX_ID) REFERENCES PEX_PERSONAS_EXPEDIENTE_REC (PEX_ID),
  CONSTRAINT FK_CDP_EPX FOREIGN KEY (CDE_ID) REFERENCES CDE_CICLO_DEUDA_EXP (CDE_ID),
  CONSTRAINT FK_CDP_MOB FOREIGN KEY (DD_MOB_ID) REFERENCES &MASTER_SCHEMA..DD_MOB_MOTIVOS_BAJA (DD_MOB_ID)
);

CREATE SEQUENCE S_CDE_CICLO_DEUDA_EXP;

CREATE SEQUENCE S_CDC_CICLO_DEUDA_CEX;

CREATE SEQUENCE S_CDP_CICLO_DEUDA_PEX;