DECLARE

 LAST_DESPACHO_ID NUMBER(16,0);
 LAST_USUARIO_ID NUMBER(16,0);
 VAR_USERNAME VARCHAR(50 CHAR) := 'GESTOREDP';
 VAR_PASSWORD VARCHAR(50 CHAR) := '1234';
 VAR_NOMBRE_USU VARCHAR(50 CHAR) := 'GESTOR EDP';
 VAR_NOMBRE_GESTORIA VARCHAR(50 CHAR) := 'Gestor√≠a EDP';
 VAR_CODIGO_TIPO_DESPACHO VARCHAR(50 CHAR) := '3';
 
BEGIN


--Creo UN DESPACHO DE TIPO EDP
LAST_DESPACHO_ID := S_DES_DESPACHO_EXTERNO.nextval;
Insert into BANK01.DES_DESPACHO_EXTERNO (
DES_ID,DES_DESPACHO,VERSION,
USUARIOCREAR,FECHACREAR,USUARIOMODIFICAR,FECHAMODIFICAR,BORRADO,
ZON_ID,DD_TDE_ID) 
values (
LAST_DESPACHO_ID,VAR_NOMBRE_GESTORIA,'1',
'BANKMASTER',sysdate,'BANKMASTER',sysdate, 0,
12501,(select dd_tde_id from bankmaster.DD_TDE_TIPO_DESPACHO where DD_TDE_CODIGO=VAR_CODIGO_TIPO_DESPACHO));

-- CREAMOS UN USUARIO PARA EL DESPACHO EDP
LAST_USUARIO_ID := BANKMASTER.S_USU_USUARIOS.nextval;
INSERT INTO BANKMASTER.USU_USUARIOS (
        USU_ID, ENTIDAD_ID, USU_USERNAME, USU_PASSWORD,
        USU_NOMBRE, USU_APELLIDO1, USU_APELLIDO2, USU_TELEFONO, USU_MAIL,
        VERSION, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR,
        USU_EXTERNO, USU_FECHA_VIGENCIA_PASS,
        USU_GRUPO, USU_FECHA_EXTRACCION,USU_BAJA_LDAP, BORRADO, USUARIOBORRAR, FECHABORRAR)
VALUES (LAST_USUARIO_ID, 1, VAR_USERNAME, VAR_PASSWORD,
        VAR_NOMBRE_USU, 'ape1', 'ape2', '111111111', 'my@email.com',
        0, 'ETL',sysdate,'ETL',sysdate,
        1,'19/10/10',
        0,sysdate,0,0,NULL,NULL);
        
-- CREAMOS LA RELACION ENTRE USUARIO Y DESPACHO CREADO
Insert into BANK01.usd_usuarios_despachos (
USD_ID,USU_ID,DES_ID,
USD_GESTOR_DEFECTO,USD_SUPERVISOR,VERSION,
USUARIOCREAR,FECHACREAR,USUARIOMODIFICAR,FECHAMODIFICAR,USUARIOBORRAR,FECHABORRAR,BORRADO) 
values (
s_usd_usuarios_despachos.nextval,LAST_USUARIO_ID,LAST_DESPACHO_ID,
1,0,0,
'BANKMASTER',sysdate,'BANKMASTER',sysdate,null,null,0);

-- INSERTA EL USUARIO EN UNA ZONA
INSERT INTO BANK01.ZON_PEF_USU (ZON_ID,PEF_ID,USU_ID, ZPU_ID,
VERSION,USUARIOCREAR,FECHACREAR,USUARIOMODIFICAR,FECHAMODIFICAR,USUARIOBORRAR,FECHABORRAR,BORRADO,ZPU_FECHA_EXTRACCION)
VALUES (
(SELECT ZON_ID FROM ZON_ZONIFICACION WHERE ZON_COD='01'), 10000000000701, LAST_USUARIO_ID, BANK01.S_ZON_PEF_USU.nextVal,
0,'BANKMASTER', sysdate, 'BANKMASTER', sysdate, NULL, NULL, 0, null);

END;

/


-- Refrescamos la vista de tareas asignadas a usuarios.
begin
DBMS_MVIEW.REFRESH ('vtar_asu_vs_usu');
end;
