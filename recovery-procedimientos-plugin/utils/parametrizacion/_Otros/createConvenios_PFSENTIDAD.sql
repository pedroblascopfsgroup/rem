      
/*==============================================================*/
/* Table: CRE_PRC_CEX    1 a N con PRC_CEX					            */
/* Creditos defindidos para cada contrato asociado al 					*/
/* procedimiento 																								*/
/*==============================================================*/

CREATE SEQUENCE S_CRE_PRC_CEX;

CREATE TABLE CRE_PRC_CEX  (
   CRE_CEX_ID					  	 NUMBER(16)					NOT NULL,
   CRE_PRC_CEX_PRCID				 NUMBER(16)					NOT NULL,
   CRE_PRC_CEX_CEXID				 NUMBER(16)					NOT NULL,
   TPO_CNT_ID_EXT					 NUMBER(16),
   CRE_PRINCIPAL_EXT				 NUMBER(16,2),
   TPO_CNT_ID_SUP					 NUMBER(16),
   CRE_PRINCIPAL_SUP				 NUMBER(16,2),
   TPO_CNT_ID_FINAL 				 NUMBER(16),
   CRE_PRINCIPAL_FINAL			 	 NUMBER(16,2),
   STD_CRE_ID								 NUMBER(16),
   VERSION                   INTEGER         DEFAULT 0  		NOT NULL,
   USUARIOCREAR              VARCHAR2(10 BYTE)   				NOT NULL,
   FECHACREAR                TIMESTAMP(6)        				NOT NULL,
   USUARIOMODIFICAR          VARCHAR2(10 BYTE),
   FECHAMODIFICAR            TIMESTAMP(6),
   USUARIOBORRAR             VARCHAR2(10 BYTE),
   FECHABORRAR               TIMESTAMP(6),
   BORRADO                   NUMBER(1)       DEFAULT 0			NOT NULL,   
   CONSTRAINT PK_CRE_CEX_ID PRIMARY KEY (CRE_CEX_ID)
   
);	/* la clave principal de PRC_CEX es doble (COC_PRC_CEX_PRCID, COC_PRC_CEX_CEXID) */

ALTER TABLE CRE_PRC_CEX
   ADD CONSTRAINT FK_CRE_PRC_CEX_FK_PRC_CEX FOREIGN KEY (CRE_PRC_CEX_PRCID, CRE_PRC_CEX_CEXID)
      REFERENCES PRC_CEX (PRC_ID, CEX_ID);

ALTER TABLE CRE_PRC_CEX
   ADD CONSTRAINT FK_CRE_FK_TPO_CREDITO_FINAL FOREIGN KEY (TPO_CNT_ID_FINAL)
      REFERENCES PFSMASTER.DD_TPO_CREDITO (CRE_ID);    
      
ALTER TABLE CRE_PRC_CEX
   ADD CONSTRAINT FK_CRE_FK_TPO_CREDITO_EXT FOREIGN KEY (TPO_CNT_ID_EXT)
      REFERENCES PFSMASTER.DD_TPO_CREDITO (CRE_ID);    
      
ALTER TABLE CRE_PRC_CEX
   ADD CONSTRAINT FK_CRE_FK_TPO_CREDITO_SUP FOREIGN KEY (TPO_CNT_ID_SUP)
      REFERENCES PFSMASTER.DD_TPO_CREDITO (CRE_ID);    
     
ALTER TABLE CRE_PRC_CEX
   ADD CONSTRAINT FK_CRE_FK_STD_CREDITO FOREIGN KEY (STD_CRE_ID)
      REFERENCES PFSMASTER.DD_STD_CREDITO (STD_CRE_ID);  
      
     
/*==============================================================*/
/* Table: COV_CONVENIOS	1 a N con procedimientos    					  */
/* Convenios definidos dentro de un procedimiento 							*/
/* y para un concurso determinado																*/
/*==============================================================*/

CREATE SEQUENCE S_COV_CONVENIOS;

CREATE TABLE COV_CONVENIOS  (
   COV_ID					NUMBER(16)							NOT NULL,
   PRC_ID					NUMBER(16)							NOT NULL,
   COV_FECHA				TIMESTAMP							NOT NULL,
   COV_NUMPROPONENTES		NUMBER(16)							,
   COV_TOTALMASA			NUMBER(16,2)						NOT NULL,
   COV_PORCENTAJE			NUMBER(16,2)						,
   DD_COV_TIPO_ID			NUMBER(16)							NOT NULL,
   DD_COV_INCIO_ID			NUMBER(16)							,
   DD_COV_ESTADO_ID			NUMBER(16)							,
   DD_COV_POSTURA_ID		NUMBER(16)							,
   DD_COV_ADHERIRSE_ID		NUMBER(16)							,
   COV_OBSERVACIONES		VARCHAR2(250)						,
   COV_DES_TERCEROS			VARCHAR2(250)						,
   COV_DES_ANTICIPADO		VARCHAR2(250)						,
   COV_DES_ADHESIONES		VARCHAR2(250)						,
   VERSION              INTEGER   				  DEFAULT 0  	NOT NULL,
   USUARIOCREAR         VARCHAR2(10 BYTE)   					NOT NULL,
   FECHACREAR           TIMESTAMP(6)        					NOT NULL,
   USUARIOMODIFICAR     VARCHAR2(10 BYTE),
   FECHAMODIFICAR       TIMESTAMP(6),
   USUARIOBORRAR        VARCHAR2(10 BYTE),
   FECHABORRAR          TIMESTAMP(6),
   BORRADO                   NUMBER(1)       DEFAULT 0	NOT NULL,
   CONSTRAINT PK_COV_CONVENIOS PRIMARY KEY (COV_ID)
);	
/* la calve tambien podría ser PRC_ID - PRC_COD_PROC_EN_JUZGADO que nos indica el auto */

ALTER TABLE COV_CONVENIOS
   ADD CONSTRAINT FK_COV_CONVENIOS_FK_ASUNTOS FOREIGN KEY (PRC_ID)
      REFERENCES PRC_PROCEDIMIENTOS (PRC_ID);
 
 ALTER TABLE COV_CONVENIOS
   ADD CONSTRAINT FK_COV_CONVENIOS_FK_TIPOESTADO FOREIGN KEY (DD_COV_ESTADO_ID)
      REFERENCES PFSMASTER.DD_ESTADO_CONVENIO (ESTCONV_ID);     
      
 ALTER TABLE COV_CONVENIOS
   ADD CONSTRAINT FK_COV_CONVENIOS_FK_POSTURA FOREIGN KEY (DD_COV_POSTURA_ID)
      REFERENCES PFSMASTER.DD_CONVENIO_POSTURA (POS_ID);  
      
  ALTER TABLE COV_CONVENIOS
   ADD CONSTRAINT FK_COV_CONVENIOS_FK_INICIO FOREIGN KEY (DD_COV_INCIO_ID)
      REFERENCES PFSMASTER.DD_CONVENIO_INICIO(INI_ID);     
        
  ALTER TABLE COV_CONVENIOS
   ADD CONSTRAINT FK_COV_CONVENIOS_FK_TIPO FOREIGN KEY (DD_COV_TIPO_ID)
      REFERENCES PFSMASTER.DD_CONVENIO_TIPO(TPO_COV_ID); 

  ALTER TABLE COV_CONVENIOS
   ADD CONSTRAINT FK_COV_CONVENIOS_FK_DD_SINO FOREIGN KEY (DD_COV_ADHERIRSE_ID)
      REFERENCES PFSMASTER.DD_SIN_SINO(DD_SIN_ID);    
                  
                  
/*==============================================================*/
/* Table: 	COV_CONVENIOS_CREDITOS nos indica 									*/
/* los creditos que aparecen en cada convenio		  							*/
/*==============================================================*/


CREATE SEQUENCE S_COV_CONVENIOS_CREDITOS;

CREATE TABLE COV_CONVENIOS_CREDITOS  (
   COVCRE_ID 				 NUMBER(16)						NOT NULL,
   COV_ID					 NUMBER(16)						NOT NULL,
   CRE_CEX_ID				 NUMBER(16)						NOT NULL,
   COVCRE_QUITA				 NUMBER(16,2),
   COVCRE_ESPERA			 NUMBER(16,2),
   COVCRE_COMENTARIO		 VARCHAR2(250),
   VERSION                   INTEGER         DEFAULT 0  	NOT NULL,
   USUARIOCREAR              VARCHAR2(10 BYTE)   			NOT NULL,
   FECHACREAR                TIMESTAMP(6)        			NOT NULL,
   USUARIOMODIFICAR          VARCHAR2(10 BYTE),
   FECHAMODIFICAR            TIMESTAMP(6),
   USUARIOBORRAR             VARCHAR2(10 BYTE),
   FECHABORRAR               TIMESTAMP(6),
   BORRADO                   NUMBER(1)       DEFAULT 0		NOT NULL,   
   CONSTRAINT PK_COV_CONVENIOS_CREDITOS PRIMARY KEY (COVCRE_ID)
);	

ALTER TABLE COV_CONVENIOS_CREDITOS
   ADD CONSTRAINT FK_COVCRE_FK_CONVENIOS FOREIGN KEY (COV_ID)
      REFERENCES COV_CONVENIOS (COV_ID)
      ON DELETE CASCADE;

ALTER TABLE COV_CONVENIOS_CREDITOS
   ADD CONSTRAINT FK_COVCRE_FK_CREDITOS FOREIGN KEY (CRE_CEX_ID)
      REFERENCES CRE_PRC_CEX (CRE_CEX_ID)
      ON DELETE CASCADE;     
      
  