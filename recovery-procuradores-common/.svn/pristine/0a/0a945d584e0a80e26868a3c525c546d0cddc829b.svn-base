package es.pfsgroup.plugin.recovery.procuradores.recordatorio.dao.impl;

import org.springframework.stereotype.Repository;

import es.capgemini.devon.pagination.Page;
import es.capgemini.pfs.dao.AbstractEntityDao;
import es.pfsgroup.commons.utils.HQLBuilder;
import es.pfsgroup.commons.utils.HibernateQueryUtils;
import es.pfsgroup.plugin.recovery.procuradores.recordatorio.dao.RECRecordatorioDao;
import es.pfsgroup.plugin.recovery.procuradores.recordatorio.dto.RECRecordatorioDto;
import es.pfsgroup.plugin.recovery.procuradores.recordatorio.model.RECRecordatorio;

@Repository("RECRecordatorioDao")
public class RECRecordatorioDaoImpl extends AbstractEntityDao<RECRecordatorio, Long> implements RECRecordatorioDao{


	@Override
	public Page getListaRecordatorios(RECRecordatorioDto dto) {
		
		HQLBuilder hb = new HQLBuilder(" from RECRecordatorio rec ");
		HQLBuilder.addFiltroLikeSiNotNull(hb, "rec.titulo", dto.getTitulo(), true);
		HQLBuilder.addFiltroIgualQueSiNotNull(hb, "rec.open", dto.getOpen());
		hb.orderBy("rec.fecha", HQLBuilder.ORDER_DESC );

		return HibernateQueryUtils.page(this, hb, dto);
		
	}

	@Override
	public RECRecordatorio getRecRecordatorio(Long idRecordatorio) {
		
		HQLBuilder hb = new HQLBuilder(" from RECRecordatorio rec ");
		HQLBuilder.addFiltroLikeSiNotNull(hb, "rec.id", idRecordatorio, true);
		
		return HibernateQueryUtils.uniqueResult(this, hb);
	}

	@Override
	public Long getCountListadoRecordatorios(Long idUsuario) {
		
		HQLBuilder hb = new HQLBuilder(" from RECRecordatorio rec ");
		HQLBuilder.addFiltroLikeSiNotNull(hb, "rec.usuario", idUsuario, true);
		HQLBuilder.addFiltroIgualQue(hb, "rec.open", true);

		return (long) HibernateQueryUtils.list(this, hb).size();
	}
	
}
