whenever sqlerror exit sql.sqlcode;
-- ##########################################
-- ## Author: Javier Ruiz
-- ## Finalidad: Agregar campos de importes intermedios
-- ## en el proceso de facturacion y agrupaci√≥n por Agencia
-- ## 
-- ## INSTRUCCIONES:
-- ## VERSIONES:
-- ##        1.0 Version inicial
-- ##########################################

DECLARE
    -- Vble. para validar la existencia de las Tablas.
    table_count number(3);
    -- Querys
    query_body varchar (30048);
BEGIN

 	select count(1) into table_count from all_tables WHERE table_name='TMP_RECOBRO_DETALLE_FACTURA';
	if table_count = 1 then
		-- Como son campos no nullables, primero hay que truncar la tabla
		query_body := 'TRUNCATE TABLE BANK01.TMP_RECOBRO_DETALLE_FACTURA';
		EXECUTE IMMEDIATE query_body;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_CONCEP_FACTU' AND TABLE_NAME = 'TMP_RECOBRO_DETALLE_FACTURA';
    if table_count = 0 then
      query_body := 'ALTER TABLE BANK01.TMP_RECOBRO_DETALLE_FACTURA 
					ADD (RDF_IMP_CONCEP_FACTU NUMBER(16, 2) NOT NULL)';
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
					
    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_REAL_FACTU' AND TABLE_NAME = 'TMP_RECOBRO_DETALLE_FACTURA';
    if table_count = 0 then          
      query_body := 'ALTER TABLE BANK01.TMP_RECOBRO_DETALLE_FACTURA 
						ADD (RDF_IMP_REAL_FACTU NUMBER(16, 2) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
	
	end if;	
	
 	select count(1) into table_count from all_tables WHERE table_name='H_RECOBRO_DETALLE_FACTURA';
	if table_count = 1 then
		-- Como son campos no nullables, primero hay que truncar la tabla
		query_body := 'TRUNCATE TABLE BANK01.H_RECOBRO_DETALLE_FACTURA';
		EXECUTE IMMEDIATE query_body;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_CONCEP_FACTU' AND TABLE_NAME = 'H_RECOBRO_DETALLE_FACTURA';
    if table_count = 0 then
      query_body := 'ALTER TABLE BANK01.H_RECOBRO_DETALLE_FACTURA 
					ADD (RDF_IMP_CONCEP_FACTU NUMBER(16, 2) NOT NULL)';
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
					
    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_REAL_FACTU' AND TABLE_NAME = 'H_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
      query_body := 'ALTER TABLE BANK01.H_RECOBRO_DETALLE_FACTURA 
						ADD (RDF_IMP_REAL_FACTU NUMBER(16, 2) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
	
	end if;	
	
 	select count(1) into table_count from all_tables WHERE table_name='TMP_RECOBRO_DETALLE_FACTURA_CO';
	if table_count = 1 then
		-- Como son campos no nullables, primero hay que truncar la tabla
		query_body := 'TRUNCATE TABLE BANK01.TMP_RECOBRO_DETALLE_FACTURA_CO';
		EXECUTE IMMEDIATE query_body;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_CONCEP_FACTU' AND TABLE_NAME = 'TMP_RECOBRO_DETALLE_FACTURA_CO';
    IF TABLE_COUNT = 0 THEN
      query_body := 'ALTER TABLE BANK01.TMP_RECOBRO_DETALLE_FACTURA_CO 
					ADD (RDF_IMP_CONCEP_FACTU NUMBER(16, 2) NOT NULL)';
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
					
    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_REAL_FACTU' AND TABLE_NAME = 'TMP_RECOBRO_DETALLE_FACTURA_CO';
    IF TABLE_COUNT = 0 THEN
  		query_body := 'ALTER TABLE BANK01.TMP_RECOBRO_DETALLE_FACTURA_CO 
						ADD (RDF_IMP_REAL_FACTU NUMBER(16, 2) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
	
	end if;	
	
 	select count(1) into table_count from all_tables WHERE table_name='H_RECOBRO_DETALLE_FACTURA_CO';
	if table_count = 1 then
		-- Como son campos no nullables, primero hay que truncar la tabla
		query_body := 'TRUNCATE TABLE BANK01.H_RECOBRO_DETALLE_FACTURA_CO';
		EXECUTE IMMEDIATE query_body;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_CONCEP_FACTU' AND TABLE_NAME = 'H_RECOBRO_DETALLE_FACTURA_CO';
    IF TABLE_COUNT = 0 THEN
  		query_body := 'ALTER TABLE BANK01.H_RECOBRO_DETALLE_FACTURA_CO 
					ADD (RDF_IMP_CONCEP_FACTU NUMBER(16, 2) NOT NULL)';
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_REAL_FACTU' AND TABLE_NAME = 'H_RECOBRO_DETALLE_FACTURA_CO';
    IF TABLE_COUNT = 0 THEN
  		query_body := 'ALTER TABLE BANK01.H_RECOBRO_DETALLE_FACTURA_CO 
						ADD (RDF_IMP_REAL_FACTU NUMBER(16, 2) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
	
	end if;	
	
 	select count(1) into table_count from all_tables WHERE table_name='RDF_RECOBRO_DETALLE_FACTURA';
	if table_count = 1 then
		-- Como son campos no nullables, primero hay que truncar la tabla
		query_body := 'TRUNCATE TABLE BANK01.RDF_RECOBRO_DETALLE_FACTURA';
		EXECUTE IMMEDIATE query_body;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_CONCEP_FACTU' AND TABLE_NAME = 'RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
      query_body := 'ALTER TABLE BANK01.RDF_RECOBRO_DETALLE_FACTURA 
					ADD (RDF_IMP_CONCEP_FACTU NUMBER(16, 2) NOT NULL)';
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
					
    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_REAL_FACTU' AND TABLE_NAME = 'RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
  		QUERY_BODY := 'ALTER TABLE BANK01.RDF_RECOBRO_DETALLE_FACTURA 
						ADD (RDF_IMP_REAL_FACTU NUMBER(16, 2) NOT NULL)'; 
    	EXECUTE IMMEDIATE query_body;
    end if;
		
    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RCF_SCA_ID' AND TABLE_NAME = 'RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
  		query_body := 'ALTER TABLE BANK01.RDF_RECOBRO_DETALLE_FACTURA 
						ADD (RCF_SCA_ID NUMBER(16, 0) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;		
    end if;
		
    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RCF_AGE_ID' AND TABLE_NAME = 'RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
      query_body := 'ALTER TABLE BANK01.RDF_RECOBRO_DETALLE_FACTURA 
						ADD (RCF_AGE_ID NUMBER(16, 0) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;
	
	end if;	
	
 	select count(1) into table_count from all_tables WHERE table_name='H_RDF_RECOBRO_DETALLE_FACTURA';
	if table_count = 1 then
		-- Como son campos no nullables, primero hay que truncar la tabla
		query_body := 'TRUNCATE TABLE BANK01.H_RDF_RECOBRO_DETALLE_FACTURA';
		EXECUTE IMMEDIATE query_body;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_CONCEP_FACTU' AND TABLE_NAME = 'H_RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
      query_body := 'ALTER TABLE BANK01.H_RDF_RECOBRO_DETALLE_FACTURA 
					ADD (RDF_IMP_CONCEP_FACTU NUMBER(16, 2) NOT NULL)';
      EXECUTE IMMEDIATE query_body;
    end if;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RDF_IMP_REAL_FACTU' AND TABLE_NAME = 'H_RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
      query_body := 'ALTER TABLE BANK01.H_RDF_RECOBRO_DETALLE_FACTURA 
						ADD (RDF_IMP_REAL_FACTU NUMBER(16, 2) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;
    end if;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RCF_SCA_ID' AND TABLE_NAME = 'H_RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN
      query_body := 'ALTER TABLE BANK01.H_RDF_RECOBRO_DETALLE_FACTURA 
              ADD (RCF_SCA_ID NUMBER(16, 0) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;		
    end if;

    SELECT COUNT(1) INTO TABLE_COUNT FROM USER_TAB_COLS WHERE COLUMN_NAME = 'RCF_AGE_ID' AND TABLE_NAME = 'H_RDF_RECOBRO_DETALLE_FACTURA';
    IF TABLE_COUNT = 0 THEN		
  		QUERY_BODY := 'ALTER TABLE BANK01.H_RDF_RECOBRO_DETALLE_FACTURA 
						ADD (RCF_AGE_ID NUMBER(16, 0) NOT NULL)'; 
      EXECUTE IMMEDIATE QUERY_BODY;		
    end if;
	
	end if;	
	
	COMMIT;
	
END;
/
exit