<?xml version="1.0" encoding="UTF-8"?>

<process-definition xmlns="urn:jbpm.org:jpdl-3.2" name="activo_tramiteSancionOfertaApple">

	<start-state name="inicio">
		<transition to="T017_DefinicionOferta"></transition>
	</start-state>
	<state name="T017_DefinicionOferta">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_DefinicionOfertaDecision" name="avanzaBPM"></transition>
	</state> 
	<decision name ="T017_DefinicionOfertaDecision" expression="#{T017_DefinicionOfertaDecision}">
        <transition to="T017_ResolucionCES" name="noMayorista"></transition>
		<transition to="T017_PBC_CN" name="mayorista"></transition>
	</decision>
	
	<state name="T017_PBC_CN">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_PBC_CNDecision" name="avanzaBPM"></transition>
	</state> 
	<decision name ="T017_PBC_CNDecision" expression="#{T017_PBC_CNDecision}">
        <transition to="T017_ResolucionCES" name="resultadoPositivo"></transition>
		<transition to="T017_ResolucionExpediente" name="resultadoNegativo"></transition>
	</decision>
	
	<state name="T017_ResolucionCES">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ResolucionCESDecision" name="avanzaBPM"></transition>
	</state> <!--Transicion a Decision 3 caminos-->
    <decision name ="T017_ResolucionCESDecision" expression="#{T017_ResolucionCESDecision}">
        <transition to="forkReservaSi" name="AceptaConReserva"></transition> 
        <transition to="forkReservaNo" name="AceptaSinReserva"></transition> 
        <transition to="forkReservaSiBbva" name="AceptaConReservaBbva"></transition>
  		<transition to="forkReservaNoBbva" name="AceptaSinReservaBbva"></transition> 
        <transition to="T017_RespuestaOfertanteCES" name="Contraoferta"></transition>
		<transition to="T017_ResolucionExpediente" name="Deniega"></transition>
	</decision> <!--Decision Resolucion CES : "Fork :Informe Juridico / Advisory Note / PBC (Reserva/Venta) dependiendo de si tiene reserva o no"-->
		<state name="T017_RespuestaOfertanteCES">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_RespuestaOfertanteCESDecision" name="avanzaBPM"></transition>
	</state> <!--Transicion a Decision 3 caminos-->
    <decision name ="T017_RespuestaOfertanteCESDecision" expression="#{T017_RespuestaOfertanteCESDecision}">
        <transition to="forkReservaSi" name="AceptaConReserva"></transition> 
        <transition to="forkReservaNo" name="AceptaSinReserva"></transition>
        <transition to="forkReservaSiBbva" name="AceptaConReservaBbva"></transition>
 		<transition to="forkReservaNoBbva" name="AceptaSinReservaBbva"></transition>   
        <transition to="T017_RatificacionComiteCES" name="Contraoferta"></transition> 
		<transition to="T017_ResolucionExpediente" name="Deniega"></transition>
	</decision> <!--Decision Resolucion CES : "Fork :Informe Juridico / Advisory Note / PBC (Reserva/Venta) dependiendo de si tiene reserva o no"-->
  <state name="T017_RatificacionComiteCES">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_RatificacionComiteCESDecision" name="avanzaBPM"></transition>
	</state> <!--Transicion a Decision 3 caminos-->
  <decision name ="T017_RatificacionComiteCESDecision" expression="#{T017_RatificacionComiteCESDecision}">
    <transition to="forkReservaSi" name="AceptaConReserva"></transition> 
    <transition to="forkReservaNo" name="AceptaSinReserva"></transition>
    <transition to="forkReservaSiBbva" name="AceptaConReservaBbva"></transition>
 	<transition to="forkReservaNoBbva" name="AceptaSinReservaBbva"></transition>  
    <transition to="T017_RespuestaOfertanteCES" name="Contraoferta"></transition>
	<transition to="T017_ResolucionExpediente" name="Deniega"></transition>
	</decision> <!--Decision Resolucion CES : "Fork :Informe Juridico / Advisory Note / PBC (Reserva/Venta) dependiendo de si tiene reserva o no"-->

    <fork name="forkReservaSi">  
        <transition to="T017_AdvisoryNote" name="advisoryNote"></transition>
        <transition to="T017_PBCReserva" name="reserva"></transition>
    </fork><!--Fork Resolucion CES ACEPTA CON RESERVA -->
    <fork name="forkReservaNo">  
        <transition to="T017_AdvisoryNote" name="advisoryNote"></transition>
        <transition to="T017_PBCVenta" name="venta"></transition>
    </fork><!--Fork Resolucion CES ACEPTA SIN RESERVA-->

    <fork name="forkReservaSiBbva">  
        <transition to="T017_PBCReserva" name="reserva"></transition>
    </fork>
    <fork name="forkReservaNoBbva">  
        <transition to="T017_PBCVenta" name="venta"></transition>
    </fork>

    <state name="T017_AdvisoryNote">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_RecomendCES" name="avanzaBPM"></transition>
	</state> <!--Transicion directa a RecomendCES-->
    <state name="T017_RecomendCES">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_RecomendCESDecision" name="avanzaBPM"></transition>
	</state> <!--Transicion a decision T017_RecomendCESDecision -->
	<decision name ="T017_RecomendCESDecision" expression="#{T017_RecomendCESDecision}">
        <transition to="T017_ResolucionDivarian" name="AceptaArrowRemaining"></transition>
        <transition to="T017_ResolucionPROManzana" name="Acepta"></transition>
		<transition to="T017_ResolucionExpediente" name="DeniegaConReserva"></transition>
		<transition to="T017_ResolucionExpediente" name="DeniegaSinReserva"></transition>
	</decision> <!--Decision RecomendCES Resolucion Expediente / Resolucion Expediente / Resolucion PRO Manzana-->
    <state name="T017_ResolucionExpediente">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					resolucionExpedienteEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="Fin" name="avanzaBPM"></transition>
    </state> <!--Transicion directa a Fin -->
    <state name="T017_ResolucionDivarian">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ResolucionDivarianDecision" name="avanzaBPM"></transition>
	</state>
	<decision name ="T017_ResolucionDivarianDecision" expression="#{T017_ResolucionDivarianDecision}">
        <transition to="join1" name="Acepta"></transition> <!--Nodo de union-->
        <transition to="T017_ResolucionExpediente" name="DeniegaConReserva"></transition>
		<transition to="T017_ResolucionExpediente" name="DeniegaSinReservaONoExiste"></transition>
	</decision>
    <state name="T017_ResolucionPROManzana">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ResolucionPROManzanaDecision" name="avanzaBPM"></transition>
	</state> <!--Transicion a decision T017_RecomendCESDecision -->
	<decision name ="T017_ResolucionPROManzanaDecision" expression="#{T017_ResolucionPROManzanaDecision}">
        <transition to="join1" name="Acepta"></transition> <!--Nodo de union-->
        <transition to="join2" name="ApruebaBC"></transition> <!--Nodo de union-->
        <transition to="T017_ResolucionExpediente" name="DeniegaConReserva"></transition>
		<transition to="T017_ResolucionExpediente" name="DeniegaSinReservaONoExiste"></transition>
	</decision> <!--Decision Resolucion Pro Manzana Resolucion Expediente / Resolucion Expediente / NODO DE UNION PREGUNTAR A SOLER -->
    <state name="T017_PBCReserva">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_PBCReservaDecision" name="avanzaBPM"></transition>
	</state> <!--Transicion a decision T017_RecomendCESDecision -->
	<decision name ="T017_PBCReservaDecision" expression="#{T017_PBCReservaDecision}">
        <transition to="T017_InstruccionesReserva" name="Aprueba"></transition>
		<transition to="T017_ResolucionExpediente" name="Deniega"></transition>
		<transition to="T017_AgendarFechaFirmaArras" name="ApruebaBC"></transition>
	</decision> <!--Decision PBCReserva : Resolucion Expediente / InstruccionesReserva -->
	<state name="T017_AgendarFechaFirmaArras">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ConfirmarFechaFirmaArras" name="avanzaBPM"></transition>
	</state>
	<state name="T017_ConfirmarFechaFirmaArras">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ConfirmarFechaFirmaArrasDecision" name="avanzaBPM"></transition>
	</state>	
	<decision name ="T017_ConfirmarFechaFirmaArrasDecision" expression="#{T017_ConfirmarFechaFirmaArrasDecision}">
        <transition to="T017_InstruccionesReserva" name="Confirmado"></transition>
		<transition to="T017_AgendarFechaFirmaArras" name="noConfirmado"></transition>
	</decision>
	
	<state name="T017_InstruccionesReserva">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_InstruccionesReservaDecision" name="avanzaBPM"></transition>
	</state> 			
	<decision name ="T017_InstruccionesReservaDecision" expression="#{T017_InstruccionesReservaDecision}">
        <transition to="T017_ObtencionContratoReserva" name="OK"></transition>
		<transition to="T017_AgendarFechaFirmaArras" name="KO"></transition>
	</decision>
	
	<state name="T017_ObtencionContratoReserva">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ObtencionContratoReservaDecision" name="avanzaBPM"></transition>
	</state>
	
	<decision name ="T017_ObtencionContratoReservaDecision" expression="#{T017_ObtencionContratoReservaDecision}">
        <transition to="T017_PBCVenta" name="OK"></transition>
		<transition to="T017_AgendarFechaFirmaArras" name="KO"></transition>
	</decision>
	
	
	<state name="T017_PBCVenta">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_PBCVentaDecision" name="avanzaBPM"></transition>
	</state>
	<decision name ="T017_PBCVentaDecision" expression="#{T017_PBCVentaDecision}">
        <transition to="join1" name="Aprueba"></transition> <!--Nodo de union-->
        <transition to="join2" name="ApruebaBC"></transition> <!--Nodo de union BC-->
		<transition to="T017_ResolucionExpediente" name="Deniega"></transition>
	</decision> <!--Decision PBCReserva : Resolucion Expediente / InstruccionesReserva -->
    <join name="join1">
        <transition to="T017_PosicionamientoYFirma"></transition>
    </join>
    
    <join name="join2">
        <transition to="T017_AgendarPosicionamiento"></transition>
    </join>
    
    <state name="T017_AgendarPosicionamiento">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ConfirmarFechaEscritura" name="avanzaBPM"></transition>
	</state>
	
	<state name="T017_ConfirmarFechaEscritura">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_ConfirmarFechaEscrituraDecision" name="avanzaBPM"></transition>
	</state>	
	<decision name ="T017_ConfirmarFechaEscrituraDecision" expression="#{T017_ConfirmarFechaEscrituraDecision}">
        <transition to="T017_AgendarPosicionamiento" name="noConfirmado"></transition>
		<transition to="T017_FirmaContrato" name="Confirmado"></transition>
	</decision>
	
	<state name="T017_FirmaContrato">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_DocsPosVenta" name="avanzaBPM"></transition>
	</state>
	
    <state name="T017_PosicionamientoYFirma">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_PosicionamientoYFirmaDecision" name="avanzaBPM"></transition>
	</state>
	<decision name ="T017_PosicionamientoYFirmaDecision" expression="#{T017_PosicionamientoYFirmaDecision}">
        <transition to="T017_DocsPosVenta" name="Firmado"></transition> <!--Nodo de union-->
		<transition to="T017_ResolucionExpediente" name="NoFirmado"></transition>
	</decision> <!--Decisión Posicionamiento y firma, a resolución expediente o a docs postventa -->
    <state name="T017_DocsPosVenta">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="T017_CierreEconomico" name="avanzaBPM"></transition>
	</state> <!-- Transmision directa a Cierre Economico -->
	<state name="T017_CierreEconomico">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					ActivoGenericSaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="Fin" name="avanzaBPM"></transition>
	</state> <!-- THE END -->
	
	
		<state name="T017_BloqueoScreening">
		<event type="node-enter">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericEnterActionHandler
				</targetBean>
			</action>
		</event>
		<event type="node-leave">
			<action name="miTarea"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy"
				config-type="bean">
				<targetBean>
					activoGenericLeaveActionHandler
				</targetBean>
			</action>
		</event>
		<transition to="Fin" name="avanzaBPM"></transition>
	</state>
		
	
	<end-state name="Fin">
		<event type="node-enter">
			<action name="myAction" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>activoEndProcessActionHandler
				</targetBean>
			</action>
		</event>
	</end-state>

</process-definition>