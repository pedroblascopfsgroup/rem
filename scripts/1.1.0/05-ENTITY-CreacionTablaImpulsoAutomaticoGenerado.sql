DEFINE NOMBRE_TABLA = IAG_IMPULSO_AUTO_GENERADO
DEFINE NOMBRE_INDICE = IAG_IMPULSO_AUTO_GENERADO_PK

declare
   c int;
   nombre_tabla varchar2(255);
begin
   nombre_tabla := '&NOMBRE_TABLA';
   select count(*) into c from user_tables where table_name = upper(nombre_tabla);
   if c = 1 then
      execute immediate 'drop table ' || nombre_tabla;
   end if;
   select count(*) into c from user_sequences where sequence_name = upper('S_' || nombre_tabla);
   if c = 1 then
      execute immediate 'drop sequence S_' || nombre_tabla;
   end if;
end;

CREATE SEQUENCE S_&NOMBRE_TABLA
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 100
  NOORDER;
  
CREATE TABLE &NOMBRE_TABLA (
    IAG_ID NUMBER(16) NOT NULL,
    PIA_ID NUMBER(16),
    IAG_RESULTADO VARCHAR2(3), --POSIBLES VALORES 'OK', 'ERR'
    IAG_DESCRICION_ERROR VARCHAR2(255),
    IAG_DOCUMENTO_GENERADO VARCHAR2(255),
    ADJ_ID NUMBER(16),
    PRC_ID NUMBER(16),
    TEX_ID NUMBER(16),
    DD_PLA_ID NUMBER(16),
    IAG_CON_PROCURADOR NUMBER(1),
    BPM_IPT_ID NUMBER(16),
    IAG_CASO_NOVA VARCHAR2(16),
    VERSION                  INTEGER              DEFAULT 0                     NOT NULL,
    USUARIOCREAR             VARCHAR2(10 BYTE)    NOT NULL,
    FECHACREAR               TIMESTAMP(6)         NOT NULL,
    USUARIOMODIFICAR         VARCHAR2(10 BYTE),
    FECHAMODIFICAR           TIMESTAMP(6),
    USUARIOBORRAR            VARCHAR2(10 BYTE),
    FECHABORRAR              TIMESTAMP(6),
    BORRADO                  NUMBER(1)            DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX &NOMBRE_INDICE ON &NOMBRE_TABLA (IAG_ID);

ALTER TABLE &NOMBRE_TABLA ADD (
  CONSTRAINT &NOMBRE_INDICE 
 PRIMARY KEY (IAG_ID));
 

ALTER TABLE &NOMBRE_TABLA ADD (
  CONSTRAINT FK_PIA_ID 
 FOREIGN KEY (PIA_ID) 
 REFERENCES PIA_PROCESO_IMPULSO_AUTO (PIA_ID));

--ALTER TABLE &NOMBRE_TABLA ADD (
--  CONSTRAINT FK_ADJ_ID 
-- FOREIGN KEY (ADJ_ID) 
-- REFERENCES ADJ_ADJUNTOS (ADJ_ID));

ALTER TABLE &NOMBRE_TABLA ADD (
  CONSTRAINT FK_PRC_ID 
 FOREIGN KEY (PRC_ID) 
 REFERENCES PRC_PROCEDIMIENTOS (PRC_ID));
 
ALTER TABLE &NOMBRE_TABLA ADD (
  CONSTRAINT FK_TEX_ID 
 FOREIGN KEY (TEX_ID) 
 REFERENCES TEX_TAREA_EXTERNA (TEX_ID));
 
ALTER TABLE &NOMBRE_TABLA ADD (
  CONSTRAINT FK_DD_PLA_ID 
 FOREIGN KEY (DD_PLA_ID) 
 REFERENCES DD_PLA_PLAZAS (DD_PLA_ID));

ALTER TABLE &NOMBRE_TABLA ADD (
  CONSTRAINT FK_BPM_IPT_ID 
 FOREIGN KEY (BPM_IPT_ID) 
 REFERENCES BPM_IPT_INPUT (BPM_IPT_ID));