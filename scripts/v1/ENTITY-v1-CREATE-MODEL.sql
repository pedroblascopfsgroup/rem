/*
 * Estructura de tablas del plugin recovery-bpmframework-plugin V 1.0
 */
-- Secuencia para la generación de tokens para el procesado masivo.

CREATE SEQUENCE S_BPM_PROCESO_TOKEN START WITH 1 INCREMENT BY 1;

-- Tipo de accion

CREATE SEQUENCE S_BPM_DD_TAC_TIPO_ACCION START WITH 1;

CREATE TABLE BPM_DD_TAC_TIPO_ACCION
(
  BPM_DD_TAC_ID                    NUMBER(16)          NOT NULL,
  BPM_DD_TAC_CODIGO                 VARCHAR2(50 CHAR),
  BPM_DD_TAC_DESCRIPCION            VARCHAR2(100 CHAR),
  BPM_DD_TAC_DESCRIPCION_LARGA      VARCHAR2(500 CHAR),
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX PK_BPM_DD_TAC_TIPO_INPUT ON BPM_DD_TAC_TIPO_ACCION (BPM_DD_TAC_ID);

ALTER TABLE BPM_DD_TAC_TIPO_ACCION ADD (
  CONSTRAINT PK_BPM_DD_TAC_TIPO_ACCION PRIMARY KEY (BPM_DD_TAC_ID)
);

-- Tipo de Input
CREATE SEQUENCE S_BPM_DD_TIN_TIPO_INPUT START WITH 1;

CREATE TABLE BPM_DD_TIN_TIPO_INPUT
(
  BPM_DD_TIN_ID                    NUMBER(16)          NOT NULL,
  BPM_DD_TIN_CODIGO                 VARCHAR2(50 CHAR),
  BPM_DD_TIN_DESCRIPCION            VARCHAR2(100 CHAR),
  BPM_DD_TIN_DESCRIPCION_LARGA      VARCHAR2(500 CHAR),
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX PK_BPM_DD_TIN_TIPO_INPUT ON BPM_DD_TIN_TIPO_INPUT (BPM_DD_TIN_ID);

ALTER TABLE BPM_DD_TIN_TIPO_INPUT ADD (
  CONSTRAINT PK_BPM_DD_TIN_TIPO_INPUT PRIMARY KEY (BPM_DD_TIN_ID)
);

-- Input
CREATE SEQUENCE S_BPM_IPT_INPUT START WITH 1;

CREATE TABLE BPM_IPT_INPUT
(
  BPM_IPT_ID                    NUMBER(16)          NOT NULL,
  BPM_DD_TIN_ID                 NUMBER(16)          NOT NULL,
  PRC_ID                    NUMBER(16)          NOT NULL,
  BPM_IPT_ADJUNTO           BLOB,
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX PK_BPM_IPT_INPUT ON BPM_IPT_INPUT (BPM_IPT_ID);

ALTER TABLE BPM_IPT_INPUT ADD (
  CONSTRAINT PK_BPM_IPT_INPUT PRIMARY KEY (BPM_IPT_ID),
  CONSTRAINT FK_BPM_IPT_PRC_ID FOREIGN KEY (PRC_ID) REFERENCES PRC_PROCEDIMIENTOS (PRC_ID),
  CONSTRAINT FK_BPM_IPT_DD_TIN_ID FOREIGN KEY (BPM_DD_TIN_ID) REFERENCES BPM_DD_TIN_TIPO_INPUT (BPM_DD_TIN_ID)
);

-- Datos del Input
CREATE SEQUENCE S_BPM_DIP_DATOS_INPUT START WITH 1;

CREATE TABLE BPM_DIP_DATOS_INPUT
(
  BPM_DIP_ID            NUMBER(16)                  NOT NULL,
  BPM_IPT_ID            NUMBER(16)                  NOT NULL,
  BPM_DIP_NOMBRE        VARCHAR2(250 CHAR)          NOT NULL,
  BPM_DIP_VALOR         VARCHAR2(1000 CHAR),
  BPM_DIP_VALOR_CLOB    CLOB,
  VERSION           INTEGER                     DEFAULT 0                     NOT NULL,
  USUARIOCREAR      VARCHAR2(10 CHAR)           NOT NULL,
  FECHACREAR        TIMESTAMP(6)                NOT NULL,
  USUARIOMODIFICAR  VARCHAR2(10 CHAR),
  FECHAMODIFICAR    TIMESTAMP(6),
  USUARIOBORRAR     VARCHAR2(10 CHAR),
  FECHABORRAR       TIMESTAMP(6),
  BORRADO           NUMBER(1)                   DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX PK_BPM_DIP_DATOS_INPUT ON BPM_DIP_DATOS_INPUT (BPM_DIP_ID);

ALTER TABLE BPM_DIP_DATOS_INPUT  ADD (
  CONSTRAINT PK_BPM_DIP_DATOS_INPUT PRIMARY KEY (BPM_DIP_ID),
  CONSTRAINT FK_BPM_DIP_BPM_IPT_ID FOREIGN KEY (BPM_IPT_ID) REFERENCES BPM_IPT_INPUT (BPM_IPT_ID)
);
 
-- Peticiones Batch
CREATE SEQUENCE S_BPM_PET_PETICIONES_BATCH START WITH 1;

CREATE TABLE BPM_PET_PETICIONES_BATCH
(
  BPM_PET_ID                    NUMBER(16)          NOT NULL,
  BPM_PET_TOKEN_ID              NUMBER(16)          NOT NULL,
  BPM_IPT_ID                    NUMBER(16)          NOT NULL,
  BPM_PET_START_BO              VARCHAR2(500 CHAR),
  BPM_PET_END_BO              VARCHAR2(500 CHAR),
  BPM_PET_SUCCESS_BO              VARCHAR2(500 CHAR),
  BPM_PET_ERROR_BO              VARCHAR2(500 CHAR),
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX PK_BPM_PET_PETICIONES_BATCH ON BPM_PET_PETICIONES_BATCH (BPM_PET_ID);

ALTER TABLE BPM_PET_PETICIONES_BATCH ADD (
  CONSTRAINT PK_BPM_PET_PETICIONES_BATCH PRIMARY KEY (BPM_PET_ID),
  CONSTRAINT FK_BPM_PET_BPM_IPT FOREIGN KEY (BPM_IPT_ID) REFERENCES BPM_IPT_INPUT (BPM_IPT_ID)
);

-- Relación Tipo de Input con tipo de procedimiento.

CREATE SEQUENCE S_BPM_TPI_TIPO_PROC_INPUT START WITH 1;

CREATE TABLE BPM_TPI_TIPO_PROC_INPUT
(
  BPM_TPI_ID                        NUMBER(16)          NOT NULL,
  DD_TPO_ID                         NUMBER(16)          NOT NULL,
  BPM_DD_TAC_ID                     NUMBER(16)          NOT NULL,  
  BPM_DD_TIN_ID                     NUMBER(16)          NOT NULL,
  DD_INFORME_ID						NUMBER(16)          NOT NULL,
  BPM_TPI_NODE_INC                  VARCHAR2(500 CHAR)  DEFAULT 'ALL',
  BPM_TPI_NODE_EXC                  VARCHAR2(500 CHAR)  DEFAULT 'NONE',
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX PK_BPM_TPI_TIPO_PROC_INPUT ON BPM_TPI_TIPO_PROC_INPUT (BPM_TPI_ID);

ALTER TABLE BPM_TPI_TIPO_PROC_INPUT ADD (
  CONSTRAINT PK_BPM_TPI_TIPO_PROC_INPUT PRIMARY KEY (BPM_TPI_ID),
  CONSTRAINT FK_BPM_TPI_TIPO_PROC_INPUT FOREIGN KEY (DD_TPO_ID) REFERENCES DD_TPO_TIPO_PROCEDIMIENTO (DD_TPO_ID),
  CONSTRAINT FK_BPM_TPI_TIPO_PROC_INPUT_2 FOREIGN KEY (BPM_DD_TIN_ID) REFERENCES BPM_DD_TIN_TIPO_INPUT (BPM_DD_TIN_ID),
  CONSTRAINT FK_BPM_TPI_TIPO_PROC_INPUT_3 FOREIGN KEY (BPM_DD_TAC_ID) REFERENCES BPM_DD_TAC_TIPO_ACCION (BPM_DD_TAC_ID),
  CONSTRAINT FK_BPM_TPI_TIPO_PROC_INPUT_4 FOREIGN KEY (DD_INFORME_ID) REFERENCES DD_INFORMES (DD_INFORME_ID)
);

-- Destino datos input

CREATE SEQUENCE S_BPM_IDT_INPUT_DATOS START WITH 1;

CREATE TABLE BPM_IDT_INPUT_DATOS
(
  BPM_IDT_ID                        NUMBER(16)          	NOT NULL,
  BPM_TPI_ID                        NUMBER(16)          	NOT NULL,
  BPM_IDT_NOMBRE                    VARCHAR2(100 CHAR)  	NOT NULL,
  BPM_IDT_GRUPO                     VARCHAR2(50 CHAR)  		NOT NULL,
  BPM_IDT_DATO                      VARCHAR2(100 CHAR)  	NOT NULL,
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL
);

CREATE UNIQUE INDEX PK_BPM_IDT_INPUT_DATOS ON BPM_IDT_INPUT_DATOS (BPM_IDT_ID);

ALTER TABLE BPM_IDT_INPUT_DATOS ADD (
  CONSTRAINT PK_BPM_IDT_INPUT_DATOS PRIMARY KEY (BPM_IDT_ID),
  CONSTRAINT FK_BPM_IDT_INPUT_DATOS FOREIGN KEY (BPM_TPI_ID) REFERENCES BPM_TPI_TIPO_PROC_INPUT (BPM_TPI_ID)
);


-- Tabla nombre_grupos_valores de los datos de los input.

CREATE SEQUENCE S_BPM_GVA_GRUPOS_VALORES START WITH 1;

CREATE TABLE BPM_GVA_GRUPOS_VALORES
(
  BPM_GVA_ID                    NUMBER(16)          	NOT NULL,
  PRC_ID                    	NUMBER(16)          	NOT NULL,
  BPM_GVA_NOMBRE_DATO           VARCHAR2(100 CHAR)  	NOT NULL,
  BPM_GVA_NOMBRE_GRUPO          VARCHAR2(50 CHAR)  		NOT NULL,
  BPM_GVA_VALOR                 VARCHAR2(100 CHAR)  	NOT NULL,
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL,
  BPM_TPI_NOMBRE_TRANSICION  VARCHAR2(100 BYTE)
);

CREATE UNIQUE INDEX PK_BPM_GVA_GRUPOS_VALORES ON BPM_GVA_GRUPOS_VALORES (BPM_GVA_ID);

ALTER TABLE BPM_GVA_GRUPOS_VALORES ADD (
  CONSTRAINT PK_BPM_GVA_GRUPOS_VALORES PRIMARY KEY (BPM_GVA_ID),
  CONSTRAINT FK_BPM_GVA_GRUPOS_VALORES FOREIGN KEY (PRC_ID) REFERENCES PRC_PROCEDIMIENTOS (prc_id)
);
