spool ./99-system-grants-desa-error.log
begin
  
 

  --CONCESION DE PERMISOS A MINIREC_CONSULTA
  for rs in (select table_name 
               from ALL_TABLES 
			   where UPPER(OWNER) = 'MINIREC') loop            
    EXECUTE IMMEDIATE 'GRANT SELECT ON MINIREC.' || rs.table_name || ' TO MINIREC_CONSULTA';  
  end loop;

 --CONCESION DE PERMISOS A SV00450
  for rs in (select table_name 
               from ALL_TABLES 
			   where UPPER(OWNER) = 'MINIREC') loop        
    if RS.TABLE_NAME LIKE 'RCV_GEST_%' then    
    EXECUTE IMMEDIATE 'GRANT SELECT ON MINIREC.' || rs.table_name || ' TO SV00450';
    end if;  
  end loop;

-- AÑADIDO POR GONZALO
for rs in (select table_name 
               from ALL_TABLES 
			   where UPPER(OWNER) = 'BANK01') loop        
    EXECUTE IMMEDIATE 'GRANT SELECT ON BANK01.' || rs.table_name || ' TO RECOVERY_BANKIA_DATASTAGE';
  end loop;
for rs in (select table_name 
               from ALL_TABLES 
			   where UPPER(OWNER) = 'BANKMASTER') loop        
    EXECUTE IMMEDIATE 'GRANT SELECT ON BANKMASTER.' || rs.table_name || ' TO RECOVERY_BANKIA_DATASTAGE';
  end loop;
--FIN GONZALO


-- AÑADIDO POR FRAN GUTIERREZ
for rs in (select table_name 
               from ALL_TABLES 
  where UPPER(OWNER) = 'MINIREC' ) loop           
    EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE, DELETE ON MINIREC.' || rs.table_name || ' TO BANK01';
  end loop;

--FIN FRAN
-- AÑADIDO POR OSCAR DORADO

for rs in (select OBJECT_name
		from ALL_PROCEDURES
	where UPPER(OWNER) = 'BANK01'
	and object_name like '%ALTA_%' ) loop
	EXECUTE IMMEDIATE 'GRANT EXECUTE ON BANK01.' || rs.object_name || ' TO BANK01';
	end loop;

--FIN OSCAR

--Joaquin Arnal
for rs in (select table_name 
               from ALL_TABLES 
  where UPPER(OWNER) = 'PFSRECOVERY'
         and table_name like '%TMP_RCV_GEST_%' ) loop           
    EXECUTE IMMEDIATE 'GRANT SELECT ON PFSRECOVERY.' || rs.table_name || ' TO BANK01';
  end loop;
--Fin Joaquin


end;
/



-- Funciones especiales de SYS para todos usuarios propietarios Recovery + Batch + BI+++++++++++++++

--FUNCIONES: EXECUTE
---------------------------------------------------
-- De funciones SYS a usuarios propietarios BANK01, BANKMASTER, RECOVERY_BANKIA_DWH, 
-- RECOVERY_BANKIA_DATASTAGE y RECOVERY_BANKIA_MD

begin
  FOR RS IN (SELECT USERNAME AS USER_OWNER  FROM ALL_USERS  WHERE UPPER(USERNAME) IN ('BANK01', 'BANKMASTER', 'MINIREC', 'RECOVERY_BANKIA_DWH', 'RECOVERY_BANKIA_DATASTAGE', 'RECOVERY_BANKIA_MD') ) LOOP

    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.TRUNCATE_TABLE' || ' TO ' || rs.USER_OWNER);
    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.REFRESCAR_MVIEW' || ' TO ' || rs.USER_OWNER);
    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.CREA_TEMP_TABLES' || ' TO ' || rs.USER_OWNER);
    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.CREA_DROP_INDEX' || ' TO ' || rs.USER_OWNER);
    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.ALTER_INDEX' || ' TO ' || rs.USER_OWNER);
    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.ESTADISTICAS' || ' TO ' || rs.USER_OWNER);
    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.ALTER_TABLE' || ' TO ' || rs.USER_OWNER);
    EXECUTE IMMEDIATE ('GRANT EXECUTE ON ' || 'SYSTEM.PROCEDURE_COMPILE' || ' TO ' || rs.USER_OWNER);

  END LOOP;
end;
/


--##################################################################################################
--Permisos para Usuarios Transaccionales - Usuario Propietario
-- JoseVi, Emilio
--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


--ONLINE + BATCH + BI+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

--Permisos WITH GRANT OPTION de Bankmaster a Bank01
---------------------------------------------------
begin
   FOR RS IN (SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER IN ('BANKMASTER')) LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.'  || RS.TABLE_NAME || ' TO BANK01 WITH GRANT OPTION');
  END LOOP;
end;
/

--TABLAS: SELECT, INSERT, UPDATE, DELETE
---------------------------------------------------
-- De objetos BANK01 a BANK01_TX, BANKMASTER_TX, RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER = 'BANK01') LOOP 
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/
-- De objetos BANKMASTER a BANK01_TX, BANKMASTER_TX, RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER = 'BANKMASTER') LOOP 
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--SECUENCIAS: SELECT
---------------------------------------------------
-- De objetos BANK01 a BANK01_TX, BANKMASTER_TX, RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT SEQUENCE_OWNER, SEQUENCE_NAME FROM DBA_SEQUENCES WHERE SEQUENCE_OWNER = 'BANK01') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

-- De objetos BANKMASTER a BANK01_TX, BANKMASTER_TX, RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT SEQUENCE_OWNER, SEQUENCE_NAME FROM DBA_SEQUENCES WHERE SEQUENCE_OWNER = 'BANKMASTER') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--VISTAS: SELECT
---------------------------------------------------
-- De objetos BANK01 a BANK01_TX, BANKMASTER_TX , RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, VIEW_NAME FROM DBA_VIEWS WHERE OWNER = 'BANK01') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

-- De objetos BANKMASTER a BANK01_TX, BANKMASTER_TX , RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, VIEW_NAME FROM DBA_VIEWS WHERE OWNER  = 'BANKMASTER') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.'  || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--VISTAS MATERIALIZADAS: SELECT
---------------------------------------------------
-- De objetos BANK01 a BANK01_TX, BANKMASTER_TX RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, MVIEW_NAME FROM DBA_MVIEWS WHERE OWNER = 'BANK01') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;

end;
/

-- De objetos BANKMASTER a BANK01_TX, BANKMASTER_TX ,RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, MVIEW_NAME FROM DBA_MVIEWS WHERE OWNER = 'BANKMASTER') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO BANKMASTER_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--PAQUETES, PROCEDIMIENTOS Y FUNCIONES: EXECUTE
---------------------------------------------------
-- De objetos BANK01 a BANK01_TX, BANKMASTER_TX RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
  FOR RS IN (SELECT OWNER,OBJECT_NAME FROM DBA_PROCEDURES  WHERE UPPER(OWNER) = 'BANK01' AND OBJECT_TYPE IN ('PACKAGE', 'PROCEDURE', 'FUNCTION') ) LOOP
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO BANK01_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO BANKMASTER_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO MINIREC_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DWH_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX';
  END LOOP;
end;
/

-- De objetos BANKMASTER a BANK01_TX, BANKMASTER_TX ,RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
  FOR RS IN (SELECT OWNER,OBJECT_NAME FROM DBA_PROCEDURES  WHERE UPPER(OWNER) = 'BANKMASTER' AND OBJECT_TYPE IN ('PACKAGE', 'PROCEDURE', 'FUNCTION') ) LOOP
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO BANK01_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO BANKMASTER_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DWH_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX';
  END LOOP;
end;
/




--MINIREC + BI++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

--TABLAS: SELECT, INSERT, UPDATE, DELETE
---------------------------------------------------
-- De objetos MINIREC a BANK01_TX, MINIREC_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER = 'MINIREC') LOOP 
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO MINIREC_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--SECUENCIAS: SELECT
---------------------------------------------------
-- De objetos MINIREC a BANK01_TX, MINIREC_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT SEQUENCE_OWNER,SEQUENCE_NAME FROM DBA_SEQUENCES WHERE SEQUENCE_OWNER = 'MINIREC') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO MINIREC_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--VISTAS: SELECT
---------------------------------------------------
-- De objetos MINIREC a BANK01_TX, MINIREC_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER,VIEW_NAME FROM DBA_VIEWS WHERE OWNER = 'MINIREC') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.VIEW_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.VIEW_NAME || ' TO MINIREC_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--VISTAS MATERIALIZADAS: SELECT
---------------------------------------------------
-- De objetos MINIREC a BANK01_TX, MINIREC_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER,MVIEW_NAME FROM DBA_MVIEWS WHERE OWNER = 'MINIREC') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO BANK01_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO MINIREC_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/


--PAQUETES, PROCEDIMIENTOS Y FUNCIONES: EXECUTE
---------------------------------------------------
-- De objetos MINIREC a BANK01_TX, MINIREC_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
  FOR RS IN (SELECT OWNER,OBJECT_NAME FROM DBA_PROCEDURES  WHERE UPPER(OWNER) = 'MINIREC' AND OBJECT_TYPE IN ('PACKAGE', 'PROCEDURE', 'FUNCTION') ) LOOP
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO MINIREC_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO BANK01_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX';
  END LOOP;
end;
/



--BI a BI_TX++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


--TABLAS: SELECT, INSERT, UPDATE, DELETE
---------------------------------------------------
--De objetos RECOVERY_BANKIA_DWH a RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER IN ('RECOVERY_BANKIA_DWH')) LOOP 
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

--De objetos RECOVERY_BANKIA_DATASTAGE a RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER IN ('RECOVERY_BANKIA_DATASTAGE')) LOOP 
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

--De objetos RECOVERY_BANKIA_MD a RECOVERY_BANKIA_MD_TX
begin
   FOR RS IN (SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER IN ('RECOVERY_BANKIA_MD')) LOOP 
      EXECUTE IMMEDIATE ('GRANT SELECT,INSERT,UPDATE,DELETE ON ' || RS.OWNER || '.' || RS.TABLE_NAME || ' TO RECOVERY_BANKIA_MD_TX');
  END LOOP;
end;
/


--SECUENCIAS: SELECT
---------------------------------------------------
--De objetos RECOVERY_BANKIA_DWH a RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT SEQUENCE_OWNER,SEQUENCE_NAME FROM DBA_SEQUENCES WHERE SEQUENCE_OWNER = 'RECOVERY_BANKIA_DWH') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

--De objetos RECOVERY_BANKIA_DATASTAGE a RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT SEQUENCE_OWNER,SEQUENCE_NAME FROM DBA_SEQUENCES WHERE SEQUENCE_OWNER = 'RECOVERY_BANKIA_DATASTAGE') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

--De objetos RECOVERY_BANKIA_MD a RECOVERY_BANKIA_MD_TX
begin
   FOR RS IN (SELECT SEQUENCE_OWNER,SEQUENCE_NAME FROM DBA_SEQUENCES WHERE SEQUENCE_OWNER = 'RECOVERY_BANKIA_MD') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.SEQUENCE_OWNER || '.' || RS.SEQUENCE_NAME || ' TO RECOVERY_BANKIA_MD_TX');
  END LOOP;
end;
/


--VISTAS: SELECT
---------------------------------------------------
--De objetos RECOVERY_BANKIA_DWH a RECOVERY_BANKIA_DWH_TX y RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER,VIEW_NAME FROM DBA_VIEWS WHERE OWNER = 'RECOVERY_BANKIA_DWH') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

--De objetos RECOVERY_BANKIA_DATASTAGE a RECOVERY_BANKIA_DATASTAGE_TX
begin
   FOR RS IN (SELECT OWNER,VIEW_NAME FROM DBA_VIEWS WHERE OWNER = 'RECOVERY_BANKIA_DATASTAGE') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

--De objetos RECOVERY_BANKIA_MD a RECOVERY_BANKIA_MD_TX
begin
   FOR RS IN (SELECT OWNER,VIEW_NAME FROM DBA_VIEWS WHERE OWNER = 'RECOVERY_BANKIA_MD') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.VIEW_NAME || ' TO RECOVERY_BANKIA_MD_TX');
  END LOOP;
end;
/



--VISTAS MATERIALIZADAS: SELECT
---------------------------------------------------
begin
   FOR RS IN (SELECT OWNER,MVIEW_NAME FROM DBA_MVIEWS WHERE OWNER = 'RECOVERY_BANKIA_DWH') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DWH_TX');
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

begin
   FOR RS IN (SELECT OWNER,MVIEW_NAME FROM DBA_MVIEWS WHERE OWNER = 'RECOVERY_BANKIA_DATASTAGE') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX');
  END LOOP;
end;
/

begin
   FOR RS IN (SELECT OWNER,MVIEW_NAME FROM DBA_MVIEWS WHERE OWNER = 'RECOVERY_BANKIA_MD') LOOP
      EXECUTE IMMEDIATE ('GRANT SELECT ON ' || RS.OWNER || '.' || RS.MVIEW_NAME || ' TO RECOVERY_BANKIA_MD_TX');
  END LOOP;
end;
/


--PAQUETES, PROCEDIMIENTOS Y FUNCIONES: EXECUTE
---------------------------------------------------
-- De objetos RECOVERY_BANKIA_DWH a RECOVERY_BANKIA_DWH_TX
begin
  FOR RS IN (SELECT OWNER,OBJECT_NAME FROM DBA_PROCEDURES  WHERE UPPER(OWNER) = 'RECOVERY_BANKIA_DWH' AND OBJECT_TYPE IN ('PACKAGE', 'PROCEDURE', 'FUNCTION') ) LOOP
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DWH_TX';
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX';
  END LOOP;
end;
/

-- De objetos RECOVERY_BANKIA_DATASTAGE a RECOVERY_BANKIA_DATASTAGE_TX y RECOVERY_BANKIA_DWH_TX
begin
  FOR RS IN (SELECT OWNER,OBJECT_NAME FROM DBA_PROCEDURES  WHERE UPPER(OWNER) = 'RECOVERY_BANKIA_DATASTAGE' AND OBJECT_TYPE IN ('PACKAGE', 'PROCEDURE', 'FUNCTION') ) LOOP
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_DATASTAGE_TX';
  END LOOP;
end;
/

-- De objetos RECOVERY_BANKIA_MD a RECOVERY_BANKIA_MD_TX
begin
  FOR RS IN (SELECT OWNER,OBJECT_NAME FROM DBA_PROCEDURES  WHERE UPPER(OWNER) = 'RECOVERY_BANKIA_MD' AND OBJECT_TYPE IN ('PACKAGE', 'PROCEDURE', 'FUNCTION') ) LOOP
    EXECUTE IMMEDIATE 'GRANT EXECUTE ON ' || RS.OWNER || '.' || RS.OBJECT_NAME || ' TO RECOVERY_BANKIA_MD_TX';
  END LOOP;
end;
/



--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
--Fin Permisos para Usuarios Transaccionales
-- JoseVi, Emilio
--##################################################################################################


spool off
exit

