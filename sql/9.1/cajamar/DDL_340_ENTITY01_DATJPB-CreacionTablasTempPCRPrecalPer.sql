--/*
--##########################################
--## AUTOR=JOSE MANUEL PEREZ BARBERÁ
--## FECHA_CREACION=20160104
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=CMREC-1670
--## PRODUCTO=NO
--## 
--## Finalidad: Creación de tablas 
--##							TMP_PER_EST_CICLO_VIDA
--##							TMP_PER_MOV
--##							TMP_PER_DVENC_RIES_DIREC
--##							TMP_PER_DVENC_RIES_INDIREC
--##							TMP_PER_RIESGO_TOTAL
--##							TMP_PER_RIESGO_TOTAL_DIRECTO
--##							TMP_PER_RIESGO_TOTAL_INDIRECTO
--##							TMP_PER_SITUACION_CLIENTE
--##							TMP_PER_DIAS_VENCIDO
--##							TMP_PER_NUM_EXP_ACTIVOS
--##							TMP_PER_NUM_ASU_ACTIVOS
--##							TMP_PER_NUM_ASU_ACT_POR_PRC
--##							TMP_PER_SITUACION
--##							TMP_PER_SERV_NOMINIA_PENSION
--##							TMP_PER_ULTIMA_ACTUACION
--##							TMP_PER_DISPUESTO_NO_VENCIDO
--##							TMP_PER_DISPUESTO_VENCIDO
--##							TMP_PER_DESC_CNAE
--##                               , esquema CM01.
--## INSTRUCCIONES:  Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;


DECLARE

 V_ESQUEMA VARCHAR2(25 CHAR):=   '#ESQUEMA#'; 			-- Configuracion Esquema
 V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; 		-- Configuracion Esquema Master
 ITABLE_SPACE VARCHAR(25 CHAR) :='#TABLESPACE_INDEX#';
 TABLA1 VARCHAR(30 CHAR) :='TMP_PER_EST_CICLO_VIDA';
 INDICE1 VARCHAR(30 CHAR) :='IDX_TMP_PER_EST_CIC_VID_PER_ID';
 TABLA2 VARCHAR(30 CHAR) :='TMP_PER_MOV';
 INDICE2a VARCHAR(30 CHAR) :='IDX_TMP_PER_MOV_PER_ID_DD_TIN';
 INDICE2b VARCHAR(30 CHAR) :='IDX_TMP_PER_MOV_MOV_ID';
 TABLA3 VARCHAR(30 CHAR) :='TMP_PER_DVENC_RIES_DIREC';
 INDICE3 VARCHAR(30 CHAR):='IDX_TMP_PER_DV_RIES_D_PER_ID';
 TABLA4 VARCHAR(30 CHAR) :='TMP_PER_DVENC_RIES_INDIREC';
 INDICE4 VARCHAR(30 CHAR):='IDX_TMP_PER_DV_RIES_I_PER_ID';
 TABLA5 VARCHAR(30 CHAR) :='TMP_PER_RIESGO_TOTAL';
 INDICE5 VARCHAR(30 CHAR):='IDX_TMP_PER_RIES_TOTAL_PER_ID';
 TABLA6 VARCHAR(30 CHAR) :='TMP_PER_RIESGO_TOTAL_DIRECTO';
 INDICE6 VARCHAR(30 CHAR):='IDX_TMP_PER_RIES_TOT_D_PER_ID';
 TABLA7 VARCHAR(30 CHAR) :='TMP_PER_RIESGO_TOTAL_INDIRECTO'; 
 INDICE7 VARCHAR(30 CHAR):='IDX_TMP_PER_RIES_TOT_I_PER_ID';
 TABLA8 VARCHAR(30 CHAR) :='TMP_PER_SITUACION_CLIENTE';
 INDICE8 VARCHAR(30 CHAR):='IDX_TMP_PER_SIT_CLIENTE_PER_ID';
 TABLA9 VARCHAR(30 CHAR) :='TMP_PER_DIAS_VENCIDO';
 INDICE9 VARCHAR(30 CHAR):='IDX_TMP_PER_DIAS_VENC_PER_ID';
 TABLA10 VARCHAR(30 CHAR) :='TMP_PER_NUM_EXP_ACTIVOS';
 INDICE10 VARCHAR(30 CHAR):='IDX_TMP_PER_NUM_EXP_ACT_PER_ID';
 TABLA11 VARCHAR(30 CHAR) :='TMP_PER_NUM_ASU_ACTIVOS';
 INDICE11 VARCHAR(30 CHAR):='IDX_TMP_PER_NUM_ASU_ACT_PER_ID';
 TABLA12 VARCHAR(30 CHAR) :='TMP_PER_NUM_ASU_ACT_POR_PRC';
 INDICE12 VARCHAR(30 CHAR):='IDX_TMP_P_N_AS_A_P_PRC_PER_ID';
 TABLA13 VARCHAR(30 CHAR) :='TMP_PER_SITUACION';
 INDICE13 VARCHAR(30 CHAR):='IDX_TMP_PER_SITUACION_PER_ID';
 TABLA14 VARCHAR(30 CHAR) :='TMP_PER_SERV_NOMINIA_PENSION'; 
 INDICE14 VARCHAR(30 CHAR):='IDX_TMP_TMP_PER_S_N_P_PER_ID';
 TABLA15 VARCHAR(30 CHAR) :='TMP_PER_ULTIMA_ACTUACION';
 INDICE15 VARCHAR(30 CHAR):='IDX_TMP_PER_ULTIMA_ACT_PER_ID';
 TABLA16 VARCHAR(30 CHAR) :='TMP_PER_DISPUESTO_NO_VENCIDO';
 INDICE16 VARCHAR(30 CHAR):='IDX_TMP_PER_DISP_NO_VEN_PER_ID';
 TABLA17 VARCHAR(30 CHAR) :='TMP_PER_DISPUESTO_VENCIDO';
 INDICE17 VARCHAR(30 CHAR):='IDX_TMP_PER_DISP_VEN_PER_ID';
 TABLA18 VARCHAR(30 CHAR) :='TMP_PER_DESC_CNAE';
 INDICE18 VARCHAR(30 CHAR):='IDX_TMP_PER_DESC_CNAE_PER_ID';
 err_num NUMBER;
 err_msg VARCHAR2(2048 CHAR); 
 V_MSQL VARCHAR2(8500 CHAR);
 S_MSQL VARCHAR2(8500 CHAR);
 V_EXISTE NUMBER (1);

BEGIN 

-- Crear tabla 1 TMP_PER_EST_CICLO_VIDA

--Validamos si la tabla existe antes de crearla
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA1;
  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA1||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		EST_CICLO_VIDA VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA1||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA1 );
     DBMS_OUTPUT.PUT_LINE(TABLA1||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA1||' CREADA');     
  END IF;
 
--Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA1
  AND INDEX_NAME = ''||INDICE1;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE1||' ON '||V_ESQUEMA||'.'||TABLA1||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA1||'.'||INDICE1||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE1||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA1||'.'||INDICE1||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA1||'.'||INDICE1||' CREADO');     
  END IF; 

--Fin crear tabla 1

-- Crear tabla 2 TMP_PER_MOV
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA2;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA2||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		MOV_ID NUMBER(16,0) NOT NULL ENABLE,
		DD_TIN_TITULAR NUMBER(16,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA2 );
     DBMS_OUTPUT.PUT_LINE(TABLA2||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||' CREADA');     
  END IF;   

--Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA2
  AND INDEX_NAME = ''||INDICE2a;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE2a||' ON '||V_ESQUEMA||'.'||TABLA2||'
	(	
		PER_ID,
		DD_TIN_TITULAR
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||'.'||INDICE2a||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE2a||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA2||'.'||INDICE2a||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||'.'||INDICE2a||' CREADO');     
  END IF; 
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA2
  AND INDEX_NAME = ''||INDICE2b;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE2b||' ON '||V_ESQUEMA||'.'||TABLA2||'
	(	
		MOV_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||'.'||INDICE2b||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE2b||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA2||'.'||INDICE1||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||'.'||INDICE2b||' CREADO');     
  END IF; 

--Fin crear tabla 2

-- Crear tabla 3 TMP_PER_DVENC_RIES_DIREC
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA3;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA3||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		MIN_MOV_FECHA_POS_VENCIDA NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA3||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA3 );
     DBMS_OUTPUT.PUT_LINE(TABLA3||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA3||' CREADA');     
  END IF;   

--Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA3
  AND INDEX_NAME = ''||INDICE3;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE3||' ON '||V_ESQUEMA||'.'||TABLA3||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA3||'.'||INDICE3||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE3||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA3||'.'||INDICE3||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA3||'.'||INDICE3||' CREADO');     
  END IF; 

--Fin crear tabla 3

-- Crear tabla 4 TMP_PER_DVENC_RIES_INDIREC
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA4;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA4||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		DIAS_VENC_RIESGO_INDIRECTO NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA4||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA4 );
     DBMS_OUTPUT.PUT_LINE(TABLA4||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA4||' CREADA');     
  END IF; 
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA4
  AND INDEX_NAME = ''||INDICE4;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE4||' ON '||V_ESQUEMA||'.'||TABLA4||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA4||'.'||INDICE4||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE4||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA4||'.'||INDICE4||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA4||'.'||INDICE4||' CREADO');     
  END IF;   

--Fin crear tabla 4

-- Crear tabla 5 TMP_PER_RIESGO_TOTAL
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA5;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA5||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		RIESGO_TOTAL NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA5||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA5 );
     DBMS_OUTPUT.PUT_LINE(TABLA5||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA5||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA5
  AND INDEX_NAME = ''||INDICE5;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE5||' ON '||V_ESQUEMA||'.'||TABLA5||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA5||'.'||INDICE5||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE5||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA5||'.'||INDICE5||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA5||'.'||INDICE5||' CREADO');     
  END IF; 
--Fin crear tabla 5

-- Crear tabla 6 TMP_PER_RIESGO_TOTAL_DIRECTO
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA6;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA6||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		RIESGO_TOTAL_DIRECTO NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA6||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA6 );
     DBMS_OUTPUT.PUT_LINE(TABLA6||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA6||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA6
  AND INDEX_NAME = ''||INDICE6;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE6||' ON '||V_ESQUEMA||'.'||TABLA6||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA6||'.'||INDICE6||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE6||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA6||'.'||INDICE6||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA6||'.'||INDICE6||' CREADO');     
  END IF; 
--Fin crear tabla 6

-- Crear tabla 7 TMP_PER_RIESGO_TOTAL_INDIRECTO
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA7;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA7||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		RIESGO_TOTAL_INDIRECTO NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA7||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA7 );
     DBMS_OUTPUT.PUT_LINE(TABLA7||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA7||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA7
  AND INDEX_NAME = ''||INDICE7;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE7||' ON '||V_ESQUEMA||'.'||TABLA7||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA7||'.'||INDICE7||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE7||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA7||'.'||INDICE7||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA7||'.'||INDICE7||' CREADO');     
  END IF; 
--Fin crear tabla 7

-- Crear tabla 8 TMP_PER_SITUACION_CLIENTE
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA8;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA8||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		SITUACION_CLIENTE VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA8||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA8 );
     DBMS_OUTPUT.PUT_LINE(TABLA8||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA8||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA8
  AND INDEX_NAME = ''||INDICE8;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE8||' ON '||V_ESQUEMA||'.'||TABLA8||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA8||'.'||INDICE8||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE8||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA8||'.'||INDICE8||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA8||'.'||INDICE8||' CREADO');     
  END IF; 
--Fin crear tabla 8

-- Crear tabla 9 TMP_PER_DIAS_VENCIDO
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA9;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA9||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		DIAS_VENCIDO NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA9||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA9 );
     DBMS_OUTPUT.PUT_LINE(TABLA9||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA9||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA9
  AND INDEX_NAME = ''||INDICE9;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE9||' ON '||V_ESQUEMA||'.'||TABLA9||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA9||'.'||INDICE9||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE9||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA9||'.'||INDICE9||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA9||'.'||INDICE9||' CREADO');     
  END IF; 
--Fin crear tabla 9

-- Crear tabla 10 TMP_PER_NUM_EXP_ACTIVOS
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA10;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA10||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		NUM_EXP_ACTIVOS NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA10||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA10 );
     DBMS_OUTPUT.PUT_LINE(TABLA10||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA10||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA10
  AND INDEX_NAME = ''||INDICE10;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE10||' ON '||V_ESQUEMA||'.'||TABLA10||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA10||'.'||INDICE10||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE10||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA10||'.'||INDICE10||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA10||'.'||INDICE10||' CREADO');     
  END IF; 
--Fin crear tabla 10

-- Crear tabla 11 TMP_PER_NUM_ASU_ACTIVOS
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA11;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA11||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		NUM_ASU_ACTIVOS NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA11||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA11 );
     DBMS_OUTPUT.PUT_LINE(TABLA11||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA11||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA11
  AND INDEX_NAME = ''||INDICE11;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE11||' ON '||V_ESQUEMA||'.'||TABLA11||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA11||'.'||INDICE11||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE11||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA11||'.'||INDICE11||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA11||'.'||INDICE11||' CREADO');     
  END IF; 
--Fin crear tabla 11

-- Crear tabla 12 TMP_PER_NUM_ASU_ACT_POR_PRC
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA12;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA12||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		NUM_ASU_ACTIVOS_POR_PRC NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA12||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA12 );
     DBMS_OUTPUT.PUT_LINE(TABLA12||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA12||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA12
  AND INDEX_NAME = ''||INDICE12;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE12||' ON '||V_ESQUEMA||'.'||TABLA12||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA12||'.'||INDICE12||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE12||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA12||'.'||INDICE12||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA12||'.'||INDICE12||' CREADO');     
  END IF; 
--Fin crear tabla 12

-- Crear tabla 13 TMP_PER_SITUACION
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA13;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA13||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		SITUACION VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA13||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA13 );
     DBMS_OUTPUT.PUT_LINE(TABLA13||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA13||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA13
  AND INDEX_NAME = ''||INDICE13;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE13||' ON '||V_ESQUEMA||'.'||TABLA13||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA13||'.'||INDICE13||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE13||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA13||'.'||INDICE13||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA13||'.'||INDICE13||' CREADO');     
  END IF; 
--Fin crear tabla 13

-- Crear tabla 14 TMP_PER_SERV_NOMINIA_PENSION
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA14;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA14||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		SERV_NOMINIA_PENSION VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA14||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA14 );
     DBMS_OUTPUT.PUT_LINE(TABLA14||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA14||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA14
  AND INDEX_NAME = ''||INDICE14;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE14||' ON '||V_ESQUEMA||'.'||TABLA14||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA14||'.'||INDICE14||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE14||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA14||'.'||INDICE14||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA14||'.'||INDICE14||' CREADO');     
  END IF; 
--Fin crear tabla 14

-- Crear tabla 15 TMP_PER_ULTIMA_ACTUACION
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA15;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA15||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		ULTIMA_ACTUACION VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA15||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA15 );
     DBMS_OUTPUT.PUT_LINE(TABLA15||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA15||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA15
  AND INDEX_NAME = ''||INDICE15;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE15||' ON '||V_ESQUEMA||'.'||TABLA15||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA15||'.'||INDICE15||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE15||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA15||'.'||INDICE15||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA15||'.'||INDICE15||' CREADO');     
  END IF; 
--Fin crear tabla 15

-- Crear tabla 16 TMP_PER_DISPUESTO_NO_VENCIDO
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA16;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA16||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		DISPUESTO_NO_VENCIDO VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA16||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA16 );
     DBMS_OUTPUT.PUT_LINE(TABLA16||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA16||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA16
  AND INDEX_NAME = ''||INDICE16;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE16||' ON '||V_ESQUEMA||'.'||TABLA16||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA16||'.'||INDICE16||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE16||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA16||'.'||INDICE16||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA16||'.'||INDICE16||' CREADO');     
  END IF; 
--Fin crear tabla 16

-- Crear tabla 17 TMP_PER_DISPUESTO_VENCIDO
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA17;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA17||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		DISPUESTO_VENCIDO VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA17||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA17 );
     DBMS_OUTPUT.PUT_LINE(TABLA17||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA17||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA17
  AND INDEX_NAME = ''||INDICE17;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE17||' ON '||V_ESQUEMA||'.'||TABLA17||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA17||'.'||INDICE17||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE17||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA17||'.'||INDICE17||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA17||'.'||INDICE17||' CREADO');     
  END IF; 
--Fin crear tabla 17

-- Crear tabla 18 TMP_PER_DESC_CNAE
--Validamos si la tabla existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA18;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA18||' 
   (	
		PER_ID NUMBER(16,0) NOT NULL ENABLE, 
		DESC_CNAE VARCHAR2(50 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA18||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA18 );
     DBMS_OUTPUT.PUT_LINE(TABLA18||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA18||' CREADA');     
  END IF;   
  
  --Validamos si el índice existe antes de crearlo  
  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_INDEXES
  WHERE TABLE_NAME = ''||TABLA18
  AND INDEX_NAME = ''||INDICE18;  
  
  V_MSQL := 'CREATE INDEX '||V_ESQUEMA||'.'||INDICE18||' ON '||V_ESQUEMA||'.'||TABLA18||'
	(	
		PER_ID
	)
	TABLESPACE '||ITABLE_SPACE||'';
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA18||'.'||INDICE18||' CREADO');
  ELSE   
     EXECUTE IMMEDIATE ('DROP INDEX '||V_ESQUEMA||'.'||INDICE18||'' );
     DBMS_OUTPUT.PUT_LINE(TABLA18||'.'||INDICE18||' BORRADO');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA18||'.'||INDICE18||' CREADO');     
  END IF; 
--Fin crear tabla 18

EXCEPTION
WHEN OTHERS THEN  
  err_num := SQLCODE;
  err_msg := SQLERRM;

  DBMS_OUTPUT.put_line('Error:'||TO_CHAR(err_num));
  DBMS_OUTPUT.put_line(err_msg);
  
  ROLLBACK;
  RAISE;
END;
/
EXIT;   
