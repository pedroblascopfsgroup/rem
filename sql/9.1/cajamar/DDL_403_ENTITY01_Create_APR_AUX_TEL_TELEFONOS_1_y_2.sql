--/*
--##########################################
--## AUTOR=LORENZO LERATE
--## FECHA_CREACION=20160419
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=1.0
--## INCIDENCIA_LINK=CMREC-3091
--## PRODUCTO=SI
--## Finalidad: Creación de tablas APR_AUX_TEL_TELEFONOS_1 y APR_AUX_TEL_TELEFONOS_2
--##           
--## INSTRUCCIONES: Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE

    V_MSQL         VARCHAR2(32000 CHAR); -- Sentencia a ejecutar    
    V_ESQUEMA      VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M    VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL          VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS   NUMBER(16); -- Vble. para validar la existencia de una tabla.  
    ERR_NUM        NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG        VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.

    V_TEXT1        VARCHAR2(2400 CHAR); -- Vble. auxiliar
    
BEGIN


    --------------------------
    --  HRN_HIST_RENUM_CNT  --
    --------------------------
    
    --** Comprobamos si existe la tabla   

    V_SQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = ''APR_AUX_TEL_TELEFONOS_1'' and owner = '''||v_esquema||'''';
    EXECUTE IMMEDIATE v_sql INTO v_num_tablas;
    
    -- Si existe la creamos
    IF V_NUM_TABLAS = 0 THEN 
            V_SQL := 'CREATE TABLE '||v_esquema||'."APR_AUX_TEL_TELEFONOS_1" 
   (	"ATT_FECHA_EXTRACCION" DATE, 
	"ATT_FECHA_DATO" DATE, 
	"ATT_CODIGO_ENTIDAD" NUMBER(4,0), 
	"ATT_CODIGO_PERSONA" NUMBER(16,0), 
	"ATT_CODIGO_PROPIETARIO" NUMBER(5,0), 
	"ATT_TELEFONO" VARCHAR2(20 BYTE), 
	"ATT_ORIGEN_TELEFONO" VARCHAR2(6 BYTE), 
	"ATT_CONSENTIMIENTO_TELEFONO" VARCHAR2(1 BYTE), 
	"ATT_FECHA_EXPIRACION" DATE, 
	"ATT_TIPO_TELEFONO" VARCHAR2(5 BYTE), 
	"ATT_CHAR_EXTRA1" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA2" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA3" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA4" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA5" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA6" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA7" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA8" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA9" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA10" VARCHAR2(50 BYTE), 
	"ATT_FLAG_EXTRA1" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA2" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA3" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA4" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA5" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA6" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA7" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA8" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA9" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA10" VARCHAR2(1 BYTE), 
	"ATT_DATE_EXTRA1" DATE, 
	"ATT_DATE_EXTRA2" DATE, 
	"ATT_DATE_EXTRA3" DATE, 
	"ATT_DATE_EXTRA4" DATE, 
	"ATT_DATE_EXTRA5" DATE, 
	"ATT_DATE_EXTRA6" DATE, 
	"ATT_DATE_EXTRA7" DATE, 
	"ATT_DATE_EXTRA8" DATE, 
	"ATT_DATE_EXTRA9" DATE, 
	"ATT_DATE_EXTRA10" DATE, 
	"ATT_NUM_EXTRA1" NUMBER(16,2), 
	"ATT_NUM_EXTRA2" NUMBER(16,2), 
	"ATT_NUM_EXTRA3" NUMBER(16,2), 
	"ATT_NUM_EXTRA4" NUMBER(16,2), 
	"ATT_NUM_EXTRA5" NUMBER(16,2), 
	"ATT_NUM_EXTRA6" NUMBER(16,2), 
	"ATT_NUM_EXTRA7" NUMBER(16,2), 
	"ATT_NUM_EXTRA8" NUMBER(16,2), 
	"ATT_NUM_EXTRA9" NUMBER(16,2), 
	"ATT_NUM_EXTRA10" NUMBER(16,2), 
	"ATT_TEL_ID" NUMBER(16,0)
   )';
   
   EXECUTE IMMEDIATE V_MSQL;
   DBMS_OUTPUT.PUT_LINE('[INFO] Creada tabla '||v_esquema||'.APR_AUX_TEL_TELEFONOS_1.');   
   
   V_SQL := 'CREATE TABLE '||v_esquema||'."APR_AUX_TEL_TELEFONOS_2" 
   (	"ATT_FECHA_EXTRACCION" DATE, 
	"ATT_FECHA_DATO" DATE, 
	"ATT_CODIGO_ENTIDAD" NUMBER(4,0), 
	"ATT_CODIGO_PERSONA" NUMBER(16,0), 
	"ATT_CODIGO_PROPIETARIO" NUMBER(5,0), 
	"ATT_TELEFONO" VARCHAR2(20 BYTE), 
	"ATT_ORIGEN_TELEFONO" VARCHAR2(6 BYTE), 
	"ATT_CONSENTIMIENTO_TELEFONO" VARCHAR2(1 BYTE), 
	"ATT_FECHA_EXPIRACION" DATE, 
	"ATT_TIPO_TELEFONO" VARCHAR2(5 BYTE), 
	"ATT_CHAR_EXTRA1" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA2" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA3" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA4" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA5" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA6" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA7" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA8" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA9" VARCHAR2(50 BYTE), 
	"ATT_CHAR_EXTRA10" VARCHAR2(50 BYTE), 
	"ATT_FLAG_EXTRA1" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA2" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA3" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA4" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA5" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA6" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA7" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA8" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA9" VARCHAR2(1 BYTE), 
	"ATT_FLAG_EXTRA10" VARCHAR2(1 BYTE), 
	"ATT_DATE_EXTRA1" DATE, 
	"ATT_DATE_EXTRA2" DATE, 
	"ATT_DATE_EXTRA3" DATE, 
	"ATT_DATE_EXTRA4" DATE, 
	"ATT_DATE_EXTRA5" DATE, 
	"ATT_DATE_EXTRA6" DATE, 
	"ATT_DATE_EXTRA7" DATE, 
	"ATT_DATE_EXTRA8" DATE, 
	"ATT_DATE_EXTRA9" DATE, 
	"ATT_DATE_EXTRA10" DATE, 
	"ATT_NUM_EXTRA1" NUMBER(16,2), 
	"ATT_NUM_EXTRA2" NUMBER(16,2), 
	"ATT_NUM_EXTRA3" NUMBER(16,2), 
	"ATT_NUM_EXTRA4" NUMBER(16,2), 
	"ATT_NUM_EXTRA5" NUMBER(16,2), 
	"ATT_NUM_EXTRA6" NUMBER(16,2), 
	"ATT_NUM_EXTRA7" NUMBER(16,2), 
	"ATT_NUM_EXTRA8" NUMBER(16,2), 
	"ATT_NUM_EXTRA9" NUMBER(16,2), 
	"ATT_NUM_EXTRA10" NUMBER(16,2), 
	"ATT_TEL_ID" NUMBER(16,0)
   )';

	EXECUTE IMMEDIATE V_MSQL;
	DBMS_OUTPUT.PUT_LINE('[INFO] Creada tabla '||v_esquema||'.APR_AUX_TEL_TELEFONOS_2.');
	
	ELSE
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Creada tabla '||v_esquema||'.APR_AUX_TEL_TELEFONOS_1 y 2 ya estaba creada.');
	
    END IF;
    
    DBMS_OUTPUT.PUT_LINE('[INFO] Finalizado');
   
EXCEPTION
  WHEN OTHERS THEN
    ERR_NUM := SQLCODE;
    ERR_MSG := SQLERRM;
    DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
    DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
    DBMS_OUTPUT.put_line(ERR_MSG);
    ROLLBACK;
    RAISE;
END;
/
EXIT;
