--/*
--##########################################
--## AUTOR=JAVIER DIAZ RAMOS
--## FECHA_CREACION=20150724
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=CMREC-438
--## PRODUCTO=NO
--## 
--## Finalidad: Inserción de datos de Diccionarios Relaciones Cajamar , esquema CM01.
--## INSTRUCCIONES:  Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
DECLARE

 
   TYPE T_TIPO_PROVINCIA IS TABLE OF VARCHAR2(150);
   TYPE T_ARRAY_PROVINCIA IS TABLE OF T_TIPO_PROVINCIA;
   
   
   
	
  -- Configuracion Esquemas
   V_ESQUEMA VARCHAR(25) := 'CM01';
   V_ESQUEMA_M VARCHAR(25) := 'CMMASTER';
   V_TipoContrado VARCHAR(50) := 'BNKContrato';

   V_USUARIO_CREAR VARCHAR2(10) := 'INICIAL';
   
   -- Configuracion Entidad
   V_ENTIDAD VARCHAR2(255) := 'CAJAMAR-CDD';
   V_WORKING_CODE VARCHAR2(255) := '3058';

						   
	
	 V_TIPO_PROVINCIA T_ARRAY_PROVINCIA := T_ARRAY_PROVINCIA(									
												T_TIPO_PROVINCIA('1','ALAVA','ALAVA'),
T_TIPO_PROVINCIA('2','ALBACETE','ALBACETE'),
T_TIPO_PROVINCIA('3','ALICANTE','ALICANTE'),
T_TIPO_PROVINCIA('4','ALMERIA','ALMERIA'),
T_TIPO_PROVINCIA('5','AVILA','AVILA'),
T_TIPO_PROVINCIA('6','BADAJOZ','BADAJOZ'),
T_TIPO_PROVINCIA('7','BALEARES','BALEARES'),
T_TIPO_PROVINCIA('8','BARCELONA','BARCELONA'),
T_TIPO_PROVINCIA('9','BURGOS','BURGOS'),
T_TIPO_PROVINCIA('10','CACERES','CACERES'),
T_TIPO_PROVINCIA('11','CADIZ','CADIZ'),
T_TIPO_PROVINCIA('12','CASTELLON DE LA PLANA','CASTELLON DE LA PLANA'),
T_TIPO_PROVINCIA('13','CIUDAD REAL','CIUDAD REAL'),
T_TIPO_PROVINCIA('14','CORDOBA','CORDOBA'),
T_TIPO_PROVINCIA('15','CORU¥A, LA','CORU¥A, LA'),
T_TIPO_PROVINCIA('16','CUENCA','CUENCA'),
T_TIPO_PROVINCIA('17','GIRONA','GIRONA'),
T_TIPO_PROVINCIA('18','GRANADA','GRANADA'),
T_TIPO_PROVINCIA('19','GUADALAJARA','GUADALAJARA'),
T_TIPO_PROVINCIA('20','GUIPUZCOA','GUIPUZCOA'),
T_TIPO_PROVINCIA('21','HUELVA','HUELVA'),
T_TIPO_PROVINCIA('22','HUESCA','HUESCA'),
T_TIPO_PROVINCIA('23','JAEN','JAEN'),
T_TIPO_PROVINCIA('24','LEON','LEON'),
T_TIPO_PROVINCIA('25','LLEIDA','LLEIDA'),
T_TIPO_PROVINCIA('26','LOGRO¥O','LOGRO¥O'),
T_TIPO_PROVINCIA('27','LUGO','LUGO'),
T_TIPO_PROVINCIA('28','MADRID','MADRID'),
T_TIPO_PROVINCIA('29','MALAGA','MALAGA'),
T_TIPO_PROVINCIA('30','MURCIA','MURCIA'),
T_TIPO_PROVINCIA('31','NAVARRA','NAVARRA'),
T_TIPO_PROVINCIA('32','ORENSE','ORENSE'),
T_TIPO_PROVINCIA('33','OVIEDO','OVIEDO'),
T_TIPO_PROVINCIA('34','PALENCIA','PALENCIA'),
T_TIPO_PROVINCIA('35','LAS PALMAS','LAS PALMAS'),
T_TIPO_PROVINCIA('36','PONTEVEDRA','PONTEVEDRA'),
T_TIPO_PROVINCIA('37','SALAMANCA','SALAMANCA'),
T_TIPO_PROVINCIA('38','SANTA CRUZ DE TENERIFE','SANTA CRUZ DE TENERIFE'),
T_TIPO_PROVINCIA('39','SANTANDER','SANTANDER'),
T_TIPO_PROVINCIA('40','SEGOVIA','SEGOVIA'),
T_TIPO_PROVINCIA('41','SEVILLA','SEVILLA'),
T_TIPO_PROVINCIA('42','SORIA','SORIA'),
T_TIPO_PROVINCIA('43','TARRAGONA','TARRAGONA'),
T_TIPO_PROVINCIA('44','TERUEL','TERUEL'),
T_TIPO_PROVINCIA('45','TOLEDO','TOLEDO'),
T_TIPO_PROVINCIA('46','VALENCIA','VALENCIA'),
T_TIPO_PROVINCIA('47','VALLADOLID','VALLADOLID'),
T_TIPO_PROVINCIA('48','VIZCAYA','VIZCAYA'),
T_TIPO_PROVINCIA('49','ZAMORA','ZAMORA'),
T_TIPO_PROVINCIA('50','ZARAGOZA','ZARAGOZA'),
T_TIPO_PROVINCIA('51','CEUTA','CEUTA'),
T_TIPO_PROVINCIA('52','MELILLA','MELILLA')
                                   );
							   




                                   								   

--##########################################
--## FIN Configuraciones a rellenar
--##########################################
--*/  
   
   V_MSQL VARCHAR(5000);
   V_EXIST NUMBER(10);

   V_ENTIDAD_ID NUMBER(16);
   V_PEF_ID NUMBER;
  
   V_TMP_TIPO_PROVINCIA T_TIPO_PROVINCIA ;
   
   
  
   
   err_num NUMBER;
   err_msg VARCHAR2(255);
BEGIN



 EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA || '.DIR_DIRECCIONES DISABLE CONSTRAINTS FK_DIR_DIRE_FK_PER_DD_DD_PRV_P');   	
 DBMS_OUTPUT.PUT_LINE('ALTER TABLE DIR_DIRECCIONES DISABLE CONSTRAINTS FK_DIR_DIRE_FK_PER_DD_DD_PRV_P');  
 
 
 EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA || '.BIE_BIEN_ENTIDAD DISABLE CONSTRAINTS FK_BIEE_PRV_ID');   	
 DBMS_OUTPUT.PUT_LINE('ALTER TABLE BIE_BIEN_ENTIDAD DISABLE CONSTRAINTS FK_BIEE_PRV_ID'); 
 

 EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA || '.OFI_OFICINAS DISABLE CONSTRAINTS FK_OFI_OFIC_FK_FF_PRV_DD_PRV_P');   	
 DBMS_OUTPUT.PUT_LINE('ALTER TABLE OFI_OFICINAS DISABLE CONSTRAINTS FK_OFI_OFIC_FK_FF_PRV_DD_PRV_P');   

 EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA_M || '.DD_LOC_LOCALIDAD DISABLE CONSTRAINTS FK_DD_LOC_L_FK_PRV_LO_DD_PRV_P');   	
 DBMS_OUTPUT.PUT_LINE('ALTER TABLE DD_LOC_LOCALIDAD DISABLE CONSTRAINTS FK_DD_LOC_L_FK_PRV_LO_DD_PRV_P');   



			DBMS_OUTPUT.PUT_LINE('Se borra DD_PRV_PROVINCIA - PROVINCIA');
	    execute immediate('DELETE FROM ' || V_ESQUEMA_M || '.DD_PRV_PROVINCIA');
			
		
    
    SELECT count(*) INTO V_ENTIDAD_ID
    FROM all_sequences
    WHERE sequence_name = 'S_DD_PRV_PROVINCIA' and sequence_owner=V_ESQUEMA_M;
    if V_ENTIDAD_ID is not null and V_ENTIDAD_ID = 1 then    
	    EXECUTE IMMEDIATE('DROP SEQUENCE '|| V_ESQUEMA_M || '.S_DD_PRV_PROVINCIA');
	end if;
	
	
	/*
	SELECT count(*) INTO V_ENTIDAD_ID
    FROM all_sequences
    WHERE sequence_name = 'S_DD_TPB_TIPO_PROD_BANCARIO' and sequence_owner=V_ESQUEMA_M;
    if V_ENTIDAD_ID is not null and V_ENTIDAD_ID = 1 then    
	    EXECUTE IMMEDIATE('DROP SEQUENCE '|| V_ESQUEMA_M || '.S_DD_TPB_TIPO_PROD_BANCARIO');
	end if;
	
	SELECT count(*) INTO V_ENTIDAD_ID
    FROM all_sequences
    WHERE sequence_name = 'S_DD_ECV_ESTADO_CICLO_VIDA' and sequence_owner=V_ESQUEMA_M;
    if V_ENTIDAD_ID is not null and V_ENTIDAD_ID = 1 then    
	    EXECUTE IMMEDIATE('DROP SEQUENCE '|| V_ESQUEMA_M || '.S_DD_ECV_ESTADO_CICLO_VIDA');
	end if;
	*/

	  
	  EXECUTE IMMEDIATE('CREATE SEQUENCE '|| V_ESQUEMA_M || '.S_DD_PRV_PROVINCIA
      START WITH 1
      MAXVALUE 999999999999999999999999999
      MINVALUE 1
      NOCYCLE
      CACHE 20
      NOORDER');
	  /*
	    EXECUTE IMMEDIATE('CREATE SEQUENCE '|| V_ESQUEMA_M || '.S_DD_TPB_TIPO_PROD_BANCARIO
      START WITH 1
      MAXVALUE 999999999999999999999999999
      MINVALUE 1
      NOCYCLE
      CACHE 20
      NOORDER');
	  
	   EXECUTE IMMEDIATE('CREATE SEQUENCE '|| V_ESQUEMA_M || '.S_DD_ECV_ESTADO_CICLO_VIDA
      START WITH 1
      MAXVALUE 999999999999999999999999999
      MINVALUE 1
      NOCYCLE
      CACHE 20
      NOORDER');
	 */
   DBMS_OUTPUT.PUT_LINE('Creando DD_PRV_PROVINCIA......');
   FOR I IN V_TIPO_PROVINCIA.FIRST .. V_TIPO_PROVINCIA.LAST
   LOOP
      V_MSQL := 'SELECT '||V_ESQUEMA_M||'.S_DD_PRV_PROVINCIA.NEXTVAL FROM DUAL';
      EXECUTE IMMEDIATE V_MSQL INTO V_ENTIDAD_ID;
      V_TMP_TIPO_PROVINCIA := V_TIPO_PROVINCIA(I);
      DBMS_OUTPUT.PUT_LINE('Creando Tipo PROVINCIA: '||V_TMP_TIPO_PROVINCIA(1));   

      V_MSQL := 'INSERT INTO '||V_ESQUEMA_M||'.DD_PRV_PROVINCIA (DD_PRV_ID, DD_PRV_CODIGO, DD_PRV_DESCRIPCION,' ||
        'DD_PRV_DESCRIPCION_LARGA, VERSION, USUARIOCREAR, FECHACREAR, BORRADO) ' ||
                 ' VALUES ('||  V_ENTIDAD_ID || ','''||V_TMP_TIPO_PROVINCIA(1)||''','''||V_TMP_TIPO_PROVINCIA(2)||''','''
         ||V_TMP_TIPO_PROVINCIA(3)||''','
         || '0,'''||V_USUARIO_CREAR||''',SYSDATE,0)';
      --DBMS_OUTPUT.PUT_LINE(V_MSQL);
      EXECUTE IMMEDIATE V_MSQL;
   END LOOP; --LOOP TIPO VIA
    COMMIT;
   V_TMP_TIPO_PROVINCIA:= NULL;
   V_TIPO_PROVINCIA:= NULL;
   
   

   /*
     DBMS_OUTPUT.PUT_LINE('Creando DD_TPB_TIPO_PROD_BANCARIO......');
   FOR I IN V_TIPO_PRODUCTOB.FIRST .. V_TIPO_PRODUCTOB.LAST
   LOOP
      V_MSQL := 'SELECT '||V_ESQUEMA||'.S_DD_TPB_TIPO_PROD_BANCARIO.NEXTVAL FROM DUAL';
      EXECUTE IMMEDIATE V_MSQL INTO V_ENTIDAD_ID;
      V_TMP_TIPO_PRODUCTOB := V_TIPO_PRODUCTOB(I);
      DBMS_OUTPUT.PUT_LINE('Creando TIPO PRODUCTO BANCARIO: '||V_TMP_TIPO_PRODUCTOB(1));   

      V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.DD_TPB_TIPO_PROD_BANCARIO (DD_TPB_ID, DD_TPB_CODIGO, DD_TPB_DESCRIPCION,' ||
        'DD_TPB_DESCRIPCION_LARGA, VERSION, USUARIOCREAR, FECHACREAR, BORRADO) ' ||
                 ' VALUES ('||  V_ENTIDAD_ID || ','''||V_TMP_TIPO_PRODUCTOB(1)||''','''||V_TMP_TIPO_PRODUCTOB(2)||''','''
         ||V_TMP_TIPO_PRODUCTOB(3)||''','
         || '0,'''||V_USUARIO_CREAR||''',SYSDATE,0)';
      --DBMS_OUTPUT.PUT_LINE(V_MSQL);
      EXECUTE IMMEDIATE V_MSQL;
   END LOOP; --LOOP PRODUCTO BANCARIO
    COMMIT;
   V_TMP_TIPO_PRODUCTOB:= NULL;
   V_TIPO_PRODUCTOB:= NULL;
   
    DBMS_OUTPUT.PUT_LINE('Creando DD_ECV_ESTADO_CICLO_VIDA......');
   FOR I IN V_TIPO_CICLOV.FIRST .. V_TIPO_CICLOV.LAST
   LOOP
      V_MSQL := 'SELECT '||V_ESQUEMA||'.S_DD_ECV_ESTADO_CICLO_VIDA.NEXTVAL FROM DUAL';
      EXECUTE IMMEDIATE V_MSQL INTO V_ENTIDAD_ID;
      V_TMP_TIPO_CICLOV := V_TIPO_CICLOV(I);
      DBMS_OUTPUT.PUT_LINE('Creando ESTADO CICLO VIDA RELACION: '||V_TMP_TIPO_CICLOV(1));   

      V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.DD_ECV_ESTADO_CICLO_VIDA (DD_ECV_ID, DD_ECV_CODIGO, DD_ECV_DESCRIPCION,' ||
        'DD_ECV_DESCRIPCION_LARGA, VERSION, USUARIOCREAR, FECHACREAR, BORRADO) ' ||
                 ' VALUES ('||  V_ENTIDAD_ID || ','''||V_TMP_TIPO_CICLOV(1)||''','''||V_TMP_TIPO_CICLOV(2)||''','''
         ||V_TMP_TIPO_CICLOV(3)||''','
         || '0,'''||V_USUARIO_CREAR||''',SYSDATE,0)';
      --DBMS_OUTPUT.PUT_LINE(V_MSQL);
      EXECUTE IMMEDIATE V_MSQL;
   END LOOP; --LOOP ESTADO CICLO VIDA RELACION
    COMMIT;
   V_TMP_TIPO_CICLOV:= NULL;
   V_TIPO_CICLOV:= NULL;
*/


   EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA || '.DIR_DIRECCIONES ENABLE CONSTRAINTS FK_DIR_DIRE_FK_PER_DD_DD_PRV_P');   	
   DBMS_OUTPUT.PUT_LINE('HABILITAMOS LA FK ALTER TABLE DIR_DIRECCIONES ENABLE CONSTRAINTS FK_DIR_DIRE_FK_PER_DD_DD_PRV_P'); 
  
   EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA || '.BIE_BIEN_ENTIDAD ENABLE CONSTRAINTS FK_BIEE_PRV_ID');   	
   DBMS_OUTPUT.PUT_LINE('ALTER TABLE BIE_BIEN_ENTIDAD ENABLE CONSTRAINTS FK_BIEE_PRV_ID'); 
  
   EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA || '.OFI_OFICINAS DISABLE CONSTRAINTS FK_OFI_OFIC_FK_FF_PRV_DD_PRV_P');
   DBMS_OUTPUT.PUT_LINE('HABILITAMOS LA FK ALTER TABLE OFI_OFICINAS ENABLE CONSTRAINTS FK_OFI_OFIC_FK_FF_PRV_DD_PRV_P');    

   EXECUTE IMMEDIATE('ALTER TABLE ' || V_ESQUEMA_M || '.DD_LOC_LOCALIDAD DISABLE CONSTRAINTS FK_DD_LOC_L_FK_PRV_LO_DD_PRV_P');   	
   DBMS_OUTPUT.PUT_LINE('HABILITAMOS LA FK ALTER TABLE DD_LOC_LOCALIDAD ENABLE CONSTRAINTS FK_DD_LOC_L_FK_PRV_LO_DD_PRV_P');   

   DBMS_OUTPUT.PUT_LINE('Script ejecutado correctamente'); 

EXCEPTION

WHEN OTHERS THEN  
  err_num := SQLCODE;
  err_msg := SQLERRM;

  DBMS_OUTPUT.put_line('Error:'||TO_CHAR(err_num));
  DBMS_OUTPUT.put_line(err_msg);
  
  ROLLBACK;
  RAISE;
END;
/
EXIT;

