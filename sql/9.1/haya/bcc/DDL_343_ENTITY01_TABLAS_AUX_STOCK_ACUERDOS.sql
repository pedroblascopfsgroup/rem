--/*
--##########################################
--## AUTOR=MIGUEL SANCHEZ
--## FECHA_CREACION=20160112
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=1.0
--## INCIDENCIA_LINK= HR-15674
--## PRODUCTO=NO
--## 
--## Finalidad: Creación de tablas AUX_STOCK_ACU_*
--## INSTRUCCIONES:  Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;


DECLARE

 V_ESQUEMA VARCHAR2(25 CHAR):=   '#ESQUEMA#'; 			-- Configuracion Esquema
 V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; 		-- Configuracion Esquema Master
 TABLA VARCHAR(30 CHAR) :='AUX_STOCK_ACU_ACU';
 TABLA2 VARCHAR(30 CHAR) :='AUX_STOCK_ACU_ANA';
 TABLA3 VARCHAR(30 CHAR) :='AUX_STOCK_ACU_TEA';
 TABLA4 VARCHAR(30 CHAR) :='AUX_STOCK_ACU_BIT';
 TABLA5 VARCHAR(30 CHAR) :='AUX_STOCK_ACU_TEC';
 TABLA6 VARCHAR(30 CHAR) :='AUX_STOCK_ACU_AAR';
 TABLA7 VARCHAR(30 CHAR) :='AUX_STOCK_ACU_AEA';
 TABLA8 VARCHAR(30 CHAR) :='AUX_STOCK_ACU_OPE';
 err_num NUMBER;
 err_msg VARCHAR2(2048 CHAR); 
 V_MSQL VARCHAR2(8500 CHAR);
 V_EXISTE NUMBER (1);

BEGIN 

--Validamos si la tabla 1 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA||' 
   (	
	ASU_SYS_GUID VARCHAR2(32 BYTE),
	DD_TPA_CODIGO VARCHAR2(50 CHAR),
	DD_SOL_CODIGO VARCHAR2(50 CHAR),
	DD_EAC_CODIGO VARCHAR2(50 CHAR),
	ACU_OBSERVACIONES VARCHAR2(2000 CHAR),
	ACU_FECHA_PROPUESTA DATE,
	ACU_FECHA_ESTADO DATE,
	DD_ATP_CODIGO VARCHAR2(50 CHAR),
	ACU_IMPORTE_PAGO NUMBER(16,2),
	DD_APE_CODIGO VARCHAR2(50 CHAR),
	ACU_PERIODO NUMBER(16,0),
	ACU_IDJBPM NUMBER(19,0),
	ACU_FECHA_CIERRE DATE,
	VERSION NUMBER(38,0),
	USUARIOMODIFICAR VARCHAR2(50 CHAR),
	FECHAMODIFICAR TIMESTAMP(6),
	USUARIOBORRAR VARCHAR2(50 CHAR),
	FECHABORRAR TIMESTAMP(6),
	BORRADO NUMBER(1,0),
	ACU_MOTIVO VARCHAR2(250 BYTE),
	DTYPE VARCHAR2(50 BYTE),
	ACU_FECHA_COMPROMISO TIMESTAMP(6),
	EXP_SYS_GUID VARCHAR2(32 BYTE),
	RCF_TPP_CODIGO VARCHAR2(15 BYTE),
	RCF_STP_CODIGO VARCHAR2(15 BYTE),
	ACU_FECHA_RESOL_PROP TIMESTAMP(6),
	ACU_PORC_QUITA NUMBER(5,0),
	DES_DESPACHO VARCHAR2(100 BYTE),
	ACU_FECHA_LIMITE DATE,
	ACU_ESTADO_ACUERDO_NUSE VARCHAR2(5 BYTE),
	ACU_DEUDA_TOTAL NUMBER(16,2),
	SYS_GUID VARCHAR2(32 BYTE),
	ACU_IMPORTE_COSTAS NUMBER(16,2),
	USU_USERNAME_PROPONENTE VARCHAR2(50 CHAR),
	USU_USERNAME_USD VARCHAR2(50 CHAR),
	DES_DESPACHO_USD VARCHAR2(100 CHAR),
	DD_MTR_CODIGO VARCHAR2(500 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA );
     DBMS_OUTPUT.PUT_LINE(TABLA||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA||' CREADA');     
  END IF;   

--Fin crear tabla 1

--Validamos si la tabla 2 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA2;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA2||' 
   (	
	ACU_SYS_GUID VARCHAR2(32 BYTE),
	DD_ACT_CODIGO NUMBER(16,0),
	ANA_OBSERV_TITULOS VARCHAR2(2000 CHAR),
	DD_ACC_CODIGO VARCHAR2(50 CHAR),
	ANA_IMPORTE_PAGO NUMBER(16,2),
	ANA_OBSERV_PAGO VARCHAR2(2000 CHAR),
	DD_ACS_CODIGO VARCHAR2(50 CHAR),
	ANA_IMPORTE_SOLVENCIA NUMBER(16,2),
	ANA_OBSERV_SOLVENCIA VARCHAR2(2000 CHAR),
	VERSION NUMBER(38,0),
	USUARIOCREAR VARCHAR2(50 CHAR),
	FECHACREAR TIMESTAMP(6),
	USUARIOMODIFICAR VARCHAR2(50 CHAR),
	FECHAMODIFICAR TIMESTAMP(6),
	USUARIOBORRAR VARCHAR2(50 CHAR),
	FECHABORRAR TIMESTAMP(6),
	BORRADO NUMBER(1,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA2 );
     DBMS_OUTPUT.PUT_LINE(TABLA2||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA2||' CREADA');     
  END IF;   

--Fin crear tabla 2

--Validamos si la tabla 3 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA3;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA3||' 
   (	
	ACU_SYS_GUID VARCHAR2(32 BYTE),
	DD_TPA_CODIGO VARCHAR2(50 CHAR),
	RCF_DD_TPR_CODIGO VARCHAR2(20 CHAR),
	TEA_MODO_DESEMBOLSO VARCHAR2(100 BYTE),
	TEA_FORMALIZACION VARCHAR2(100 BYTE),
	TEA_IMPORTE NUMBER(16,2),
	TEA_COMISIONES NUMBER(16,2),
	TEA_PERIODICIDAD VARCHAR2(50 BYTE),
	TEA_PERIODO_FIJO VARCHAR2(50 BYTE),
	TEA_SISTEMA_AMORTIZACION VARCHAR2(50 BYTE),
	TEA_INTERES NUMBER(7,2),
	TEA_PERIODO_VARIABLE VARCHAR2(50 BYTE),
	TEA_INFORME_LETRADO VARCHAR2(2000 BYTE),
	VERSION NUMBER(38,0),
	USUARIOCREAR VARCHAR2(50 CHAR),
	FECHACREAR TIMESTAMP(6),
	USUARIOMODIFICAR VARCHAR2(50 CHAR),
	FECHAMODIFICAR TIMESTAMP(6),
	USUARIOBORRAR VARCHAR2(50 CHAR),
	FECHABORRAR TIMESTAMP(6),
	BORRADO NUMBER(1,0),
	SYS_GUID VARCHAR2(32 BYTE),
	DD_SBT_CODIGO VARCHAR2(500 BYTE),
	DD_EGT_CODIGO VARCHAR2(10 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA3||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA3 );
     DBMS_OUTPUT.PUT_LINE(TABLA3||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA3||' CREADA');     
  END IF;   

--Fin crear tabla 3

--Validamos si la tabla 4 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA4;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA4||' 
   (	
	TEA_SYS_GUID VARCHAR2(32 BYTE),
	BIE_CODIGO_INTERNO NUMBER(16,0),
	VERSION NUMBER(38,0),
	USUARIOCREAR VARCHAR2(50 CHAR),
	FECHACREAR TIMESTAMP(6),
	USUARIOMODIFICAR VARCHAR2(50 CHAR),
	FECHAMODIFICAR TIMESTAMP(6),
	USUARIOBORRAR VARCHAR2(50 CHAR),
	FECHABORRAR TIMESTAMP(6),
	BORRADO NUMBER(1,0),
	SYS_GUID VARCHAR2(32 BYTE),
        BIE_ID NUMBER(16,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA4||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA4 );
     DBMS_OUTPUT.PUT_LINE(TABLA4||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA4||' CREADA');     
  END IF;   

--Fin crear tabla 4

--Validamos si la tabla 5 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA5;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA5||' 
   (	
	TEA_SYS_GUID VARCHAR2(32 BYTE),
	CNT_CONTRATO VARCHAR2(50 CHAR),
	VERSION NUMBER(38,0),
	USUARIOCREAR VARCHAR2(50 CHAR),
	FECHACREAR TIMESTAMP(6),
	USUARIOMODIFICAR VARCHAR2(50 CHAR),
	FECHAMODIFICAR TIMESTAMP(6),
	USUARIOBORRAR VARCHAR2(50 CHAR),
	FECHABORRAR TIMESTAMP(6),
	BORRADO NUMBER(1,0),
	SYS_GUID VARCHAR2(32 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA5||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA5 );
     DBMS_OUTPUT.PUT_LINE(TABLA5||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA5||' CREADA');     
  END IF;   

--Fin crear tabla 5

--Validamos si la tabla 6 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA6;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA6||' 
   (	
	ACU_SYS_GUID VARCHAR2(32 BYTE),
	DD_ATA_CODIGO VARCHAR2(50 CHAR),
	DD_RAA_CODIGO VARCHAR2(50 CHAR),
	AAR_FECHA_ACTUACION DATE,
	AAR_OBSERVACIONES VARCHAR2(2000 CHAR),
	VERSION NUMBER(38,0),
	USUARIOCREAR VARCHAR2(50 CHAR),
	FECHACREAR TIMESTAMP(6),
	USUARIOMODIFICAR VARCHAR2(50 CHAR),
	FECHAMODIFICAR TIMESTAMP(6),
	USUARIOBORRAR VARCHAR2(50 CHAR),
	FECHABORRAR TIMESTAMP(6),
	BORRADO NUMBER(1,0),
	DD_TAY_CODIGO VARCHAR2(20 CHAR),
	SYS_GUID VARCHAR2(32 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA6||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA6 );
     DBMS_OUTPUT.PUT_LINE(TABLA6||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA6||' CREADA');     
  END IF;   

--Fin crear tabla 6

--Validamos si la tabla 7 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA7;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA7||' 
   (	
	ACU_SYS_GUID VARCHAR2(32 BYTE),
	DD_SSA_CODIGO VARCHAR2(50 CHAR),
	DD_VAA_CODIGO VARCHAR2(50 CHAR),
	AEA_OBSERVACIONES VARCHAR2(2000 CHAR),
	VERSION NUMBER(38,0),
	USUARIOCREAR VARCHAR2(50 CHAR),
	FECHACREAR TIMESTAMP(6),
	USUARIOMODIFICAR VARCHAR2(50 CHAR),
	FECHAMODIFICAR TIMESTAMP(6),
	USUARIOBORRAR VARCHAR2(50 CHAR),
	FECHABORRAR TIMESTAMP(6),
	BORRADO NUMBER(1,0),
	SYS_GUID VARCHAR2(32 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA7||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA7 );
     DBMS_OUTPUT.PUT_LINE(TABLA7||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA7||' CREADA');     
  END IF;   

--Fin crear tabla 7

--Validamos si la tabla 8 existe antes de crearla

  SELECT COUNT(*) INTO V_EXISTE
  FROM ALL_TABLES
  WHERE TABLE_NAME = ''||TABLA8;

  
  V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||TABLA8||' 
   ( 
		TEA_SYS_GUID VARCHAR2(32 BYTE),
		OP_IMP_PAG_PREV_FORM NUMBER(16,2),
		OP_PLZ_PAG_PREV_FORM NUMBER(4,0),
		OP_CARENCIA NUMBER(16,2),
		OP_CUOTA_ASUMIBLE NUMBER(16,2),
		OP_CARGAS_POSTERIORES NUMBER(16,2),
		OP_GARANTIAS_EXTRAS NUMBER(16,2),
		OP_NUM_EXPEDIENTE VARCHAR2(500 BYTE),
		OP_SOLICITAR_ALQUILER NUMBER(1,0),
		OP_LIQUIDEZ NUMBER(16,2),
		OP_TASACION NUMBER(16,2),
		OP_IMPORTE_PAGAR_QUITA NUMBER(16,2),
		OP_PORCENTAJE_QUITA NUMBER(3,0),
		OP_IMPORTE_VENCIDO NUMBER(16,2),
		OP_IMPORTE_NO_VENCIDO NUMBER(16,2),
		OP_IMP_INTERESES_MORATORIOS NUMBER(16,2),
		OP_IMP_INTERESES_ORDINARIOS NUMBER(16,2),
		OP_COMISION NUMBER(16,2),
		OP_GASTOS NUMBER(16,2),
		OP_NOM_CESIONARIO VARCHAR2(500 BYTE),
		OP_REL_CES_TIT VARCHAR2(500 BYTE),
		OP_SOLVENCIA_CESIONARIO NUMBER(16,2),
		OP_IMPORTE_CESION NUMBER(16,2),
		OP_FECHA_PAGO DATE,
		OP_PLAN_PGS_FECHA DATE,
		OP_PLAN_PGS_FRECUENCIA VARCHAR2(30 BYTE),
		OP_PLAN_PGS_NUM_PAGOS NUMBER(5,0),
		OP_PLAN_PGS_IMPORTE NUMBER(16,0),
		OP_ANALISIS_SOLVENCIA VARCHAR2(4000 BYTE),
		OP_DESC_ACUERDO VARCHAR2(4000 BYTE),
		VERSION NUMBER(38,0),
		BORRADO NUMBER(1,0),
		USUARIOMODIFICAR VARCHAR2(50 CHAR),
		FECHAMODIFICAR TIMESTAMP(6),
		USUARIOBORRAR VARCHAR2(50 CHAR),
		FECHABORRAR TIMESTAMP(6),
		OP_FECHA_SOL_PREVISTA DATE,
		OP_NUM_CONTRATO_DESCUENTO VARCHAR2(50 BYTE),
		OP_NUM_CONTRATO_PTMO_PROMOTOR VARCHAR2(50 BYTE),
		OP_COD_PERSONA_AFECTADA VARCHAR2(50 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING';
 
 
  IF V_EXISTE = 0 THEN   
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA8||' CREADA');
  ELSE   
     EXECUTE IMMEDIATE ('DROP TABLE '||V_ESQUEMA||'.'||TABLA8 );
     DBMS_OUTPUT.PUT_LINE(TABLA8||' BORRADA');
     EXECUTE IMMEDIATE V_MSQL;
     DBMS_OUTPUT.PUT_LINE(TABLA8||' CREADA');     
  END IF;   

--Fin crear tabla 8



--Excepciones

EXCEPTION
WHEN OTHERS THEN  
  err_num := SQLCODE;
  err_msg := SQLERRM;

  DBMS_OUTPUT.put_line('Error:'||TO_CHAR(err_num));
  DBMS_OUTPUT.put_line(err_msg);
  
  ROLLBACK;
  RAISE;
END;
/
EXIT;   

