-- --------------------------------------------------------------------------------
-- Routine DDL
-- Note: comments before and after the routine body will not be stored by the server
-- --------------------------------------------------------------------------------
DELIMITER $$

CREATE DEFINER=`lindorff`@`62.15.160.2` PROCEDURE `Crear_Dim_Persona`(OUT o_error_status varchar(500))
MY_BLOCK_DIM_PER: BEGIN


-- ===============================================================================================
-- Autor: Gonzalo Martín, PFS Group
-- Fecha creación: Septiembre 2013
-- Responsable última modificación: Gonzalo Martín, PFS Group
-- Fecha última modificación: 10/12/2013
-- Motivos del cambio: SP Lindorff v0
-- Cliente: Recovery BI Lindorff  
--
-- Descripción: Procedimiento almancenado que crea las tablas de la dimensión Persona.
-- ===============================================================================================

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DE LOS HANDLER DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for 1062 set o_error_status := 'Error 1062: La tabla ya existe';
DECLARE EXIT handler for 1048 set o_error_status := 'Error 1048: Has intentado insertar un valor nulo'; 
DECLARE EXIT handler for 1318 set o_error_status := 'Error 1318: Número de parámetros incorrecto'; 

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DEL HANDLER GENÉRICO DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for sqlexception set o_error_status:= 'Se ha producido un error en el proceso';


 CREATE TABLE IF NOT EXISTS DIM_PERSONA_AMBITO_EXPEDIENTE (
  `AMBITO_EXPEDIENTE_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `AMBITO_EXPEDIENTE_PERSONA_DESC` VARCHAR(250) NULL ,
  `AMBITO_EXPEDIENTE_PERSONA_DESC_ALT` VARCHAR(500) NULL ,
  PRIMARY KEY (`AMBITO_EXPEDIENTE_PERSONA_ID`));


 CREATE TABLE IF NOT EXISTS DIM_PERSONA_ARQUETIPO(
  `ARQUETIPO_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `ARQUETIPO_PERSONA_DESC` VARCHAR(100) NULL ,
  `ITINERARIO_PERSONA_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ARQUETIPO_PERSONA_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_ESTADO_FINANCIERO( 
  `ESTADO_FINANCIERO_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `ESTADO_FINANCIERO_PERSONA_DESC` VARCHAR(50) NULL ,
  `ESTADO_FINANCIERO_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`ESTADO_FINANCIERO_PERSONA_ID`));


 CREATE TABLE IF NOT EXISTS DIM_PERSONA_GRUPO_GESTOR (
  `GRUPO_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `GRUPO_GESTOR_DESC` VARCHAR(50) NULL ,
  `GRUPO_GESTOR_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`GRUPO_GESTOR_ID`));
   

 CREATE TABLE IF NOT EXISTS DIM_PERSONA_ITINERARIO(
  `ITINERARIO_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `ITINERARIO_PERSONA_DESC` VARCHAR(100) NULL ,
  `TIPO_ITINERARIO_PERSONA_ID` DECIMAL(16,0) NULL ,
  `AMBITO_EXPEDIENTE_PERSONA_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ITINERARIO_PERSONA_ID`));
  
    
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_NACIONALIDAD (
  `NACIONALIDAD_ID` DECIMAL(16,0) NOT NULL ,
  `NACIONALIDAD_DESC` VARCHAR(50) NULL ,
  `NACIONALIDAD_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`NACIONALIDAD_ID`));
   
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_NIVEL( 
  `NIVEL_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `NIVEL_PERSONA_DESC` VARCHAR(50) NULL ,
  `NIVEL_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`NIVEL_PERSONA_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_OFICINA( 
  `OFICINA_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `OFICINA_PERSONA_DESC` VARCHAR(50) NULL ,
  `OFICINA_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  `PROVINCIA_PERSONA_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`OFICINA_PERSONA_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_PERSONA_PAIS_NACIMIENTO (
  `PAIS_NACIMIENTO_ID` DECIMAL(16,0) NOT NULL ,
  `PAIS_NACIMIENTO_DESC` VARCHAR(50) NULL ,
  `PAIS_NACIMIENTO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`PAIS_NACIMIENTO_ID`));
  
   
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_PERFIL(
  `PERFIL_ID` DECIMAL(16,0) NOT NULL ,
  `PERFIL_DESC` VARCHAR(50) NULL ,
  `PERFIL_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`PERFIL_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_POLITICA(
  `POLITICA_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `POLITICA_PERSONA_DESC` VARCHAR(50) NULL ,
  `POLITICA_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`POLITICA_PERSONA_ID`));  

 CREATE TABLE IF NOT EXISTS DIM_PERSONA_PROVINCIA( 
  `PROVINCIA_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `PROVINCIA_PERSONA_DESC` VARCHAR(50) NULL ,
  `PROVINCIA_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`PROVINCIA_PERSONA_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_RATING_AUXILIAR(
  `RATING_AUXILIAR_ID` DECIMAL(16,0) NOT NULL ,
  `RATING_AUXILIAR_DESC` VARCHAR(50) NULL ,
  `RATING_AUXILIAR_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`RATING_AUXILIAR_ID`));
   

 CREATE TABLE IF NOT EXISTS DIM_PERSONA_RATING_EXTERNO(
  `RATING_EXTERNO_ID` DECIMAL(16,0) NOT NULL ,
  `RATING_EXTERNO_DESC` VARCHAR(50) NULL ,
  `RATING_EXTERNO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`RATING_EXTERNO_ID`));


 CREATE TABLE IF NOT EXISTS DIM_PERSONA_SEGMENTO(
  `SEGMENTO_ID` DECIMAL(16,0) NOT NULL ,
  `SEGMENTO_DESC` VARCHAR(50) NULL ,
  `SEGMENTO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`SEGMENTO_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_PERSONA_SEGMENTO_DETALLE(
  `SEGMENTO_DETALLE_ID` DECIMAL(16,0) NOT NULL ,
  `SEGMENTO_DETALLE_DESC` VARCHAR(50) NULL ,
  `SEGMENTO_DETALLE_DESC_ALT` VARCHAR(250) NULL ,
  `SEGMENTO_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`SEGMENTO_DETALLE_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_SEXO( 
  `SEXO_ID` DECIMAL(16,0) NOT NULL ,
  `SEXO_DESC` VARCHAR(50) NULL ,
  PRIMARY KEY (`SEXO_ID`));


 CREATE TABLE IF NOT EXISTS DIM_PERSONA_TENDENCIA(
  `TENDENCIA_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `TENDENCIA_PERSONA_DESC` VARCHAR(50) NULL ,
  `TENDENCIA_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`TENDENCIA_PERSONA_ID`));  
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_TIPO_DOCUMENTO(
  `TIPO_DOCUMENTO_ID` DECIMAL(16,0) NOT NULL ,
  `TIPO_DOCUMENTO_DESC` VARCHAR(50) NULL ,
  `TIPO_DOCUMENTO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`TIPO_DOCUMENTO_ID`));
 
 
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_TIPO_ITINERARIO (
  `TIPO_ITINERARIO_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `TIPO_ITINERARIO_PERSONA_DESC` VARCHAR(50) NULL ,
  `TIPO_ITINERARIO_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`TIPO_ITINERARIO_PERSONA_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_TIPO_PERSONA(
  `TIPO_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `TIPO_PERSONA_DESC` VARCHAR(50) NULL ,
  `TIPO_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`TIPO_PERSONA_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_TIPO_POLITICA(
  `TIPO_POLITICA_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `TIPO_POLITICA_PERSONA_DESC` VARCHAR(50) NULL ,
  `TIPO_POLITICA_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  `POLITICA_PERSONA_ID` DECIMAL(16,0) NULL ,
  `TENDENCIA_PERSONA_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`TIPO_POLITICA_PERSONA_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_ZONA( 
  `ZONA_PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `ZONA_PERSONA_DESC` VARCHAR(50) NULL ,
  `ZONA_PERSONA_DESC_ALT` VARCHAR(250) NULL ,
  `NIVEL_PERSONA_ID` DECIMAL(16,0) NULL ,
  `OFICINA_PERSONA_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ZONA_PERSONA_ID`));
  


  
  /*
  CREATE TABLE IF NOT EXISTS DIM_PERSONA_TRAMO_EDAD( 
  `TRAMO_EDAD_ID` DECIMAL(16,0) NOT NULL ,
  `TRAMO_EDAD_DESC` VARCHAR(50) NULL ,
  PRIMARY KEY (`TRAMO_EDAD_ID`));
  
  
  CREATE TABLE IF NOT EXISTS DIM_PERSONA_TRAMO_RIESGO( 
  `TRAMO_RIESGO_ID` DECIMAL(16,0) NOT NULL ,
  `TRAMO_RIESGO_DESC` VARCHAR(50) NULL ,
  PRIMARY KEY (`TRAMO_RIESGO_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_TRAMO_RIESGO_INDIRECTO( 
  `TRAMO_RIESGO_INDIRECTO_ID` DECIMAL(16,0) NOT NULL ,
  `TRAMO_RIESGO_INDIRECTO_DESC` VARCHAR(50) NULL ,
  PRIMARY KEY (`TRAMO_RIESGO_INDIRECTO_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA_TRAMO_DIAS_EN_IRREGULAR( 
  `TRAMO_RIESGO_INDIRECTO_ID` DECIMAL(16,0) NOT NULL ,
  `TRAMO_RIESGO_INDIRECTO_DESC` VARCHAR(50) NULL ,
  PRIMARY KEY (`TRAMO_RIESGO_INDIRECTO_ID`));


  
  CREATE TABLE IF NOT EXISTS DIM_PERSONA_TRAMO_XXX( 
  `TRAMO_XXX_ID` DECIMAL(16,0) NOT NULL ,
  `TRAMO_XXX_DESC` VARCHAR(50) NULL ,
  PRIMARY KEY (`TRAMO_XXX_ID`));
  */
  
  
 CREATE TABLE IF NOT EXISTS DIM_PERSONA( 
  `PERSONA_ID` DECIMAL(16,0) NOT NULL ,
  `DOCUMENTO_ID` VARCHAR(20) NULL ,
  `NOMBRE` VARCHAR(100) NULL ,
  `APELLIDO_1` VARCHAR(100) NULL ,
  `APELLIDO_2` VARCHAR(100) NULL ,
  `TELEFONO_1` VARCHAR(20) NULL ,
  `TELEFONO_2` VARCHAR(20) NULL ,
  `MOVIL_1` VARCHAR(20) NULL ,
  `MOVIL_2` VARCHAR(20) NULL ,
  `EMAIL` VARCHAR(100) NULL ,
  `ARQUETIPO_PERSONA_ID` DECIMAL(16,0) NULL ,
  `ESTADO_FINANCIERO_PERSONA_ID` DECIMAL(16,0) NULL ,
  `GRUPO_GESTOR_ID` DECIMAL(16,0) NULL ,
  `NACIONALIDAD_ID` DECIMAL(16,0) NULL ,
  `OFICINA_PERSONA_ID` DECIMAL(16,0) NULL ,
  `PAIS_NACIMIENTO_ID` DECIMAL(16,0) NULL ,
  `PERFIL_ID` DECIMAL(16,0) NULL ,
  `POLITICA_PERSONA_ID` DECIMAL(16,0) NULL ,  
  `RATING_AUXILIAR_ID` DECIMAL(16,0) NULL ,
  `RATING_EXTERNO_ID` DECIMAL(16,0) NULL ,
  `SEGMENTO_ID` DECIMAL(16,0) NULL ,
  `SEGMENTO_DETALLE_ID` DECIMAL(16,0) NULL ,
  `SEXO_ID` DECIMAL(16,0) NULL ,
  `TIPO_DOCUMENTO_ID` DECIMAL(16,0) NULL ,
  `TIPO_PERSONA_ID` DECIMAL(16,0) NULL ,
  `TIPO_POLITICA_PERSONA_ID` DECIMAL(16,0) NULL ,
  `ZONA_PERSONA_ID` DECIMAL(16,0) NULL ,
  
  /*
  `TRAMO_XXX_ID` DECIMAL(16,0) NULL ,
  `TRAMO_XXX_ID` DECIMAL(16,0) NULL ,
  `TRAMO_XXX_ID` DECIMAL(16,0) NULL ,
  */
  PRIMARY KEY (`PERSONA_ID`));
  
END MY_BLOCK_DIM_PER
