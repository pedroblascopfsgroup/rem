-- --------------------------------------------------------------------------------
-- Routine DDL
-- Note: comments before and after the routine body will not be stored by the server
-- --------------------------------------------------------------------------------
DELIMITER $$

CREATE DEFINER=`lindorff`@`62.15.160.2` PROCEDURE `Truncar_Dim_Contrato`(OUT o_error_status varchar(500))
MY_BLOCK_DIM_TRUNC_CNT: BEGIN

-- ===============================================================================================
-- Autor: Gonzalo Martín, PFS Group
-- Fecha creación: Septiembre 2013
-- Responsable última modificación: Gonzalo Martín, PFS Group
-- Fecha última modificación: 10/12/2013
-- Motivos del cambio: SP Lindorff v0
-- Cliente: Recovery BI Lindorff  
--
-- Descripción: Procedimiento almancenado que trunca las tablas de la dimensión Contrato.
-- ===============================================================================================

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DE LOS HANDLER DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for 1062 set o_error_status := 'Error 1062: La tabla ya existe';
DECLARE EXIT handler for 1048 set o_error_status := 'Error 1048: Has intentado insertar un valor nulo'; 
DECLARE EXIT handler for 1318 set o_error_status := 'Error 1318: Número de parámetros incorrecto'; 

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DEL HANDLER GENÉRICO DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for sqlexception set o_error_status:= 'Se ha producido un error en el proceso';

TRUNCATE TABLE DIM_CONTRATO;
TRUNCATE TABLE DIM_CONTRATO_CATALOGO_DETALLE_1; 
TRUNCATE TABLE DIM_CONTRATO_CATALOGO_DETALLE_2; 
TRUNCATE TABLE DIM_CONTRATO_CATALOGO_DETALLE_3; 
TRUNCATE TABLE DIM_CONTRATO_CATALOGO_DETALLE_4; 
TRUNCATE TABLE DIM_CONTRATO_CATALOGO_DETALLE_5; 
TRUNCATE TABLE DIM_CONTRATO_CATALOGO_DETALLE_6; 
TRUNCATE TABLE DIM_CONTRATO_ESTADO_CONTRATO; 
TRUNCATE TABLE DIM_CONTRATO_ESTADO_FINANCIERO;
TRUNCATE TABLE DIM_CONTRATO_ESTADO_FINANCIERO_AGRUPADO;
TRUNCATE TABLE DIM_CONTRATO_ESTADO_FINANCIERO_ANTERIOR;
TRUNCATE TABLE DIM_CONTRATO_ESTADO_FINANCIERO_ANTERIOR_AGRUPADO;
TRUNCATE TABLE DIM_CONTRATO_FINALIDAD_CONTRATO; 
TRUNCATE TABLE DIM_CONTRATO_FINALIDAD_OFICIAL; 
TRUNCATE TABLE DIM_CONTRATO_GARANTIA_CONTABLE; 
TRUNCATE TABLE DIM_CONTRATO_GARANTIA_CONTRATO; 
TRUNCATE TABLE DIM_CONTRATO_JUDICIALIZADO;
TRUNCATE TABLE DIM_CONTRATO_ESTADO_JUDICIALIZADO;
TRUNCATE TABLE DIM_CONTRATO_MONEDA; 
TRUNCATE TABLE DIM_CONTRATO_NIVEL; 
TRUNCATE TABLE DIM_CONTRATO_OFICINA; 
TRUNCATE TABLE DIM_CONTRATO_PRODUCTO; 
TRUNCATE TABLE DIM_CONTRATO_PROVINCIA; 
TRUNCATE TABLE DIM_CONTRATO_TIPO_PRODUCTO; 
TRUNCATE TABLE DIM_CONTRATO_ZONA; 
TRUNCATE TABLE DIM_CONTRATO_NACIONALIDAD_TITULAR; 
TRUNCATE TABLE DIM_CONTRATO_POLITICA_TITULAR; 
TRUNCATE TABLE DIM_CONTRATO_SEGMENTO_TITULAR; 
TRUNCATE TABLE DIM_CONTRATO_SEXO_TITULAR; 
TRUNCATE TABLE DIM_CONTRATO_SITUACION;
TRUNCATE TABLE DIM_CONTRATO_SITUACION_DETALLE;
TRUNCATE TABLE DIM_CONTRATO_SITUACION_ANTERIOR;
TRUNCATE TABLE DIM_CONTRATO_SITUACION_ANTERIOR_DETALLE;
TRUNCATE TABLE DIM_CONTRATO_SITUACION_RESPECTO_PERIODO_ANT;
TRUNCATE TABLE DIM_CONTRATO_TIPO_PERSONA_TITULAR; 
TRUNCATE TABLE DIM_CONTRATO_ESTADO_INSINUACION_CONTRATO;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_DIAS;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_FASES;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_FASES_AGRUPADO;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_DIAS_PERIODO_ANT;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_FASES_PERIODO_ANT;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_FASES_AGRUPADO_PERIODO_ANT;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_DIAS_EN_GESTION_A_COBRO;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_DIAS_IRREGULAR_A_COBRO;
TRUNCATE TABLE DIM_CONTRATO_GARANTIA_CONTRATO_AGRUPADO; 
TRUNCATE TABLE DIM_CONTRATO_SEGMENTO_TITULAR_AGRUPADO;
TRUNCATE TABLE DIM_CONTRATO_EN_GESTION_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_RESULTADO_ACTUACION;
TRUNCATE TABLE DIM_CONTRATO_EN_IRREGULAR;
TRUNCATE TABLE DIM_CONTRATO_MODELO_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_PROVEEDOR_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_CON_DPS;
TRUNCATE TABLE DIM_CONTRATO_CON_CONTACTO_UTIL;
TRUNCATE TABLE DIM_CONTRATO_CON_ACTUACION_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_ESTADO_FINANCIERO_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_ESTADO_FINANCIERO_ANTERIOR_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_EN_GESTION_RECOBRO_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_EN_IRREGULAR_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_MODELO_RECOBRO_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_PROVEEDOR_RECOBRO_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_DIAS_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREGULARIDAD_FASES_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_TRAMO_IRREG_FASES_AGRUPADO_INICIO_CAMPANA_RECOBRO;
TRUNCATE TABLE DIM_CONTRATO_EN_GESTION_ESPECIALIZADA; 
TRUNCATE TABLE DIM_CONTRATO_CON_PREVISION;
TRUNCATE TABLE DIM_CONTRATO_CON_PREVISION_REVISADA;
TRUNCATE TABLE DIM_CONTRATO_TIPO_PREVISION; 
TRUNCATE TABLE DIM_CONTRATO_PREVISION_SITUACION_INICIAL; 
TRUNCATE TABLE DIM_CONTRATO_PREVISION_SITUACION_AUTOMATICO; 
TRUNCATE TABLE DIM_CONTRATO_PREVISION_SITUACION_MANUAL; 
TRUNCATE TABLE DIM_CONTRATO_PREVISION_SITUACION_FINAL; 
TRUNCATE TABLE DIM_CONTRATO_MOTIVO_PREVISION;
TRUNCATE TABLE DIM_CONTRATO_SITUACION_ESPECIALIZADA;
TRUNCATE TABLE DIM_CONTRATO_GESTOR_ESPECIALIZADA;
TRUNCATE TABLE DIM_CONTRATO_SUPERVISOR_N1_ESPECIALIZADA;
TRUNCATE TABLE DIM_CONTRATO_SUPERVISOR_N2_ESPECIALIZADA;
TRUNCATE TABLE DIM_CONTRATO_SUPERVISOR_N3_ESPECIALIZADA;
TRUNCATE TABLE DIM_CONTRATO_EN_CARTERA_ESTUDIO;
TRUNCATE TABLE DIM_CONTRATO_MODELO_GESTION_CARTERA;
TRUNCATE TABLE DIM_CONTRATO_UNIDAD_GESTION_CARTERA;
TRUNCATE TABLE DIM_CONTRATO_CARTERA;
TRUNCATE TABLE DIM_CONTRATO_TIPO_CARTERA;
TRUNCATE TABLE DIM_CONTRATO_CON_CAPITAL_FALLIDO;
TRUNCATE TABLE DIM_CONTRATO_PROPIETARIO;
TRUNCATE TABLE DIM_CONTRATO_CEDENTE;

END MY_BLOCK_DIM_TRUNC_CNT