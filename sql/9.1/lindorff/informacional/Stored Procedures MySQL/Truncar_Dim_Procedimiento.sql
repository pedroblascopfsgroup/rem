-- --------------------------------------------------------------------------------
-- Routine DDL
-- Note: comments before and after the routine body will not be stored by the server
-- --------------------------------------------------------------------------------
DELIMITER $$

CREATE DEFINER=`lindorff`@`ba01` PROCEDURE `Truncar_Dim_Procedimiento`(OUT o_error_status varchar(500))
MY_BLOCK_TRUNC_DIM_PRC:BEGIN

-- ===============================================================================================
-- Autor: Gonzalo Martín, PFS Group
-- Fecha creación: Septiembre 2013
-- Responsable última modificación: Gonzalo Martín, PFS Group
-- Fecha última modificación: 26/03/2015
-- Motivos del cambio: segmento y socio
-- Cliente: Recovery BI Lindorff  
--
-- Descripción: Procedimiento almancenado que trunca las tablas de la dimensión Procedimiento.
-- ===============================================================================================

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DE LOS HANDLER DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for 1062 set o_error_status := 'Error 1062: La tabla ya existe';
DECLARE EXIT handler for 1048 set o_error_status := 'Error 1048: Has intentado insertar un valor nulo'; 
DECLARE EXIT handler for 1318 set o_error_status := 'Error 1318: Número de parámetros incorrecto'; 

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DEL HANDLER GENÉRICO DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for sqlexception set o_error_status:= 'Se ha producido un error en el proceso';

TRUNCATE TABLE DIM_PROCEDIMIENTO_JUZGADO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_PLAZA;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_RECLAMACION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_PROCEDIMIENTO_AGRUPADO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_PROCEDIMIENTO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_PROCEDIMIENTO_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_FASE_ACTUAL;
TRUNCATE TABLE DIM_PROCEDIMIENTO_FASE_ACTUAL_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_FASE_ANTERIOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_FASE_ANTERIOR_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ESTADO_PROCEDIMIENTO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ESTADO_FASE_ACTUAL;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ESTADO_FASE_ANTERIOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_CREADA_TIPO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_CREADA_TIPO_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_CREADA_DESCRIPCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_FINALIZADA_TIPO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_FINALIZADA_TIPO_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_FINALIZADA_DESCRIPCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_ACTUALIZADA_TIPO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_ACTUALIZADA_TIPO_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_ACTUALIZADA_DESCRIPCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_PENDIENTE_TIPO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_PENDIENTE_TIPO_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_PENDIENTE_DESCRIPCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_PENDIENTE_FA_TIPO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_PENDIENTE_FA_TIPO_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_PENDIENTE_FA_DESCRIPCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_GESTOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_GESTOR_EN_RECOVERY;
TRUNCATE TABLE DIM_PROCEDIMIENTO_GESTOR_RESOLUCION_EN_RECOVERY;
TRUNCATE TABLE DIM_PROCEDIMIENTO_SUPERVISOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_DESPACHO_GESTOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_DESPACHO_SUPERVISOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_DESPACHO_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_DESPACHO_GESTOR; 
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_DESPACHO_SUPERVISOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_DESPACHO_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ENTIDAD_GESTOR; 
TRUNCATE TABLE DIM_PROCEDIMIENTO_ENTIDAD_SUPERVISOR; 
TRUNCATE TABLE DIM_PROCEDIMIENTO_ENTIDAD_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_NIVEL_DESPACHO_GESTOR; 
TRUNCATE TABLE DIM_PROCEDIMIENTO_NIVEL_DESPACHO_SUPERVISOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_NIVEL_DESPACHO_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_OFICINA_DESPACHO_GESTOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_OFICINA_DESPACHO_SUPERVISOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_OFICINA_DESPACHO_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_PROVINCIA_DESPACHO_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_PROVINCIA_DESPACHO_GESTOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_PROVINCIA_DESPACHO_SUPERVISOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ZONA_DESPACHO_GESTOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ZONA_DESPACHO_SUPERVISOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ZONA_DESPACHO_GESTOR_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_SALDO_TOTAL;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_SALDO_TOTAL_CONCURSO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_ULTIMA_ACTUALIZACION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_CONTRATO_VENCIDO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_CONTRATO_VENCIDO_CREACION_ASUNTO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_PENDIENTE_CUMPLIMIENTO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ULTIMA_TAREA_FINALIZADA_CUMPLIMIENTO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_AUTO_FASE_COMUN_A_DIA_ANALISIS;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_AUTO_FASE_COMUN_A_LIQUIDACION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_CREACION_ASUNTO_A_INTERP_DEMANDA;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_CREACION_ASUNTO_A_ACEPTACION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_ACEPTACION_ASUNTO_A_INTERP_DEMANDA;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_CREACION_ASUNTO_A_RECOG_DOC_Y_ACEPT;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_RECOGIDA_DOC_Y_ACEPT_A_REGIS_TD;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_RECOGIDA_DOC_Y_ACEPT_A_RECEP_DC;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_INTERP_DEMANDA_DECL_A_RESOL_FIRME;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_INTERP_DEMANDA_ORD_A_INICIO_APREMIO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_INTERP_DEMANDA_HIP_A_SUBASTA;
TRUNCATE TABLE DIM_PROCEDIMIENTO_FASE_SUBASTA_HIPOTECARIO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_INTERP_DEMANDA_MON_A_DECRETO_FIN;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_INTERP_DEMANDA_MON_A_ADMI_DEMANDA;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_ADMI_DEMANDA_MON_A_REQUERIMIENTO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_REQUERIMIENTO_MON_A_DECRETO_FIN;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_INTERPOSICION_DEMANDA_ETJ_A_AUTO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_AUTO_ETJ_A_NOTIFICACION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_NOTIFICACION_ETJ_A_COBRO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_CONTRATO_GARANTIA_REAL_ASOCIADO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_COBRO_TIPO_DETALLE;
TRUNCATE TABLE DIM_PROCEDIMIENTO_COBRO_TIPO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_CON_COBRO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_ULTIMA_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_ACTUALIZACION_ESTIMACIONES;
TRUNCATE TABLE DIM_PROCEDIMIENTO_CARTERA;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TIPO_CARTERA;
TRUNCATE TABLE DIM_PROCEDIMIENTO_CEDENTE_CONTRATO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_PROPIETARIO_CONTRATO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_SEGMENTO_CONTRATO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_SOCIO_CONTRATO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_FASE_SUBASTA_EJECUCION_NOTARIAL;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TITULAR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_CON_PROCURADOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_PROCURADOR;
TRUNCATE TABLE DIM_PROCEDIMIENTO_CON_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_CON_IMPULSO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_RESULTADO_ULTIMO_IMPULSO; 
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_DESDE_ULTIMA_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_TRAMO_DIAS_DESDE_ULTIMO_IMPULSO;
TRUNCATE TABLE DIM_PROCEDIMIENTO_MOTIVO_INADMISION_ULTIMA_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_MOTIVO_INADMISION_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_MOTIVO_ARCHIVO_ULTIMA_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_MOTIVO_ARCHIVO_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_REQUERIMIENTO_PREVIO_ULTIMA_RESOLUCION;
TRUNCATE TABLE DIM_PROCEDIMIENTO_REQUERIMIENTO_PREVIO_RESOLUCION;

TRUNCATE TABLE DIM_PROCEDIMIENTO;

TRUNCATE TABLE TEMP_PROCEDIMIENTO_GESTOR;
TRUNCATE TABLE TEMP_PROCEDIMIENTO_SUPERVISOR;

  
END MY_BLOCK_TRUNC_DIM_PRC
