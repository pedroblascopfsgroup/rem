-- --------------------------------------------------------------------------------
-- Routine DDL
-- Note: comments before and after the routine body will not be stored by the server
-- --------------------------------------------------------------------------------
DELIMITER $$

CREATE DEFINER=`lindorff`@`62.15.160.2` PROCEDURE `Crear_Dim_Asunto`(OUT o_error_status varchar(500))
MY_BLOCK_DIM_ASU: BEGIN


-- ===============================================================================================
-- Autor: Gonzalo Martín, PFS Group
-- Fecha creación: Septiembre 2013
-- Responsable última modificación: Gonzalo Martín, PFS Group
-- Fecha última modificación: 10/12/2013
-- Motivos del cambio: SP Lindorff v0
-- Cliente: Recovery BI Lindorff  
--
-- Descripción: Procedimiento almancenado que crea las tablas de la dimensión Asunto.
-- ===============================================================================================

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DE LOS HANDLER DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for 1062 set o_error_status := 'Error 1062: La tabla ya existe';
DECLARE EXIT handler for 1048 set o_error_status := 'Error 1048: Has intentado insertar un valor nulo'; 
DECLARE EXIT handler for 1318 set o_error_status := 'Error 1318: Número de parámetros incorrecto'; 

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DEL HANDLER GENÉRICO DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for sqlexception set o_error_status:= 'Se ha producido un error en el proceso';


 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_ESTADO(
  `ESTADO_ASUNTO_ID` DECIMAL(16,0) NOT NULL ,
  `ESTADO_ASUNTO_DESC` VARCHAR(50) NULL ,
  `ESTADO_ASUNTO_DESC_ALT` VARCHAR(250) NULL ,
  `ESTADO_ASUNTO_AGRUPADO_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ESTADO_ASUNTO_ID`));


 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_ESTADO_AGRUPADO(
  `ESTADO_ASUNTO_AGRUPADO_ID` DECIMAL(16,0) NOT NULL ,
  `ESTADO_ASUNTO_AGRUPADO_DESC` VARCHAR(255) NULL ,
  PRIMARY KEY (`ESTADO_ASUNTO_AGRUPADO_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_DESPACHO (
  `DESPACHO_ID` DECIMAL(16,0) NOT NULL ,
  `DESPACHO_DESC` VARCHAR(250) NULL ,
  `TIPO_DESPACHO_ID` DECIMAL(16,0) NULL ,
  `ZONA_DESPACHO_ID` DECIMAL(16,0) NULL ,  
  PRIMARY KEY (`DESPACHO_ID`));
  
  
  CREATE TABLE IF NOT EXISTS DIM_ASUNTO_TIPO_DESPACHO(
  `TIPO_DESPACHO_ID` DECIMAL(16,0) NOT NULL ,
  `TIPO_DESPACHO_DESC` VARCHAR(50) NULL ,
  `TIPO_DESPACHO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`TIPO_DESPACHO_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_DESPACHO_GESTOR (
  `DESPACHO_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `DESPACHO_GESTOR_DESC` VARCHAR(250) NULL ,
  `TIPO_DESPACHO_GESTOR_ID` DECIMAL(16,0) NULL ,
  `ZONA_DESPACHO_GESTOR_ID` DECIMAL(16,0) NULL ,  
  PRIMARY KEY (`DESPACHO_GESTOR_ID`));
  
  
  CREATE TABLE IF NOT EXISTS DIM_ASUNTO_TIPO_DESPACHO_GESTOR(
  `TIPO_DESPACHO_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `TIPO_DESPACHO_GESTOR_DESC` VARCHAR(50) NULL ,
  `TIPO_DESPACHO_GESTOR_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`TIPO_DESPACHO_GESTOR_ID`));
  
 
  CREATE TABLE IF NOT EXISTS DIM_ASUNTO_GESTOR (
  `GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `GESTOR_NOMBRE` VARCHAR(250) NULL ,
  `GESTOR_APELLIDO1` VARCHAR(250) NULL ,
  `GESTOR_APELLIDO2` VARCHAR(250) NULL ,
  `ENTIDAD_GESTOR_ID` DECIMAL(16,0) NULL , 
  `DESPACHO_GESTOR_ID` DECIMAL(16,0) NULL ,  
  PRIMARY KEY (`GESTOR_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_ENTIDAD_GESTOR(
  `ENTIDAD_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `ENTIDAD_GESTOR_DESC` VARCHAR(255) NULL ,
  PRIMARY KEY (`ENTIDAD_GESTOR_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_ROL_GESTOR(
  `ROL_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `ROL_GESTOR_DESC` VARCHAR(50) NULL ,
  `ROL_GESTOR_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`ROL_GESTOR_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_NIVEL_DESPACHO( 
  `NIVEL_DESPACHO_ID` DECIMAL(16,0) NOT NULL ,
  `NIVEL_DESPACHO_DESC` VARCHAR(50) NULL ,
  `NIVEL_DESPACHO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`NIVEL_DESPACHO_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_OFICINA_DESPACHO( 
  `OFICINA_DESPACHO_ID` DECIMAL(16,0) NOT NULL ,
  `OFICINA_DESPACHO_DESC` VARCHAR(50) NULL ,
  `OFICINA_DESPACHO_DESC_ALT` VARCHAR(250) NULL ,
  `PROVINCIA_DESPACHO_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`OFICINA_DESPACHO_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_PROVINCIA_DESPACHO( 
  `PROVINCIA_DESPACHO_ID` DECIMAL(16,0) NOT NULL ,
  `PROVINCIA_DESPACHO_DESC` VARCHAR(50) NULL ,
  `PROVINCIA_DESPACHO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`PROVINCIA_DESPACHO_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_ZONA_DESPACHO( 
  `ZONA_DESPACHO_ID` DECIMAL(16,0) NOT NULL ,
  `ZONA_DESPACHO_DESC` VARCHAR(50) NULL ,
  `ZONA_DESPACHO_DESC_ALT` VARCHAR(250) NULL ,
  `NIVEL_DESPACHO_ID` DECIMAL(16,0) NULL ,
  `OFICINA_DESPACHO_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ZONA_DESPACHO_ID`));

  
 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_NIVEL_DESPACHO_GESTOR( 
  `NIVEL_DESPACHO_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `NIVEL_DESPACHO_GESTOR_DESC` VARCHAR(50) NULL ,
  `NIVEL_DESPACHO_GESTOR_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`NIVEL_DESPACHO_GESTOR_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_OFICINA_DESPACHO_GESTOR( 
  `OFICINA_DESPACHO_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `OFICINA_DESPACHO_GESTOR_DESC` VARCHAR(50) NULL ,
  `OFICINA_DESPACHO_GESTOR_DESC_ALT` VARCHAR(250) NULL ,
  `PROVINCIA_DESPACHO_GESTOR_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`OFICINA_DESPACHO_GESTOR_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_PROVINCIA_DESPACHO_GESTOR( 
  `PROVINCIA_DESPACHO_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `PROVINCIA_DESPACHO_GESTOR_DESC` VARCHAR(50) NULL ,
  `PROVINCIA_DESPACHO_GESTOR_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`PROVINCIA_DESPACHO_GESTOR_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_ZONA_DESPACHO_GESTOR( 
  `ZONA_DESPACHO_GESTOR_ID` DECIMAL(16,0) NOT NULL ,
  `ZONA_DESPACHO_GESTOR_DESC` VARCHAR(50) NULL ,
  `ZONA_DESPACHO_GESTOR_DESC_ALT` VARCHAR(250) NULL ,
  `NIVEL_DESPACHO_GESTOR_ID` DECIMAL(16,0) NULL ,
  `OFICINA_DESPACHO_GESTOR_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ZONA_DESPACHO_GESTOR_ID`));
  
/*
 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_ACUERDO(
  `ACUERDO_ASUNTO_ID` DECIMAL(16,0) NOT NULL ,
  `ACUERDO_ASUNTO_DESC` VARCHAR(150) NULL ,
  PRIMARY KEY (`ACUERDO_ASUNTO_ID`));  


 CREATE TABLE IF NOT EXISTS DIM_ASUNTO_CONTRATO_FISICO(
  `CONTRATO_FISICO_ASUNTO_ID` DECIMAL(16,0) NOT NULL ,
  `CONTRATO_FISICO_ASUNTO_DESC` VARCHAR(150) NULL ,
  PRIMARY KEY (`CONTRATO_FISICO_ASUNTO_ID`));  
*/

 CREATE TABLE IF NOT EXISTS DIM_ASUNTO( 
  `ASUNTO_ID` DECIMAL(16,0) NOT NULL ,
  `NOMBRE_ASUNTO` VARCHAR(310) NULL ,
  `EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  `DESPACHO_ID` DECIMAL(16,0) NULL ,
  `ACUERDO_ASUNTO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_FISICO_ASUNTO_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ASUNTO_ID`));

 CREATE TABLE IF NOT EXISTS TEMP_DESPACHO_ASUNTO( 
  `ASUNTO_ID` DECIMAL(16,0) NULL, 
  `DESPACHO_ID` DECIMAL(16,0) NOT NULL
 );
 
 
END MY_BLOCK_DIM_ASU
