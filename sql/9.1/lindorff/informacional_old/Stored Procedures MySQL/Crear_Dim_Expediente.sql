-- --------------------------------------------------------------------------------
-- Routine DDL
-- Note: comments before and after the routine body will not be stored by the server
-- --------------------------------------------------------------------------------
DELIMITER $$

CREATE DEFINER=`lindorff`@`62.15.160.2` PROCEDURE `Crear_Dim_Expediente`(OUT o_error_status varchar(500))
MY_BLOCK_DIM_EXP: BEGIN

-- ===============================================================================================
-- Autor: Gonzalo Martín, PFS Group
-- Fecha creación: Septiembre 2013
-- Responsable última modificación: Gonzalo Martín, PFS Group
-- Fecha última modificación: 10/12/2013
-- Motivos del cambio: SP Lindorff v0
-- Cliente: Recovery BI Lindorff  
--
-- Descripción: Procedimiento almancenado que crea las tablas de la dimensión Expediente.
-- ===============================================================================================

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DE LOS HANDLER DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for 1062 set o_error_status := 'Error 1062: La tabla ya existe';
DECLARE EXIT handler for 1048 set o_error_status := 'Error 1048: Has intentado insertar un valor nulo'; 
DECLARE EXIT handler for 1318 set o_error_status := 'Error 1318: Número de parámetros incorrecto'; 

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DEL HANDLER GENÉRICO DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for sqlexception set o_error_status:= 'Se ha producido un error en el proceso';


 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_ACTITUD(
  `ACTITUD_ID` DECIMAL(16,0) NOT NULL ,
  `ACTITUD_DESC` VARCHAR(50) NULL ,
  `ACTITUD_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`ACTITUD_ID`));


 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_AMBITO_EXPEDIENTE (
  `AMBITO_EXPEDIENTE_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `AMBITO_EXPEDIENTE_EXPEDIENTE_DESC` VARCHAR(250) NULL ,
  `AMBITO_EXPEDIENTE_EXPEDIENTE_DESC_ALT` VARCHAR(500) NULL ,
  PRIMARY KEY (`AMBITO_EXPEDIENTE_EXPEDIENTE_ID`));


 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_ARQUETIPO(
  `ARQUETIPO_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `ARQUETIPO_EXPEDIENTE_DESC` VARCHAR(100) NULL ,
  `ITINERARIO_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ARQUETIPO_EXPEDIENTE_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_CAUSA_IMPAGO( 
  `CAUSA_IMPAGO_ID` DECIMAL(16,0) NOT NULL ,
  `CAUSA_IMPAGO_DESC` VARCHAR(50) NULL ,
  `CAUSA_IMPAGO_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`CAUSA_IMPAGO_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_COMITE (
  `COMITE_ID` DECIMAL(16,0) NOT NULL ,
  `COMITE_DESC` VARCHAR(100) NULL ,
  `ZONA_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`COMITE_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_DECISION (
  `DECISION_ID` DECIMAL(16,0) NOT NULL ,
  `DECISION_DESC` VARCHAR(100) NULL ,
  `SESION_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`DECISION_ID`));


 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_ENTIDAD_INFORMACION (
  `ENTIDAD_INFORMACION_ID` DECIMAL(16,0) NOT NULL ,
  `ENTIDAD_INFORMACION_DESC` VARCHAR(50) NULL ,
  `ENTIDAD_INFORMACION_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`ENTIDAD_INFORMACION_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_ESTADO_EXPEDIENTE(
  `ESTADO_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `ESTADO_EXPEDIENTE_DESC` VARCHAR(50) NULL ,
  `ESTADO_EXPEDIENTE_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`ESTADO_EXPEDIENTE_ID`));
  
  
  CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_ESTADO_ITINERARIO (
  `ESTADO_ITINERARIO_ID` DECIMAL(16,0) NOT NULL ,
  `ESTADO_ITINERARIO_DESC` VARCHAR(50) NULL ,
  `ESTADO_ITINERARIO_DESC_ALT` VARCHAR(250) NULL ,
  `ENTIDAD_INFORMACION_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ESTADO_ITINERARIO_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_ITINERARIO(
  `ITINERARIO_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `ITINERARIO_EXPEDIENTE_DESC` VARCHAR(100) NULL ,
  `TIPO_ITINERARIO_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  `AMBITO_EXPEDIENTE_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ITINERARIO_EXPEDIENTE_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_NIVEL( 
  `NIVEL_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `NIVEL_EXPEDIENTE_DESC` VARCHAR(50) NULL ,
  `NIVEL_EXPEDIENTE_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`NIVEL_EXPEDIENTE_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_OFICINA( 
  `OFICINA_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `OFICINA_EXPEDIENTE_DESC` VARCHAR(50) NULL ,
  `OFICINA_EXPEDIENTE_DESC_ALT` VARCHAR(250) NULL ,
  `PROVINCIA_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`OFICINA_EXPEDIENTE_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_PROPUESTA (
  `PROPUESTA_ID` DECIMAL(16,0) NOT NULL ,
  `PROPUESTA_DESC` VARCHAR(50) NULL ,
  `PROPUESTA_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`PROPUESTA_ID`));
  

 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_PROVINCIA( 
  `PROVINCIA_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `PROVINCIA_EXPEDIENTE_DESC` VARCHAR(50) NULL ,
  `PROVINCIA_EXPEDIENTE_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`PROVINCIA_EXPEDIENTE_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_SESION (
  `SESION_ID` DECIMAL(16,0) NOT NULL ,
  `SESION_FECHA_INICIO` DATE NULL ,
  `SESION_FECHA_FIN` DATE NULL ,
  `COMITE_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`SESION_ID`));
  
 
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_TIPO_ITINERARIO (
  `TIPO_ITINERARIO_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `TIPO_ITINERARIO_EXPEDIENTE_DESC` VARCHAR(50) NULL ,
  `TIPO_ITINERARIO_EXPEDIENTE_DESC_ALT` VARCHAR(250) NULL ,
  PRIMARY KEY (`TIPO_ITINERARIO_EXPEDIENTE_ID`));
  
  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_ZONA( 
  `ZONA_EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `ZONA_EXPEDIENTE_DESC` VARCHAR(50) NULL ,
  `ZONA_EXPEDIENTE_DESC_ALT` VARCHAR(250) NULL ,
  `NIVEL_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  `OFICINA_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  PRIMARY KEY (`ZONA_EXPEDIENTE_ID`));

  
  /*  
 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE_TRAMO_XXX( 
  `TRAMO_XXX_ID` DECIMAL(16,0) NOT NULL ,
  `TRAMO_XXX_DESC` VARCHAR(50) NULL ,
  PRIMARY KEY (`TRAMO_XXX_ID`));
  */
  

 CREATE TABLE IF NOT EXISTS DIM_EXPEDIENTE( 
  `EXPEDIENTE_ID` DECIMAL(16,0) NOT NULL ,
  `EXPEDIENTE_DESC` VARCHAR(310) NULL ,
  
  `ACTITUD_ID` DECIMAL(16,0) NULL ,
  `ARQUETIPO_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  `CAUSA_IMPAGO_ID` DECIMAL(16,0) NULL ,
  `COMITE_ID` DECIMAL(16,0) NULL ,
  `DECISION_ID` DECIMAL(16,0) NULL ,
  `ESTADO_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  `ESTADO_ITINERARIO_ID` DECIMAL(16,0) NULL ,
  `OFICINA_EXPEDIENTE_ID` DECIMAL(16,0) NULL ,
  `PROPUESTA_ID` DECIMAL(16,0) NULL ,
  
  /*
  `TRAMO_XXX_ID` DECIMAL(16,0) NULL ,
  `TRAMO_XXX_ID` DECIMAL(16,0) NULL ,
  `TRAMO_XXX_ID` DECIMAL(16,0) NULL ,
*/

  PRIMARY KEY (`EXPEDIENTE_ID`));


END MY_BLOCK_DIM_EXP
