-- --------------------------------------------------------------------------------
-- Routine DDL
-- Note: comments before and after the routine body will not be stored by the server
-- --------------------------------------------------------------------------------
DELIMITER $$

CREATE DEFINER=`lindorff`@`62.15.160.2` PROCEDURE `Crear_H_Contrato`(OUT o_error_status varchar(500))
MY_BLOCK_H_CNT: BEGIN

-- ===============================================================================================
-- Autor: Gonzalo Martín, PFS Group
-- Fecha creación: Septiembre 2013
-- Responsable última modificación: Gonzalo Martín, PFS Group
-- Fecha última modificación: 10/12/2013
-- Motivos del cambio: SP Lindorff v0
-- Cliente: Recovery BI Lindorff  
--
-- Descripción: Procedimiento almancenado que crea la tabla de hechos Contrato.
-- ===============================================================================================


-- --------------------------------------------------------------------------------
-- DEFINICIÓN DE LOS HANDLER DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for 1062 set o_error_status := 'Error 1062: La tabla ya existe';
DECLARE EXIT handler for 1048 set o_error_status := 'Error 1048: Has intentado insertar un valor nulo'; 
DECLARE EXIT handler for 1318 set o_error_status := 'Error 1318: Número de parámetros incorrecto'; 

-- --------------------------------------------------------------------------------
-- DEFINICIÓN DEL HANDLER GENÉRICO DE ERROR
-- --------------------------------------------------------------------------------
DECLARE EXIT handler for sqlexception set o_error_status:= 'Se ha producido un error en el proceso';


-- =========================================================================================================================
--                                                 TABLAS DE HECHOS
-- =========================================================================================================================
 CREATE TABLE IF NOT EXISTS H_CONTRATO( 
  `DIA_ID` DATE NOT NULL,                                          -- Fecha Extracción
  `FECHA_CARGA_DATOS` DATE NOT NULL,                               -- Fecha último día cargado
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL, 
  -- Dimensiones
  `SITUACION_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,              -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_ANTERIOR_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,     -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_RESPECTO_PERIODO_ANT_ID` DECIMAL(16,0) NULL,          -- 0 Mantiene, 1 Alta, 2 Baja
  `DIA_POS_VENCIDA_ID` DATE NULL, 
  `DIA_SALDO_DUDOSO_ID` DATE NULL, 
  `ESTADO_FINANCIERO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_FINANCIERO_ANTERIOR_ID` DECIMAL(16,0) NULL ,
  `ESTADO_CONTRATO_ID` DECIMAL(16,0) NULL ,  
  `CONTRATO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL , 
  `CONTRATO_ESTADO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_INSINUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CAPITAL_FALLIDO_ID` DECIMAL(16,0) NULL ,
  `TIPO_GESTION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `FECHA_CREACION_CONTRATO` DATE NULL,
  -- Recobro
  `EN_GESTION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `FECHA_ALTA_GESTION_RECOBRO` DATE NULL,
  `FECHA_BAJA_GESTION_RECOBRO` DATE NULL,
  `FECHA_COMPROMETIDA_PAGO` DATE NULL,
  `FECHA_DPS` DATE NULL,
  `TRAMO_IRREGULARIDAD_DIAS_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_DIAS_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_EN_GESTION_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_IRREGULAR_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `RESULTADO_ACTUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `MODELO_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `PROVEEDOR_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_EN_IRREGULAR_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_DPS_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CONTACTO_UTIL_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_ACTUACION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  -- Especializada
  `FECHA_PREVISION` date NULL,
  `EN_GESTION_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_REVISADA_ID` DECIMAL(16,0) NULL ,
  `TIPO_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_INICIAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_AUTOMATICO_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_MANUAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_FINAL_ID` DECIMAL(16,0)  NULL ,
  `MOTIVO_PREVISION_ID` DECIMAL(16,0) NULL ,
  `SITUACION_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `GESTOR_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `SUPERVISOR_N1_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N2_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N3_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  -- Estudio Carteras
  `EN_CARTERA_ESTUDIO_ID` DECIMAL(16,0)  NULL ,
  `MODELO_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  `UNIDAD_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  -- Métricas
  `NUM_CONTRATOS` INT NULL,  
  `NUM_CLIENTES_ASOCIADOS` INT NULL,
  `NUM_EXPEDIENTES_ASOCIADOS` INT NULL,
  `NUM_DIAS_VENCIDOS` INT NULL,
  `NUM_DIAS_VENCIDOS_PERIODO_ANT` INT NULL,              
  `SALDO_TOTAL` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_NO_VENCIDA` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_VENCIDA` DECIMAL(14,2) NULL ,
  `SALDO_DUDOSO` DECIMAL(14,2) NULL ,
  `PROVISION` DECIMAL(14,2) NULL ,
  `INTERESES_REMUNERATORIOS` DECIMAL(14,2) NULL ,
  `INTERESES_MORATORIOS` DECIMAL(14,2) NULL ,
  `COMISIONES` DECIMAL(14,2) NULL ,
  `GASTOS` DECIMAL(14,2) NULL ,
  `RIESGO` DECIMAL(14,2) NULL ,
  `DEUDA_IRREGULAR` DECIMAL(14,2) NULL ,
  `DISPUESTO` DECIMAL(14,2) NULL ,
  `SALDO_PASIVO` DECIMAL(14,2) NULL ,
  `RIESGO_GARANTIA` DECIMAL(14,2) NULL ,
  `SALDO_EXCE` DECIMAL(14,2) NULL ,
  `LIMITE_DESC` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_1` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_2` DECIMAL(14,2) NULL ,
  `MOV_LTV_INI` DECIMAL(16,0) NULL ,
  `MOV_LTV_FIN` DECIMAL(16,0) NULL,
  `DD_MX3_ID` decimal(16,0) DEFAULT NULL,
  `DD_MX4_ID` decimal(16,0) DEFAULT NULL,
  `CNT_LIMITE_INI` decimal(14,2) DEFAULT NULL,
  `CNT_LIMITE_FIN` decimal(14,2) DEFAULT NULL,
  `NUM_CREDITOS_INSINUADOS` INT NULL, 
  `CREDITO_INSINUADO_PRINCIPAL_EXTERNO` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_SUPERVISOR` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_FINAL` DECIMAL(16,2) NULL,
  `DEUDA_EXIGIBLE` decimal(14,2) DEFAULT NULL,
  `CAPITAL_FALLIDO` decimal(16,2) DEFAULT NULL,
  -- Recobro
  `NUM_DPS` INT NULL,
  `NUM_DPS_ACUMULADO` INT NULL,
  `DPS` decimal(14,2) NULL,
  `DPS_CAPITAL` decimal(14,2) NULL,
  `DPS_ICG` decimal(14,2) NULL,
  `DPS_ACUMULADO` decimal(14,2) NULL,
  `DPS_CAPITAL_ACUMULADO` decimal(14,2) NULL,
  `DPS_ICG_ACUMULADO` decimal(14,2) NULL,
  `SALDO_MAXIMO_GESTION` decimal(14,2) NULL,
  `IMPORTE_A_RECLAMAR` decimal(14,2) NULL,
  `NUM_DIAS_EN_GESTION_A_COBRO` INT NULL,
  `NUM_DIAS_IRREGULAR_A_COBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_ACUMULADO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL_ACUMULADO` INT NULL,
  -- Especializada
  `IMPORTE_IRREGULAR_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_FINAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_FINAL` decimal(14,2) NULL
 );
 

  CREATE TABLE IF NOT EXISTS H_CONTRATO_MES( 
  `MES_ID` DECIMAL(16,0) NOT NULL,                                 
  `FECHA_CARGA_DATOS` DATE NOT NULL,                               -- Fecha último día cargado
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL, 
  -- Dimensiones
  `SITUACION_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,              -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_ANTERIOR_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,     -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_RESPECTO_PERIODO_ANT_ID` DECIMAL(16,0) NULL,          -- 0 Mantiene, 1 Alta, 2 Baja
  `DIA_POS_VENCIDA_ID` DATE NULL, 
  `DIA_SALDO_DUDOSO_ID` DATE NULL, 
  `ESTADO_FINANCIERO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_FINANCIERO_ANTERIOR_ID` DECIMAL(16,0) NULL ,
  `ESTADO_CONTRATO_ID` DECIMAL(16,0) NULL ,  
  `CONTRATO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL , 
  `CONTRATO_ESTADO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_INSINUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CAPITAL_FALLIDO_ID` DECIMAL(16,0) NULL ,
  `TIPO_GESTION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `FECHA_CREACION_CONTRATO` DATE NULL,
  -- Recobro
  `EN_GESTION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `FECHA_ALTA_GESTION_RECOBRO` DATE NULL,
  `FECHA_BAJA_GESTION_RECOBRO` DATE NULL,
  `FECHA_COMPROMETIDA_PAGO` DATE NULL,
  `FECHA_DPS` DATE NULL,
  `TRAMO_IRREGULARIDAD_DIAS_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_DIAS_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_EN_GESTION_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_IRREGULAR_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `RESULTADO_ACTUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `MODELO_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `PROVEEDOR_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_EN_IRREGULAR_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_DPS_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CONTACTO_UTIL_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_ACTUACION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  -- Especializada
  `FECHA_PREVISION` date NULL,
  `EN_GESTION_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_REVISADA_ID` DECIMAL(16,0) NULL ,
  `TIPO_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_INICIAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_AUTOMATICO_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_MANUAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_FINAL_ID` DECIMAL(16,0)  NULL ,
  `MOTIVO_PREVISION_ID` DECIMAL(16,0) NULL ,
  `SITUACION_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `GESTOR_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `SUPERVISOR_N1_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N2_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N3_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  -- Estudio Carteras
  `EN_CARTERA_ESTUDIO_ID` DECIMAL(16,0)  NULL ,
  `MODELO_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  `UNIDAD_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  -- Métricas
  `NUM_CONTRATOS` INT NULL,  
  `NUM_CLIENTES_ASOCIADOS` INT NULL,
  `NUM_EXPEDIENTES_ASOCIADOS` INT NULL,
  `NUM_DIAS_VENCIDOS` INT NULL,
  `NUM_DIAS_VENCIDOS_PERIODO_ANT` INT NULL,              
  `SALDO_TOTAL` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_NO_VENCIDA` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_VENCIDA` DECIMAL(14,2) NULL ,
  `SALDO_DUDOSO` DECIMAL(14,2) NULL ,
  `PROVISION` DECIMAL(14,2) NULL ,
  `INTERESES_REMUNERATORIOS` DECIMAL(14,2) NULL ,
  `INTERESES_MORATORIOS` DECIMAL(14,2) NULL ,
  `COMISIONES` DECIMAL(14,2) NULL ,
  `GASTOS` DECIMAL(14,2) NULL ,
  `RIESGO` DECIMAL(14,2) NULL ,
  `DEUDA_IRREGULAR` DECIMAL(14,2) NULL ,
  `DISPUESTO` DECIMAL(14,2) NULL ,
  `SALDO_PASIVO` DECIMAL(14,2) NULL ,
  `RIESGO_GARANTIA` DECIMAL(14,2) NULL ,
  `SALDO_EXCE` DECIMAL(14,2) NULL ,
  `LIMITE_DESC` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_1` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_2` DECIMAL(14,2) NULL ,
  `MOV_LTV_INI` DECIMAL(16,0) NULL ,
  `MOV_LTV_FIN` DECIMAL(16,0) NULL,
  `DD_MX3_ID` decimal(16,0) DEFAULT NULL,
  `DD_MX4_ID` decimal(16,0) DEFAULT NULL,
  `CNT_LIMITE_INI` decimal(14,2) DEFAULT NULL,
  `CNT_LIMITE_FIN` decimal(14,2) DEFAULT NULL,
  `NUM_CREDITOS_INSINUADOS` INT NULL, 
  `CREDITO_INSINUADO_PRINCIPAL_EXTERNO` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_SUPERVISOR` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_FINAL` DECIMAL(16,2) NULL,
  `DEUDA_EXIGIBLE` decimal(14,2) DEFAULT NULL,
  `CAPITAL_FALLIDO` decimal(16,2) DEFAULT NULL,
  -- Recobro
  `NUM_DPS` INT NULL,
  `NUM_DPS_ACUMULADO` INT NULL,
  `DPS` decimal(14,2) NULL,
  `DPS_CAPITAL` decimal(14,2) NULL,
  `DPS_ICG` decimal(14,2) NULL,
  `DPS_ACUMULADO` decimal(14,2) NULL,
  `DPS_CAPITAL_ACUMULADO` decimal(14,2) NULL,
  `DPS_ICG_ACUMULADO` decimal(14,2) NULL,
  `SALDO_MAXIMO_GESTION` decimal(14,2) NULL,
  `IMPORTE_A_RECLAMAR` decimal(14,2) NULL,
  `NUM_DIAS_EN_GESTION_A_COBRO` INT NULL,
  `NUM_DIAS_IRREGULAR_A_COBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_ACUMULADO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL_ACUMULADO` INT NULL,
  -- Especializada
  `IMPORTE_IRREGULAR_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_FINAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_FINAL` decimal(14,2) NULL
 );
 
 
  CREATE TABLE IF NOT EXISTS H_CONTRATO_TRIMESTRE( 
  `TRIMESTRE_ID` DECIMAL(16,0) NOT NULL,                         
  `FECHA_CARGA_DATOS` DATE NOT NULL,                               -- Fecha último día cargado
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL, 
  -- Dimensiones
  `SITUACION_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,              -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_ANTERIOR_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,     -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_RESPECTO_PERIODO_ANT_ID` DECIMAL(16,0) NULL,          -- 0 Mantiene, 1 Alta, 2 Baja
  `DIA_POS_VENCIDA_ID` DATE NULL, 
  `DIA_SALDO_DUDOSO_ID` DATE NULL, 
  `ESTADO_FINANCIERO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_FINANCIERO_ANTERIOR_ID` DECIMAL(16,0) NULL ,
  `ESTADO_CONTRATO_ID` DECIMAL(16,0) NULL ,  
  `CONTRATO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL , 
  `CONTRATO_ESTADO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_INSINUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CAPITAL_FALLIDO_ID` DECIMAL(16,0) NULL ,
  `TIPO_GESTION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `FECHA_CREACION_CONTRATO` DATE NULL,
  -- Recobro
  `EN_GESTION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `FECHA_ALTA_GESTION_RECOBRO` DATE NULL,
  `FECHA_BAJA_GESTION_RECOBRO` DATE NULL,
  `FECHA_COMPROMETIDA_PAGO` DATE NULL,
  `FECHA_DPS` DATE NULL,
  `TRAMO_IRREGULARIDAD_DIAS_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_DIAS_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_EN_GESTION_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_IRREGULAR_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `RESULTADO_ACTUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `MODELO_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `PROVEEDOR_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_EN_IRREGULAR_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_DPS_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CONTACTO_UTIL_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_ACTUACION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  -- Especializada
  `FECHA_PREVISION` date NULL,
  `EN_GESTION_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_REVISADA_ID` DECIMAL(16,0) NULL ,
  `TIPO_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_INICIAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_AUTOMATICO_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_MANUAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_FINAL_ID` DECIMAL(16,0)  NULL ,
  `MOTIVO_PREVISION_ID` DECIMAL(16,0) NULL ,
  `SITUACION_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `GESTOR_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `SUPERVISOR_N1_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N2_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N3_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  -- Estudio Carteras
  `EN_CARTERA_ESTUDIO_ID` DECIMAL(16,0)  NULL ,
  `MODELO_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  `UNIDAD_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  -- Métricas
  `NUM_CONTRATOS` INT NULL,  
  `NUM_CLIENTES_ASOCIADOS` INT NULL,
  `NUM_EXPEDIENTES_ASOCIADOS` INT NULL,
  `NUM_DIAS_VENCIDOS` INT NULL,
  `NUM_DIAS_VENCIDOS_PERIODO_ANT` INT NULL,              
  `SALDO_TOTAL` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_NO_VENCIDA` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_VENCIDA` DECIMAL(14,2) NULL ,
  `SALDO_DUDOSO` DECIMAL(14,2) NULL ,
  `PROVISION` DECIMAL(14,2) NULL ,
  `INTERESES_REMUNERATORIOS` DECIMAL(14,2) NULL ,
  `INTERESES_MORATORIOS` DECIMAL(14,2) NULL ,
  `COMISIONES` DECIMAL(14,2) NULL ,
  `GASTOS` DECIMAL(14,2) NULL ,
  `RIESGO` DECIMAL(14,2) NULL ,
  `DEUDA_IRREGULAR` DECIMAL(14,2) NULL ,
  `DISPUESTO` DECIMAL(14,2) NULL ,
  `SALDO_PASIVO` DECIMAL(14,2) NULL ,
  `RIESGO_GARANTIA` DECIMAL(14,2) NULL ,
  `SALDO_EXCE` DECIMAL(14,2) NULL ,
  `LIMITE_DESC` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_1` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_2` DECIMAL(14,2) NULL ,
  `MOV_LTV_INI` DECIMAL(16,0) NULL ,
  `MOV_LTV_FIN` DECIMAL(16,0) NULL,
  `DD_MX3_ID` decimal(16,0) DEFAULT NULL,
  `DD_MX4_ID` decimal(16,0) DEFAULT NULL,
  `CNT_LIMITE_INI` decimal(14,2) DEFAULT NULL,
  `CNT_LIMITE_FIN` decimal(14,2) DEFAULT NULL,
  `NUM_CREDITOS_INSINUADOS` INT NULL, 
  `CREDITO_INSINUADO_PRINCIPAL_EXTERNO` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_SUPERVISOR` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_FINAL` DECIMAL(16,2) NULL,
  `DEUDA_EXIGIBLE` decimal(14,2) DEFAULT NULL,
  `CAPITAL_FALLIDO` decimal(16,2) DEFAULT NULL,
  -- Recobro
  `NUM_DPS` INT NULL,
  `NUM_DPS_ACUMULADO` INT NULL,
  `DPS` decimal(14,2) NULL,
  `DPS_CAPITAL` decimal(14,2) NULL,
  `DPS_ICG` decimal(14,2) NULL,
  `DPS_ACUMULADO` decimal(14,2) NULL,
  `DPS_CAPITAL_ACUMULADO` decimal(14,2) NULL,
  `DPS_ICG_ACUMULADO` decimal(14,2) NULL,
  `SALDO_MAXIMO_GESTION` decimal(14,2) NULL,
  `IMPORTE_A_RECLAMAR` decimal(14,2) NULL,
  `NUM_DIAS_EN_GESTION_A_COBRO` INT NULL,
  `NUM_DIAS_IRREGULAR_A_COBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_ACUMULADO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL_ACUMULADO` INT NULL,
  -- Especializada
  `IMPORTE_IRREGULAR_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_FINAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_FINAL` decimal(14,2) NULL
 );
 

  CREATE TABLE IF NOT EXISTS H_CONTRATO_ANIO( 
  `ANIO_ID` DECIMAL(16,0) NOT NULL,                                
  `FECHA_CARGA_DATOS` DATE NOT NULL,                               -- Fecha último día cargado
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL, 
  -- Dimensiones
  `SITUACION_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,              -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_ANTERIOR_CONTRATO_DETALLE_ID` DECIMAL(16,0) NULL,     -- 0 Normal, 1 Vencido < 30 días, 2 Vencido 30-60 días, ...
  `SITUACION_RESPECTO_PERIODO_ANT_ID` DECIMAL(16,0) NULL,          -- 0 Mantiene, 1 Alta, 2 Baja
  `DIA_POS_VENCIDA_ID` DATE NULL, 
  `DIA_SALDO_DUDOSO_ID` DATE NULL, 
  `ESTADO_FINANCIERO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_FINANCIERO_ANTERIOR_ID` DECIMAL(16,0) NULL ,
  `ESTADO_CONTRATO_ID` DECIMAL(16,0) NULL ,  
  `CONTRATO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL , 
  `CONTRATO_ESTADO_JUDICIALIZADO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_INSINUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CAPITAL_FALLIDO_ID` DECIMAL(16,0) NULL ,
  `TIPO_GESTION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `FECHA_CREACION_CONTRATO` DATE NULL,
  -- Recobro
  `EN_GESTION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `FECHA_ALTA_GESTION_RECOBRO` DATE NULL,
  `FECHA_BAJA_GESTION_RECOBRO` DATE NULL,
  `FECHA_COMPROMETIDA_PAGO` DATE NULL,
  `FECHA_DPS` DATE NULL,
  `TRAMO_IRREGULARIDAD_DIAS_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_DIAS_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_PERIODO_ANT_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_EN_GESTION_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `TRAMO_DIAS_IRREGULAR_A_COBRO_ID` DECIMAL(16,0) NULL ,
  `RESULTADO_ACTUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `MODELO_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `PROVEEDOR_RECOBRO_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_EN_IRREGULAR_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_DPS_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_CONTACTO_UTIL_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_CON_ACTUACION_RECOBRO_ID` DECIMAL(16,0) NULL ,
  -- Especializada
  `FECHA_PREVISION` date NULL,
  `EN_GESTION_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `CONTRATO_CON_PREVISION_REVISADA_ID` DECIMAL(16,0) NULL ,
  `TIPO_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_INICIAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_AUTOMATICO_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_MANUAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_FINAL_ID` DECIMAL(16,0)  NULL ,
  `MOTIVO_PREVISION_ID` DECIMAL(16,0) NULL ,
  `SITUACION_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `GESTOR_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `SUPERVISOR_N1_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N2_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N3_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  -- Estudio Carteras
  `EN_CARTERA_ESTUDIO_ID` DECIMAL(16,0)  NULL ,
  `MODELO_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  `UNIDAD_GESTION_CARTERA_ID` DECIMAL(16,0) NULL ,
  -- Métricas
  `NUM_CONTRATOS` INT NULL,  
  `NUM_CLIENTES_ASOCIADOS` INT NULL,
  `NUM_EXPEDIENTES_ASOCIADOS` INT NULL,
  `NUM_DIAS_VENCIDOS` INT NULL,
  `NUM_DIAS_VENCIDOS_PERIODO_ANT` INT NULL,              
  `SALDO_TOTAL` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_NO_VENCIDA` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_VENCIDA` DECIMAL(14,2) NULL ,
  `SALDO_DUDOSO` DECIMAL(14,2) NULL ,
  `PROVISION` DECIMAL(14,2) NULL ,
  `INTERESES_REMUNERATORIOS` DECIMAL(14,2) NULL ,
  `INTERESES_MORATORIOS` DECIMAL(14,2) NULL ,
  `COMISIONES` DECIMAL(14,2) NULL ,
  `GASTOS` DECIMAL(14,2) NULL ,
  `RIESGO` DECIMAL(14,2) NULL ,
  `DEUDA_IRREGULAR` DECIMAL(14,2) NULL ,
  `DISPUESTO` DECIMAL(14,2) NULL ,
  `SALDO_PASIVO` DECIMAL(14,2) NULL ,
  `RIESGO_GARANTIA` DECIMAL(14,2) NULL ,
  `SALDO_EXCE` DECIMAL(14,2) NULL ,
  `LIMITE_DESC` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_1` DECIMAL(14,2) NULL ,
  `MOV_EXTRA_2` DECIMAL(14,2) NULL ,
  `MOV_LTV_INI` DECIMAL(16,0) NULL ,
  `MOV_LTV_FIN` DECIMAL(16,0) NULL,
  `DD_MX3_ID` decimal(16,0) DEFAULT NULL,
  `DD_MX4_ID` decimal(16,0) DEFAULT NULL,
  `CNT_LIMITE_INI` decimal(14,2) DEFAULT NULL,
  `CNT_LIMITE_FIN` decimal(14,2) DEFAULT NULL,
  `NUM_CREDITOS_INSINUADOS` INT NULL, 
  `CREDITO_INSINUADO_PRINCIPAL_EXTERNO` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_SUPERVISOR` DECIMAL(16,2) NULL ,
  `CREDITO_INSINUADO_PRINCIPAL_FINAL` DECIMAL(16,2) NULL,
  `DEUDA_EXIGIBLE` decimal(14,2) DEFAULT NULL,
  `CAPITAL_FALLIDO` decimal(16,2) DEFAULT NULL,
  -- Recobro
  `NUM_DPS` INT NULL,
  `NUM_DPS_ACUMULADO` INT NULL,
  `DPS` decimal(14,2) NULL,
  `DPS_CAPITAL` decimal(14,2) NULL,
  `DPS_ICG` decimal(14,2) NULL,
  `DPS_ACUMULADO` decimal(14,2) NULL,
  `DPS_CAPITAL_ACUMULADO` decimal(14,2) NULL,
  `DPS_ICG_ACUMULADO` decimal(14,2) NULL,
  `SALDO_MAXIMO_GESTION` decimal(14,2) NULL,
  `IMPORTE_A_RECLAMAR` decimal(14,2) NULL,
  `NUM_DIAS_EN_GESTION_A_COBRO` INT NULL,
  `NUM_DIAS_IRREGULAR_A_COBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_ACUMULADO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL_ACUMULADO` INT NULL,
  -- Especializada
  `IMPORTE_IRREGULAR_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_FINAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_FINAL` decimal(14,2) NULL
 );
 

-- ----------------------------------------------------------------------------------------------
--                            H_CONTRATO_INICIO_CAMPANA_RECOBRO
-- ----------------------------------------------------------------------------------------------
 CREATE TABLE IF NOT EXISTS H_CONTRATO_INICIO_CAMPANA_RECOBRO( 
  `FECHA_INICIO_CAMPANA_RECOBRO` DATE NOT NULL,                     -- Fecha último día cargado
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL, 
  -- Dimensiones
  `ESTADO_FINANCIERO_CONTRATO_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_FINANCIERO_ANTERIOR_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL , 
  -- Recobro
  `EN_GESTION_RECOBRO_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_DIAS_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `TRAMO_IRREGULARIDAD_FASES_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `MODELO_RECOBRO_CONTRATO_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `PROVEEDOR_RECOBRO_CONTRATO_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL ,
  `CONTRATO_EN_IRREGULAR_INICIO_CAMPANA_RECOBRO_ID` DECIMAL(16,0) NULL ,
  -- Métricas
  `NUM_CONTRATOS_INICIO_CAMPANA_RECOBRO` INT NULL,  
  `NUM_DIAS_VENCIDOS_INICIO_CAMPANA_RECOBRO` INT NULL,
  `SALDO_TOTAL_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_NO_VENCIDA_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `POSICION_VIVA_VENCIDA_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `SALDO_DUDOSO_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `PROVISION_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `INTERESES_REMUNERATORIOS_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `INTERESES_MORATORIOS_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `COMISIONES_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `GASTOS_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `RIESGO_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `DEUDA_IRREGULAR_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `DISPUESTO_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `SALDO_PASIVO_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `RIESGO_GARANTIA_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  `SALDO_EXCE_INICIO_CAMPANA_RECOBRO` DECIMAL(14,2) NULL ,
  -- Recobro
  `IMPORTE_A_RECLAMAR_INICIO_CAMPANA_RECOBRO` decimal(14,2) NULL
 );
 

-- =========================================================================================================================
--                                                 TABLAS TEMPORALES
-- =========================================================================================================================
 
 CREATE TABLE IF NOT EXISTS TEMP_FECHA( 
  `DIA_H` DATE NULL,  -- Fecha H_TEMP
  `DIA_ANT` DATE NULL,  -- Sig fecha
  `MES_H` INT NULL,
  `MES_ANT` INT NULL,
  `TRIMESTRE_H` INT NULL,
  `TRIMESTRE_ANT` INT NULL,
  `ANIO_H` INT NULL,
  `ANIO_ANT` INT NULL
 );

 
 CREATE TABLE IF NOT EXISTS TEMP_FECHA_AUX( 
  `DIA_AUX` DATE NULL,
  `MES_AUX` INT NULL,
  `TRIMESTRE_AUX` INT NULL,
  `ANIO_AUX` INT NULL
 );

 CREATE TABLE IF NOT EXISTS TEMP_H( 
  `DIA_H` DATE NULL, 
  `MES_H` INT NULL,
  `TRIMESTRE_H` INT NULL,
  `ANIO_H` INT NULL,
  `CONTRATO_H` DECIMAL(16,0) NOT NULL,
  `SITUACION_CONTRATO_DETALLE_H` INT NULL,
  `NUM_DIAS_VENCIDOS_H` INT NULL,              
  `TRAMO_IRREGULARIDAD_FASES_H` DECIMAL(16,0) NULL
 );


  CREATE TABLE IF NOT EXISTS TEMP_ANT( 
  `DIA_ANT` DATE NULL,  
  `MES_ANT` INT NULL,
  `TRIMESTRE_ANT` INT NULL,
  `ANIO_ANT` INT NULL,
  `CONTRATO_ANT` DECIMAL(16,0) NOT NULL,
  `SITUACION_CONTRATO_DETALLE_ANT` INT NULL,
  `NUM_DIAS_VENCIDOS_PERIODO_ANT` INT NULL,              
  `TRAMO_IRREGULARIDAD_FASES_PERIODO_ANT` DECIMAL(16,0) NULL 
 );
 
 
  CREATE TABLE IF NOT EXISTS TEMP_MANTIENE( 
  `DIA_ID` DATE NULL,  
  `MES_ID` DECIMAL(16,0) NULL,
  `TRIMESTRE_ID` DECIMAL(16,0) NULL,
  `ANIO_ID` DECIMAL(16,0) NULL,
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL
 );


  CREATE TABLE IF NOT EXISTS TEMP_ALTA( 
  `DIA_ID` DATE NULL, 
  `MES_ID` DECIMAL(16,0) NULL,
  `TRIMESTRE_ID` DECIMAL(16,0) NULL,
  `ANIO_ID` DECIMAL(16,0) NULL,
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL
 );


  CREATE TABLE IF NOT EXISTS TEMP_BAJA( 
  `DIA_H` DATE NULL,        -- Fecha en tabla hechos
  `DIA_MOV` DATE NULL,      -- Fecha en Mov_Movimientos
  `MES_H` INT NULL,         -- Mes en tabla hechos
  `MES_MOV` INT NULL,       -- Mes en Mov_Movimientos
  `TRIMESTRE_H` INT NULL,   -- Trimestre en tabla hechos
  `TRIMESTRE_MOV` INT NULL, -- Trimestre en Mov_Movimientos
  `ANIO_H` INT NULL,        -- Año en tabla hechos
  `ANIO_MOV` INT NULL,      -- Año en Mov_Movimientos
  `CONTRATO_ID` DECIMAL(16,0) NOT NULL,
  `SITUACION_CONTRATO_DETALLE_ANT` INT NULL,
  `NUM_DIAS_VENCIDOS_PERIODO_ANT` INT NULL,              
  `TRAMO_IRREGULARIDAD_FASES_PERIODO_ANT` DECIMAL(16,0) NULL 
 );


  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_PROCEDIMIENTO_AUX( 
  `CONTRATO_ID` DECIMAL(16,0) NULL, 
  `PROCEDIMIENTO_ID` DECIMAL(16,0) NULL,
  `ESTADO_PROCEDIMIENTO_ID` DECIMAL(16,0) NULL,
  `TIPO_PROCEDIMIENTO_AGRUPADO_ID` DECIMAL(16,0) NULL
  );
 
 
  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_PROCEDIMIENTO( 
  `CONTRATO_ID` DECIMAL(16,0) NULL, 
  `LITIGIO` DECIMAL(16,0) NULL,
  `CONCURSO` DECIMAL(16,0) NULL,
  `ESTADO_PROCEDIMIENTO_ID` DECIMAL(16,0) NULL 
 );

 
  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_SITUACION_FINANCIERA( 
  `CONTRATO_ID` DECIMAL(16,0) NULL, 
  `SITUACION_FINANCIERA_DESC` VARCHAR(50) NULL
 );

 
  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_CREDITO_INSINUADO (
  `CONTRATO_ID` DECIMAL(16,0) NULL,  
  `CREDITO_ID` DECIMAL(16,0) NULL ,
  `ESTADO_INSINUACION_CONTRATO_ID` DECIMAL(16,0) NULL,
  `CREDITO_PRINCIPAL_EXTERNO` DECIMAL(16,2) NULL,
  `CREDITO_PRINCIPAL_SUPERVISOR` DECIMAL(16,2) NULL,
  `CREDITO_PRINCIPAL_FINAL` DECIMAL(16,2) NULL,
  `FECHA_CREDITO` DATE NULL
  );  
  
    
  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_RECOBRO (
  `CONTRATO_ID` DECIMAL(16,0) NULL,  
  `NUM_DPS_ACUMULADO` INT NULL,
  `DPS_ACUMULADO` decimal(14,2) DEFAULT NULL,
  `DPS_CAPITAL_ACUMULADO` decimal(14,2) DEFAULT NULL,
  `DPS_ICG_ACUMULADO` decimal(14,2) DEFAULT NULL,
  `RESULTADO_ACTUACION_CONTRATO_ID` DECIMAL(16,0) NULL ,
  `FECHA_COMPROMETIDA_PAGO` DATE NULL,
  `MODELO_RECOBRO_ID` DECIMAL(16,0) NULL, 
  `MAX_PRIORIDAD_ACTUACION` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_ACUMULADO` INT NULL,
  `NUM_ACTUACIONES_RECOBRO_CON_CONTACTO_UTIL_ACUMULADO` INT NULL
 );  
 
 
  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_DPS (
  `ID_CONTRATO` DECIMAL(16,0) NULL,
  `DPS_FINAL` decimal(14,2) NULL,
  `DPS_CAPITAL` decimal(14,2) NULL,
  `DPS_ICG` decimal(14,2) NULL
 );  
 
 
  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_ACTIVIDAD (
  `CONTRATO_ID` DECIMAL(16,0) NULL,
  `FECHA_ACTUACION` DATE NULL,
  `FECHA_COMPROMETIDA_PAGO` DATE NULL,
  `RESULTADO_ACTUACION_CONTRATO_ID` DECIMAL(16,0) NULL,
  `PRIORIDAD_ACTUACION` INT NULL
 );
 
     
  CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_ESPECIALIZADA (
  `CONTRATO_ID` DECIMAL(16,0) NULL,  
  `SITUACION_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `GESTOR_ESPECIALIZADA_ID` DECIMAL(16,0) NULL ,
  `SUPERVISOR_N1_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N2_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL ,
  `SUPERVISOR_N3_ESPECIALIZADA_ID` DECIMAL(16,0)  NULL
 );  
 

 CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_PREVISIONES (
  `CONTRATO_ID` DECIMAL(16,0) NULL,
  `FECHA_PREVISION` date NULL,
  `FECHA_SIG_PREVISION` date NULL,
  `CONTRATO_CON_PREVISION_REVISADA_ID` DECIMAL(16,0) NULL ,
  `TIPO_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_INICIAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_AUTOMATICO_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_MANUAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_FINAL_ID` DECIMAL(16,0)  NULL ,
  `MOTIVO_PREVISION_ID` DECIMAL(16,0) NULL ,
  `IMPORTE_IRREGULAR_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_FINAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_FINAL` decimal(14,2) NULL
 );  
 
 
 CREATE TABLE IF NOT EXISTS TEMP_CONTRATO_PREVISIONES_DIA (
  `CONTRATO_ID` DECIMAL(16,0) NULL,
  `FECHA_PREVISION` date NULL,
  `FECHA_SIG_PREVISION` date NULL,
  `CONTRATO_CON_PREVISION_REVISADA_ID` DECIMAL(16,0) NULL ,
  `TIPO_PREVISION_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_INICIAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_AUTOMATICO_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_MANUAL_ID` DECIMAL(16,0)  NULL ,
  `PREVISION_SITUACION_FINAL_ID` DECIMAL(16,0)  NULL ,
  `MOTIVO_PREVISION_ID` DECIMAL(16,0) NULL ,
  `IMPORTE_IRREGULAR_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_IRREGULAR_PREVISION_FINAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_INICIO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_AUTOMATICO` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_MANUAL` decimal(14,2) NULL,
  `IMPORTE_RIESGO_PREVISION_FINAL` decimal(14,2) NULL
 );  


  CREATE TABLE IF NOT EXISTS TEMP_CONTRATOS_JUDICIALIZADOS_RESTANTES(                               
  `CONTRATO_ID` DECIMAL(16,0) NULL,
  `ULTIMO_DIA_CONTRATO` DATE NULL
 );  
 
 
 CREATE TABLE IF NOT EXISTS TEMP_CONTRATOS_JUDICIALIZADOS_RESTANTES_AUX(                               
  `CONTRATO_ID` DECIMAL(16,0) NULL,
  `MOV_FECHA_EXTRACCION` DATE NULL
 ); 
 
-- ----------------------------------------------------------------------------------------------
--                            TABLAS ESTUDIO CARTERA
-- ----------------------------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS TEMP_LOAN_INFORMATION( 
    IN_SECURED_UNSECURED	VARCHAR(250) NULL ,
    NUC	DECIMAL(16,0) NULL ,
    NUC_RIESGO	DECIMAL(16,0) NULL ,
    CCC	VARCHAR(250) NULL ,
    CCC_RIESGO	VARCHAR(250) NULL ,
    FECHA_FORMALIZACION	VARCHAR(250) NULL ,
    FECHA_VENCIMIENTO	VARCHAR(250) NULL ,
    PRODUCTO_NIVEL_2 VARCHAR(250) NULL ,
    PRODUCTO_NIVEL_3 VARCHAR(250) NULL ,
    PRODUCTO_NIVEL_4 VARCHAR(250) NULL ,
    PRODUCTO_NIVEL_5 VARCHAR(250) NULL ,
    PRODUCTO_AGRUPADO	VARCHAR(250) NULL ,
    LTV_ORIGINAL	VARCHAR(250) NULL ,
    SITUACION_CONTABLE_NIVEL_1	VARCHAR(250) NULL ,
    SITUACION_CONTABLE_NIVEL_2	VARCHAR(250) NULL ,
    FECHA_ENTRADA_FALLIDO	VARCHAR(250) NULL ,
    FECHA_1ER_VCTO_PENDIENTE	VARCHAR(250) NULL ,
    FECHA_ENTRADA_MORA	VARCHAR(250) NULL ,
    DIAS_ATRASO	VARCHAR(250) NULL ,
    CUOTA_EMITIDA_NO_PAGADA	VARCHAR(250) NULL ,
    SALDO_DEUDOR	VARCHAR(250) NULL ,
    INTERESES_VENCIDOS	VARCHAR(250) NULL ,
    DISPONIBLE	VARCHAR(250) NULL ,
    CAPITAL_VENCIDO	VARCHAR(250) NULL ,
    CAPITAL_FALLIDO	VARCHAR(250) NULL ,
    FIRST_DELINCUENCY_DATE	VARCHAR(250) NULL ,
    LAST_DELINCUENCY_DATE	VARCHAR(250) NULL ,
    NUM_IRREGULAR_STATUS	VARCHAR(250) NULL ,
    NUM_NP_STATUS	VARCHAR(250) NULL ,
    TIPO_REFERENCIA	VARCHAR(250) NULL ,
    REFERENCIA	VARCHAR(250) NULL ,
    PERIODICIDAD_INDICE	VARCHAR(250) NULL ,
    FECHA_REVISION_TIPO	VARCHAR(250) NULL ,
    INTERES	VARCHAR(250) NULL ,
    DIFERENCIAL	VARCHAR(250) NULL ,
    DIFERENCIAL_BONIFICADO	VARCHAR(250) NULL ,
    INTERES_MINIMO	VARCHAR(250) NULL ,
    TASA_INTERES_DEMORA	VARCHAR(250) NULL ,
    COMISION_CANCELACION	VARCHAR(250) NULL ,
    IN_SEGURO_HIPOTECARIO	VARCHAR(250) NULL ,
    COMPANIA	VARCHAR(250) NULL ,
    CAPITAL_ASEGURADO	VARCHAR(250) NULL ,
    IN_SINDICADO	VARCHAR(250) NULL ,
    PORCENTAJE_PARTIPACION	VARCHAR(250) NULL ,
    PRINCIPAL	VARCHAR(250) NULL ,
    PRINCIPAL_ORIGINAL	VARCHAR(250) NULL ,
    NUM_LIMITE_REDUCE	VARCHAR(250) NULL ,
    NUM_LIMITE_INCREMENTA	VARCHAR(250) NULL ,
    CREDIT_SCORE	VARCHAR(250) NULL ,
    DEBT_TO_INCOME_RATIO	VARCHAR(250) NULL ,
    JUZGADO	VARCHAR(250) NULL ,
    PASO_PROCESAL_ID	VARCHAR(250) NULL ,
    PASO_PROCESAL	VARCHAR(250) NULL ,
    PROCEDIMIENTO_JUDICIAL	VARCHAR(250) NULL ,
    FASE_RECUPERACION	VARCHAR(250) NULL ,
    FECHA_PRESENTACION_DEMANDA	VARCHAR(250) NULL ,
    IMPORTE_RECLAMADO	VARCHAR(250) NULL ,
    FECHA_ADMISION_DEMANDA	VARCHAR(250) NULL ,
    FECHA_SUBASTA	VARCHAR(250) NULL ,
    IMPORTE_SUBASTA	VARCHAR(250) NULL ,
    FECHA_TOMA_POSESION	VARCHAR(250) NULL
);


CREATE TABLE IF NOT EXISTS TEMP_ESTUDIO_CARTERA ( 
    CONTRATO_ID	DECIMAL(16,0) NULL ,
    NUC	DECIMAL(16,0) NULL ,
    NUC_RIESGO	DECIMAL(16,0) NULL , 
    CAPITAL_FALLIDO	VARCHAR(250) NULL,
    FECHA_PRIMER_VENCIMIENTO_PENDIENTE DATE NULL,
    PASO	DECIMAL(16,0) NULL,
    EN_MASIVA	DECIMAL(16,0) NULL,
    NGB_UGAS	DECIMAL(16,0) NULL
);


CREATE TABLE IF NOT EXISTS TEMP_EN_MASIVA ( 
    CONTRATO_ID	DECIMAL(16,0) NULL
);


END MY_BLOCK_H_CNT
