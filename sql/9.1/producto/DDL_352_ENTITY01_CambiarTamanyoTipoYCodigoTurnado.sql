--/*
--##########################################
--## AUTOR=Alberto Soler
--## FECHA_CREACION=20160129
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.1
--## INCIDENCIA_LINK=PRODUCTO-677
--## PRODUCTO=SÍ
--## 
--## Finalidad: Modificacion columnas ETC_TIPO y ETC_CODIGO. CODIGO_IMPORTE CODIGO_CALIDAD. 
--## ETC_CON_CODIGO_IMPORTE, ETC_CON_CODIGO_CALIDAD,ETC_LIT_CODIGO_IMPORTE y ETC_LIT_CODIGO_CALIDAD
--## INSTRUCCIONES:  Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;


DECLARE

 V_ESQUEMA VARCHAR2(25 CHAR):=   '#ESQUEMA#'; 			-- Configuracion Esquema
 V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; 		-- Configuracion Esquema Master
 err_num NUMBER;
 err_msg VARCHAR2(2048 CHAR); 
 V_MSQL VARCHAR2(8500 CHAR);
 V_TMP VARCHAR2(10);
 V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
 V_COUNT NUMBER(16); -- Vble. para validar la existencia de una tabla.  

  BEGIN 
		   -- CAMBIA A CARACTER CORRECTO ETC_TIPO
		   V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''ETC_TIPO'' AND TABLE_NAME = ''ETC_ESQUEMA_TURNADO_CONFIG''';
		   EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		   IF V_COUNT > 0 THEN
		   	DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_TIPO ya existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.ETC_ESQUEMA_TURNADO_CONFIG MODIFY ETC_TIPO VARCHAR2(10 char)';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('ETC_TIPO MODIFICADO A  VARCHAR2 DE 10');
		   ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_TIPO no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.ETC_ESQUEMA_TURNADO_CONFIG ADD (etc_tipo  VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('ETC_TIPO MODIFICADO A  VARCHAR2 DE 10');
		   END IF;

		  -- CAMBIA A CARACTER CORRECTO ETC_CODIGO
		  V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''ETC_CODIGO'' AND TABLE_NAME = ''ETC_ESQUEMA_TURNADO_CONFIG''';
		  EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		  IF V_COUNT > 0 THEN
		  	DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_CODIGO ya existe en la tabla');
		 	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.ETC_ESQUEMA_TURNADO_CONFIG MODIFY ETC_CODIGO VARCHAR2(10 CHAR)';
		  	EXECUTE IMMEDIATE V_MSQL;
		  	DBMS_OUTPUT.put_line('ETC_CODIGO MODIFICADO A  VARCHAR2 DE 10');
		  ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_CODIGO no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.ETC_ESQUEMA_TURNADO_CONFIG ADD (ETC_CODIGO  VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('ETC_CODIGO MODIFICADO A  VARCHAR2 DE 10');
		  END IF;
		
		  -- CAMBIA A CARACTER CORRECTO CODIGO_IMPORTE
		  V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''CODIGO_IMPORTE'' AND TABLE_NAME = ''TMP_AAT_ASIG_TURNADO_LETRADOS''';
		  EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		  IF V_COUNT > 0 THEN
		  	DBMS_OUTPUT.PUT_LINE('[INFO] El campo CODIGO_IMPORTE ya existe en la tabla');
		  	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.TMP_AAT_ASIG_TURNADO_LETRADOS MODIFY CODIGO_IMPORTE VARCHAR2(10 CHAR)';
		  	EXECUTE IMMEDIATE V_MSQL;
		  	DBMS_OUTPUT.put_line('CODIGO_IMPORTE MODIFICADO A  VARCHAR2 DE 10');
		  ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo CODIGO_IMPORTE  no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.TMP_AAT_ASIG_TURNADO_LETRADOS ADD (CODIGO_IMPORTE  VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('CODIGO_IMPORTE MODIFICADO A  VARCHAR2 DE 10');
		  END IF;

		  -- CAMBIA A CARACTER CORRECTO CODIGO_CALIDAD
		  V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''CODIGO_CALIDAD'' AND TABLE_NAME = ''TMP_AAT_ASIG_TURNADO_LETRADOS''';
		  EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		  IF V_COUNT > 0 THEN
		  	DBMS_OUTPUT.PUT_LINE('[INFO] El campo CODIGO_CALIDAD ya existe en la tabla');
		  	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.TMP_AAT_ASIG_TURNADO_LETRADOS MODIFY CODIGO_CALIDAD VARCHAR2(10 CHAR)';
		  	EXECUTE IMMEDIATE V_MSQL;
		  	DBMS_OUTPUT.put_line('CODIGO_CALIDAD MODIFICADO A  VARCHAR2 DE 10');
		  ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo CODIGO_CALIDAD no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.TMP_AAT_ASIG_TURNADO_LETRADOS ADD (CODIGO_CALIDAD  VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('CODIGO_CALIDAD MODIFICADO A  VARCHAR2 DE 10');
		  END IF;
		  
		  --CAMBIA A CARACTER CORRECTO ETC_CON_CODIGO_IMPORTE
		  V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''ETC_CON_CODIGO_IMPORTE'' AND TABLE_NAME = ''DES_DESPACHO_EXTERNO''';
		  EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		  IF V_COUNT > 0 THEN
		  	DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_CON_CODIGO_IMPORTE ya existe en la tabla');
		  	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO MODIFY ETC_CON_CODIGO_IMPORTE VARCHAR2(10 CHAR)';
		  	EXECUTE IMMEDIATE V_MSQL;
		  	DBMS_OUTPUT.put_line('ETC_CON_CODIGO_IMPORTE MODIFICADO A  VARCHAR2 DE 10');
		  ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_CON_CODIGO_IMPORTE no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO ADD (ETC_CON_CODIGO_IMPORTE  VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('ETC_CON_CODIGO_IMPORTE MODIFICADO A  VARCHAR2 DE 10');
		  END IF;
		  
		  --CAMBIA A CARACTER CORRECTO ETC_CON_CODIGO_CALIDAD
		  V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''ETC_CON_CODIGO_CALIDAD'' AND TABLE_NAME = ''DES_DESPACHO_EXTERNO''';
		  EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		  IF V_COUNT > 0 THEN
		  	DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_CON_CODIGO_CALIDAD ya existe en la tabla');
		  	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO MODIFY ETC_CON_CODIGO_CALIDAD VARCHAR2(10 CHAR)';
		  	EXECUTE IMMEDIATE V_MSQL;
		  	DBMS_OUTPUT.put_line('ETC_CON_CODIGO_CALIDAD MODIFICADO A  VARCHAR2 DE 10');
		  ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_CON_CODIGO_CALIDAD no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO ADD (ETC_CON_CODIGO_CALIDAD VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('ETC_CON_CODIGO_CALIDAD MODIFICADO A  VARCHAR2 DE 10');
		  END IF;
		  
		  --CAMBIA A CARACTER CORRECTO ETC_LIT_CODIGO_IMPORTE
		  V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''ETC_LIT_CODIGO_IMPORTE'' AND TABLE_NAME = ''DES_DESPACHO_EXTERNO''';
		  EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		  IF V_COUNT > 0 THEN
		  	DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_LIT_CODIGO_IMPORTE ya existe en la tabla');
			 V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO MODIFY ETC_LIT_CODIGO_IMPORTE VARCHAR2(10 CHAR)';
			 EXECUTE IMMEDIATE V_MSQL;
			 DBMS_OUTPUT.put_line('ETC_LIT_CODIGO_IMPORTE MODIFICADO A  VARCHAR2 DE 10');
		  ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_LIT_CODIGO_IMPORTE no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO ADD (ETC_LIT_CODIGO_IMPORTE VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('ETC_LIT_CODIGO_IMPORTE MODIFICADO A  VARCHAR2 DE 10');
		  END IF;
		  
		  --CAMBIA A CARACTER CORRECTO ETC_LIT_CODIGO_CALIDAD
		  V_SQL := 'SELECT COUNT(1) FROM ALL_TAB_COLUMNS WHERE COLUMN_NAME = ''ETC_LIT_CODIGO_CALIDAD'' AND TABLE_NAME = ''DES_DESPACHO_EXTERNO''';
		  EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		  IF V_COUNT > 0 THEN
		  	DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_LIT_CODIGO_CALIDAD ya existe en la tabla');
		  	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO MODIFY ETC_LIT_CODIGO_CALIDAD VARCHAR2(10 CHAR)';
		  	EXECUTE IMMEDIATE V_MSQL;
		  	DBMS_OUTPUT.put_line('ETC_LIT_CODIGO_CALIDAD MODIFICADO A  VARCHAR2 DE 10');
		  ELSE
			DBMS_OUTPUT.PUT_LINE('[INFO] El campo ETC_LIT_CODIGO_CALIDAD no existe en la tabla');
		   	V_MSQL := 'ALTER TABLE '||V_ESQUEMA||'.DES_DESPACHO_EXTERNO ADD (ETC_LIT_CODIGO_CALIDAD VARCHAR2(10 CHAR))';
		   	EXECUTE IMMEDIATE V_MSQL;
		   	DBMS_OUTPUT.put_line('ETC_LIT_CODIGO_CALIDAD MODIFICADO A  VARCHAR2 DE 10');
		  END IF;

COMMIT;

--Excepciones

EXCEPTION
WHEN OTHERS THEN  
  err_num := SQLCODE;
  err_msg := SQLERRM;

  DBMS_OUTPUT.put_line('Error:'||TO_CHAR(err_num));
  DBMS_OUTPUT.put_line(err_msg);
  
  ROLLBACK;
  RAISE;
END;
/
EXIT;

