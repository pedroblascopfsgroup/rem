--/*
--###########################################
--## AUTOR=Teresa Alonso
--## FECHA_CREACION=20170511
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=0.1
--## INCIDENCIA_LINK=HREOS-2022
--## PRODUCTO=NO
--## 
--## Finalidad: Re-asignar gestores de activo (por numero activo) al gestor jberenguer
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--###########################################
----*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE

  V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
  V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
  V_ESQUEMA_MASTER VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
  V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
  V_NUM NUMBER(16); -- Vble. para validar la existencia de una tabla.   
  ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
  ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.

BEGIN	

	DBMS_OUTPUT.PUT_LINE('[INICIO] COMIENZA EL PROCESO PARA LA RE-ASIGNACIÓN DE GESTORES PARA ');
	DBMS_OUTPUT.PUT_LINE('         ACTIVOS ASIGNADOS POR DEFECTO A OTRO GESTOR'||CHR(10));
	
	EXECUTE IMMEDIATE '
	SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = ''TMP_GEST_ACT'' AND OWNER = '''||V_ESQUEMA||'''
	'
	INTO V_NUM
	;
	
	IF V_NUM > 0 THEN
  
    EXECUTE IMMEDIATE '
		TRUNCATE TABLE '||V_ESQUEMA||'.TMP_GEST_ACT
		'
		;
	
		EXECUTE IMMEDIATE '
		DROP TABLE '||V_ESQUEMA||'.TMP_GEST_ACT
		'
		;
		
	END IF;

	EXECUTE IMMEDIATE '
	CREATE GLOBAL TEMPORARY TABLE '||V_ESQUEMA||'.TMP_GEST_ACT ON COMMIT PRESERVE ROWS AS (
	
	SELECT
	GEE_ID,
	GESTOR_CORRECTO,
	DD_TGE_ID,
	'||V_ESQUEMA||'.S_GEH_GESTOR_ENTIDAD_HIST.NEXTVAL AS GEH_ID,
	ACT_ID
	FROM (
	
		SELECT DISTINCT
		GEE.GEE_ID,
		GEE.DD_TGE_ID,
		GES.USUARIO_GESTION_ACTIVOS AS GESTOR_CORRECTO,
		GAC.ACT_ID
		FROM '||V_ESQUEMA||'.GEE_GESTOR_ENTIDAD GEE
		INNER JOIN '||V_ESQUEMA||'.GAC_GESTOR_ADD_ACTIVO GAC
			ON GAC.GEE_ID = GEE.GEE_ID
		INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
			ON ACT.ACT_ID = GAC.ACT_ID
		INNER JOIN '||V_ESQUEMA||'.BIE_BIEN BIE
			ON BIE.BIE_ID = ACT.BIE_ID
		INNER JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION LOC
			ON LOC.BIE_ID = BIE.BIE_ID
		LEFT JOIN '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV
			ON LOC.DD_PRV_ID = PRV.DD_PRV_ID
		LEFT JOIN '||V_ESQUEMA||'.ACT_GES_DISTRIBUCION GES
			ON GES.COD_PROVINCIA = PRV.DD_PRV_CODIGO
		LEFT JOIN '||V_ESQUEMA_MASTER||'.USU_USUARIOS USU
			ON USU.USU_ID = GEE.USU_ID
		LEFT JOIN '||V_ESQUEMA_MASTER||'.DD_TGE_TIPO_GESTOR TGE
			ON TGE.DD_TGE_ID = GEE.DD_TGE_ID
		LEFT JOIN '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO
			ON UPO.DD_UPO_CODIGO = GES.COD_MUNICIPIO
		WHERE TGE.DD_TGE_CODIGO = ''GACT''

		AND ACT.ACT_NUM_ACTIVO_UVEM in (
			''22747894'',
			''22049773'',
			''28082088'',
			''20811441'',
			''26553470'',
			''22051302'',
			''21322639'',
			''22049053'',
			''22049422'',
			''22050372'',
			''22049890'',
			''22049305'',
			''22051419'',
			''26718438'',
			''24870242'',
			''27887587'',
			''27887722'',
			''22050741'',
			''27887236'',
			''27887956'',
			''20538925'',
			''26553587'',
			''21043544'',
			''22059102'',
			''22048861'',
			''22050858'',
			''22049656'',
			''22049170'',
			''22051653'',
			''22051887'',
			''22050255'',
			''22050489'',
			''22051050'',
			''27887470'',
			''27887839'',
			''22783065'',
			''22804553'',
			''22797014'',
			''22804202'',
			''22756896'',
			''22051536'',
			''22050507'',
			''22050624'',
			''22051167'',
			''22049908'',
			''22050138'',
			''19388643'',
			''27887353'',
			''22049539'',
			''22051770'',
			''22776139'',
			''22769330'',
			''22769447'',
			''22783434'',
			''22050975'',
			''27887605'',
			''22050021'',
			''22048978'',
			''22051284'',
			''22051905'',
			''22790009'',
			''22769564'',
			''22776022'',
			''19388760'',
			''22783317'',
			''22763120'',
			''22783668'',
			''19388877'',
			''19389186'',
			''22763237'',
			''22763354'',
			''22804319'',
			''28535153'',
			''28535639'',
			''21427006'',
			''24755185'',
			''28535270'',
			''28535405'',
			''28535387'',
			''28535756'',
			''28535522'',
			''23924207'',
			''28535873'',
			''23924324'',
			''17208262'',
			''17208982'',
			''17206924'',
			''17207602'',
			''17210025'',
			''21320194'',
			''21317420'',
			''21321007'',
			''21317285'',
			''21318566'',
			''21319361'',
			''21319613'',
			''21320212'',
			''21321241'',
			''21317537'',
			''21318701'',
			''21318818'',
			''21319964'',
			''21320815'',
			''21088633'',
			''21088984'',
			''21089059'',
			''26287997'',
			''21715940'',
			''19322679'',
			''27426946'',
			''15426877'',
			''21716015'',
			''21716366'',
			''21716249'',
			''21480709'',
			''21716132'',
			''17207836'',
			''17209174'',
			''17209426'',
			''17206789'',
			''17207953'',
			''17209912'',
			''17206807'',
			''17210259'',
			''21089293'',
			''17210142'',
			''17207584'',
			''21088750'',
			''26339806'',
			''17208496'',
			''17209057'',
			''17209777'',
			''17208748'',
			''17207116'',
			''17207467'',
			''17208145'',
			''17209309'',
			''17209543'',
			''17208028'',
			''19315267'',
			''20184620'',
			''21088498'',
			''21089311'',
			''21088867'',
			''22060655'',
			''21089176'',
			''23924441'',
			''21088516'',
			''17207233'',
			''17207350'',
			''17208379'',
			''17209660'',
			''17207098'',
			''17209894'',
			''17207719'',
			''17209291'',
			''21318332'',
			''21319127'',
			''21318197'',
			''21318935'',
			''21320680'',
			''21317654'',
			''21319010'',
			''21320563'',
			''21317906'',
			''21320329'',
			''21320932'',
			''21317888'',
			''21319478'',
			''21320446'',
			''21321124'',
			''21318215'',
			''26287880'',
			''21317303'',
			''21317771'',
			''21318080'',
			''21318683'',
			''21320077'',
			''21319595'',
			''21319847'',
			''21320797'',
			''21317168'',
			''21318449'',
			''21319244'',
			''21319730'',
			''28081896'',
			''22926732'',
			''22924656'',
			''22925334'',
			''28906802'',
			''28907696'',
			''22927158'',
			''22925937'',
			''22928070'',
			''22924287'',
			''22926129'',
			''28871482'',
			''22927644'',
			''22925217'',
			''22925685'',
			''22924908'',
			''28907111'',
			''28907714'',
			''28536551'',
			''13666811'',
			''22782873'',
			''22927527'',
			''22925451'',
			''22927392'',
			''22927995'',
			''22924539'',
			''22926363'',
			''21421264'',
			''22927041'',
			''22926597'',
			''22925820'',
			''22926246'',
			''22762811'',
			''22756545'',
			''22797482'',
			''22770532'',
			''22804670'',
			''22764032'',
			''22925703'',
			''22924890'',
			''22926012'',
			''22049287'',
			''28906433'',
			''28907462'',
			''22927878'',
			''22923978'',
			''22924170'',
			''22927275'',
			''22925082'',
			''22926615'',
			''22926480'',
			''28907228'',
			''22926966'',
			''22927410'',
			''22927761'',
			''22924305'',
			''22924053'',
			''22790126'',
			''22783920'',
			''28536182'',
			''28536065'',
			''28536200'',
			''28906667'',
			''28907093'',
			''27888031'',
			''28906550'',
			''28907579'',
			''28907831'',
			''28082223'',
			''21421381'',
			''28536317'',
			''21421516'',
			''22804787'',
			''22769798'',
			''28081914'',
			''20516886'',
			''22782522'',
			''21421498'',
			''22926849'',
			''22924422'',
			''22925100'',
			''22924773'',
			''22925568'',
			''22763588'',
			''28906784'',
			''28906919'',
			''28907345'',
			''16564652'',
			''28535990'',
			''28536434'',
			''21530307'',
			''20788928'',
			''22718713'',
			''28081662'',
			''19527924'',
			''22762928'',
			''22768904'',
			''22782756'',
			''17716368'',
			''24049109'',
			''22805582'',
			''22764383'',
			''22776742'',
			''22757223'',
			''22805465'',
			''22764266'',
			''22763957'',
			''26717877'',
			''19527186'',
			''26553605'',
			''22797617'',
			''22757691'',
			''22757106'',
			''22805231'',
			''22770163'',
			''16277350'',
			''21181885'',
			''21858859'',
			''22052817'',
			''24712541'',
			''24712910'',
			''19427532'',
			''20538790'',
			''22060052'',
			''22770415'',
			''26388464'',
			''16061882'',
			''19083492'',
			''24712775'',
			''24712892'',
			''17793934'',
			''20538808'',
			''14982359'',
			''20538556'',
			''20538673'',
			''23925605'',
			''26553722'',
			''26168689'',
			''20245881'',
			''28081311'',
			''26717994'',
			''28081293'',
			''26209771'',
			''26718204'',
			''26717760'',
			''20026064'',
			''22805348'',
			''22770046'',
			''22769195'',
			''22796822'',
			''26718555'',
			''26718186'',
			''26718789'',
			''26717526'',
			''26717409'',
			''20111730'',
			''16184505'',
			''21117725'',
			''21117842'',
			''21183727'',
			''20543892'',
			''21117590'',
			''21117959'',
			''21117608'',
			''22014598'',
			''22014850'',
			''22015159'',
			''22015276'',
			''22015996'',
			''22015879'',
			''21183610'',
			''22014967'',
			''22015645'',
			''22015762'',
			''21117473'',
			''22013083'',
			''22014616'',
			''22014733'',
			''22015528'',
			''21720187'',
			''20788793'',
			''16379818'',
			''16380885'',
			''17981405'',
			''16380651'',
			''19244191'',
			''19244443'',
			''19811032'',
			''19601171'',
			''20658776'',
			''20658911'',
			''20659085'',
			''20659103'',
			''20659220'',
			''19601288'',
			''21089428'',
			''20026298'',
			''20026181'',
			''20977545'',
			''20977779'',
			''20977428'',
			''20977662'',
			''20977896'',
			''20977914'',
			''20978106'',
			''20978223'',
			''20978457'',
			''20978574'',
			''20978340'',
			''20978691'',
			''20978709'',
			''20978943'',
			''20979018'',
			''20978826'',
			''20979135'',
			''20979621'',
			''20979252'',
			''20979504'',
			''20979855'',
			''20979369'',
			''20979738'',
			''20979486'',
			''20979972'',
			''20980085'',
			''28081428'',
			''28082106'',
			''28082457'',
			''28082340'',
			''28082574'',
			''28081779'',
			''28081545'',
			''20512383'',
			''20513547'',
			''20512149'',
			''20512266'',
			''20513430'',
			''20513898'',
			''20514828'',
			''20514945'',
			''20513313'',
			''20513664'',
			''20514108'',
			''20514342'',
			''20514693'',
			''20515254'',
			''20515488'',
			''20512752'',
			''20512869'',
			''20513178'',
			''20513781'',
			''20514711'',
			''20514090'',
			''20514459'',
			''20512401'',
			''20512635'',
			''20512986'',
			''20513295'',
			''20515371'',
			''20512518'',
			''20513061'',
			''20514576'',
			''20515020'',
			''20515137'',
			''24712658''
						)
		AND USU.USU_USERNAME not in (''jberenguer'') 
		AND GES.PROVINCIA IS NOT NULL
		AND GES.MUNICIPIO IS NULL
		AND GEE.BORRADO = 0
	)
	)
	'
	;
	
	V_NUM := SQL%ROWCOUNT;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] SE VA A ACTUALIZAR EL GESTOR A '||V_NUM||' ACTIVOS.');
 
	DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZANDO USU_ID EN GEE_GESTOR_ENTIDAD...');
	
	EXECUTE IMMEDIATE '
	MERGE INTO '||V_ESQUEMA||'.GEE_GESTOR_ENTIDAD GEE USING
	(
	SELECT 
	TMPGEST.GEE_ID,
	TMPGEST.ACT_ID,
	USU.USU_ID
	FROM '||V_ESQUEMA||'.TMP_GEST_ACT TMPGEST
	LEFT JOIN '||V_ESQUEMA_MASTER||'.USU_USUARIOS USU
		ON USU.USU_USERNAME = ''jberenguer'' 
	) TMP
	ON (GEE.GEE_ID = TMP.GEE_ID)
	WHEN MATCHED THEN UPDATE SET
	GEE.USU_ID = TMP.USU_ID,
	GEE.USUARIOMODIFICAR = ''HREOS-2022-3'',
	GEE.FECHAMODIFICAR = SYSDATE
	'
	;
	
	V_NUM := SQL%ROWCOUNT;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] GEE_GESTOR_ENTIDAD ACTUALIZADA...'||V_NUM||' REGISTROS.');
	
	DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZANDO GEH_FECHA_HASTA EN GEH_GESTOR_ENTIDAD_HIST PARA DAR DE BAJA EL ANTERIOR GESTOR...');
	
	EXECUTE IMMEDIATE '
	MERGE INTO '||V_ESQUEMA||'.GEH_GESTOR_ENTIDAD_HIST GEH USING
	(
	WITH ACT AS (
    SELECT DISTINCT
    TMP.ACT_ID,
    GAH.GEH_ID,
    TMP.DD_TGE_ID,
    (SELECT USU_ID FROM '||V_ESQUEMA_MASTER||'.USU_USUARIOS WHERE USU_USERNAME =  ''jberenguer'' ) AS USU_ID 
    FROM '||V_ESQUEMA||'.TMP_GEST_ACT TMP
    LEFT JOIN '||V_ESQUEMA||'.GAH_GESTOR_ACTIVO_HISTORICO GAH
      ON GAH.ACT_ID = TMP.ACT_ID
    LEFT JOIN '||V_ESQUEMA||'.GAC_GESTOR_ADD_ACTIVO GAC
      ON GAC.ACT_ID = TMP.ACT_ID
    LEFT JOIN '||V_ESQUEMA||'.GEE_GESTOR_ENTIDAD GEE
      ON GEE.GEE_ID = GAC.GEE_ID
    WHERE GAH.ACT_ID IS NOT NULL
    AND GEE.USUARIOMODIFICAR = ''HREOS-2022-3''
  )
  SELECT GEH.GEH_ID
  FROM ACT
  INNER JOIN '||V_ESQUEMA||'.GEH_GESTOR_ENTIDAD_HIST GEH
    ON GEH.GEH_ID = ACT.GEH_ID
  WHERE GEH.USU_ID != ACT.USU_ID
  AND GEH.DD_TGE_ID = ACT.DD_TGE_ID
	) TMP
	ON (GEH.GEH_ID = TMP.GEH_ID)
	WHEN MATCHED THEN UPDATE SET
	GEH.GEH_FECHA_HASTA = SYSDATE,
	GEH.USUARIOMODIFICAR = ''HREOS-2022-3'',
	GEH.FECHAMODIFICAR = SYSDATE
	'
	;
	
	V_NUM := SQL%ROWCOUNT;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] GEH_GESTOR_ENTIDAD_HIST ACTUALIZADA...'||V_NUM||' REGISTROS.');
	
	DBMS_OUTPUT.PUT_LINE('[INFO] INSERTANDO NUEVOS REGISTROS EN GEH_GESTOR_ENTIDAD_HIST PARA DAR DE ALTA EL NUEVO GESTOR...');
	
	EXECUTE IMMEDIATE '
	INSERT INTO '||V_ESQUEMA||'.GEH_GESTOR_ENTIDAD_HIST GEH
	(GEH_ID,
	USU_ID,
	DD_TGE_ID,
	GEH_FECHA_DESDE,
	USUARIOCREAR,
	FECHACREAR,
	BORRADO
	)
	SELECT
	GEH_ID,
	(SELECT USU_ID FROM '||V_ESQUEMA_MASTER||'.USU_USUARIOS WHERE USU_USERNAME = ''jberenguer'' ) AS USU_ID, 
	DD_TGE_ID,
	SYSDATE AS GEH_FECHA_DESDE,
	''HREOS-2022-3'' AS USUARIOCREAR,
	SYSDATE AS FECHACREAR,
	0 AS BORRADO
	FROM '||V_ESQUEMA||'.TMP_GEST_ACT TMP
	'
	;
	
	V_NUM := SQL%ROWCOUNT;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] INSERTADOS '||V_NUM||' REGISTROS EN GEH_GESTOR_ENTIDAD_HIST.');
	
	DBMS_OUTPUT.PUT_LINE('[INFO] INSERTANDO NUEVOS REGISTROS EN GAH_GESTOR_ACTIVO_HISTORICO PARA RELACIONAR LOS REGISTROS DE');
	DBMS_OUTPUT.PUT_LINE('       GEH_GESTOR_ENTIDAD_HIST CON LOS ACTIVOS...');
	
	EXECUTE IMMEDIATE '
	INSERT INTO '||V_ESQUEMA||'.GAH_GESTOR_ACTIVO_HISTORICO GAH
	(GEH_ID,
	ACT_ID
	)
	SELECT 
	GEH_ID,
	ACT_ID
	FROM '||V_ESQUEMA||'.TMP_GEST_ACT
	'
	;
	
	V_NUM := SQL%ROWCOUNT;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] INSERTADOS '||V_NUM||' REGISTROS EN GAH_GESTOR_ACTIVO_HISTORICO.');
	
	DBMS_OUTPUT.PUT_LINE('[INFO] GESTORES ACTUALIZADOS CORRECTAMENTE.'||CHR(10));

--      HREOS-2022-3:No asignar gestores a las tareas afectadas  	
--	DBMS_OUTPUT.PUT_LINE('[INFO] SE VAN A RE-ASIGNAR LOS GESTORES PARA LAS TAREAS AFECTADAS...');
	
--	DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZANDO USU_ID EN TAC_TAREAS_ACTIVO...');
	
--	EXECUTE IMMEDIATE '
--	MERGE INTO '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS TAC USING
--	(
--	SELECT
--	TAC.TAR_ID,
--	TAC.ACT_ID,
--	TAC.USU_ID,
--	GEE.GEE_ID,
--	GEE.DD_TGE_ID as GEE_DD_TGE_ID,
--	TAP.DD_TGE_ID as TAP_DD_TGE_ID,
--	GEE.USU_ID as USU_ID_NEW
--	FROM '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS TAC 
--	INNER JOIN '||V_ESQUEMA||'.TAR_TAREAS_NOTIFICACIONES TAR
--	  ON TAR.TAR_ID = TAC.TAR_ID
--	INNER JOIN '||V_ESQUEMA||'.TEX_TAREA_EXTERNA TEX
--	  ON TEX.TAR_ID = TAR.TAR_ID
--	INNER JOIN '||V_ESQUEMA||'.TAP_TAREA_PROCEDIMIENTO TAP
--	  ON TAP.TAP_ID = TEX.TAP_ID
--	INNER JOIN '||V_ESQUEMA||'.GAC_GESTOR_ADD_ACTIVO GAC 
--	  ON GAC.ACT_ID = TAC.ACT_ID
--	INNER JOIN '||V_ESQUEMA||'.GEE_GESTOR_ENTIDAD GEE 
--	  ON GEE.GEE_ID = GAC.GEE_ID
--	WHERE GEE.DD_TGE_ID = (select dd_tge_id from remmaster.dd_tge_tipo_gestor where dd_tge_codigo = ''GACT'')
--	AND TAP.DD_TGE_ID = (select dd_tge_id from remmaster.dd_tge_tipo_gestor where dd_tge_codigo = ''GACT'') 
--	AND TAC.USU_ID != GEE.USU_ID
--	AND TAR.TAR_FECHA_FIN IS NULL
--	--AND TAC.BORRADO = 0
--	--AND TAR.BORRADO = 0
--	--AND TEX.BORRADO = 0
--	--AND TAP.BORRADO = 0
--	AND GEE.BORRADO = 0
--	AND GEE.USUARIOMODIFICAR = ''HREOS-2022-3''
--	) TMP
--	ON (TAC.TAR_ID = TMP.TAR_ID)
--	WHEN MATCHED THEN UPDATE SET
--	TAC.USU_ID = TMP.USU_ID_NEW,
--	TAC.USUARIOMODIFICAR = ''HREOS-2022-3'',
--	TAC.FECHAMODIFICAR = SYSDATE
--	'
--	;
--	
--	V_NUM := SQL%ROWCOUNT;
--	
--	DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZADOS '||V_NUM||' REGISTROS EN TAC_TAREAS_ACTIVOS.');
--	
--	DBMS_OUTPUT.PUT_LINE('[INFO] TAREAS ACTUALIZADAS.'||CHR(10));
--
	 
 	EXECUTE IMMEDIATE '
	SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = ''TMP_GEST_ACT'' AND OWNER = '''||V_ESQUEMA||'''
	'
	INTO V_NUM
	;

	IF V_NUM > 0 THEN
  
    EXECUTE IMMEDIATE '
		TRUNCATE TABLE '||V_ESQUEMA||'.TMP_GEST_ACT
		'
		;
	
		EXECUTE IMMEDIATE '
		DROP TABLE '||V_ESQUEMA||'.TMP_GEST_ACT
		'
		;
		
	END IF;
	
	DBMS_OUTPUT.PUT_LINE('[FIN]  PROCESO FINALIZADO CORRECTAMENTE ');
 
EXCEPTION

   WHEN OTHERS THEN
        err_num := SQLCODE;
        err_msg := SQLERRM;

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);

        ROLLBACK;
        RAISE;          

END;

/

EXIT
