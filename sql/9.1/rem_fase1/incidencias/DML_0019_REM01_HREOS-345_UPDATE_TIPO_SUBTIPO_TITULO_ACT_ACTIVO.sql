--/*
--#########################################
--## AUTOR=PABLO MESEGUER
--## FECHA_CREACION=20160429
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=0.1
--## INCIDENCIA_LINK=HREOS-345
--## PRODUCTO=NO
--## 
--## Finalidad: Actualizar TIPO_TITULO/SUBTIPO_TITULO en los activos de prinex, en ACT__ACTIVO. 
--##			   
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versi√≥n inicial
--#########################################
----*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
  V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
  V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
  V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
  V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
  V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.      
  ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
  ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.

  TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
  TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
  V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
	T_TIPO_DATA('41853','02','13'),
	T_TIPO_DATA('47921','02','13'),
	T_TIPO_DATA('28192','02','13'),
	T_TIPO_DATA('30800','02','13'),
	T_TIPO_DATA('28813','02','13'),
	T_TIPO_DATA('67846','01','01'),
	T_TIPO_DATA('29690','02','13'),
	T_TIPO_DATA('67955','01','01'),
	T_TIPO_DATA('45665','02','13'),
	T_TIPO_DATA('12386','02','13'),
	T_TIPO_DATA('46942','02','13'),
	T_TIPO_DATA('28125','02','13'),
	T_TIPO_DATA('29799','02','13'),
	T_TIPO_DATA('42986','02','13'),
	T_TIPO_DATA('52061','02','13'),
	T_TIPO_DATA('41511','02','13'),
	T_TIPO_DATA('28199','02','13'),
	T_TIPO_DATA('15464','02','13'),
	T_TIPO_DATA('34337','02','13'),
	T_TIPO_DATA('28124','02','13'),
	T_TIPO_DATA('29798','02','13'),
	T_TIPO_DATA('28121','02','13'),
	T_TIPO_DATA('46012','02','13'),
	T_TIPO_DATA('40354','02','13'),
	T_TIPO_DATA('28120','02','13'),
	T_TIPO_DATA('28291','02','13'),
	T_TIPO_DATA('46017','02','13'),
	T_TIPO_DATA('28341','02','13'),
	T_TIPO_DATA('54158','02','13'),
	T_TIPO_DATA('30802','02','13'),
	T_TIPO_DATA('15471','02','13'),
	T_TIPO_DATA('11819','02','13'),
	T_TIPO_DATA('43039','02','13'),
	T_TIPO_DATA('43040','02','13'),
	T_TIPO_DATA('30788','02','13'),
	T_TIPO_DATA('51541','02','13'),
	T_TIPO_DATA('28187','02','13'),
	T_TIPO_DATA('28193','02','13'),
	T_TIPO_DATA('28198','02','13'),
	T_TIPO_DATA('28202','02','13'),
	T_TIPO_DATA('46943','02','13'),
	T_TIPO_DATA('28715','02','13'),
	T_TIPO_DATA('31330','02','13'),
	T_TIPO_DATA('28119','02','13'),
	T_TIPO_DATA('54151','02','13'),
	T_TIPO_DATA('30804','02','13'),
	T_TIPO_DATA('28127','02','13'),
	T_TIPO_DATA('50556','02','13'),
	T_TIPO_DATA('54154','02','13'),
	T_TIPO_DATA('32845','02','13'),
	T_TIPO_DATA('22741','02','13'),
	T_TIPO_DATA('32842','02','13'),
	T_TIPO_DATA('12407','02','13'),
	T_TIPO_DATA('28195','02','13'),
	T_TIPO_DATA('44701','02','13'),
	T_TIPO_DATA('2207','02','13'),
	T_TIPO_DATA('28716','02','13'),
	T_TIPO_DATA('1153','02','13'),
	T_TIPO_DATA('1395','02','13'),
	T_TIPO_DATA('28748','02','13'),
	T_TIPO_DATA('32176','02','13'),
	T_TIPO_DATA('28343','02','13'),
	T_TIPO_DATA('29787','02','13'),
	T_TIPO_DATA('31329','02','13'),
	T_TIPO_DATA('67956','01','01'),
	T_TIPO_DATA('28334','02','13'),
	T_TIPO_DATA('20138','02','13'),
	T_TIPO_DATA('67942','02','04'),
	T_TIPO_DATA('22742','02','13'),
	T_TIPO_DATA('67945','02','03'),
	T_TIPO_DATA('67944','02','03'),
	T_TIPO_DATA('11347','02','13'),
	T_TIPO_DATA('25977','02','13'),
	T_TIPO_DATA('43885','02','13'),
	T_TIPO_DATA('28293','02','13'),
	T_TIPO_DATA('67532','01','02'),
	T_TIPO_DATA('67946','02','03'),
	T_TIPO_DATA('67938','02','03'),
	T_TIPO_DATA('67941','02','04'),
	T_TIPO_DATA('67398','02','04'),
	T_TIPO_DATA('67485','02','04'),
	T_TIPO_DATA('6829','02','13'),
	T_TIPO_DATA('15452','02','13'),
	T_TIPO_DATA('44694','02','13'),
	T_TIPO_DATA('67556','01','01'),
	T_TIPO_DATA('67613','01','01'),
	T_TIPO_DATA('67619','01','01'),
	T_TIPO_DATA('67635','01','01'),
	T_TIPO_DATA('67574','01','01'),
	T_TIPO_DATA('1087','02','13'),
	T_TIPO_DATA('6832','02','13'),
	T_TIPO_DATA('67598','01','01'),
	T_TIPO_DATA('67602','01','01'),
	T_TIPO_DATA('67659','01','01'),
	T_TIPO_DATA('67745','01','01'),
	T_TIPO_DATA('67766','01','01'),
	T_TIPO_DATA('67708','01','01'),
	T_TIPO_DATA('67710','01','01'),
	T_TIPO_DATA('67715','01','01'),
	T_TIPO_DATA('67717','01','01'),
	T_TIPO_DATA('67721','01','01'),
	T_TIPO_DATA('67722','01','01'),
	T_TIPO_DATA('44705','02','13'),
	T_TIPO_DATA('67731','01','01'),
	T_TIPO_DATA('67689','01','01'),
	T_TIPO_DATA('67694','01','01'),
	T_TIPO_DATA('67674','01','01'),
	T_TIPO_DATA('67679','01','01'),
	T_TIPO_DATA('1135','02','13'),
	T_TIPO_DATA('44526','02','13'),
	T_TIPO_DATA('11814','02','13'),
	T_TIPO_DATA('15470','02','13'),
	T_TIPO_DATA('40356','02','13'),
	T_TIPO_DATA('1616','02','13'),
	T_TIPO_DATA('6803','02','13'),
	T_TIPO_DATA('44703','02','13'),
	T_TIPO_DATA('28753','02','13'),
	T_TIPO_DATA('28814','02','13'),
	T_TIPO_DATA('67540','01','01'),
	T_TIPO_DATA('67547','01','01'),
	T_TIPO_DATA('67554','01','01'),
	T_TIPO_DATA('67640','01','01'),
	T_TIPO_DATA('67564','01','01'),
	T_TIPO_DATA('67566','01','01'),
	T_TIPO_DATA('67568','01','01'),
	T_TIPO_DATA('67580','01','01'),
	T_TIPO_DATA('67588','01','01'),
	T_TIPO_DATA('67589','01','01'),
	T_TIPO_DATA('67591','01','01'),
	T_TIPO_DATA('67593','01','01'),
	T_TIPO_DATA('67594','01','01'),
	T_TIPO_DATA('67595','01','01'),
	T_TIPO_DATA('67601','01','01'),
	T_TIPO_DATA('67645','01','01'),
	T_TIPO_DATA('67740','01','01'),
	T_TIPO_DATA('67758','01','01'),
	T_TIPO_DATA('67707','01','01'),
	T_TIPO_DATA('67680','01','01'),
	T_TIPO_DATA('67693','01','01'),
	T_TIPO_DATA('67730','01','01'),
	T_TIPO_DATA('67701','01','01'),
	T_TIPO_DATA('67700','01','01'),
	T_TIPO_DATA('67557','01','01'),
	T_TIPO_DATA('67599','01','01'),
	T_TIPO_DATA('67652','01','01'),
	T_TIPO_DATA('67735','01','01'),
	T_TIPO_DATA('67762','01','01'),
	T_TIPO_DATA('67662','01','01'),
	T_TIPO_DATA('67672','01','01'),
	T_TIPO_DATA('67684','01','01'),
	T_TIPO_DATA('67541','01','01'),
	T_TIPO_DATA('67553','01','01'),
	T_TIPO_DATA('67548','01','01'),
	T_TIPO_DATA('67623','01','01'),
	T_TIPO_DATA('67628','01','01'),
	T_TIPO_DATA('67642','01','01'),
	T_TIPO_DATA('67562','01','01'),
	T_TIPO_DATA('67592','01','01'),
	T_TIPO_DATA('67648','01','01'),
	T_TIPO_DATA('67651','01','01'),
	T_TIPO_DATA('67733','01','01'),
	T_TIPO_DATA('67738','01','01'),
	T_TIPO_DATA('67747','01','01'),
	T_TIPO_DATA('67753','01','01'),
	T_TIPO_DATA('67754','01','01'),
	T_TIPO_DATA('67764','01','01'),
	T_TIPO_DATA('67681','01','01'),
	T_TIPO_DATA('67685','01','01'),
	T_TIPO_DATA('29803','02','13'),
	T_TIPO_DATA('44704','02','13'),
	T_TIPO_DATA('30805','02','13'),
	T_TIPO_DATA('28123','02','13'),
	T_TIPO_DATA('28126','02','13'),
	T_TIPO_DATA('27749','02','13'),
	T_TIPO_DATA('42987','02','13'),
	T_TIPO_DATA('40896','02','13'),
	T_TIPO_DATA('40359','02','13'),
	T_TIPO_DATA('41854','02','13'),
	T_TIPO_DATA('32846','02','13'),
	T_TIPO_DATA('67546','01','01'),
	T_TIPO_DATA('67550','01','01'),
	T_TIPO_DATA('67617','01','01'),
	T_TIPO_DATA('67632','01','01'),
	T_TIPO_DATA('67633','01','01'),
	T_TIPO_DATA('67636','01','01'),
	T_TIPO_DATA('67637','01','01'),
	T_TIPO_DATA('67638','01','01'),
	T_TIPO_DATA('67570','01','01'),
	T_TIPO_DATA('67596','01','01'),
	T_TIPO_DATA('67600','01','01'),
	T_TIPO_DATA('67688','01','01'),
	T_TIPO_DATA('67644','01','01'),
	T_TIPO_DATA('67656','01','01'),
	T_TIPO_DATA('67734','01','01'),
	T_TIPO_DATA('67736','01','01'),
	T_TIPO_DATA('67741','01','01'),
	T_TIPO_DATA('67743','01','01'),
	T_TIPO_DATA('67749','01','01'),
	T_TIPO_DATA('67760','01','01'),
	T_TIPO_DATA('67719','01','01'),
	T_TIPO_DATA('67724','01','01'),
	T_TIPO_DATA('67698','01','01'),
	T_TIPO_DATA('67666','01','01'),
	T_TIPO_DATA('67682','01','01'),
	T_TIPO_DATA('67691','01','01'),
	T_TIPO_DATA('67555','01','01'),
	T_TIPO_DATA('67603','01','01'),
	T_TIPO_DATA('67607','01','01'),
	T_TIPO_DATA('67609','01','01'),
	T_TIPO_DATA('67611','01','01'),
	T_TIPO_DATA('67621','01','01'),
	T_TIPO_DATA('67626','01','01'),
	T_TIPO_DATA('67641','01','01'),
	T_TIPO_DATA('67582','01','01'),
	T_TIPO_DATA('67597','01','01'),
	T_TIPO_DATA('67643','01','01'),
	T_TIPO_DATA('67649','01','01'),
	T_TIPO_DATA('67650','01','01'),
	T_TIPO_DATA('67657','01','01'),
	T_TIPO_DATA('67660','01','01'),
	T_TIPO_DATA('67750','01','01'),
	T_TIPO_DATA('67756','01','01'),
	T_TIPO_DATA('67759','01','01'),
	T_TIPO_DATA('67767','01','01'),
	T_TIPO_DATA('67705','01','01'),
	T_TIPO_DATA('67711','01','01'),
	T_TIPO_DATA('67727','01','01'),
	T_TIPO_DATA('67729','01','01'),
	T_TIPO_DATA('67697','01','01'),
	T_TIPO_DATA('67670','01','01'),
	T_TIPO_DATA('67676','01','01'),
	T_TIPO_DATA('67683','01','01'),
	T_TIPO_DATA('67545','01','01'),
	T_TIPO_DATA('67558','01','01'),
	T_TIPO_DATA('67549','01','01'),
	T_TIPO_DATA('67615','01','01'),
	T_TIPO_DATA('67630','01','01'),
	T_TIPO_DATA('67639','01','01'),
	T_TIPO_DATA('67576','01','01'),
	T_TIPO_DATA('67653','01','01'),
	T_TIPO_DATA('67739','01','01'),
	T_TIPO_DATA('67744','01','01'),
	T_TIPO_DATA('67746','01','01'),
	T_TIPO_DATA('67751','01','01'),
	T_TIPO_DATA('67725','01','01'),
	T_TIPO_DATA('67686','01','01'),
	T_TIPO_DATA('67943','02','03'),
	T_TIPO_DATA('66965','01','01'),
	T_TIPO_DATA('67543','01','01'),
	T_TIPO_DATA('67559','01','01'),
	T_TIPO_DATA('67551','01','01'),
	T_TIPO_DATA('67605','01','01'),
	T_TIPO_DATA('67625','01','01'),
	T_TIPO_DATA('67560','01','01'),
	T_TIPO_DATA('67572','01','01'),
	T_TIPO_DATA('67578','01','01'),
	T_TIPO_DATA('67583','01','01'),
	T_TIPO_DATA('67584','01','01'),
	T_TIPO_DATA('67586','01','01'),
	T_TIPO_DATA('67647','01','01'),
	T_TIPO_DATA('67654','01','01'),
	T_TIPO_DATA('67655','01','01'),
	T_TIPO_DATA('67658','01','01'),
	T_TIPO_DATA('67661','01','01'),
	T_TIPO_DATA('67737','01','01'),
	T_TIPO_DATA('67742','01','01'),
	T_TIPO_DATA('67748','01','01'),
	T_TIPO_DATA('67702','01','01'),
	T_TIPO_DATA('67703','01','01'),
	T_TIPO_DATA('67706','01','01'),
	T_TIPO_DATA('67713','01','01'),
	T_TIPO_DATA('67696','01','01'),
	T_TIPO_DATA('67664','01','01'),
	T_TIPO_DATA('67668','01','01'),
	T_TIPO_DATA('67678','01','01'),
	T_TIPO_DATA('67692','01','01'),
	T_TIPO_DATA('40885','02','13'),
	T_TIPO_DATA('43887','02','13'),
	T_TIPO_DATA('43884','02','13'),
	T_TIPO_DATA('41855','02','13'),
	T_TIPO_DATA('41512','02','13'),
	T_TIPO_DATA('28194','02','13'),
	T_TIPO_DATA('15450','02','13'),
	T_TIPO_DATA('28756','02','13'),
	T_TIPO_DATA('28130','02','13'),
	T_TIPO_DATA('40357','02','13'),
	T_TIPO_DATA('43882','02','13'),
	T_TIPO_DATA('29800','02','13'),
	T_TIPO_DATA('44381','02','13'),
	T_TIPO_DATA('43886','02','13'),
	T_TIPO_DATA('34339','02','13'),
	T_TIPO_DATA('43881','02','13'),
	T_TIPO_DATA('28128','02','13'),
	T_TIPO_DATA('28196','02','13'),
	T_TIPO_DATA('4916','02','13'),
	T_TIPO_DATA('8572','02','13'),
	T_TIPO_DATA('11718','02','13'),
	T_TIPO_DATA('11344','02','13'),
	T_TIPO_DATA('3814','02','13'),
	T_TIPO_DATA('8561','02','13'),
	T_TIPO_DATA('28755','02','13'),
	T_TIPO_DATA('28294','02','13'),
	T_TIPO_DATA('34336','02','13'),
	T_TIPO_DATA('15457','02','13'),
	T_TIPO_DATA('15449','02','13'),
	T_TIPO_DATA('28757','02','13'),
	T_TIPO_DATA('40895','02','13'),
	T_TIPO_DATA('28340','02','13'),
	T_TIPO_DATA('40346','02','13'),
	T_TIPO_DATA('40350','02','13'),
	T_TIPO_DATA('8562','02','13'),
	T_TIPO_DATA('20626','02','13'),
	T_TIPO_DATA('31327','02','13'),
	T_TIPO_DATA('31260','02','13'),
	T_TIPO_DATA('67843','01','01'),
	T_TIPO_DATA('13353','02','13'),
	T_TIPO_DATA('28743','02','13'),
	T_TIPO_DATA('32263','02','13'),
	T_TIPO_DATA('22739','02','13'),
	T_TIPO_DATA('22735','02','13'),
	T_TIPO_DATA('1042','02','13'),
	T_TIPO_DATA('13701','02','13'),
	T_TIPO_DATA('2416','02','13'),
	T_TIPO_DATA('40353','02','13'),
	T_TIPO_DATA('15463','02','13'),
	T_TIPO_DATA('2208','02','13'),
	T_TIPO_DATA('40355','02','13'),
	T_TIPO_DATA('8563','02','13'),
	T_TIPO_DATA('46026','02','13'),
	T_TIPO_DATA('13823','02','13'),
	T_TIPO_DATA('30797','02','13'),
	T_TIPO_DATA('11818','02','13'),
	T_TIPO_DATA('33707','02','13'),
	T_TIPO_DATA('29804','02','13'),
	T_TIPO_DATA('25971','02','13'),
	T_TIPO_DATA('40351','02','13'),
	T_TIPO_DATA('15465','02','13'),
	T_TIPO_DATA('30795','02','13'),
	T_TIPO_DATA('12403','02','13'),
	T_TIPO_DATA('42988','02','13'),
	T_TIPO_DATA('46018','02','13'),
	T_TIPO_DATA('42981','02','13'),
	T_TIPO_DATA('64236','02','13'),
	T_TIPO_DATA('2271','02','13'),
	T_TIPO_DATA('15469','02','13'),
	T_TIPO_DATA('43036','02','13'),
	T_TIPO_DATA('28750','02','13'),
	T_TIPO_DATA('27709','02','13'),
	T_TIPO_DATA('22632','02','13'),
	T_TIPO_DATA('22633','02','13'),
	T_TIPO_DATA('31328','02','13'),
	T_TIPO_DATA('43883','02','13'),
	T_TIPO_DATA('67212','02','04'),
	T_TIPO_DATA('46022','02','13'),
	T_TIPO_DATA('40347','02','13'),
	T_TIPO_DATA('29796','02','13'),
	T_TIPO_DATA('1136','02','13'),
	T_TIPO_DATA('46027','02','13'),
	T_TIPO_DATA('27762','02','13'),
	T_TIPO_DATA('45666','02','13'),
	T_TIPO_DATA('25967','02','13'),
	T_TIPO_DATA('11813','02','13'),
	T_TIPO_DATA('65384','02','13'),
	T_TIPO_DATA('1080','02','13'),
	T_TIPO_DATA('6894','02','13'),
	T_TIPO_DATA('33158','02','13'),
	T_TIPO_DATA('32844','02','13'),
	T_TIPO_DATA('28759','02','13'),
	T_TIPO_DATA('2488','02','13'),
	T_TIPO_DATA('32847','02','13'),
	T_TIPO_DATA('51540','02','13'),
	T_TIPO_DATA('51538','02','13'),
	T_TIPO_DATA('31332','02','13'),
	T_TIPO_DATA('40894','02','13'),
	T_TIPO_DATA('22942','02','13'),
	T_TIPO_DATA('57528','02','13'),
	T_TIPO_DATA('32848','02','13'),
	T_TIPO_DATA('30801','02','13'),
	T_TIPO_DATA('22761','02','13'),
	T_TIPO_DATA('13354','02','13'),
	T_TIPO_DATA('9480','02','13'),
	T_TIPO_DATA('28760','02','13'),
	T_TIPO_DATA('52051','02','13'),
	T_TIPO_DATA('6565','02','13'),
	T_TIPO_DATA('30793','02','13'),
	T_TIPO_DATA('30794','02','13'),
	T_TIPO_DATA('20746','02','13'),
	T_TIPO_DATA('22762','02','13'),
	T_TIPO_DATA('40352','02','13'),
	T_TIPO_DATA('33155','02','13'),
	T_TIPO_DATA('1041','02','13'),
	T_TIPO_DATA('27750','02','13'),
	T_TIPO_DATA('31331','02','13'),
	T_TIPO_DATA('31262','02','13'),
	T_TIPO_DATA('28122','02','13'),
	T_TIPO_DATA('28758','02','13'),
	T_TIPO_DATA('56005','02','13'),
	T_TIPO_DATA('22740','02','13'),
	T_TIPO_DATA('15466','02','13'),
	T_TIPO_DATA('29731','02','13'),
	T_TIPO_DATA('8451','02','13'),
	T_TIPO_DATA('11817','02','13'),
	T_TIPO_DATA('47475','02','13'),
	T_TIPO_DATA('28749','02','13'),
	T_TIPO_DATA('40515','02','13'),
	T_TIPO_DATA('1194','02','13'),
	T_TIPO_DATA('11346','02','13'),
	T_TIPO_DATA('67830','01','01'),
	T_TIPO_DATA('52052','02','13'),
	T_TIPO_DATA('44702','02','13'),
	T_TIPO_DATA('40075','02','13'),
	T_TIPO_DATA('29692','02','13'),
	T_TIPO_DATA('67957','01','01'),
	T_TIPO_DATA('67958','01','01'),
	T_TIPO_DATA('20876','02','13'),
	T_TIPO_DATA('51578','02','13'),
	T_TIPO_DATA('52063','02','13'),
	T_TIPO_DATA('48522','02','13'),
	T_TIPO_DATA('22941','02','13'),
	T_TIPO_DATA('30803','02','13'),
	T_TIPO_DATA('28751','02','13'),
	T_TIPO_DATA('22743','02','13'),
	T_TIPO_DATA('39549','02','13'),
	T_TIPO_DATA('20132','02','13'),
	T_TIPO_DATA('20139','02','13'),
	T_TIPO_DATA('22744','02','13'),
	T_TIPO_DATA('44375','02','13'),
	T_TIPO_DATA('28754','02','13'),
	T_TIPO_DATA('40897','02','13'),
	T_TIPO_DATA('28129','02','13'),
	T_TIPO_DATA('34338','02','13'),
	T_TIPO_DATA('32843','02','13'),
	T_TIPO_DATA('40902','02','13'),
	T_TIPO_DATA('44376','02','13')

  ); 
  V_TMP_TIPO_DATA T_TIPO_DATA;
  
BEGIN	

   DBMS_OUTPUT.PUT_LINE('[INFO] INICIO DEL PROCESO, DE ACTUALIZACION DE TIPO_TITULO/SUBTIPO_TITULO DE ACTIVO EN ACT_ACTIVO');
   
   FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
     LOOP
    
       V_TMP_TIPO_DATA := V_TIPO_DATA(I);
       
       --COMPROBAMOS AL EXISTENCIA DEL ACTIVO MEDIANTE EL ACT_NUM_ACTIVO_PRINEX EN ACT_ACTIVO
       
       V_SQL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT 
       WHERE ACT_NUM_ACTIVO_PRINEX = '||V_TMP_TIPO_DATA(1)||'';
       EXECUTE IMMEDIATE V_SQL INTO V_NUM_TABLAS;
       
       --SI EXISTE, ACTUALIZAMOS SU TIPO Y SUBTIPO DE TITULO EN ACT_ACTIVO 
       
       IF V_NUM_TABLAS > 0 THEN				         
			                                        
          V_SQL := '
		  MERGE INTO ACT_ACTIVO ACT
		  USING
		  (
			 SELECT ACT.ACT_NUM_ACTIVO_PRINEX AS NUM_PRINEX FROM ACT_ACTIVO ACT
			 WHERE ACT.ACT_NUM_ACTIVO_PRINEX = '||V_TMP_TIPO_DATA(1)||'
		  ) TMP
		  ON (ACT.ACT_NUM_ACTIVO_PRINEX = TMP.NUM_PRINEX)      
		  WHEN MATCHED THEN UPDATE 
		  SET 
		  ACT.DD_TTA_ID	= (SELECT DD_TTA_ID FROM DD_TTA_TIPO_TITULO_ACTIVO TTA WHERE TTA.DD_TTA_CODIGO = '||V_TMP_TIPO_DATA(2)||'),
		  ACT.DD_STA_ID = (SELECT DD_STA_ID FROM DD_STA_SUBTIPO_TITULO_ACTIVO STA WHERE STA.DD_STA_CODIGO = '||V_TMP_TIPO_DATA(3)||'),
		  ACT.USUARIOMODIFICAR = ''HREOS-345'',
		  ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
                            
          EXECUTE IMMEDIATE V_SQL;                  
                
       ELSE
       
                DBMS_OUTPUT.PUT_LINE('[INFO] EL ACTIVO DE PRINEX INFORMADO '||V_TMP_TIPO_DATA(1)||' NO EXISTE EN ACT_ACTIVO');
                
       END IF;
       
    END LOOP;
    
    COMMIT;
  
    EXECUTE IMMEDIATE('ANALYZE TABLE '||V_ESQUEMA||'.ACT_ACTIVO COMPUTE STATISTICS');
  
    DBMS_OUTPUT.PUT_LINE('[INFO] '||V_ESQUEMA||'.ACT_ACTIVO ANALIZADA.');
      
    DBMS_OUTPUT.PUT_LINE('[FIN] LA TABLA ACT_ACTIVO SE HA ACTUALIZADO CORRECTAMENTE');
 
 
EXCEPTION

   WHEN OTHERS THEN
        err_num := SQLCODE;
        err_msg := SQLERRM;

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecuci√≥n:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);

        ROLLBACK;
        RAISE;          

END;

/

EXIT
