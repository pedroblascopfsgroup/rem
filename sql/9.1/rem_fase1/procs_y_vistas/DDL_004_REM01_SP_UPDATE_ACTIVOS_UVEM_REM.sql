--/*
--##########################################
--## AUTOR=JAVIER DIAZ
--## FECHA_CREACION=20160616
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.1
--## INCIDENCIA_LINK=0
--## PRODUCTO=NO
--## Finalidad: Procedimiento que actualiza información de los activos a partir de un fichero proveniente de UVEM- 
--##			tabla APR_AUX_DATOS_ACTIVO, con datos procedentes de UVEM.
--##           
--## INSTRUCCIONES: Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##        0.2 Se agrega al procedimiento la carga y actualización de CALIDADES ACTIVOS E INFOCOMERCIAL-DISTRIBUCIÓN.
--##        0.3 Corrección Error esquema
--##        0.4 Mejoras del proceso -> Actualiza Calidades Activo de forma independiente a Datos Activo - Actualiza sólo los registros que tienen cambios, Mejor información en Log, campos de auditoria.
--##########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;

create or replace PROCEDURE SP_UPDATE_ACTIVOS_UVEM_REM (P_TEXTO OUT VARCHAR2,
P_ACT_ACTIVO OUT VARCHAR2,
P_BIE_LOCALIZACION OUT VARCHAR2,
P_INFOCOMERCIAL_NEW OUT VARCHAR2,
P_INFOCOMERCIAL_MODIF OUT VARCHAR2,
P_EDIFICIO_NEW OUT VARCHAR2,
P_EDIFICIO_MODIF OUT VARCHAR2,
P_VIVIENDA_NEW OUT VARCHAR2,
P_VIVIENDA_MODIF OUT VARCHAR2,
P_LOCAL_NEW OUT VARCHAR2,
P_LOCAL_MODIF OUT VARCHAR2,
P_APARCA_NEW OUT VARCHAR2,
P_APARCA_MODIFI OUT VARCHAR2,
P_CRI_NEW OUT VARCHAR2,
P_CRI_MODIF OUT VARCHAR2,
P_CRE_NEW OUT VARCHAR2,
P_CRE_MODIF OUT VARCHAR2,
P_PRV_NEW OUT VARCHAR2,
P_PRV_MODIF OUT VARCHAR2,
P_SOL_NEW OUT VARCHAR2,
P_SOL_MODIF OUT VARCHAR2,
P_INF_NEW OUT VARCHAR2,
P_INF_MODIF OUT VARCHAR2,
P_ZCO_NEW OUT VARCHAR2,
P_ZCO_MODIF OUT VARCHAR2,
P_INS_NEW OUT VARCHAR2,
P_INS_MODIF OUT VARCHAR2,
P_BNY_NEW OUT VARCHAR2,
P_BNY_MODIF OUT VARCHAR2,
P_COC_NEW OUT VARCHAR2,
P_COC_MODIF OUT VARCHAR2,
P_DIST_NEW OUT VARCHAR2,
P_DIST_MODIF OUT VARCHAR2

) AS
--V0.4 Versión  hito : 1.0.7-rem-patch01


V_ESQUEMA VARCHAR2(15 CHAR) := '#ESQUEMA#';
V_ESQUEMA_MASTER VARCHAR2(15 CHAR) := '#ESQUEMA_MASTER#';
 V_TABLA_AUX VARCHAR2(40 CHAR) := 'APR_AUX_DATOS_ACTIVO';
 V_TABLA VARCHAR2(40 CHAR) := 'APR_AUX_DATOS_ACTIVO';
 V_TABLA_VIV VARCHAR2(40 CHAR) := 'ACT_VIV_VIVIENDA';
 V_TABLA_INFO VARCHAR2(40 CHAR) := 'ACT_ICO_INFO_COMERCIAL';
 V_TABLA_LOCAL  VARCHAR2(40 CHAR) := 'ACT_LCO_LOCAL_COMERCIAL';
 V_TABLA_APARC VARCHAR2(40 CHAR) := 'ACT_APR_PLAZA_APARCAMIENTO';


err_num NUMBER;
 err_msg VARCHAR2(2048);

 TABLE_COUNT NUMBER(10,0) := 0;
  TABLE_COUNT2 NUMBER(10,0) := 0;
 TABLE_COUNT3 NUMBER(10,0) := 0;

 TABLE_VIVIENDA NUMBER(10,0) := 0;
  TABLE_LOCAL NUMBER(10,0) := 0;
  TABLE_APARCA NUMBER(10,0) := 0;

 NUEVOS_COUNT NUMBER(10,0) := 0;
 UPDATES_COUNT NUMBER(10,0) := 0;
  UPDATES_COUNT_ADM NUMBER(10,0) := 0;
   UPDATES_COUNT_NO_ADM NUMBER(10,0) := 0;
   UPDATE_VIVIENDAS NUMBER(10,0) := 0;
   UPDATE_LOCAL  NUMBER(10,0) := 0;
   UPDATE_APARCAMIENTO  NUMBER(10,0) := 0;
   UPDATE_DATOS_NULL NUMBER(10,0) := 0;
   TOTAL_BIE_LOCALI NUMBER(10,0) := 0;
   UPDATE_ACTIVOS NUMBER(10,0) := 0;
   UPDATES_INFO NUMBER(10,0) := 0;
   UPDATES_EDIFICIO NUMBER(10,0) := 0;

   NUEVOS_VIVIENDAS NUMBER(10,0) := 0;
   NUEVOS_LOCAL NUMBER(10,0) := 0;
   NUEVOS_APARCAMIENTO NUMBER(10,0) := 0;
   
   UPDATE_DIST NUMBER(10,0) := 0;
   NUEVOS_DIST NUMBER(10,0) := 0;
   COUNT_CALIDADES_UPDATE NUMBER(10,0) := 0;
   COUNT_CALIDADES_INSERT NUMBER(10,0) := 0;
   
   MODIF_CRI NUMBER(10,0) := 0;
   NEW_CRI NUMBER(10,0) := 0;
   MODIF_CRE NUMBER(10,0) := 0;
   NEW_CRE NUMBER(10,0) := 0;
   MODIF_PRV NUMBER(10,0) := 0;
   NEW_PRV NUMBER(10,0) := 0;
   MODIF_SOL NUMBER(10,0) := 0;
   NEW_SOL NUMBER(10,0) := 0;
   MODIF_INF NUMBER(10,0) := 0;
   NEW_INF  NUMBER(10,0) := 0;
   MODIF_ZCO NUMBER(10,0) := 0;
   NEW_ZCO NUMBER(10,0) := 0;
   MODIF_INS NUMBER(10,0) := 0;
   NEW_INS NUMBER(10,0) := 0;
   MODIF_BNY NUMBER(10,0) := 0;
   NEW_BNY NUMBER(10,0) := 0;
   MODIF_COC NUMBER(10,0) := 0;
   NEW_COC NUMBER(10,0) := 0;
   
   V_DIST NUMBER(10,0) := 0;
   V_VIV  NUMBER(10,0) := 0;
   
   V_VAL_ACT NUMBER(10,0) := 0;
   
   R_ACTIVO NUMBER(10,0) := 0;
   R_LOCALIZACION NUMBER(10,0) := 0;
   R_LOC_ESCALERA NUMBER(10,0) := 0;
   R_DD_TVI_ID NUMBER(10,0) := 0;
   R_NOMBRE_VIA NUMBER(10,0) := 0;
   R_NUMERO_DOMICILIO NUMBER(10,0) := 0;
   R_LOC_PISO NUMBER(10,0) := 0;
   R_LOC_PUERTA NUMBER(10,0) := 0;
   R_LOC_COD_POST NUMBER(10,0) := 0;
   R_UPO_ID NUMBER(10,0) := 0;
   R_LOC_ID NUMBER(10,0) := 0;
   R_PRV_ID NUMBER(10,0) := 0;
   R_CIC_ID NUMBER(10,0) := 0;
   R_INFOCOMERCIAL NUMBER(10,0) := 0;
   R_EDIFICIO NUMBER(10,0) := 0;
   R_VIVIENDA NUMBER(10,0) := 0;
   R_LOCAL NUMBER(10,0) := 0;
   R_APARCA NUMBER(10,0) := 0;
   R_CRI NUMBER(10,0) := 0;
   R_CRE NUMBER(10,0) := 0;
   R_PRV NUMBER(10,0) := 0;
   R_SOL NUMBER(10,0) := 0;
   R_INF NUMBER(10,0) := 0;
   R_ZCO NUMBER(10,0) := 0;
   R_INS NUMBER(10,0) := 0;
   R_BNY NUMBER(10,0) := 0;
   R_COC NUMBER(10,0) := 0;
   R_DIST NUMBER(10,0) := 0;

   

CAMPO_ACTUALIZADO VARCHAR2(2 CHAR);

 V_MSQL_ACT VARCHAR2(8500 CHAR);
 V_MSQL1 VARCHAR2(8500 CHAR);

  V_MSQL2 VARCHAR2(8500 CHAR);
  V_MSQL3 VARCHAR2(8500 CHAR);
    V_MSQL4 VARCHAR2(8500 CHAR);
        V_MSQL5 VARCHAR2(8500 CHAR);
  V_MSQL6 VARCHAR2(8500 CHAR);
  V_MSQL7 VARCHAR2(8500 CHAR);
    V_MSQL8 VARCHAR2(8500 CHAR);
   V_MSQL9 VARCHAR2(8500 CHAR);
      V_MSQL10 VARCHAR2(8500 CHAR);
      V_MSQL11 VARCHAR2(8500 CHAR);
      V_MSQL12 VARCHAR2(8500 CHAR);
      V_MSQL13 VARCHAR2(8500 CHAR);
      V_MSQL14 VARCHAR2(8500 CHAR);
      V_MSQL15 VARCHAR2(8500 CHAR);
      V_MSQL_DIST VARCHAR2(8500 CHAR);
      V_MSQL_DIST_I VARCHAR2(8500 CHAR);
      
      V_MSQL_CRI VARCHAR2(8500 CHAR);
      V_MSQL_CRE VARCHAR2(8500 CHAR);
      V_MSQL_PRV VARCHAR2(8500 CHAR);
      V_MSQL_SOL VARCHAR2(8500 CHAR);
      V_MSQL_INF VARCHAR2(8500 CHAR);
      V_MSQL_ZCO VARCHAR2(8500 CHAR);
      V_MSQL_INS VARCHAR2(8500 CHAR);
      V_MSQL_BNY VARCHAR2(8500 CHAR);
      V_MSQL_COC VARCHAR2(8500 CHAR);
      V_CRI_INS VARCHAR2(8500 CHAR);
      V_CRE_INS VARCHAR2(8500 CHAR);
      V_PRV_INS VARCHAR2(8500 CHAR);
      V_SOL_INS VARCHAR2(8500 CHAR);
      V_INF_INS VARCHAR2(8500 CHAR);
      V_ZCO_INS VARCHAR2(8500 CHAR);
      V_INS_INS VARCHAR2(8500 CHAR);
      V_BNY_INS VARCHAR2(8500 CHAR);
      V_COC_INS VARCHAR2(8500 CHAR);
      
      REG_ACTIVO VARCHAR2(4000 CHAR);
      REG_LOCALIZACION VARCHAR2(4000 CHAR);
      REG_LOC_ESCALERA VARCHAR2(4000 CHAR);
      REG_DD_TVI_ID VARCHAR2(4000 CHAR);
      REG_NOMBRE_VIA VARCHAR2(4000 CHAR);
      REG_NUMERO_DOMICILIO VARCHAR2(4000 CHAR);
      REG_LOC_PISO VARCHAR2(4000 CHAR);
      REG_LOC_PUERTA VARCHAR2(4000 CHAR);
      REG_LOC_COD_POST VARCHAR2(4000 CHAR);
      REG_UPO_ID VARCHAR2(4000 CHAR);
      REG_LOC_ID VARCHAR2(4000 CHAR);
      REG_PRV_ID VARCHAR2(4000 CHAR);
      REG_CIC_ID VARCHAR2(4000 CHAR);
      REG_INFOCOMERCIAL VARCHAR2(4000 CHAR);
      REG_EDIFICIO VARCHAR2(4000 CHAR);
      REG_VIVIENDA VARCHAR2(4000 CHAR);
      REG_LOCAL VARCHAR2(4000 CHAR);
      REG_APARCA VARCHAR2(4000 CHAR);
      REG_CRI VARCHAR2(4000 CHAR);
      REG_CRE  VARCHAR2(4000 CHAR);
      REG_PRV VARCHAR2(4000 CHAR);
      REG_SOL VARCHAR2(4000 CHAR);
      REG_INF VARCHAR2(4000 CHAR);
      REG_ZCO VARCHAR2(4000 CHAR);
      REG_INS VARCHAR2(4000 CHAR);
      REG_BNY VARCHAR2(4000 CHAR);
      REG_COC VARCHAR2(4000 CHAR);
      REG_DIST VARCHAR2(4000 CHAR);

UPDATE_NULL1  VARCHAR2(8500 CHAR);
UPDATE_NULL2  VARCHAR2(8500 CHAR);
UPDATE_NULL3  VARCHAR2(8500 CHAR);
UPDATE_NULL4  VARCHAR2(8500 CHAR);
UPDATE_NULL5  VARCHAR2(8500 CHAR);
UPDATE_NULL6  VARCHAR2(8500 CHAR);
UPDATE_NULL7  VARCHAR2(8500 CHAR);
UPDATE_NULL8  VARCHAR2(8500 CHAR);
UPDATE_NULL9  VARCHAR2(8500 CHAR);
UPDATE_NULL10 VARCHAR2(8500 CHAR);
UPDATE_NULL11 VARCHAR2(8500 CHAR);
UPDATE_NULL12 VARCHAR2(8500 CHAR);


   V_SENTENCIA1 VARCHAR2(1600 CHAR);
   V_SENTENCIA2 VARCHAR2(1600 CHAR);
V_SENTENCIA3 VARCHAR2(1600 CHAR);
V_VALIDA_DIST VARCHAR2(1600 CHAR);
V_VALIDA_VIV VARCHAR2(1600 CHAR);
V_VALIDA_ACT VARCHAR2(1600 CHAR);

V_VIVIENDA VARCHAR2(1600 CHAR);

V_CALIDADES_ACTIVO CLOB;
V_VALIDA_ACT_DIST CLOB;
V_INFO_DISTRIBUCION VARCHAR2(4000 CHAR);

V_LOCAL VARCHAR2(1600 CHAR);
V_APARCA VARCHAR2(1600 CHAR);

ACT_ID  NUMBER(17);
ACT_ID_INFO NUMBER(17);

BIE_LOC_ID  NUMBER(17);
ACT_NUMERO_ACTIVO NUMBER(17);

DD_TPH_ID NUMBER(2);

ACT_NUMERO_UVEM NUMBER(16);
ACT_NUMERO_PRINEX NUMBER(16);

ESTADO_ADMISION NUMBER(1);
DD_TVI_ID VARCHAR2(20 CHAR);
LOC_NOMBRE_VIA VARCHAR2(100 CHAR);
BIE_LOC_NOMBRE_VIA VARCHAR2(100 CHAR);

LOC_NUMERO_DOMICILIO VARCHAR2(100 CHAR);
BIE_LOC_NUMERO_DOMICILIO VARCHAR2(100 CHAR);

LOC_ESCALERA VARCHAR2(10 CHAR);


  DIS_NUM_PLANTA NUMBER(16);
  DIS_CANTIDAD NUMBER(8);
  DIS_SUPERFICIE NUMBER(16,2);

  

CRI_PTA_ENT_NORMAL NUMBER(1);
CRI_PTA_ENT_BLINDADA NUMBER(1);

  CRI_PTA_ENT_ACORAZADA NUMBER(1);
  CRI_PTA_PASO_MACIZAS NUMBER(1);
  CRI_PTA_PASO_HUECAS NUMBER(1);
  CRI_PTA_PASO_LACADAS NUMBER(1);
  CRI_ARMARIOS_EMPOTRADOS NUMBER(1);
  CRI_CRP_INT_OTROS VARCHAR2(250 CHAR);
  CRE_VTNAS_HIERRO NUMBER(1);
  CRE_VTNAS_ALU_ANODIZADO NUMBER(1);
  CRE_VTNAS_ALU_LACADO NUMBER(1);
  CRE_VTNAS_PVC NUMBER(1);
  CRE_VTNAS_MADERA NUMBER(1);
  CRE_PERS_PLASTICO NUMBER(1);
  CRE_PERS_ALU NUMBER(1);
  CRE_VTNAS_CORREDERAS NUMBER(1);
  CRE_VTNAS_ABATIBLES NUMBER(1);
  CRE_VTNAS_OSCILOBAT NUMBER(1);
  CRE_DOBLE_CRISTAL NUMBER(1);
  CRE_EST_DOBLE_CRISTAL NUMBER(1);
  CRE_CRP_EXT_OTROS VARCHAR2(250 CHAR);
  PRV_HUMEDAD_PARED NUMBER(1);
  PRV_HUMEDAD_TECHO NUMBER(1);
  PRV_GRIETA_PARED NUMBER(1);
  PRV_GRIETA_TECHO NUMBER(1);
  PRV_GOTELE NUMBER(1);
  PRV_PLASTICA_LISA NUMBER(1);
  PRV_PAPEL_PINTADO NUMBER(1); 
  PRV_PINTURA_LISA_TECHO NUMBER(1);
  PRV_PINTURA_LISA_TECHO_EST NUMBER(1);
  PRV_MOLDURA_ESCAYOLA NUMBER(1);
  PRV_MOLDURA_ESCAYOLA_EST NUMBER(1);
  PRV_PARAMENTOS_OTROS VARCHAR2(250 CHAR);
  SOL_TARIMA_FLOTANTE NUMBER(1);
  SOL_PARQUE NUMBER(1);
  SOL_MARMOL NUMBER(1);
  SOL_PLAQUETA NUMBER(1);
  SOL_SOLADO_OTROS VARCHAR2(250 CHAR);
  INF_OCIO NUMBER(1);
  INF_HOTELES NUMBER(1);
  INF_HOTELES_DESC VARCHAR2(250 CHAR);
  INF_TEATROS NUMBER(1);
  INF_TEATROS_DESC VARCHAR2(250 CHAR);
  INF_SALAS_CINE NUMBER(1);
  INF_SALAS_CINE_DESC VARCHAR2(250 CHAR);
  INF_INST_DEPORT NUMBER(1);
  INF_INST_DEPORT_DESC VARCHAR2(250 CHAR);
  INF_CENTROS_COMERC NUMBER(1);
  INF_CENTROS_COMERC_DESC VARCHAR2(250 CHAR);
  INF_OCIO_OTROS VARCHAR2(250 CHAR);
  INF_CENTROS_EDU NUMBER(1);
  INF_ESCUELAS_INF NUMBER(1);
  INF_ESCUELAS_INF_DESC VARCHAR2(250 CHAR);
  INF_COLEGIOS NUMBER(1);
  INF_COLEGIOS_DESC VARCHAR2(250 CHAR);
  INF_INSTITUTOS NUMBER(1);
  INF_INSTITUTOS_DESC VARCHAR2(250 CHAR);
  INF_UNIVERSIDADES NUMBER(1);
  INF_UNIVERSIDADES_DESC VARCHAR2(250 CHAR);
  INF_CENTROS_EDU_OTROS VARCHAR2(250 CHAR);
  INF_CENTROS_SANIT NUMBER(1);
  INF_CENTROS_SALUD NUMBER(1);
  INF_CENTROS_SALUD_DESC VARCHAR2(250 CHAR);
  INF_CLINICAS NUMBER(1);
  INF_CLINICAS_DESC VARCHAR2(250 CHAR);
  INF_HOSPITALES NUMBER(1);
  INF_HOSPITALES_DESC VARCHAR2(250 CHAR);
  INF_CENTROS_SANIT_OTROS VARCHAR2(250 CHAR);
  INF_PARKING_SUP_SUF NUMBER(1);
  INF_COMUNICACIONES NUMBER(1);
  INF_FACIL_ACCESO NUMBER(1);
  INF_FACIL_ACCESO_DESC VARCHAR2(250 CHAR);
  INF_LINEAS_BUS NUMBER(1);
  INF_LINEAS_BUS_DESC VARCHAR2(250 CHAR);
  INF_METRO NUMBER(1);
  INF_METRO_DESC VARCHAR2(250 CHAR);
  INF_EST_TREN NUMBER(1);
  INF_EST_TREN_DESC VARCHAR2(250 CHAR);
  INF_COMUNICACIONES_OTRO VARCHAR2(250 CHAR);
  ZCO_ZONAS_COMUNES NUMBER(1);
  ZCO_JARDINES NUMBER(1);
  ZCO_PISCINA NUMBER(1);
  ZCO_INST_DEP NUMBER(1);
  ZCO_PADEL NUMBER(1);
  ZCO_TENIS NUMBER(1);
  ZCO_PISTA_POLIDEP NUMBER(1);
  ZCO_OTROS VARCHAR2(250 CHAR);
  ZCO_ZONA_INFANTIL NUMBER(1);
  ZCO_CONSERJE_VIGILANCIA NUMBER(1);
  ZCO_GIMNASIO NUMBER(1);
  ZCO_ZONA_COMUN_OTROS VARCHAR2(250 CHAR);
  INS_ELECTR NUMBER(1);
  INS_ELECTR_CON_CONTADOR NUMBER(1);
  INS_ELECTR_BUEN_ESTADO NUMBER(1);
  INS_ELECTR_DEFECTUOSA_ANTIGUA NUMBER(1);
  INS_AGUA NUMBER(1);
  INS_AGUA_CON_CONTADOR NUMBER(1);
  INS_AGUA_BUEN_ESTADO NUMBER(1);
  INS_AGUA_DEFECTUOSA_ANTIGUA NUMBER(1);
  INS_AGUA_CALIENTE_CENTRAL NUMBER(1);
  INS_AGUA_CALIENTE_GAS_NATURAL NUMBER(1);
  INS_GAS NUMBER(1);
  INS_GAS_CON_CONTADOR NUMBER(1);
  INS_GAS_INST_BUEN_ESTADO NUMBER(1);
  INS_GAS_DEFECTUOSA_ANTIGUA NUMBER(1);
  INS_CALEF NUMBER(1);
  INS_CALEF_CENTRAL NUMBER(1);
  INS_CALEF_GAS_NATURAL NUMBER(1);
  INS_CALEF_RADIADORES_ALU NUMBER(1);
  INS_CALEF_PREINSTALACION NUMBER(1);
  INS_AIRE NUMBER(1);
  INS_AIRE_PREINSTALACION NUMBER(1);
  INS_AIRE_INSTALACION NUMBER(1);
  INS_AIRE_FRIO_CALOR NUMBER(1);
  INS_INST_OTROS VARCHAR2(250 CHAR);
  BNY_DUCHA_BANYERA NUMBER(1);
  BNY_DUCHA NUMBER(1);
  BNY_BANYERA NUMBER(1);
  BNY_BANYERA_HIDROMASAJE NUMBER(1);
  BNY_COLUMNA_HIDROMASAJE NUMBER(1);
  BNY_ALICATADO_MARMOL NUMBER(1);
  BNY_ALICATADO_GRANITO NUMBER(1);
  BNY_ALICATADO_AZULEJO NUMBER(1);
  BNY_ENCIMERA NUMBER(1);
  BNY_MARMOL NUMBER(1);
  BNY_GRANITO NUMBER(1);
  BNY_OTRO_MATERIAL NUMBER(1);
  BNY_SANITARIOS NUMBER(1);
  BNY_SANITARIOS_EST NUMBER(1);
  BNY_SUELOS NUMBER(1); 
  BNY_GRIFO_MONOMANDO NUMBER(1);
  BNY_GRIFO_MONOMANDO_EST NUMBER(1);
  BNY_BANYO_OTROS VARCHAR2(250 CHAR);
  COC_AMUEBLADA NUMBER(1);
  COC_AMUEBLADA_EST NUMBER(1);
  COC_ENCIMERA NUMBER(1);
  COC_ENCI_GRANITO NUMBER(1);
  COC_ENCI_MARMOL NUMBER(1);
  COC_ENCI_OTRO_MATERIAL NUMBER(1);
  COC_VITRO NUMBER(1);
  COC_LAVADORA NUMBER(1);
  COC_FRIGORIFICO NUMBER(1);
  COC_LAVAVAJILLAS NUMBER(1);
  COC_MICROONDAS NUMBER(1);
  COC_HORNO NUMBER(1);
  COC_SUELOS NUMBER(1);
  COC_AZULEJOS NUMBER(1);
  COC_AZULEJOS_EST NUMBER(1);
  COC_GRIFOS_MONOMANDO NUMBER(1);
  COC_GRIFOS_MONOMANDO_EST NUMBER(1);
  COC_COCINA_OTROS VARCHAR2(250 CHAR);

  

  ICO_ACT_DIST NUMBER(16);



BIE_LOC_ESCALERA VARCHAR2(10 CHAR);
BIE_LOC_PISO VARCHAR2(11 CHAR);
BIE_LOC_PUERTA VARCHAR2(17 CHAR);
BIE_LOC_COD_POST VARCHAR2(250 CHAR);
DD_UPO_ID NUMBER(16);
DD_LOC_ID NUMBER(16);
DD_PRV_ID NUMBER(16);
DD_CIC_ID NUMBER(16);
ICO_ID NUMBER(16);
ICO_ID_DIST NUMBER(16);
DIS_ID NUMBER(16);

INFO_ICO_ID NUMBER(16);
CRI_ICO_ID NUMBER(16);
CRE_ICO_ID NUMBER(16);
PRV_ICO_ID NUMBER(16);
SOL_ICO_ID NUMBER(16);
INF_ICO_ID NUMBER(16);
ZCO_ICO_ID NUMBER(16);
INS_ICO_ID NUMBER(16);
BNY_ICO_ID NUMBER(16);
COC_ICO_ID NUMBER(16);

EDI_ANO_REHABILITACION NUMBER(8);
EDI_NUM_PLANTAS NUMBER(8);
EDI_ASCENSOR NUMBER(1);
EDI_NUM_ASCENSORES NUMBER(8);
EDI_REFORMA_FACHADA NUMBER(1);
EDI_REFORMA_ESCALERA NUMBER(1);
EDI_REFORMA_PORTAL NUMBER(1);
EDI_REFORMA_ASCENSOR NUMBER(1);
EDI_REFORMA_CUBIERTA NUMBER(1);
EDI_REFORMA_OTRA_ZONA NUMBER(1);
EDI_REFORMA_OTRO NUMBER(1);
EDI_REFORMA_OTRO_ZONA_COM_DES VARCHAR2(250 CHAR);
EDI_REFORMA_OTRO_DESC  VARCHAR2(250 CHAR);
EDI_DESCRIPCION  VARCHAR2(512 CHAR);
EDI_ENTORNO_INFRAESTRUCTURA VARCHAR2(1024 CHAR);
EDI_ENTORNO_COMUNICACION VARCHAR2(3000 CHAR);

VIV_ULTIMA_PLANTA NUMBER(1);
VIV_NUM_PLANTAS_INTERIOR NUMBER(8);
VIV_REFORMA_CARP_INT NUMBER(1);
VIV_REFORMA_CARP_EXT NUMBER(1);
VIV_REFORMA_COCINA NUMBER(1);
VIV_REFORMA_BANYO NUMBER(1);
VIV_REFORMA_SUELO NUMBER(1);
VIV_REFORMA_PINTURA NUMBER(1);
VIV_REFORMA_INTEGRAL NUMBER(1);
VIV_REFORMA_OTRO NUMBER(1);
VIV_REFORMA_OTRO_DESC VARCHAR2(250 CHAR);
VIV_REFORMA_PRESUPUESTO NUMBER(16,2);
VIV_DISTRIBUCION_TXT VARCHAR2(1500 CHAR);

LCO_MTS_FACHADA_PPAL NUMBER(16,2);
LCO_MTS_FACHADA_LAT NUMBER(16,2);
LCO_MTS_LUZ_LIBRE NUMBER(16,2);
LCO_MTS_ALTURA_LIBRE NUMBER(16,2);
LCO_MTS_LINEALES_PROF NUMBER(16,2);
LCO_DIAFANO NUMBER(16,2);
LCO_USO_IDONEO VARCHAR2(250 CHAR);
LCO_USO_ANTERIOR VARCHAR2(250 CHAR);
LCO_OBSERVACIONES VARCHAR2(512 CHAR);

APR_DESTINO_COCHE NUMBER(1);
APR_DESTINO_MOTO NUMBER(1);
APR_DESTINO_DOBLE NUMBER(1);
APR_ANCHURA NUMBER(16,2);
APR_PROFUNDIDAD NUMBER(16,2);
APR_FORMA_IRREGULAR NUMBER(1);

ICO_ACTIVOS_VINC VARCHAR2(250 CHAR);
ICO_FECHA_EMISION_INFORME DATE;
ICO_FECHA_ULTIMA_VISITA DATE;
ICO_FECHA_ACEPTACION DATE;
ICO_FECHA_RECHAZO DATE;
ICO_CONDICIONES_LEGALES VARCHAR2(1024 CHAR);

VALOR VARCHAR2(1024 CHAR);

LOC_PISO VARCHAR2(11 CHAR);
LOC_PUERTA VARCHAR2(17 CHAR);
LOC_COD_POST VARCHAR2(250 CHAR);


CURSOR SEQ_TAB
    IS
   SELECT
ACT.ACT_ID,
BLO.BIE_LOC_ID,
DAT.ACT_NUMERO_ACTIVO ,
DAT.ACT_NUMERO_UVEM,
DAT.ACT_NUMERO_PRINEX,
ESTADO_ADMISION,
BLO.DD_TVI_ID,
DAT.LOC_NOMBRE_VIA,
DAT.LOC_NUMERO_DOMICILIO,
DAT.LOC_ESCALERA,
DAT.LOC_PISO,
DAT.LOC_PUERTA,
DAT.LOC_COD_POST,
BLO.BIE_LOC_NOMBRE_VIA,
BLO.BIE_LOC_NUMERO_DOMICILIO,
BLO.BIE_LOC_ESCALERA,
BLO.BIE_LOC_PISO,
BLO.BIE_LOC_PUERTA,
BLO.BIE_LOC_COD_POST,
BLO.DD_UPO_ID,
BLO.DD_LOC_ID,
BLO.DD_PRV_ID,
BLO.DD_CIC_ID,
DAT.ICO_ACTIVOS_VINC,
DAT.ICO_FECHA_EMISION_INFORME,
DAT.ICO_FECHA_ULTIMA_VISITA,
DAT.ICO_FECHA_ACEPTACION,
DAT.ICO_FECHA_RECHAZO,
INFO.ACT_ID ACT_ID_INFO,
DAT.ICO_CONDICIONES_LEGALES,
INFO.ICO_ID,
DAT.EDI_ANO_REHABILITACION,
DAT.EDI_NUM_PLANTAS,
DAT.EDI_ASCENSOR,
DAT.EDI_NUM_ASCENSORES,
DAT.EDI_REFORMA_FACHADA,
DAT.EDI_REFORMA_ESCALERA,
DAT.EDI_REFORMA_PORTAL,
DAT.EDI_REFORMA_ASCENSOR,
DAT.EDI_REFORMA_CUBIERTA,
DAT.EDI_REFORMA_OTRA_ZONA,
DAT.EDI_REFORMA_OTRO,
DAT.EDI_REFORMA_OTRO_ZONA_COM_DES,
DAT.EDI_REFORMA_OTRO_DESC,
DAT.EDI_DESCRIPCION,
DAT.EDI_ENTORNO_INFRAESTRUCTURA,
DAT.EDI_ENTORNO_COMUNICACION,
DAT.VIV_ULTIMA_PLANTA,
DAT.VIV_NUM_PLANTAS_INTERIOR,
DAT.VIV_REFORMA_CARP_INT,
DAT.VIV_REFORMA_CARP_EXT,
DAT.VIV_REFORMA_COCINA,
DAT.VIV_REFORMA_BANYO,
DAT.VIV_REFORMA_SUELO,
DAT.VIV_REFORMA_PINTURA,
DAT.VIV_REFORMA_INTEGRAL,
DAT.VIV_REFORMA_OTRO,
DAT.VIV_REFORMA_OTRO_DESC,
DAT.VIV_REFORMA_PRESUPUESTO,
DAT.VIV_DISTRIBUCION_TXT,
DAT.LCO_MTS_FACHADA_PPAL,
DAT.LCO_MTS_FACHADA_LAT,
DAT.LCO_MTS_LUZ_LIBRE,
DAT.LCO_MTS_ALTURA_LIBRE,
DAT.LCO_MTS_LINEALES_PROF,
DAT.LCO_DIAFANO,
DAT.LCO_USO_IDONEO,
DAT.LCO_USO_ANTERIOR,
DAT.LCO_OBSERVACIONES,
DAT.APR_DESTINO_COCHE,
DAT.APR_DESTINO_MOTO,
DAT.APR_DESTINO_DOBLE,
DAT.APR_ANCHURA,
DAT.APR_PROFUNDIDAD,
DAT.APR_FORMA_IRREGULAR
FROM
REM01.APR_AUX_DATOS_ACTIVO DAT,
REM01.ACT_ACTIVO ACT,
REM01.ACT_LOC_LOCALIZACION LOC,
REM01.BIE_LOCALIZACION BLO,
REM01.ACT_ICO_INFO_COMERCIAL INFO
WHERE
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = LOC.ACT_ID
AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
AND ACT.ACT_ID = INFO.ACT_ID (+)
;



CURSOR C_INFO_DIST
    IS
SELECT 
A.A1 ICO_ACT_DIST,
B.B1 ICO_ID_DIST,
B.B2 DIS_NUM_PLANTA,
B.B3 DD_TPH_ID,
B.B4 DIS_CANTIDAD,
B.B5 DIS_SUPERFICIE,
A.DIS_ID
FROM 
(SELECT DIS.DIS_ID, DIS.ICO_ID A1, DIS.DIS_NUM_PLANTA A2, DIS.DD_TPH_ID A3 FROM REM01.ACT_DIS_DISTRIBUCION DIS) A,

(
SELECT INFO.ICO_ID B1, DIST.DIS_NUM_PLANTA B2, TPH.DD_TPH_ID B3, DIST.DIS_CANTIDAD B4, DIS_SUPERFICIE B5 FROM REM01.APR_AUX_INFOCOMERCIAL_DIST DIST,
REM01.ACT_ACTIVO ACT, 
REM01.APR_AUX_DATOS_ACTIVO DAT,
REM01.ACT_ICO_INFO_COMERCIAL INFO,
REM01.DD_TPH_TIPO_HABITACULO TPH
WHERE ACT.ACT_NUM_ACTIVO = DIST.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = DIST.ACT_NUMERO_ACTIVO
AND  INFO.ACT_ID = ACT.ACT_ID
AND DIST.TIPO_HABITACULO = TPH.DD_TPH_CODIGO (+)
) B

WHERE A.A1 (+) = B.B1 
AND   A.A2 (+) = B.B2 
AND   A.A3 (+) = B.B3 


;

BEGIN

OPEN SEQ_TAB;
    FETCH SEQ_TAB INTO
    ACT_ID,
    BIE_LOC_ID,
    ACT_NUMERO_ACTIVO,
    ACT_NUMERO_UVEM,
    ACT_NUMERO_PRINEX,
    ESTADO_ADMISION,
    DD_TVI_ID,
    LOC_NOMBRE_VIA,
    LOC_NUMERO_DOMICILIO,
    LOC_ESCALERA,
    LOC_PISO,
    LOC_PUERTA,
    LOC_COD_POST,
    BIE_LOC_NOMBRE_VIA,
    BIE_LOC_NUMERO_DOMICILIO,
    BIE_LOC_ESCALERA,
    BIE_LOC_PISO,
    BIE_LOC_PUERTA,
    BIE_LOC_COD_POST,
    DD_UPO_ID,
    DD_LOC_ID,
    DD_PRV_ID,
    DD_CIC_ID,
    ICO_ACTIVOS_VINC,
    ICO_FECHA_EMISION_INFORME,
    ICO_FECHA_ULTIMA_VISITA,
    ICO_FECHA_ACEPTACION,
    ICO_FECHA_RECHAZO,
    ACT_ID_INFO,
    ICO_CONDICIONES_LEGALES,
    ICO_ID,
    EDI_ANO_REHABILITACION,
    EDI_NUM_PLANTAS,
    EDI_ASCENSOR,
    EDI_NUM_ASCENSORES,
    EDI_REFORMA_FACHADA,
    EDI_REFORMA_ESCALERA,
    EDI_REFORMA_PORTAL,
    EDI_REFORMA_ASCENSOR,
    EDI_REFORMA_CUBIERTA,
    EDI_REFORMA_OTRA_ZONA,
    EDI_REFORMA_OTRO,
    EDI_REFORMA_OTRO_ZONA_COM_DES,
    EDI_REFORMA_OTRO_DESC,
    EDI_DESCRIPCION,
    EDI_ENTORNO_INFRAESTRUCTURA,
    EDI_ENTORNO_COMUNICACION,
    VIV_ULTIMA_PLANTA,
    VIV_NUM_PLANTAS_INTERIOR,
    VIV_REFORMA_CARP_INT,
    VIV_REFORMA_CARP_EXT,
    VIV_REFORMA_COCINA,
    VIV_REFORMA_BANYO,
    VIV_REFORMA_SUELO,
    VIV_REFORMA_PINTURA,
    VIV_REFORMA_INTEGRAL,
    VIV_REFORMA_OTRO,
    VIV_REFORMA_OTRO_DESC,
    VIV_REFORMA_PRESUPUESTO,
    VIV_DISTRIBUCION_TXT,
    LCO_MTS_FACHADA_PPAL,
    LCO_MTS_FACHADA_LAT,
    LCO_MTS_LUZ_LIBRE,
    LCO_MTS_ALTURA_LIBRE,
    LCO_MTS_LINEALES_PROF,
    LCO_DIAFANO,
    LCO_USO_IDONEO,
    LCO_USO_ANTERIOR,
    LCO_OBSERVACIONES,
    APR_DESTINO_COCHE,
    APR_DESTINO_MOTO,
    APR_DESTINO_DOBLE,
    APR_ANCHURA,
    APR_PROFUNDIDAD,
    APR_FORMA_IRREGULAR
    ;
    WHILE SEQ_TAB%found
    LOOP



P_TEXTO := 'INFO: EL PROCESO DE ACTUALIZACIÓN HA FINALIZADO CORRECTAMENTE';


IF ESTADO_ADMISION = 1 THEN



--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOCALIZACION := '
 SELECT COUNT(*) FROM (
SELECT 
TVI.DD_TVI_ID,
DAT.LOC_NOMBRE_VIA,
DAT.LOC_NUMERO_DOMICILIO,
DAT.LOC_ESCALERA,
DAT.LOC_PISO,
DAT.LOC_PUERTA,
DAT.LOC_COD_POST,
UPO.DD_UPO_ID,
LOC.DD_LOC_ID,
PRV.DD_PRV_ID,
CIC.DD_CIC_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
 MINUS
  SELECT 
BLO.DD_TVI_ID,
BLO.BIE_LOC_NOMBRE_VIA,
BLO.BIE_LOC_NUMERO_DOMICILIO,
BLO.BIE_LOC_ESCALERA,
BLO.BIE_LOC_PISO,
BLO.BIE_LOC_PUERTA,
BLO.BIE_LOC_COD_POST,
BLO.DD_UPO_ID,
BLO.DD_LOC_ID,
BLO.DD_PRV_ID,
BLO.DD_CIC_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOCALIZACION);

EXECUTE IMMEDIATE REG_LOCALIZACION INTO R_LOCALIZACION;

  IF R_LOCALIZACION > 0 THEN



 V_MSQL1 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_TVI_ID = (SELECT TVI.DD_TVI_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI
WHERE DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  BIE_LOC_NOMBRE_VIA = '''||REPLACE(LOC_NOMBRE_VIA,'''','''''')||''',
  BIE_LOC_NUMERO_DOMICILIO = '''||REPLACE(LOC_NUMERO_DOMICILIO,'''','''''')||''',
  BIE_LOC_ESCALERA = '''||REPLACE(LOC_ESCALERA,'''','''''')||''',
  BIE_LOC_PISO = '''||REPLACE(LOC_PISO,'''','''''')||''',
  BIE_LOC_PUERTA = '''||REPLACE(LOC_PUERTA,'''','''''')||''',
  BIE_LOC_COD_POST = '''||REPLACE(LOC_COD_POST,'''','''''')||''',
  DD_UPO_ID = (SELECT UPO.DD_UPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO
WHERE DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  DD_LOC_ID = (SELECT LOC.DD_LOC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC
WHERE DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
  DD_PRV_ID = (SELECT PRV.DD_PRV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV
WHERE DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),


  DD_CIC_ID = (SELECT CIC.DD_CIC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.PAIS   =  CIC.DD_CIC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),

  USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';




 EXECUTE IMMEDIATE V_MSQL1;



 UPDATES_COUNT_ADM := UPDATES_COUNT_ADM + 1 ;
 
 END IF;

----VALIDAMOS LOS ACTIVOS SIN ADMISIÓN PARA ACTUALIZAR SOLO LOS CAMPOS DE DIRECCION QUE ESTEN EN NULL

ELSIF ESTADO_ADMISION = 0 THEN

--INICIALIZAMOS LA VARIABLE QUE SIRVE DE CONTADOR DE REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION
CAMPO_ACTUALIZADO := 'NO';

 IF DD_TVI_ID IS NULL OR DD_TVI_ID = ''
 THEN
 
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_DD_TVI_ID := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
TVI.DD_TVI_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_TVI_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_DD_TVI_ID);

EXECUTE IMMEDIATE REG_DD_TVI_ID INTO R_DD_TVI_ID;

  IF R_DD_TVI_ID > 0 THEN
 

--DBMS_OUTPUT.PUT_LINE('EL DD_TVI_ID ESTA NULLO EN BIE_LOCALIZACION');




 UPDATE_NULL1 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_TVI_ID = (SELECT TVI.DD_TVI_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI
WHERE DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL1;
  
  CAMPO_ACTUALIZADO := 'SI';

  

  END IF;
  
  END IF;

   IF BIE_LOC_NOMBRE_VIA IS NULL OR BIE_LOC_NOMBRE_VIA = ''
 THEN

--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_NOMBRE_VIA := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_NOMBRE_VIA
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_NOMBRE_VIA
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_NOMBRE_VIA);

EXECUTE IMMEDIATE REG_NOMBRE_VIA INTO R_NOMBRE_VIA;

  IF R_NOMBRE_VIA > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_NOMBRE_VIA ESTA NULLO EN BIE_LOCALIZACION');



 UPDATE_NULL2 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_NOMBRE_VIA = '''||REPLACE(LOC_NOMBRE_VIA,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



   EXECUTE IMMEDIATE UPDATE_NULL2;
     CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';

  END IF;
  
  END IF;

    IF BIE_LOC_NUMERO_DOMICILIO IS NULL OR BIE_LOC_NUMERO_DOMICILIO = ''
 THEN

  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_NUMERO_DOMICILIO := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_NUMERO_DOMICILIO
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_NUMERO_DOMICILIO
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_NUMERO_DOMICILIO);

EXECUTE IMMEDIATE REG_NUMERO_DOMICILIO INTO R_NUMERO_DOMICILIO;

  IF R_NUMERO_DOMICILIO > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_NUMERO_DOMICILIO ESTA NULLO EN BIE_LOCALIZACION');


 UPDATE_NULL3 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_NUMERO_DOMICILIO = '''||REPLACE(LOC_NUMERO_DOMICILIO,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



EXECUTE IMMEDIATE UPDATE_NULL3;

    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';

  END IF;

  END IF;

    IF BIE_LOC_ESCALERA IS NULL OR BIE_LOC_ESCALERA = ''
  THEN
  
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_ESCALERA := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_ESCALERA
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_ESCALERA
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_ESCALERA);

EXECUTE IMMEDIATE REG_LOC_ESCALERA INTO R_LOC_ESCALERA;

  IF R_LOC_ESCALERA > 0 THEN
  

--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_ESCALERA ESTA NULLO EN BIE_LOCALIZACION');


  UPDATE_NULL4 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_ESCALERA = '''||REPLACE(LOC_ESCALERA,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



EXECUTE IMMEDIATE UPDATE_NULL4;


    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';


END IF;

END IF;

  IF BIE_LOC_PISO IS NULL OR BIE_LOC_PISO = ''
  THEN
  
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_PISO := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_PISO
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_PISO
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_PISO);

EXECUTE IMMEDIATE REG_LOC_PISO INTO R_LOC_PISO;

  IF R_LOC_PISO > 0 THEN
 

--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_PISO ESTA NULLO EN BIE_LOCALIZACION');

  UPDATE_NULL5 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_PISO = '''||REPLACE(LOC_PISO,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL5;
  
    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
END IF;

END IF;


 IF BIE_LOC_PUERTA IS NULL OR BIE_LOC_PUERTA = ''
 THEN

--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_PUERTA := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_PUERTA
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_PUERTA
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_PUERTA);

EXECUTE IMMEDIATE REG_LOC_PUERTA INTO R_LOC_PUERTA;

  IF R_LOC_PUERTA > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_PUERTA ESTA NULLO EN BIE_LOCALIZACION');


 UPDATE_NULL6 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_PUERTA = '''||REPLACE(LOC_PUERTA,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



    EXECUTE IMMEDIATE UPDATE_NULL6;
    
    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
    
    END IF;

  END IF;

   IF BIE_LOC_COD_POST IS NULL OR BIE_LOC_COD_POST = ''
 THEN

--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_COD_POST := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_COD_POST
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_COD_POST
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_PUERTA);

EXECUTE IMMEDIATE REG_LOC_COD_POST INTO R_LOC_COD_POST;

  IF R_LOC_COD_POST > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_COD_POST ESTA NULLO EN BIE_LOCALIZACION');

  UPDATE_NULL7 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_COD_POST = '''||REPLACE(LOC_COD_POST,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL7;
  
     CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';

END IF;

  END IF;



   IF DD_UPO_ID IS NULL OR DD_UPO_ID = ''
 THEN
 
 --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_UPO_ID := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
UPO.DD_UPO_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_UPO_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_PUERTA);

EXECUTE IMMEDIATE REG_UPO_ID INTO R_UPO_ID;

  IF R_UPO_ID > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL DD_UPO_ID ESTA NULLO EN BIE_LOCALIZACION');


  UPDATE_NULL9 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_UPO_ID = (SELECT UPO.DD_UPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO
WHERE DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL9;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  END IF;

  END IF;

     IF DD_LOC_ID IS NULL OR DD_LOC_ID = ''
 THEN

 --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_ID := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
LOC.DD_LOC_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_LOC_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_PUERTA);

EXECUTE IMMEDIATE REG_LOC_ID INTO R_LOC_ID;

  IF R_LOC_ID > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL DD_LOC_ID ESTA NULLO EN BIE_LOCALIZACION');

   UPDATE_NULL10 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_LOC_ID =  (SELECT LOC.DD_LOC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC
WHERE DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL10;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  END IF;


  END IF;

       IF DD_PRV_ID IS NULL OR DD_PRV_ID = ''
 THEN
 
 --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_PRV_ID := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
PRV.DD_PRV_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_PRV_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_PUERTA);

EXECUTE IMMEDIATE REG_PRV_ID INTO R_PRV_ID;

  IF R_PRV_ID > 0 THEN



--DBMS_OUTPUT.PUT_LINE('EL DD_PRV_ID ESTA NULLO EN BIE_LOCALIZACION');

 UPDATE_NULL11 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_PRV_ID = (SELECT PRV.DD_PRV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV
WHERE DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL11;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  END IF;

  END IF;

  IF DD_CIC_ID IS NULL OR DD_CIC_ID = ''
 THEN
 
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_CIC_ID := '
 SELECT COUNT(*) FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
CIC.DD_CIC_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_CIC_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  )
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_LOC_PUERTA);

EXECUTE IMMEDIATE REG_CIC_ID INTO R_CIC_ID;

  IF R_CIC_ID > 0 THEN

--DBMS_OUTPUT.PUT_LINE('EL DD_CIC_ID ESTA NULLO EN BIE_LOCALIZACION');

 UPDATE_NULL12 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_CIC_ID =  (SELECT CIC.DD_CIC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.PAIS   =  CIC.DD_CIC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL12;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  
  
  END IF;






  END IF;

------VALIDAMOS LOS REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION QUE ESTABAN EN NULL Y QUE EN EL FICHERO CONTIENEN INFORMACIÓN A ACTUALIZAR----

IF CAMPO_ACTUALIZADO = 'SI'

THEN 

UPDATE_DATOS_NULL := UPDATE_DATOS_NULL + 1;


END IF;





END IF;




--------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_ACTIVO := '
 
 SELECT COUNT(*) FROM (
  SELECT 
SCM.DD_SCM_ID,
DAT.ACT_NUMERO_ACTIVO,
DAT.ACT_NUMERO_UVEM,
DAT.ACT_NUMERO_PRINEX
FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.DD_SCM_SITUACION_COMERCIAL SCM
WHERE SCM.DD_SCM_CODIGO = DAT.SITUACION_COMERCIAL
AND   ACT.ACT_NUM_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
ACT.DD_SCM_ID,
ACT.ACT_NUM_ACTIVO,
ACT.ACT_NUM_ACTIVO_UVEM,
ACT.ACT_NUM_ACTIVO_PRINEX
FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT
WHERE 
ACT.ACT_NUM_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND ACT.ACT_NUM_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;


--DBMS_OUTPUT.PUT_LINE(REG_ACTIVO);

EXECUTE IMMEDIATE REG_ACTIVO INTO R_ACTIVO;

  IF R_ACTIVO > 0 THEN


----ACTUALIZAMOS ACTIVOS CON SITUACION COMERCIAL, NUMERO_UVEM Y PRINEX PROVENIENTES DEL FICHERO

V_MSQL_ACT := 'UPDATE '||V_ESQUEMA||'.ACT_ACTIVO
  SET DD_SCM_ID = (SELECT SCM.DD_SCM_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.DD_SCM_SITUACION_COMERCIAL SCM
WHERE DAT.SITUACION_COMERCIAL   =  SCM.DD_SCM_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
ACT_NUM_ACTIVO_UVEM = '''||ACT_NUMERO_UVEM||''',
ACT_NUM_ACTIVO_PRINEX =  '''||ACT_NUMERO_PRINEX||''',
USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE ACT_ID = '||ACT_ID||'';

UPDATE_ACTIVOS := UPDATE_ACTIVOS + 1;


   EXECUTE IMMEDIATE V_MSQL_ACT;

END IF;

----VALIDAMOS QUE EL ACTIVO TIENE INFORMACION COMERCIAL, SI EXISTE ACTUALIZAMOS.

IF ACT_ID_INFO IS NOT NULL THEN


---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_INFOCOMERCIAL := '
 
 SELECT COUNT(*) FROM (
  SELECT 
  UAC.DD_UAC_ID,
  DAT.ICO_ACTIVOS_VINC,
  PRO.PVE_ID ICO_MEDIADOR_ID,
  DAT.ICO_FECHA_EMISION_INFORME,
  DAT.ICO_FECHA_ULTIMA_VISITA,
  DAT.ICO_FECHA_ACEPTACION,
  DAT.ICO_FECHA_RECHAZO,
  DAT.ICO_CONDICIONES_LEGALES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.DD_UAC_UBICACION_ACTIVO UAC,
  '||V_ESQUEMA||'.ACT_PVE_PROVEEDOR PRO
  WHERE 
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND DAT.UBICACION_ACTIVO   =  UAC.DD_UAC_CODIGO (+)
AND DAT.PVE_CODIGO = PRO.PVE_COD_UVEM (+)
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
INFO.DD_UAC_ID,
INFO.ICO_ACTIVOS_VINC,
INFO.ICO_MEDIADOR_ID,
INFO.ICO_FECHA_EMISION_INFORME,
  INFO.ICO_FECHA_ULTIMA_VISITA,
  INFO.ICO_FECHA_ACEPTACION,
  INFO.ICO_FECHA_RECHAZO,
  INFO.ICO_CONDICIONES_LEGALES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
  WHERE 
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_INFOCOMERCIAL INTO R_INFOCOMERCIAL;

  IF R_INFOCOMERCIAL > 0 THEN


 V_MSQL3 := 'UPDATE '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL
  SET
  DD_UAC_ID = (SELECT UAC.DD_UAC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_UAC_UBICACION_ACTIVO UAC
WHERE DAT.UBICACION_ACTIVO   =  UAC.DD_UAC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  ICO_ACTIVOS_VINC = '''||REPLACE(ICO_ACTIVOS_VINC,'''','''''')||''',
  ICO_MEDIADOR_ID =  (SELECT PRO.PVE_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_PVE_PROVEEDOR PRO
WHERE DAT.PVE_CODIGO = PRO.PVE_COD_UVEM
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  ICO_FECHA_EMISION_INFORME = '''||ICO_FECHA_EMISION_INFORME||''',
  ICO_FECHA_ULTIMA_VISITA = '''||ICO_FECHA_ULTIMA_VISITA||''',
  ICO_FECHA_ACEPTACION = '''||ICO_FECHA_ACEPTACION||''',
  ICO_FECHA_RECHAZO = '''||ICO_FECHA_RECHAZO||''',
  ICO_CONDICIONES_LEGALES = '''||REPLACE(ICO_CONDICIONES_LEGALES,'''','''''')||''',
  USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE ACT_ID = '||ACT_ID||'';



 EXECUTE IMMEDIATE V_MSQL3;

 UPDATES_INFO := UPDATES_INFO + 1;

END IF;




---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_EDIFICIO := '
 
 SELECT COUNT(*) FROM (
SELECT 
  TPF.DD_TPF_ID,
  DAT.EDI_ANO_REHABILITACION,
  DAT.EDI_NUM_PLANTAS,
  DAT.EDI_ASCENSOR,
  DAT.EDI_NUM_ASCENSORES  ,
  DAT.EDI_REFORMA_FACHADA ,
  DAT.EDI_REFORMA_ESCALERA,
  DAT.EDI_REFORMA_PORTAL,
  DAT.EDI_REFORMA_ASCENSOR,
  DAT.EDI_REFORMA_CUBIERTA,
  DAT.EDI_REFORMA_OTRA_ZONA,
  DAT.EDI_REFORMA_OTRO,
  DAT.EDI_REFORMA_OTRO_ZONA_COM_DES,
  DAT.EDI_REFORMA_OTRO_DESC,
  DAT.EDI_DESCRIPCION,
  DAT.EDI_ENTORNO_INFRAESTRUCTURA,
  DAT.EDI_ENTORNO_COMUNICACION,
  ECV.DD_ECV_ID
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_EDI_EDIFICIO EDI,
  '||V_ESQUEMA||'.DD_TPF_TIPO_FACHADA TPF,
  '||V_ESQUEMA||'.DD_ECV_ESTADO_CONSERVACION ECV
WHERE 
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = EDI.ICO_ID
AND DAT.TIPO_FACHADA_EDIFICIO   =  TPF.DD_TPF_CODIGO (+)
AND DAT.ESTADO_CONSERVACION_EDIFICIO   =  ECV.DD_ECV_CODIGO (+)
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
 EDI.DD_TPF_ID,
 EDI.EDI_ANO_REHABILITACION,
  EDI.EDI_NUM_PLANTAS,
  EDI.EDI_ASCENSOR,
  EDI.EDI_NUM_ASCENSORES  ,
  EDI.EDI_REFORMA_FACHADA ,
  EDI.EDI_REFORMA_ESCALERA,
  EDI.EDI_REFORMA_PORTAL,
  EDI.EDI_REFORMA_ASCENSOR,
  EDI.EDI_REFORMA_CUBIERTA,
  EDI.EDI_REFORMA_OTRA_ZONA,
  EDI.EDI_REFORMA_OTRO,
  EDI.EDI_REFORMA_OTRO_ZONA_COM_DES,
  EDI.EDI_REFORMA_OTRO_DESC,
  EDI.EDI_DESCRIPCION,
  EDI.EDI_ENTORNO_INFRAESTRUCTURA,
  EDI.EDI_ENTORNO_COMUNICACION,
  EDI.DD_ECV_ID
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_EDI_EDIFICIO EDI
  WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = EDI.ICO_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||' )
  '
  ;
  
  EXECUTE IMMEDIATE REG_EDIFICIO INTO R_EDIFICIO;

  IF R_EDIFICIO > 0 THEN



   V_MSQL4 := 'UPDATE '||V_ESQUEMA||'.ACT_EDI_EDIFICIO
  SET
      DD_TPF_ID = (SELECT TPF.DD_TPF_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPF_TIPO_FACHADA TPF
WHERE DAT.TIPO_FACHADA_EDIFICIO   =  TPF.DD_TPF_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      EDI_ANO_REHABILITACION = '||EDI_ANO_REHABILITACION||',
      EDI_NUM_PLANTAS = '||EDI_NUM_PLANTAS||',
      EDI_ASCENSOR = '||EDI_ASCENSOR||',
      EDI_NUM_ASCENSORES = '||EDI_NUM_ASCENSORES||',
      EDI_REFORMA_FACHADA = '||EDI_REFORMA_FACHADA||',
      EDI_REFORMA_ESCALERA = '||EDI_REFORMA_ESCALERA||',
      EDI_REFORMA_PORTAL = '||EDI_REFORMA_PORTAL||',
      EDI_REFORMA_ASCENSOR = '||EDI_REFORMA_ASCENSOR||',
      EDI_REFORMA_CUBIERTA = '||EDI_REFORMA_CUBIERTA||',
      EDI_REFORMA_OTRA_ZONA = '||EDI_REFORMA_OTRA_ZONA||',
      EDI_REFORMA_OTRO = '||EDI_REFORMA_OTRO||',
       EDI_REFORMA_OTRO_ZONA_COM_DES = '''||REPLACE(EDI_REFORMA_OTRO_ZONA_COM_DES,'''','''''')||''',
       EDI_REFORMA_OTRO_DESC = '''||REPLACE(EDI_REFORMA_OTRO_DESC,'''','''''')||''',
       EDI_DESCRIPCION = '''||REPLACE(EDI_DESCRIPCION,'''','''''')||''',
       EDI_ENTORNO_INFRAESTRUCTURA = '''||REPLACE(EDI_ENTORNO_INFRAESTRUCTURA,'''','''''')||''',
       EDI_ENTORNO_COMUNICACION = '''||REPLACE(EDI_ENTORNO_COMUNICACION,'''','''''')||''',
       DD_ECV_ID = (SELECT ECV.DD_ECV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_ECV_ESTADO_CONSERVACION ECV
WHERE DAT.ESTADO_CONSERVACION_EDIFICIO   =  ECV.DD_ECV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';
 
 
 --DBMS_OUTPUT.PUT_LINE(V_MSQL4);
 
  EXECUTE IMMEDIATE V_MSQL4;
 

 UPDATES_EDIFICIO := UPDATES_EDIFICIO + 1;

END IF;

----VALIDAMOS QUE EL ACTIVO ES SUBTIPO VIVIENDA

 V_VIVIENDA := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''05'',''06'',''07'',''08'',''09'',''10'',''11'',''12'',''20'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_VIVIENDA INTO TABLE_VIVIENDA;

  IF TABLE_VIVIENDA > 0 THEN



---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_VIVIENDA := '
 
SELECT COUNT (*) FROM  (
SELECT 
 TPV.DD_TPV_ID,
 TPO.DD_TPO_ID,
 TPR.DD_TPR_ID,
 DAT.VIV_ULTIMA_PLANTA,
DAT.VIV_NUM_PLANTAS_INTERIOR,
DAT.VIV_REFORMA_CARP_INT,
DAT.VIV_REFORMA_CARP_EXT,
DAT.VIV_REFORMA_COCINA,
DAT.VIV_REFORMA_BANYO,
DAT.VIV_REFORMA_SUELO,
DAT.VIV_REFORMA_PINTURA,
DAT.VIV_REFORMA_INTEGRAL,
DAT.VIV_REFORMA_OTRO,
DAT.VIV_REFORMA_OTRO_DESC,
DAT.VIV_REFORMA_PRESUPUESTO,
DAT.VIV_DISTRIBUCION_TXT
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_VIV_VIVIENDA VIV,
  '||V_ESQUEMA||'.DD_TPV_TIPO_VIVIENDA TPV,
  '||V_ESQUEMA||'.DD_TPO_TIPO_ORIENTACION TPO,
  '||V_ESQUEMA||'.DD_TPR_TIPO_RENTA TPR
WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = VIV.ICO_ID --14.191
AND DAT.TIPO_VIVIENDA   =  TPV.DD_TPV_CODIGO (+)
AND DAT.TIPO_ORIENTACION   =  TPO.DD_TPO_CODIGO (+)
AND DAT.TIPO_RENTA   =  TPR.DD_TPR_CODIGO (+)
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
 VIV.DD_TPV_ID,
VIV.DD_TPO_ID,
VIV.DD_TPR_ID,
VIV.VIV_ULTIMA_PLANTA,
VIV.VIV_NUM_PLANTAS_INTERIOR,
VIV.VIV_REFORMA_CARP_INT,
VIV.VIV_REFORMA_CARP_EXT,
VIV.VIV_REFORMA_COCINA,
VIV.VIV_REFORMA_BANYO,
VIV.VIV_REFORMA_SUELO,
VIV.VIV_REFORMA_PINTURA,
VIV.VIV_REFORMA_INTEGRAL,
VIV.VIV_REFORMA_OTRO,
VIV.VIV_REFORMA_OTRO_DESC,
VIV.VIV_REFORMA_PRESUPUESTO,
VIV.VIV_DISTRIBUCION_TXT
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_VIV_VIVIENDA VIV
  WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = VIV.ICO_ID 
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_VIVIENDA INTO R_VIVIENDA;

  IF R_VIVIENDA > 0 THEN



  V_MSQL5 := 'UPDATE '||V_ESQUEMA||'.ACT_VIV_VIVIENDA
  SET DD_TPV_ID = (SELECT TPV.DD_TPV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPV_TIPO_VIVIENDA TPV
WHERE DAT.TIPO_VIVIENDA   =  TPV.DD_TPV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      DD_TPO_ID = (SELECT TPO.DD_TPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPO_TIPO_ORIENTACION TPO
WHERE DAT.TIPO_ORIENTACION   =  TPO.DD_TPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      DD_TPR_ID = (SELECT TPR.DD_TPR_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPR_TIPO_RENTA TPR
WHERE DAT.TIPO_RENTA   =  TPR.DD_TPR_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      VIV_ULTIMA_PLANTA = '||VIV_ULTIMA_PLANTA||',
      VIV_NUM_PLANTAS_INTERIOR = '||VIV_NUM_PLANTAS_INTERIOR||',
      VIV_REFORMA_CARP_INT = '||VIV_REFORMA_CARP_INT||',
      VIV_REFORMA_CARP_EXT = '||VIV_REFORMA_CARP_EXT||',
      VIV_REFORMA_COCINA = '||VIV_REFORMA_COCINA||',
      VIV_REFORMA_BANYO = '||VIV_REFORMA_BANYO||',
      VIV_REFORMA_SUELO = '||VIV_REFORMA_SUELO||',
      VIV_REFORMA_PINTURA = '||VIV_REFORMA_PINTURA||',
      VIV_REFORMA_INTEGRAL = '||VIV_REFORMA_INTEGRAL||',
      VIV_REFORMA_OTRO = '||VIV_REFORMA_OTRO||',
      VIV_REFORMA_OTRO_DESC = '''||REPLACE(VIV_REFORMA_OTRO_DESC,'''','''''')||''',
      VIV_REFORMA_PRESUPUESTO = '||VIV_REFORMA_PRESUPUESTO||',
      VIV_DISTRIBUCION_TXT = '''||REPLACE(VIV_DISTRIBUCION_TXT,'''','''''')||'''
 WHERE ICO_ID = '||ICO_ID||'';





    EXECUTE IMMEDIATE V_MSQL5;

     UPDATE_VIVIENDAS := UPDATE_VIVIENDAS + 1;
     
     END IF;

   END IF ;



----VALIDAMOS QUE EL ACTIVO ES SUBTIPO LOCAL COMERCIAL



 V_LOCAL := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''13'',''14'',''15'',''16'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_LOCAL INTO TABLE_LOCAL;

  IF TABLE_LOCAL > 0 THEN


---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_LOCAL := '
SELECT COUNT(*) FROM (
SELECT 
 DAT.LCO_MTS_FACHADA_PPAL,
DAT.LCO_MTS_FACHADA_LAT,
DAT.LCO_MTS_LUZ_LIBRE,
DAT.LCO_MTS_ALTURA_LIBRE,
DAT.LCO_MTS_LINEALES_PROF,
DAT.LCO_DIAFANO,
DAT.LCO_USO_IDONEO,
DAT.LCO_USO_ANTERIOR,
DAT.LCO_OBSERVACIONES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
 '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL LCO
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = LCO.ICO_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
 LCO.LCO_MTS_FACHADA_PPAL,
LCO.LCO_MTS_FACHADA_LAT,
LCO.LCO_MTS_LUZ_LIBRE,
LCO.LCO_MTS_ALTURA_LIBRE,
LCO.LCO_MTS_LINEALES_PROF,
LCO.LCO_DIAFANO,
LCO.LCO_USO_IDONEO,
LCO.LCO_USO_ANTERIOR,
LCO.LCO_OBSERVACIONES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
 '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL LCO
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = LCO.ICO_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_LOCAL INTO R_LOCAL;

  IF R_LOCAL > 0 THEN

  V_MSQL6 := 'UPDATE '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL
  SET LCO_MTS_FACHADA_PPAL = '''||LCO_MTS_FACHADA_PPAL||''',
      LCO_MTS_FACHADA_LAT = '''||LCO_MTS_FACHADA_LAT||''',
      LCO_MTS_LUZ_LIBRE = '''||LCO_MTS_LUZ_LIBRE||''',
      LCO_MTS_ALTURA_LIBRE = '''||LCO_MTS_ALTURA_LIBRE||''',
      LCO_MTS_LINEALES_PROF = '''||LCO_MTS_LINEALES_PROF||''',
      LCO_DIAFANO = '''||LCO_DIAFANO||''',
      LCO_USO_IDONEO = '''||REPLACE(LCO_USO_IDONEO,'''','''''')||''',
      LCO_USO_ANTERIOR = '''||REPLACE(LCO_USO_ANTERIOR,'''','''''')||''',
      LCO_OBSERVACIONES = '''||REPLACE(LCO_OBSERVACIONES,'''','''''')||'''
 WHERE ICO_ID = '||ICO_ID||'';






    EXECUTE IMMEDIATE V_MSQL6;
    
     UPDATE_LOCAL := UPDATE_LOCAL + 1;
     
     END IF;

  END IF;

----VALIDAMOS QUE EL ACTIVO ES SUBTIPO APARCAMIENTO

 V_APARCA := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''19'',''24'',''26'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_APARCA INTO TABLE_APARCA;

  IF TABLE_APARCA > 0 THEN


---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_APARCA := '
SELECT COUNT(*) FROM (
SELECT 
 DAT.APR_DESTINO_COCHE,
DAT.APR_DESTINO_MOTO,
DAT.APR_DESTINO_DOBLE,
TUA.DD_TUA_ID,
APR.DD_TCA_ID,
DAT.APR_ANCHURA,
DAT.APR_PROFUNDIDAD,
DAT.APR_FORMA_IRREGULAR
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO APR,
  '||V_ESQUEMA||'.DD_TUA_TIPO_UBICA_APARCA TUA,
  '||V_ESQUEMA||'.DD_TCA_TIPO_CALIDAD TCA
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = APR.ICO_ID
AND DAT.DD_TUA_ID   =  TUA.DD_TUA_CODIGO (+)
AND DAT.DD_TCA_ID   =  TCA.DD_TCA_CODIGO (+)
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
 APR.APR_DESTINO_COCHE,
APR.APR_DESTINO_MOTO,
APR.APR_DESTINO_DOBLE,
APR.DD_TUA_ID,
APR.DD_TCA_ID,
APR.APR_ANCHURA,
APR.APR_PROFUNDIDAD,
APR.APR_FORMA_IRREGULAR
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO APR
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = APR.ICO_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_APARCA INTO R_APARCA;

  IF R_APARCA > 0 THEN


  V_MSQL7 := 'UPDATE '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO
  SET APR_DESTINO_COCHE = '''||APR_DESTINO_COCHE||''',
      APR_DESTINO_MOTO = '''||APR_DESTINO_MOTO||''',
      APR_DESTINO_DOBLE = '''||APR_DESTINO_DOBLE||''',
      DD_TUA_ID = (SELECT TUA.DD_TUA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TUA_TIPO_UBICA_APARCA TUA
WHERE DAT.DD_TUA_ID   =  TUA.DD_TUA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      DD_TCA_ID = (SELECT TCA.DD_TCA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TCA_TIPO_CALIDAD TCA
WHERE DAT.DD_TCA_ID   =  TCA.DD_TCA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      APR_ANCHURA = '''||APR_ANCHURA||''',
      APR_PROFUNDIDAD = '''||APR_PROFUNDIDAD||''',
      APR_FORMA_IRREGULAR = '''||APR_FORMA_IRREGULAR||'''
 WHERE ICO_ID = '||ICO_ID||'';






 EXECUTE IMMEDIATE V_MSQL7;

  UPDATE_APARCAMIENTO := UPDATE_APARCAMIENTO + 1;
  
  END IF;
  
 END IF;
 

 ELSE

----INSERTAMOS INFORMACIÓN COMERCIAL A LOS ACTIVOS QUE NO TENÍAN DICHA INFORMACION

  V_MSQL8 := 'INSERT INTO '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL (ICO_ID, ACT_ID, DD_UAC_ID, ICO_ACTIVOS_VINC, ICO_MEDIADOR_ID, ICO_FECHA_EMISION_INFORME, ICO_FECHA_ULTIMA_VISITA, ICO_FECHA_ACEPTACION ,ICO_FECHA_RECHAZO, ICO_CONDICIONES_LEGALES, USUARIOCREAR, FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_ICO_INFO_COMERCIAL.NEXTVAL,
  '||ACT_ID||',
  (SELECT UAC.DD_UAC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_UAC_UBICACION_ACTIVO UAC
WHERE DAT.UBICACION_ACTIVO   =  UAC.DD_UAC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  '''||ICO_ACTIVOS_VINC||''',

  (SELECT PRO.PVE_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_PVE_PROVEEDOR PRO
WHERE DAT.PVE_CODIGO = PRO.PVE_COD_UVEM
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),


  '''||ICO_FECHA_EMISION_INFORME||''',
  '''||ICO_FECHA_ULTIMA_VISITA||''',
  '''||ICO_FECHA_ACEPTACION||''',
  '''||ICO_FECHA_RECHAZO||''',
   '''||REPLACE(ICO_CONDICIONES_LEGALES,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';


  EXECUTE IMMEDIATE V_MSQL8;

  NUEVOS_COUNT := NUEVOS_COUNT + 1;



 V_MSQL9 := 'INSERT INTO '||V_ESQUEMA||'.ACT_EDI_EDIFICIO (EDI_ID, ICO_ID, DD_ECV_ID, DD_TPF_ID, EDI_ANO_REHABILITACION, EDI_NUM_PLANTAS, EDI_ASCENSOR, EDI_NUM_ASCENSORES, EDI_REFORMA_FACHADA, EDI_REFORMA_ESCALERA,
 EDI_REFORMA_PORTAL,
 EDI_REFORMA_ASCENSOR,
EDI_REFORMA_CUBIERTA,
EDI_REFORMA_OTRA_ZONA,
EDI_REFORMA_OTRO,
EDI_REFORMA_OTRO_DESC,
EDI_REFORMA_OTRO_ZONA_COM_DES,
EDI_DESCRIPCION,
EDI_ENTORNO_INFRAESTRUCTURA,
EDI_ENTORNO_COMUNICACION,
 USUARIOCREAR, FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_EDI_EDIFICIO.NEXTVAL,

  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
(SELECT ECV.DD_ECV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_ECV_ESTADO_CONSERVACION ECV
WHERE DAT.ESTADO_CONSERVACION_EDIFICIO   =  ECV.DD_ECV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
(SELECT TPF.DD_TPF_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPF_TIPO_FACHADA TPF
WHERE DAT.TIPO_FACHADA_EDIFICIO   =  TPF.DD_TPF_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

  '''||EDI_ANO_REHABILITACION||''',
  '''||EDI_NUM_PLANTAS||''',
  '''||EDI_ASCENSOR||''',
  '''||EDI_NUM_ASCENSORES||''',
  '''||EDI_REFORMA_FACHADA||''',
  '''||EDI_REFORMA_ESCALERA||''',
  '''||EDI_REFORMA_PORTAL||''',
  '''||EDI_REFORMA_ASCENSOR||''',
   '''||EDI_REFORMA_CUBIERTA||''',
      '''||EDI_REFORMA_OTRA_ZONA||''',
    '''||EDI_REFORMA_OTRO||''',
    '''||REPLACE(EDI_REFORMA_OTRO_DESC,'''','''''')||''',
    '''||REPLACE(EDI_REFORMA_OTRO_ZONA_COM_DES,'''','''''')||''',
    '''||REPLACE(EDI_DESCRIPCION,'''','''''')||''',
    '''||REPLACE(EDI_ENTORNO_INFRAESTRUCTURA,'''','''''')||''',
    '''||REPLACE(EDI_ENTORNO_COMUNICACION,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

  EXECUTE IMMEDIATE V_MSQL9;

----VALIDAMOS QUE EL SUBTIPO ES DE VIVIENDA PARA INSERTAR

 V_SENTENCIA1 := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''05'',''06'',''07'',''08'',''09'',''10'',''11'',''12'',''20'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_SENTENCIA1 INTO TABLE_COUNT;

  IF TABLE_COUNT > 0 THEN



 V_MSQL10 := 'INSERT INTO '||V_ESQUEMA||'.ACT_VIV_VIVIENDA (ICO_ID, DD_TPV_ID, DD_TPO_ID, DD_TPR_ID, VIV_ULTIMA_PLANTA, VIV_NUM_PLANTAS_INTERIOR, VIV_REFORMA_CARP_INT,
 VIV_REFORMA_CARP_EXT,
VIV_REFORMA_COCINA,
VIV_REFORMA_BANYO,
VIV_REFORMA_SUELO,
VIV_REFORMA_PINTURA,
VIV_REFORMA_INTEGRAL,
VIV_REFORMA_OTRO,
VIV_REFORMA_OTRO_DESC,
VIV_REFORMA_PRESUPUESTO,
VIV_DISTRIBUCION_TXT )
  VALUES (
  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

   (SELECT TPV.DD_TPV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPV_TIPO_VIVIENDA TPV
WHERE DAT.TIPO_VIVIENDA   =  TPV.DD_TPV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  (SELECT TPO.DD_TPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPO_TIPO_ORIENTACION TPO
WHERE DAT.TIPO_ORIENTACION   =  TPO.DD_TPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  (SELECT TPR.DD_TPR_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPR_TIPO_RENTA TPR
WHERE DAT.TIPO_RENTA   =  TPR.DD_TPR_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||')
 ,
  '''||VIV_ULTIMA_PLANTA||''',
  '''||VIV_NUM_PLANTAS_INTERIOR||''',
  '''||VIV_REFORMA_CARP_INT||''',
  '''||VIV_REFORMA_CARP_EXT||''',
  '''||VIV_REFORMA_COCINA||''',
   '''||VIV_REFORMA_BANYO||''',
      '''||VIV_REFORMA_SUELO||''',
    '''||VIV_REFORMA_PINTURA||''',
    '''||VIV_REFORMA_INTEGRAL||''',
    '''||VIV_REFORMA_OTRO||''',
  '''||REPLACE(VIV_REFORMA_OTRO_DESC,'''','''''')||''',
  '''||VIV_REFORMA_PRESUPUESTO||''',
  '''||REPLACE(VIV_DISTRIBUCION_TXT,'''','''''')||'''
   )';



  EXECUTE IMMEDIATE V_MSQL10;

  NUEVOS_VIVIENDAS := NUEVOS_VIVIENDAS + 1;





  V_MSQL11 := '
		UPDATE '||V_ESQUEMA||'.'||V_TABLA_INFO||' ICO
		SET DD_TIC_ID = 1
		WHERE EXISTS  (
		SELECT 1 FROM '||V_ESQUEMA||'.'||V_TABLA_VIV||' VIV
		WHERE ICO.ICO_ID = VIV.ICO_ID
    AND  ICO.ACT_ID = '||ACT_ID||'
    )
	  ';




EXECUTE IMMEDIATE V_MSQL11;


  END IF;

----VALIDAMOS QUE EL SUBTIPO ES DE LOCAL COMERCIAL PARA INSERTAR


 V_SENTENCIA2 := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''13'',''14'',''15'',''16'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_SENTENCIA2 INTO TABLE_COUNT2;

  IF TABLE_COUNT2 > 0 THEN



    V_MSQL12 := 'INSERT INTO '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL (ICO_ID,
LCO_MTS_FACHADA_PPAL,
LCO_MTS_FACHADA_LAT,
LCO_MTS_LUZ_LIBRE,
LCO_MTS_ALTURA_LIBRE,
LCO_MTS_LINEALES_PROF,
LCO_DIAFANO,
LCO_USO_IDONEO,
LCO_USO_ANTERIOR,
LCO_OBSERVACIONES )
  VALUES (
  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

  '''||LCO_MTS_FACHADA_PPAL||''',
  '''||LCO_MTS_FACHADA_LAT||''',
  '''||LCO_MTS_LUZ_LIBRE||''',
  '''||LCO_MTS_ALTURA_LIBRE||''',
  '''||LCO_MTS_LINEALES_PROF||''',
  '''||LCO_DIAFANO||''',
  '''||REPLACE(LCO_USO_IDONEO,'''','''''')||''',
  '''||REPLACE(LCO_USO_ANTERIOR,'''','''''')||''',
  '''||REPLACE(LCO_OBSERVACIONES,'''','''''')||'''
   )';



EXECUTE IMMEDIATE V_MSQL12;

    NUEVOS_LOCAL := NUEVOS_LOCAL + 1;




  V_MSQL13 := '
		UPDATE '||V_ESQUEMA||'.'||V_TABLA_INFO||' ICO
		SET DD_TIC_ID = 2
		WHERE EXISTS  (
		SELECT 1 FROM '||V_ESQUEMA||'.'||V_TABLA_LOCAL||' LOC
		WHERE ICO.ICO_ID = LOC.ICO_ID
    AND  ICO.ACT_ID = '||ACT_ID||'
    )
	  ';




EXECUTE IMMEDIATE V_MSQL13;

  END IF;


----VALIDAMOS QUE EL SUBTIPO ES DE APARCAMIENTO PARA INSERTAR

 V_SENTENCIA3 := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''19'',''24'',''26'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_SENTENCIA3 INTO TABLE_COUNT3;

  IF TABLE_COUNT3 > 0 THEN



  V_MSQL14 := 'INSERT INTO '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO (
ICO_ID,
APR_DESTINO_COCHE,
APR_DESTINO_MOTO,
APR_DESTINO_DOBLE,
DD_TUA_ID,
DD_TCA_ID,
APR_ANCHURA,
APR_PROFUNDIDAD,
APR_FORMA_IRREGULAR
 )
  VALUES (
  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

  '''||APR_DESTINO_COCHE||''',
  '''||APR_DESTINO_MOTO||''',
  '''||APR_DESTINO_DOBLE||''',
  (SELECT TUA.DD_TUA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TUA_TIPO_UBICA_APARCA TUA
WHERE DAT.DD_TUA_ID   =  TUA.DD_TUA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  (SELECT TCA.DD_TCA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TCA_TIPO_CALIDAD TCA
WHERE DAT.DD_TCA_ID   =  TCA.DD_TCA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  '''||APR_ANCHURA||''',
  '''||APR_PROFUNDIDAD||''',
  '''||APR_FORMA_IRREGULAR||'''
   )';



EXECUTE IMMEDIATE V_MSQL14;

  NUEVOS_APARCAMIENTO := NUEVOS_APARCAMIENTO + 1;





  V_MSQL15 := '
		UPDATE '||V_ESQUEMA||'.'||V_TABLA_INFO||' ICO
		SET DD_TIC_ID = 3
		WHERE EXISTS  (
		SELECT 1 FROM '||V_ESQUEMA||'.'||V_TABLA_APARC||' APAR
		WHERE ICO.ICO_ID = APAR.ICO_ID
    AND  ICO.ACT_ID = '||ACT_ID||'
    )
	  ';




EXECUTE IMMEDIATE V_MSQL15;


  END IF;


END IF;


-------------------------------------       #########    CALIDADES ACTIVO   ######### --------------------------------------------
-------------------------------------VALIDAMOS CALIDADES ACTIVOS ANTES DE INSERTAR Y ACTUALIZAR EN CADA UNA DE LAS TABLAS-------------------------------------------------------------



V_VALIDA_ACT_DIST := 'SELECT
INFO.ICO_ID INFO_ICO_ID,
CRI.ICO_ID CRI_ICO_ID,
CRE.ICO_ID CRE_ICO_ID,
PRV.ICO_ID PRV_ICO_ID,
SOL.ICO_ID SOL_ICO_ID,
INF.ICO_ID INF_ICO_ID,
ZCO.ICO_ID ZCO_ICO_ID,
INS.ICO_ID INS_ICO_ID,
BNY.ICO_ID BNY_ICO_ID,
COC.ICO_ID COC_ICO_ID
FROM 
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
'||V_ESQUEMA||'.ACT_CRI_CARPINTERIA_INT CRI,
'||V_ESQUEMA||'.ACT_CRE_CARPINTERIA_EXT CRE,
'||V_ESQUEMA||'.ACT_PRV_PARAMENTO_VERTICAL PRV,
'||V_ESQUEMA||'.ACT_SOL_SOLADO SOL,
'||V_ESQUEMA||'.ACT_INF_INFRAESTRUCTURA INF,
'||V_ESQUEMA||'.ACT_ZCO_ZONA_COMUN ZCO,
'||V_ESQUEMA||'.ACT_INS_INSTALACION INS,
'||V_ESQUEMA||'.ACT_BNY_BANYO BNY,
'||V_ESQUEMA||'.ACT_COC_COCINA COC
WHERE 
 DAT.ACT_NUMERO_ACTIVO = CAL.ACT_NUMERO_ACTIVO
AND ACT.ACT_NUM_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND INFO.ACT_ID = ACT.ACT_ID
AND CRI.ICO_ID (+) = INFO.ICO_ID 
AND CRE.ICO_ID (+) = INFO.ICO_ID 
AND PRV.ICO_ID (+) = INFO.ICO_ID 
AND SOL.ICO_ID (+) = INFO.ICO_ID 
AND INF.ICO_ID (+) = INFO.ICO_ID 
AND ZCO.ICO_ID (+) = INFO.ICO_ID 
AND INS.ICO_ID (+) = INFO.ICO_ID 
AND BNY.ICO_ID (+) = INFO.ICO_ID
AND COC.ICO_ID (+) = INFO.ICO_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;
  
 --DBMS_OUTPUT.PUT_LINE(V_VALIDA_ACT_DIST);
 



EXECUTE IMMEDIATE V_VALIDA_ACT_DIST INTO 
INFO_ICO_ID,
CRI_ICO_ID,
CRE_ICO_ID,
PRV_ICO_ID,
SOL_ICO_ID,
INF_ICO_ID,
ZCO_ICO_ID,
INS_ICO_ID,
BNY_ICO_ID,
COC_ICO_ID
;

--VALIDAMOS QUE EL ACTIVO EN CALIDADES ACTIVO EXISTA EN LA ACT_ICO_INFOCOMERCIAL

IF INFO_ICO_ID IS NOT NULL THEN --VALIDAMOS QUE EL ACTIVO EXISTA EN LA ACT_ICO_INFOCOMERCIAL Y EN EL FICHERO DE DATOS-ACTIVO

 --DBMS_OUTPUT.PUT_LINE('El ico id :'||INFO_ICO_ID||' si existe en la ACT_ICO_INFOCOMERCIAL');
 
 V_CALIDADES_ACTIVO := '
  SELECT 
  CAL.CRI_PTA_ENT_NORMAL,
  CAL.CRI_PTA_ENT_BLINDADA,
  CAL.CRI_PTA_ENT_ACORAZADA,
  CAL.CRI_PTA_PASO_MACIZAS,
  CAL.CRI_PTA_PASO_HUECAS,
  CAL.CRI_PTA_PASO_LACADAS,
  CAL.CRI_ARMARIOS_EMPOTRADOS,
  CAL.CRI_CRP_INT_OTROS,
  CAL.CRE_VTNAS_HIERRO,
  CAL.CRE_VTNAS_ALU_ANODIZADO,
  CAL.CRE_VTNAS_ALU_LACADO,
  CAL.CRE_VTNAS_PVC,
  CAL.CRE_VTNAS_MADERA,
  CAL.CRE_PERS_PLASTICO,
  CAL.CRE_PERS_ALU,
  CAL.CRE_VTNAS_CORREDERAS,
  CAL.CRE_VTNAS_ABATIBLES,
  CAL.CRE_VTNAS_OSCILOBAT,
  CAL.CRE_DOBLE_CRISTAL,
  CAL.CRE_EST_DOBLE_CRISTAL,
  CAL.CRE_CRP_EXT_OTROS,
  CAL.PRV_HUMEDAD_PARED,
  CAL.PRV_HUMEDAD_TECHO,
  CAL.PRV_GRIETA_PARED,
  CAL.PRV_GRIETA_TECHO,
  CAL.PRV_GOTELE,
  CAL.PRV_PLASTICA_LISA,
  CAL.PRV_PAPEL_PINTADO,
  CAL.PRV_PINTURA_LISA_TECHO,
  CAL.PRV_PINTURA_LISA_TECHO_EST,
  CAL.PRV_MOLDURA_ESCAYOLA,
  CAL.PRV_MOLDURA_ESCAYOLA_EST,
  CAL.PRV_PARAMENTOS_OTROS,
  CAL.SOL_TARIMA_FLOTANTE,
  CAL.SOL_PARQUE,
  CAL.SOL_MARMOL,
  CAL.SOL_PLAQUETA,
  CAL.SOL_SOLADO_OTROS,
  CAL.INF_OCIO,
  CAL.INF_HOTELES,
  CAL.INF_HOTELES_DESC,
  CAL.INF_TEATROS,
  CAL.INF_TEATROS_DESC,
  CAL.INF_SALAS_CINE,
  CAL.INF_SALAS_CINE_DESC,
  CAL.INF_INST_DEPORT,
  CAL.INF_INST_DEPORT_DESC,
  CAL.INF_CENTROS_COMERC,
  CAL.INF_CENTROS_COMERC_DESC,
  CAL.INF_OCIO_OTROS,
  CAL.INF_CENTROS_EDU,
  CAL.INF_ESCUELAS_INF,
  CAL.INF_ESCUELAS_INF_DESC,
  CAL.INF_COLEGIOS,
  CAL.INF_COLEGIOS_DESC,
  CAL.INF_INSTITUTOS,
  CAL.INF_INSTITUTOS_DESC,
  CAL.INF_UNIVERSIDADES,
  CAL.INF_UNIVERSIDADES_DESC,
  CAL.INF_CENTROS_EDU_OTROS,
  CAL.INF_CENTROS_SANIT,
  CAL.INF_CENTROS_SALUD,
  CAL.INF_CENTROS_SALUD_DESC,
  CAL.INF_CLINICAS,
  CAL.INF_CLINICAS_DESC,
  CAL.INF_HOSPITALES,
  CAL.INF_HOSPITALES_DESC,
  CAL.INF_CENTROS_SANIT_OTROS,
  CAL.INF_PARKING_SUP_SUF,
  CAL.INF_COMUNICACIONES,
  CAL.INF_FACIL_ACCESO,
  CAL.INF_FACIL_ACCESO_DESC,
  CAL.INF_LINEAS_BUS,
  CAL.INF_LINEAS_BUS_DESC,
  CAL.INF_METRO,
  CAL.INF_METRO_DESC,
  CAL.INF_EST_TREN,
  CAL.INF_EST_TREN_DESC,
  CAL.INF_COMUNICACIONES_OTRO,
  CAL.ZCO_ZONAS_COMUNES,
  CAL.ZCO_JARDINES,
  CAL.ZCO_PISCINA,
  CAL.ZCO_INST_DEP,
  CAL.ZCO_PADEL,
  CAL.ZCO_TENIS,
  CAL.ZCO_PISTA_POLIDEP,
  CAL.ZCO_OTROS,
  CAL.ZCO_ZONA_INFANTIL,
  CAL.ZCO_CONSERJE_VIGILANCIA,
  CAL.ZCO_GIMNASIO,
  CAL.ZCO_ZONA_COMUN_OTROS,
  CAL.INS_ELECTR,
  CAL.INS_ELECTR_CON_CONTADOR,
  CAL.INS_ELECTR_BUEN_ESTADO,
  CAL.INS_ELECTR_DEFECTUOSA_ANTIGUA,
  CAL.INS_AGUA,
  CAL.INS_AGUA_CON_CONTADOR,
  CAL.INS_AGUA_BUEN_ESTADO,
  CAL.INS_AGUA_DEFECTUOSA_ANTIGUA,
  CAL.INS_AGUA_CALIENTE_CENTRAL,
  CAL.INS_AGUA_CALIENTE_GAS_NATURAL,
  CAL.INS_GAS,
  CAL.INS_GAS_CON_CONTADOR,
  CAL.INS_GAS_INST_BUEN_ESTADO,
  CAL.INS_GAS_DEFECTUOSA_ANTIGUA,
  CAL.INS_CALEF,
  CAL.INS_CALEF_CENTRAL,
  CAL.INS_CALEF_GAS_NATURAL,
  CAL.INS_CALEF_RADIADORES_ALU,
  CAL.INS_CALEF_PREINSTALACION,
  CAL.INS_AIRE,
  CAL.INS_AIRE_PREINSTALACION,
  CAL.INS_AIRE_INSTALACION,
  CAL.INS_AIRE_FRIO_CALOR,
  CAL.INS_INST_OTROS,
  CAL.BNY_DUCHA_BANYERA,
  CAL.BNY_DUCHA,
  CAL.BNY_BANYERA,
  CAL.BNY_BANYERA_HIDROMASAJE,
  CAL.BNY_COLUMNA_HIDROMASAJE,
  CAL.BNY_ALICATADO_MARMOL,
  CAL.BNY_ALICATADO_GRANITO,
  CAL.BNY_ALICATADO_AZULEJO,
  CAL.BNY_ENCIMERA,
  CAL.BNY_MARMOL,
  CAL.BNY_GRANITO,
  CAL.BNY_OTRO_MATERIAL,
  CAL.BNY_SANITARIOS,
  CAL.BNY_SANITARIOS_EST,
  CAL.BNY_SUELOS,
  CAL.BNY_GRIFO_MONOMANDO,
  CAL.BNY_GRIFO_MONOMANDO_EST,
  CAL.BNY_BANYO_OTROS,
  CAL.COC_AMUEBLADA,
  CAL.COC_AMUEBLADA_EST,
  CAL.COC_ENCIMERA,
  CAL.COC_ENCI_GRANITO,
  CAL.COC_ENCI_MARMOL,
  CAL.COC_ENCI_OTRO_MATERIAL,
  CAL.COC_VITRO,
  CAL.COC_LAVADORA,
  CAL.COC_FRIGORIFICO,
  CAL.COC_LAVAVAJILLAS,
  CAL.COC_MICROONDAS,
  CAL.COC_HORNO,
  CAL.COC_SUELOS,
  CAL.COC_AZULEJOS,
  CAL.COC_AZULEJOS_EST,
  CAL.COC_GRIFOS_MONOMANDO,
  CAL.COC_GRIFOS_MONOMANDO_EST,
  CAL.COC_COCINA_OTROS
  FROM  
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND   DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND   ACT.ACT_NUM_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;


 EXECUTE IMMEDIATE V_CALIDADES_ACTIVO INTO 
  CRI_PTA_ENT_NORMAL,
  CRI_PTA_ENT_BLINDADA,
  CRI_PTA_ENT_ACORAZADA,
  CRI_PTA_PASO_MACIZAS,
  CRI_PTA_PASO_HUECAS,
  CRI_PTA_PASO_LACADAS,
  CRI_ARMARIOS_EMPOTRADOS,
  CRI_CRP_INT_OTROS,
  CRE_VTNAS_HIERRO,
  CRE_VTNAS_ALU_ANODIZADO,
  CRE_VTNAS_ALU_LACADO,
  CRE_VTNAS_PVC,
  CRE_VTNAS_MADERA,
  CRE_PERS_PLASTICO,
  CRE_PERS_ALU,
  CRE_VTNAS_CORREDERAS,
  CRE_VTNAS_ABATIBLES,
  CRE_VTNAS_OSCILOBAT,
  CRE_DOBLE_CRISTAL,
  CRE_EST_DOBLE_CRISTAL,
  CRE_CRP_EXT_OTROS,
  PRV_HUMEDAD_PARED,
  PRV_HUMEDAD_TECHO,
  PRV_GRIETA_PARED,
  PRV_GRIETA_TECHO,
  PRV_GOTELE,
  PRV_PLASTICA_LISA,
  PRV_PAPEL_PINTADO,
  PRV_PINTURA_LISA_TECHO,
  PRV_PINTURA_LISA_TECHO_EST,
  PRV_MOLDURA_ESCAYOLA,
  PRV_MOLDURA_ESCAYOLA_EST,
  PRV_PARAMENTOS_OTROS,
  SOL_TARIMA_FLOTANTE,
  SOL_PARQUE,
  SOL_MARMOL,
  SOL_PLAQUETA,
  SOL_SOLADO_OTROS,
  INF_OCIO,
  INF_HOTELES,
  INF_HOTELES_DESC,
  INF_TEATROS,
  INF_TEATROS_DESC,
  INF_SALAS_CINE,
  INF_SALAS_CINE_DESC,
  INF_INST_DEPORT,
  INF_INST_DEPORT_DESC,
  INF_CENTROS_COMERC,
  INF_CENTROS_COMERC_DESC,
  INF_OCIO_OTROS,
  INF_CENTROS_EDU,
  INF_ESCUELAS_INF,
  INF_ESCUELAS_INF_DESC,
  INF_COLEGIOS,
  INF_COLEGIOS_DESC,
  INF_INSTITUTOS,
  INF_INSTITUTOS_DESC,
  INF_UNIVERSIDADES,
  INF_UNIVERSIDADES_DESC,
  INF_CENTROS_EDU_OTROS,
  INF_CENTROS_SANIT,
  INF_CENTROS_SALUD,
  INF_CENTROS_SALUD_DESC,
  INF_CLINICAS,
  INF_CLINICAS_DESC,
  INF_HOSPITALES,
  INF_HOSPITALES_DESC,
  INF_CENTROS_SANIT_OTROS,
  INF_PARKING_SUP_SUF,
  INF_COMUNICACIONES,
  INF_FACIL_ACCESO,
  INF_FACIL_ACCESO_DESC,
  INF_LINEAS_BUS,
  INF_LINEAS_BUS_DESC,
  INF_METRO,
  INF_METRO_DESC,
  INF_EST_TREN,
  INF_EST_TREN_DESC,
  INF_COMUNICACIONES_OTRO,
  ZCO_ZONAS_COMUNES,
  ZCO_JARDINES,
  ZCO_PISCINA,
  ZCO_INST_DEP,
  ZCO_PADEL,
  ZCO_TENIS,
  ZCO_PISTA_POLIDEP,
  ZCO_OTROS,
  ZCO_ZONA_INFANTIL,
  ZCO_CONSERJE_VIGILANCIA,
  ZCO_GIMNASIO,
  ZCO_ZONA_COMUN_OTROS,
  INS_ELECTR,
  INS_ELECTR_CON_CONTADOR,
  INS_ELECTR_BUEN_ESTADO,
  INS_ELECTR_DEFECTUOSA_ANTIGUA,
  INS_AGUA,
  INS_AGUA_CON_CONTADOR,
  INS_AGUA_BUEN_ESTADO,
  INS_AGUA_DEFECTUOSA_ANTIGUA,
  INS_AGUA_CALIENTE_CENTRAL,
  INS_AGUA_CALIENTE_GAS_NATURAL,
  INS_GAS,
  INS_GAS_CON_CONTADOR,
  INS_GAS_INST_BUEN_ESTADO,
  INS_GAS_DEFECTUOSA_ANTIGUA,
  INS_CALEF,
  INS_CALEF_CENTRAL,
  INS_CALEF_GAS_NATURAL,
  INS_CALEF_RADIADORES_ALU,
  INS_CALEF_PREINSTALACION,
  INS_AIRE,
  INS_AIRE_PREINSTALACION,
  INS_AIRE_INSTALACION,
  INS_AIRE_FRIO_CALOR,
  INS_INST_OTROS,
  BNY_DUCHA_BANYERA,
  BNY_DUCHA,
  BNY_BANYERA,
  BNY_BANYERA_HIDROMASAJE,
  BNY_COLUMNA_HIDROMASAJE,
  BNY_ALICATADO_MARMOL,
  BNY_ALICATADO_GRANITO,
  BNY_ALICATADO_AZULEJO,
  BNY_ENCIMERA,
  BNY_MARMOL,
  BNY_GRANITO,
  BNY_OTRO_MATERIAL,
  BNY_SANITARIOS,
  BNY_SANITARIOS_EST,
  BNY_SUELOS,
  BNY_GRIFO_MONOMANDO,
  BNY_GRIFO_MONOMANDO_EST,
  BNY_BANYO_OTROS,
  COC_AMUEBLADA,
  COC_AMUEBLADA_EST,
  COC_ENCIMERA,
  COC_ENCI_GRANITO,
  COC_ENCI_MARMOL,
  COC_ENCI_OTRO_MATERIAL,
  COC_VITRO,
  COC_LAVADORA,
  COC_FRIGORIFICO,
  COC_LAVAVAJILLAS,
  COC_MICROONDAS,
  COC_HORNO,
  COC_SUELOS,
  COC_AZULEJOS,
  COC_AZULEJOS_EST,
  COC_GRIFOS_MONOMANDO,
  COC_GRIFOS_MONOMANDO_EST,
  COC_COCINA_OTROS
 ;
 

IF CRI_ICO_ID IS NULL THEN
 
--DBMS_OUTPUT.PUT_LINE('INSERTAMOS LOS DATOS CALIDADES EN LA TABLA ACT_CRI_CARPINTERIA_INT, ICO -> '||INFO_ICO_ID||'');

 ---- INSERTAMOS EN ACT_CRI_CARPINTERIA_INT - CALIDADES ACTIVO 

V_CRI_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_CRI_CARPINTERIA_INT (
CRI_ID,
ICO_ID,
DD_ACR_ID,
CRI_PTA_ENT_NORMAL,
CRI_PTA_ENT_BLINDADA,
CRI_PTA_ENT_ACORAZADA,
CRI_PTA_PASO_MACIZAS,
CRI_PTA_PASO_HUECAS,
CRI_PTA_PASO_LACADAS,
CRI_ARMARIOS_EMPOTRADOS,
CRI_CRP_INT_OTROS,
 USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_CRI_CARPINTERIA_INT.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

(SELECT ACR.DD_ACR_ID FROM '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
    '||V_ESQUEMA||'.DD_ACR_ACABADO_CARPINTERIA ACR
WHERE CAL.TIPO_ACABADO_CARPINTERIA   =  ACR.DD_ACR_CODIGO
AND   CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

'''||CRI_PTA_ENT_NORMAL||''',
'''||CRI_PTA_ENT_BLINDADA||''',
'''||CRI_PTA_ENT_ACORAZADA||''',
'''||CRI_PTA_PASO_MACIZAS||''',
'''||CRI_PTA_PASO_HUECAS||''',
'''||CRI_PTA_PASO_LACADAS||''',
'''||CRI_ARMARIOS_EMPOTRADOS||''',
'''||REPLACE(CRI_CRP_INT_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_CRI_INS);

  EXECUTE IMMEDIATE V_CRI_INS;
  
  NEW_CRI := NEW_CRI + 1;

ELSE 

--DBMS_OUTPUT.PUT_LINE('ACTUALIZAMOS EN LA TABLA ACT_CRI_CARPINTERIA_INT, CON ICO  -> '||INFO_ICO_ID||'');



---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_CRI := '
SELECT COUNT (*) FROM (
SELECT 
 CAL.ACT_NUMERO_ACTIVO,
 ACR.DD_ACR_ID,
 CAL.CRI_PTA_ENT_NORMAL,
CAL.CRI_PTA_ENT_BLINDADA,
CAL.CRI_PTA_ENT_ACORAZADA,
CAL.CRI_PTA_PASO_MACIZAS,
CAL.CRI_PTA_PASO_HUECAS,
CAL.CRI_PTA_PASO_LACADAS,
CAL.CRI_ARMARIOS_EMPOTRADOS,
CAL.CRI_CRP_INT_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
'||V_ESQUEMA||'.ACT_CRI_CARPINTERIA_INT CRI,
DD_ACR_ACABADO_CARPINTERIA ACR
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = CRI.ICO_ID 
AND CAL.TIPO_ACABADO_CARPINTERIA   =  ACR.DD_ACR_CODIGO (+)
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CRI.DD_ACR_ID,
CRI.CRI_PTA_ENT_NORMAL,
CRI.CRI_PTA_ENT_BLINDADA,
CRI.CRI_PTA_ENT_ACORAZADA,
CRI.CRI_PTA_PASO_MACIZAS,
CRI.CRI_PTA_PASO_HUECAS,
CRI.CRI_PTA_PASO_LACADAS,
CRI.CRI_ARMARIOS_EMPOTRADOS,
CRI.CRI_CRP_INT_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
'||V_ESQUEMA||'.ACT_CRI_CARPINTERIA_INT CRI
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = CRI.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_CRI INTO R_CRI;

  IF R_CRI > 0 THEN



---ACTUALIZAMOS ACT_CRI_CARPINTERIA_INT - CALIDADES ACTIVO

V_MSQL_CRI := 'UPDATE '||V_ESQUEMA||'.ACT_CRI_CARPINTERIA_INT
  SET
      DD_ACR_ID = (SELECT ACR.DD_ACR_ID FROM '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
    '||V_ESQUEMA||'.DD_ACR_ACABADO_CARPINTERIA ACR
WHERE CAL.TIPO_ACABADO_CARPINTERIA   =  ACR.DD_ACR_CODIGO
AND   CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      CRI_PTA_ENT_NORMAL = '''||CRI_PTA_ENT_NORMAL||''',
      CRI_PTA_ENT_BLINDADA  = '''||CRI_PTA_ENT_BLINDADA||''',
      CRI_PTA_ENT_ACORAZADA = '''||CRI_PTA_ENT_ACORAZADA||''',
      CRI_PTA_PASO_MACIZAS = '''||CRI_PTA_PASO_MACIZAS||''',
      CRI_PTA_PASO_HUECAS = '''||CRI_PTA_PASO_HUECAS||''',
      CRI_PTA_PASO_LACADAS = '''||CRI_PTA_PASO_LACADAS||''',
      CRI_ARMARIOS_EMPOTRADOS = '''||CRI_ARMARIOS_EMPOTRADOS||''',
      CRI_CRP_INT_OTROS = '''||REPLACE(CRI_CRP_INT_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';

--DBMS_OUTPUT.PUT_LINE(V_MSQL_CRI);

    EXECUTE IMMEDIATE V_MSQL_CRI;
    
    MODIF_CRI := MODIF_CRI + 1;
    
    END IF;

END IF;

IF CRE_ICO_ID IS NULL THEN

--DBMS_OUTPUT.PUT_LINE('INSERTAMOS LOS DATOS CALIDADES EN LA TABLA ACT_CRE_CARPINTERIA_EXT, ICO -> '||INFO_ICO_ID||'');

 ---- INSERTAMOS EN ACT_CRE_CARPINTERIA_EXT - CALIDADES ACTIVO 

V_CRE_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_CRE_CARPINTERIA_EXT (
CRE_ID,
ICO_ID,
CRE_VTNAS_HIERRO,
CRE_VTNAS_ALU_ANODIZADO,
CRE_VTNAS_ALU_LACADO,
CRE_VTNAS_PVC,
CRE_VTNAS_MADERA,
CRE_PERS_PLASTICO,
CRE_PERS_ALU,
CRE_VTNAS_CORREDERAS,
CRE_VTNAS_ABATIBLES,
CRE_VTNAS_OSCILOBAT,
CRE_DOBLE_CRISTAL,
CRE_EST_DOBLE_CRISTAL,
CRE_CRP_EXT_OTROS,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_CRE_CARPINTERIA_EXT.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
'''||CRE_VTNAS_HIERRO||''',
'''||CRE_VTNAS_ALU_ANODIZADO||''',
'''||CRE_VTNAS_ALU_LACADO||''',
'''||CRE_VTNAS_PVC||''',
'''||CRE_VTNAS_MADERA||''',
'''||CRE_PERS_PLASTICO||''',
'''||CRE_PERS_ALU||''',
'''||CRE_VTNAS_CORREDERAS||''',
'''||CRE_VTNAS_ABATIBLES||''',
'''||CRE_VTNAS_OSCILOBAT||''',
'''||CRE_DOBLE_CRISTAL||''',
'''||CRE_EST_DOBLE_CRISTAL||''',
'''||REPLACE(CRE_CRP_EXT_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_CRE_INS);

  EXECUTE IMMEDIATE V_CRE_INS;
  
  NEW_CRE := NEW_CRE + 1;
 
ELSE

--DBMS_OUTPUT.PUT_LINE('ACTUALIZAMOS EN LA TABLA ACT_CRE_CARPINTERIA_EXT, CON ICO  -> '||INFO_ICO_ID||'');

---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_CRE := '
SELECT COUNT(*) FROM (
SELECT 
CAL.CRE_VTNAS_HIERRO,
CAL.CRE_VTNAS_ALU_ANODIZADO,
CAL.CRE_VTNAS_ALU_LACADO,
CAL.CRE_VTNAS_PVC,
CAL.CRE_VTNAS_MADERA,
CAL.CRE_PERS_PLASTICO,
CAL.CRE_PERS_ALU,
CAL.CRE_VTNAS_CORREDERAS,
CAL.CRE_VTNAS_ABATIBLES,
CAL.CRE_VTNAS_OSCILOBAT,
CAL.CRE_DOBLE_CRISTAL,
CAL.CRE_EST_DOBLE_CRISTAL,
CAL.CRE_CRP_EXT_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
'||V_ESQUEMA||'.ACT_CRE_CARPINTERIA_EXT CRE
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = CRE.ICO_ID 
AND  CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CRE.CRE_VTNAS_HIERRO,
CRE.CRE_VTNAS_ALU_ANODIZADO,
CRE.CRE_VTNAS_ALU_LACADO,
CRE.CRE_VTNAS_PVC,
CRE.CRE_VTNAS_MADERA,
CRE.CRE_PERS_PLASTICO,
CRE.CRE_PERS_ALU,
CRE.CRE_VTNAS_CORREDERAS,
CRE.CRE_VTNAS_ABATIBLES,
CRE.CRE_VTNAS_OSCILOBAT,
CRE.CRE_DOBLE_CRISTAL,
CRE.CRE_EST_DOBLE_CRISTAL,
CRE.CRE_CRP_EXT_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
'||V_ESQUEMA||'.ACT_CRE_CARPINTERIA_EXT CRE
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = CRE.ICO_ID 
AND  CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_CRE INTO R_CRE;

  IF R_CRE > 0 THEN



---ACTUALIZAMOS ACT_CRE_CARPINTERIA_EXT - CALIDADES ACTIVO    
    
V_MSQL_CRE := 'UPDATE '||V_ESQUEMA||'.ACT_CRE_CARPINTERIA_EXT
  SET 
      CRE_VTNAS_HIERRO = '''||CRE_VTNAS_HIERRO||''',
      CRE_VTNAS_ALU_ANODIZADO = '''||CRE_VTNAS_ALU_ANODIZADO||''',
      CRE_VTNAS_ALU_LACADO = '''||CRE_VTNAS_ALU_LACADO||''',
      CRE_VTNAS_PVC = '''||CRE_VTNAS_PVC||''',
      CRE_VTNAS_MADERA = '''||CRE_VTNAS_MADERA||''',
      CRE_PERS_PLASTICO = '''||CRE_PERS_PLASTICO||''',
      CRE_PERS_ALU = '''||CRE_PERS_ALU||''',
      CRE_VTNAS_CORREDERAS = '''||CRE_VTNAS_CORREDERAS||''',
      CRE_VTNAS_ABATIBLES = '''||CRE_VTNAS_ABATIBLES||''',
      CRE_VTNAS_OSCILOBAT = '''||CRE_VTNAS_OSCILOBAT||''',
      CRE_DOBLE_CRISTAL = '''||CRE_DOBLE_CRISTAL||''',
      CRE_EST_DOBLE_CRISTAL = '''||CRE_EST_DOBLE_CRISTAL||''',
      CRE_CRP_EXT_OTROS = '''||REPLACE(CRE_CRP_EXT_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';

--DBMS_OUTPUT.PUT_LINE(V_MSQL_CRE);

    EXECUTE IMMEDIATE V_MSQL_CRE;
    
     MODIF_CRE := MODIF_CRE + 1;
     
     END IF;
  
END IF;

IF PRV_ICO_ID IS NULL THEN

--DBMS_OUTPUT.PUT_LINE('INSERTAMOS LOS DATOS CALIDADES EN LA TABLA ACT_PRV_PARAMENTO_VERTICAL, ICO -> '||INFO_ICO_ID||'');

 ---- INSERTAMOS EN ACT_PRV_PARAMENTO_VERTICAL - CALIDADES ACTIVO 

V_PRV_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_PRV_PARAMENTO_VERTICAL (
PRV_ID,
ICO_ID,
PRV_HUMEDAD_PARED,
PRV_HUMEDAD_TECHO,
PRV_GRIETA_PARED,
PRV_GRIETA_TECHO,
PRV_GOTELE,
PRV_PLASTICA_LISA,
PRV_PAPEL_PINTADO,
PRV_PINTURA_LISA_TECHO,
PRV_PINTURA_LISA_TECHO_EST,
PRV_MOLDURA_ESCAYOLA,
PRV_MOLDURA_ESCAYOLA_EST,
PRV_PARAMENTOS_OTROS,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_PRV_PARAMENTO_VERTICAL.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
'''||PRV_HUMEDAD_PARED||''',
'''||PRV_HUMEDAD_TECHO||''',
'''||PRV_GRIETA_PARED||''',
'''||PRV_GRIETA_TECHO||''',
'''||PRV_GOTELE||''',
'''||PRV_PLASTICA_LISA||''',
'''||PRV_PAPEL_PINTADO||''',
'''||PRV_PINTURA_LISA_TECHO||''',
'''||PRV_PINTURA_LISA_TECHO_EST||''',
'''||PRV_MOLDURA_ESCAYOLA||''',
'''||PRV_MOLDURA_ESCAYOLA_EST||''',
'''||REPLACE(PRV_PARAMENTOS_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_PRV_INS);

  EXECUTE IMMEDIATE V_PRV_INS;
  
  NEW_PRV := NEW_PRV + 1;

ELSE

---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_PRV := '
SELECT COUNT(*) FROM (
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CAL.PRV_HUMEDAD_PARED,
CAL.PRV_HUMEDAD_TECHO,
CAL.PRV_GRIETA_PARED,
CAL.PRV_GRIETA_TECHO,
CAL.PRV_GOTELE,
CAL.PRV_PLASTICA_LISA,
CAL.PRV_PAPEL_PINTADO,
CAL.PRV_PINTURA_LISA_TECHO,
CAL.PRV_PINTURA_LISA_TECHO_EST,
CAL.PRV_MOLDURA_ESCAYOLA,
CAL.PRV_MOLDURA_ESCAYOLA_EST,
CAL.PRV_PARAMENTOS_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_PRV_PARAMENTO_VERTICAL PRV
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = PRV.ICO_ID 
AND  CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
PRV.PRV_HUMEDAD_PARED,
PRV.PRV_HUMEDAD_TECHO,
PRV.PRV_GRIETA_PARED,
PRV.PRV_GRIETA_TECHO,
PRV.PRV_GOTELE,
PRV.PRV_PLASTICA_LISA,
PRV.PRV_PAPEL_PINTADO,
PRV.PRV_PINTURA_LISA_TECHO,
PRV.PRV_PINTURA_LISA_TECHO_EST,
PRV.PRV_MOLDURA_ESCAYOLA,
PRV.PRV_MOLDURA_ESCAYOLA_EST,
PRV.PRV_PARAMENTOS_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_PRV_PARAMENTO_VERTICAL PRV
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = PRV.ICO_ID 
AND  CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_PRV INTO R_PRV;

  IF R_PRV > 0 THEN

---ACTUALIZAMOS ACT_PRV_PARAMENTO_VERTICAL - CALIDADES ACTIVO    
    
V_MSQL_PRV := 'UPDATE '||V_ESQUEMA||'.ACT_PRV_PARAMENTO_VERTICAL
  SET 
      PRV_HUMEDAD_PARED = '''||PRV_HUMEDAD_PARED||''',
      PRV_HUMEDAD_TECHO = '''||PRV_HUMEDAD_TECHO||''',
      PRV_GRIETA_PARED = '''||PRV_GRIETA_PARED||''',
      PRV_GRIETA_TECHO = '''||PRV_GRIETA_TECHO||''',
      PRV_GOTELE = '''||PRV_GOTELE||''',
      PRV_PLASTICA_LISA = '''||PRV_PLASTICA_LISA||''',
      PRV_PAPEL_PINTADO = '''||PRV_PAPEL_PINTADO||''',
      PRV_PINTURA_LISA_TECHO = '''||PRV_PINTURA_LISA_TECHO||''',
      PRV_PINTURA_LISA_TECHO_EST = '''||PRV_PINTURA_LISA_TECHO_EST||''',
      PRV_MOLDURA_ESCAYOLA = '''||PRV_MOLDURA_ESCAYOLA||''',
      PRV_MOLDURA_ESCAYOLA_EST = '''||PRV_MOLDURA_ESCAYOLA_EST||''',
      PRV_PARAMENTOS_OTROS = '''||REPLACE(PRV_PARAMENTOS_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';

--DBMS_OUTPUT.PUT_LINE(V_MSQL_PRV);

    EXECUTE IMMEDIATE V_MSQL_PRV;
    
    MODIF_PRV := MODIF_PRV + 1;
    
    END IF;

END IF;

IF SOL_ICO_ID IS NULL THEN

---- INSERTAMOS EN ACT_SOL_SOLADO - CALIDADES ACTIVO 

V_SOL_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_SOL_SOLADO (
SOL_ID,
ICO_ID,
SOL_TARIMA_FLOTANTE,
SOL_PARQUE,
SOL_MARMOL,
SOL_PLAQUETA,
SOL_SOLADO_OTROS,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_SOL_SOLADO.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
'''||SOL_TARIMA_FLOTANTE||''',
'''||SOL_PARQUE||''',
'''||SOL_MARMOL||''',
'''||SOL_PLAQUETA||''',
'''||REPLACE(SOL_SOLADO_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_SOL_INS);

  EXECUTE IMMEDIATE V_SOL_INS;
  
      NEW_SOL := NEW_SOL + 1;

ELSE


---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_SOL := '
SELECT COUNT (*) FROM (
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CAL.SOL_TARIMA_FLOTANTE,
CAL.SOL_PARQUE,
CAL.SOL_MARMOL,
CAL.SOL_PLAQUETA,
CAL.SOL_SOLADO_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_SOL_SOLADO SOL
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = SOL.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
SOL.SOL_TARIMA_FLOTANTE,
SOL.SOL_PARQUE,
SOL.SOL_MARMOL,
SOL.SOL_PLAQUETA,
SOL.SOL_SOLADO_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_SOL_SOLADO SOL
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = SOL.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_SOL INTO R_SOL;

  IF R_SOL > 0 THEN

 ---ACTUALIZAMOS ACT_SOL_SOLADO - CALIDADES ACTIVO    
    
V_MSQL_SOL := 'UPDATE '||V_ESQUEMA||'.ACT_SOL_SOLADO
  SET 
      SOL_TARIMA_FLOTANTE = '''||SOL_TARIMA_FLOTANTE||''',
      SOL_PARQUE = '''||SOL_PARQUE||''',
      SOL_MARMOL = '''||SOL_MARMOL||''',
      SOL_PLAQUETA = '''||SOL_PLAQUETA||''',
      SOL_SOLADO_OTROS = '''||REPLACE(SOL_SOLADO_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';


--DBMS_OUTPUT.PUT_LINE(V_MSQL_SOL);

    EXECUTE IMMEDIATE V_MSQL_SOL;
    
     MODIF_SOL := MODIF_SOL + 1;
     
     END IF;

END IF;

IF INF_ICO_ID IS NULL THEN

---- INSERTAMOS EN ACT_INF_INFRAESTRUCTURA - CALIDADES ACTIVO 

V_INF_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_INF_INFRAESTRUCTURA (
INF_ID,
ICO_ID,
INF_OCIO,
INF_HOTELES,
INF_HOTELES_DESC,
INF_TEATROS,
INF_TEATROS_DESC,
INF_SALAS_CINE,
INF_SALAS_CINE_DESC,
INF_INST_DEPORT,
INF_INST_DEPORT_DESC,
INF_CENTROS_COMERC,
INF_CENTROS_COMERC_DESC,
INF_OCIO_OTROS,
INF_CENTROS_EDU,
INF_ESCUELAS_INF,
INF_ESCUELAS_INF_DESC,
INF_COLEGIOS,
INF_COLEGIOS_DESC,
INF_INSTITUTOS,
INF_INSTITUTOS_DESC,
INF_UNIVERSIDADES,
INF_UNIVERSIDADES_DESC,
INF_CENTROS_EDU_OTROS,
INF_CENTROS_SANIT,
INF_CENTROS_SALUD,
INF_CENTROS_SALUD_DESC,
INF_CLINICAS,
INF_CLINICAS_DESC,
INF_HOSPITALES,
INF_HOSPITALES_DESC,
INF_CENTROS_SANIT_OTROS,
INF_PARKING_SUP_SUF,
INF_COMUNICACIONES,
INF_FACIL_ACCESO,
INF_FACIL_ACCESO_DESC,
INF_LINEAS_BUS,
INF_LINEAS_BUS_DESC,
INF_METRO,
INF_METRO_DESC,
INF_EST_TREN,
INF_EST_TREN_DESC,
INF_COMUNICACIONES_OTRO,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_INF_INFRAESTRUCTURA.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
'''||INF_OCIO||''',
'''||INF_HOTELES||''',
'''||REPLACE(INF_HOTELES_DESC,'''','''''')||''',
'''||INF_TEATROS||''',
'''||REPLACE(INF_TEATROS_DESC,'''','''''')||''',
'''||INF_SALAS_CINE||''',
'''||REPLACE(INF_SALAS_CINE_DESC,'''','''''')||''',
'''||INF_INST_DEPORT||''',
'''||REPLACE(INF_INST_DEPORT_DESC,'''','''''')||''',
'''||INF_CENTROS_COMERC||''',
'''||REPLACE(INF_CENTROS_COMERC_DESC,'''','''''')||''',
'''||REPLACE(INF_OCIO_OTROS,'''','''''')||''',
'''||INF_CENTROS_EDU||''',
'''||INF_ESCUELAS_INF||''',
'''||REPLACE(INF_ESCUELAS_INF_DESC,'''','''''')||''',
'''||INF_COLEGIOS||''',
'''||REPLACE(INF_COLEGIOS_DESC,'''','''''')||''',
'''||INF_INSTITUTOS||''',
'''||REPLACE(INF_INSTITUTOS_DESC,'''','''''')||''',
'''||INF_UNIVERSIDADES||''',
'''||REPLACE(INF_UNIVERSIDADES_DESC,'''','''''')||''',
'''||REPLACE(INF_CENTROS_EDU_OTROS,'''','''''')||''',
'''||INF_CENTROS_SANIT||''',
'''||INF_CENTROS_SALUD||''',
'''||REPLACE(INF_CENTROS_SALUD_DESC,'''','''''')||''',
'''||INF_CLINICAS||''',
'''||REPLACE(INF_CLINICAS_DESC,'''','''''')||''',
'''||INF_HOSPITALES||''',
'''||REPLACE(INF_HOSPITALES_DESC,'''','''''')||''',
'''||REPLACE(INF_CENTROS_SANIT_OTROS,'''','''''')||''',
'''||INF_PARKING_SUP_SUF||''',
'''||INF_COMUNICACIONES||''',
'''||INF_FACIL_ACCESO||''',
'''||REPLACE(INF_FACIL_ACCESO_DESC,'''','''''')||''',
'''||INF_LINEAS_BUS||''',
'''||REPLACE(INF_LINEAS_BUS_DESC,'''','''''')||''',
'''||INF_METRO||''',
'''||REPLACE(INF_METRO_DESC,'''','''''')||''',
'''||INF_EST_TREN||''',
'''||REPLACE(INF_EST_TREN_DESC,'''','''''')||''',
'''||REPLACE(INF_COMUNICACIONES_OTRO,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_INF_INS);

  EXECUTE IMMEDIATE V_INF_INS;
  
  NEW_INF := NEW_INF + 1;
 
 ELSE 
 
 ---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_INF := '
SELECT COUNT(*) FROM (
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CAL.INF_OCIO,
CAL.INF_HOTELES,
CAL.INF_HOTELES_DESC,
CAL.INF_TEATROS,
CAL.INF_TEATROS_DESC,
CAL.INF_SALAS_CINE,
CAL.INF_SALAS_CINE_DESC,
CAL.INF_INST_DEPORT,
CAL.INF_INST_DEPORT_DESC,
CAL.INF_CENTROS_COMERC,
CAL.INF_CENTROS_COMERC_DESC,
CAL.INF_OCIO_OTROS,
CAL.INF_CENTROS_EDU,
CAL.INF_ESCUELAS_INF,
CAL.INF_ESCUELAS_INF_DESC,
CAL.INF_COLEGIOS,
CAL.INF_COLEGIOS_DESC,
CAL.INF_INSTITUTOS,
CAL.INF_INSTITUTOS_DESC,
CAL.INF_UNIVERSIDADES,
CAL.INF_UNIVERSIDADES_DESC,
CAL.INF_CENTROS_EDU_OTROS,
CAL.INF_CENTROS_SANIT,
CAL.INF_CENTROS_SALUD,
CAL.INF_CENTROS_SALUD_DESC,
CAL.INF_CLINICAS,
CAL.INF_CLINICAS_DESC,
CAL.INF_HOSPITALES,
CAL.INF_HOSPITALES_DESC,
CAL.INF_CENTROS_SANIT_OTROS,
CAL.INF_PARKING_SUP_SUF,
CAL.INF_COMUNICACIONES,
CAL.INF_FACIL_ACCESO,
CAL.INF_FACIL_ACCESO_DESC,
CAL.INF_LINEAS_BUS,
CAL.INF_LINEAS_BUS_DESC,
CAL.INF_METRO,
CAL.INF_METRO_DESC,
CAL.INF_EST_TREN,
CAL.INF_EST_TREN_DESC,
CAL.INF_COMUNICACIONES_OTRO
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_INF_INFRAESTRUCTURA INF
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = INF.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
INF.INF_OCIO,
INF.INF_HOTELES,
INF.INF_HOTELES_DESC,
INF.INF_TEATROS,
INF.INF_TEATROS_DESC,
INF.INF_SALAS_CINE,
INF.INF_SALAS_CINE_DESC,
INF.INF_INST_DEPORT,
INF.INF_INST_DEPORT_DESC,
INF.INF_CENTROS_COMERC,
INF.INF_CENTROS_COMERC_DESC,
INF.INF_OCIO_OTROS,
INF.INF_CENTROS_EDU,
INF.INF_ESCUELAS_INF,
INF.INF_ESCUELAS_INF_DESC,
INF.INF_COLEGIOS,
INF.INF_COLEGIOS_DESC,
INF.INF_INSTITUTOS,
INF.INF_INSTITUTOS_DESC,
INF.INF_UNIVERSIDADES,
INF.INF_UNIVERSIDADES_DESC,
INF.INF_CENTROS_EDU_OTROS,
INF.INF_CENTROS_SANIT,
INF.INF_CENTROS_SALUD,
INF.INF_CENTROS_SALUD_DESC,
INF.INF_CLINICAS,
INF.INF_CLINICAS_DESC,
INF.INF_HOSPITALES,
INF.INF_HOSPITALES_DESC,
INF.INF_CENTROS_SANIT_OTROS,
INF.INF_PARKING_SUP_SUF,
INF.INF_COMUNICACIONES,
INF.INF_FACIL_ACCESO,
INF.INF_FACIL_ACCESO_DESC,
INF.INF_LINEAS_BUS,
INF.INF_LINEAS_BUS_DESC,
INF.INF_METRO,
INF.INF_METRO_DESC,
INF.INF_EST_TREN,
INF.INF_EST_TREN_DESC,
INF.INF_COMUNICACIONES_OTRO
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_INF_INFRAESTRUCTURA INF
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = INF.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_INF INTO R_INF;

  IF R_INF > 0 THEN
 
 ---ACTUALIZAMOS ACT_INF_INFRAESTRUCTURA - CALIDADES ACTIVO    
    
V_MSQL_INF := 'UPDATE '||V_ESQUEMA||'.ACT_INF_INFRAESTRUCTURA
  SET 
      INF_OCIO = '''||INF_OCIO||''',
      INF_HOTELES = '''||INF_HOTELES||''',
      INF_HOTELES_DESC = '''||REPLACE(INF_HOTELES_DESC,'''','''''')||''',
      INF_TEATROS = '''||INF_TEATROS||''',
      INF_TEATROS_DESC = '''||REPLACE(INF_TEATROS_DESC,'''','''''')||''',
      INF_SALAS_CINE = '''||INF_SALAS_CINE||''',
      INF_SALAS_CINE_DESC = '''||REPLACE(INF_SALAS_CINE_DESC,'''','''''')||''',
      INF_INST_DEPORT = '''||INF_INST_DEPORT||''',
      INF_INST_DEPORT_DESC = '''||REPLACE(INF_INST_DEPORT_DESC,'''','''''')||''',
      INF_CENTROS_COMERC = '''||INF_CENTROS_COMERC||''',
      INF_CENTROS_COMERC_DESC = '''||REPLACE(INF_CENTROS_COMERC_DESC,'''','''''')||''',
      INF_OCIO_OTROS = '''||REPLACE(INF_OCIO_OTROS,'''','''''')||''',
      INF_CENTROS_EDU = '''||INF_CENTROS_EDU||''',
      INF_ESCUELAS_INF = '''||INF_ESCUELAS_INF||''',
      INF_ESCUELAS_INF_DESC = '''||REPLACE(INF_ESCUELAS_INF_DESC,'''','''''')||''',
      INF_COLEGIOS = '''||INF_COLEGIOS||''',
      INF_COLEGIOS_DESC = '''||REPLACE(INF_COLEGIOS_DESC,'''','''''')||''',
      INF_INSTITUTOS = '''||INF_INSTITUTOS||''',
      INF_INSTITUTOS_DESC = '''||REPLACE(INF_INSTITUTOS_DESC,'''','''''')||''',
      INF_UNIVERSIDADES = '''||INF_UNIVERSIDADES||''',
      INF_UNIVERSIDADES_DESC = '''||REPLACE(INF_UNIVERSIDADES_DESC,'''','''''')||''',
      INF_CENTROS_EDU_OTROS = '''||REPLACE(INF_CENTROS_EDU_OTROS,'''','''''')||''',
      INF_CENTROS_SANIT = '''||INF_CENTROS_SANIT||''',
      INF_CENTROS_SALUD = '''||INF_CENTROS_SALUD||''',
      INF_CENTROS_SALUD_DESC = '''||REPLACE(INF_CENTROS_SALUD_DESC,'''','''''')||''',
      INF_CLINICAS = '''||INF_CLINICAS||''',
      INF_CLINICAS_DESC = '''||REPLACE(INF_CLINICAS_DESC,'''','''''')||''',
      INF_HOSPITALES = '''||INF_HOSPITALES||''',
      INF_HOSPITALES_DESC = '''||REPLACE(INF_HOSPITALES_DESC,'''','''''')||''',
      INF_CENTROS_SANIT_OTROS = '''||REPLACE(INF_CENTROS_SANIT_OTROS,'''','''''')||''',
      INF_PARKING_SUP_SUF = '''||INF_PARKING_SUP_SUF||''',
      INF_COMUNICACIONES = '''||INF_COMUNICACIONES||''',
      INF_FACIL_ACCESO = '''||INF_FACIL_ACCESO||''',
      INF_FACIL_ACCESO_DESC = '''||REPLACE(INF_FACIL_ACCESO_DESC,'''','''''')||''',
      INF_LINEAS_BUS = '''||INF_LINEAS_BUS||''',
      INF_LINEAS_BUS_DESC = '''||REPLACE(INF_LINEAS_BUS_DESC,'''','''''')||''',
      INF_METRO = '''||INF_METRO||''',
      INF_METRO_DESC = '''||REPLACE(INF_METRO_DESC,'''','''''')||''',
      INF_EST_TREN = '''||INF_EST_TREN||''',
      INF_EST_TREN_DESC = '''||REPLACE(INF_EST_TREN_DESC,'''','''''')||''',
      INF_COMUNICACIONES_OTRO  = '''||REPLACE(INF_COMUNICACIONES_OTRO,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';



--DBMS_OUTPUT.PUT_LINE(V_MSQL_INF);

    EXECUTE IMMEDIATE V_MSQL_INF;
    
    MODIF_INF := MODIF_INF + 1;
    
    END IF;

END IF;

IF ZCO_ICO_ID IS NULL THEN

 ---- INSERTAMOS EN ACT_ZCO_ZONA_COMUN - CALIDADES ACTIVO 

V_ZCO_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_ZCO_ZONA_COMUN (
ZCO_ID,
ICO_ID,
ZCO_ZONAS_COMUNES,
ZCO_JARDINES,
ZCO_PISCINA,
ZCO_INST_DEP,
ZCO_PADEL,
ZCO_TENIS,
ZCO_PISTA_POLIDEP,
ZCO_OTROS,
ZCO_ZONA_INFANTIL,
ZCO_CONSERJE_VIGILANCIA,
ZCO_GIMNASIO,
ZCO_ZONA_COMUN_OTROS,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_ZCO_ZONA_COMUN.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
'''||ZCO_ZONAS_COMUNES||''',
'''||ZCO_JARDINES||''',
'''||ZCO_PISCINA||''',
'''||ZCO_INST_DEP||''',
'''||ZCO_PADEL||''',
'''||ZCO_TENIS||''',
'''||ZCO_PISTA_POLIDEP||''',
'''||REPLACE(ZCO_OTROS,'''','''''')||''',
'''||ZCO_ZONA_INFANTIL||''',
'''||ZCO_CONSERJE_VIGILANCIA||''',
'''||ZCO_GIMNASIO||''',
'''||REPLACE(ZCO_ZONA_COMUN_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_ZCO_INS);

  EXECUTE IMMEDIATE V_ZCO_INS;
 
  NEW_ZCO := NEW_ZCO + 1;
 
 ELSE
 
 ---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_ZCO := '
SELECT COUNT(*) FROM (
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CAL.ZCO_ZONAS_COMUNES,
CAL.ZCO_JARDINES,
CAL.ZCO_PISCINA,
CAL.ZCO_INST_DEP,
CAL.ZCO_PADEL,
CAL.ZCO_TENIS,
CAL.ZCO_PISTA_POLIDEP,
CAL.ZCO_OTROS,
CAL.ZCO_ZONA_INFANTIL,
CAL.ZCO_CONSERJE_VIGILANCIA,
CAL.ZCO_GIMNASIO,
CAL.ZCO_ZONA_COMUN_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_ZCO_ZONA_COMUN ZCO
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = ZCO.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
ZCO.ZCO_ZONAS_COMUNES,
ZCO.ZCO_JARDINES,
ZCO.ZCO_PISCINA,
ZCO.ZCO_INST_DEP,
ZCO.ZCO_PADEL,
ZCO.ZCO_TENIS,
ZCO.ZCO_PISTA_POLIDEP,
ZCO.ZCO_OTROS,
ZCO.ZCO_ZONA_INFANTIL,
ZCO.ZCO_CONSERJE_VIGILANCIA,
ZCO.ZCO_GIMNASIO,
ZCO.ZCO_ZONA_COMUN_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_ZCO_ZONA_COMUN ZCO
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = ZCO.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_ZCO INTO R_ZCO;

  IF R_ZCO > 0 THEN
 
  ---ACTUALIZAMOS ACT_ZCO_ZONA_COMUN - CALIDADES ACTIVO    
    
V_MSQL_ZCO := 'UPDATE '||V_ESQUEMA||'.ACT_ZCO_ZONA_COMUN
  SET 
      ZCO_ZONAS_COMUNES = '''||ZCO_ZONAS_COMUNES||''',
      ZCO_JARDINES = '''||ZCO_JARDINES||''',
      ZCO_PISCINA = '''||ZCO_PISCINA||''',
      ZCO_INST_DEP = '''||ZCO_INST_DEP||''',
      ZCO_PADEL = '''||ZCO_PADEL||''',
      ZCO_TENIS = '''||ZCO_TENIS||''',
      ZCO_PISTA_POLIDEP = '''||ZCO_PISTA_POLIDEP||''',
      ZCO_OTROS = '''||REPLACE(ZCO_OTROS,'''','''''')||''',
      ZCO_ZONA_INFANTIL = '''||ZCO_ZONA_INFANTIL||''',
      ZCO_CONSERJE_VIGILANCIA = '''||ZCO_CONSERJE_VIGILANCIA||''',
      ZCO_GIMNASIO = '''||ZCO_GIMNASIO||''',
      ZCO_ZONA_COMUN_OTROS = '''||REPLACE(ZCO_ZONA_COMUN_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';


--DBMS_OUTPUT.PUT_LINE(V_MSQL_ZCO);

    EXECUTE IMMEDIATE V_MSQL_ZCO;
    
    MODIF_ZCO := MODIF_ZCO + 1;
    
    END IF;
 
 END IF;
 
 IF INS_ICO_ID IS NULL THEN
 
 ---- INSERTAMOS EN ACT_INS_INSTALACION - CALIDADES ACTIVO 

V_INS_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_INS_INSTALACION (
INS_ID,
ICO_ID,
INS_ELECTR,
INS_ELECTR_CON_CONTADOR,
INS_ELECTR_BUEN_ESTADO,
INS_ELECTR_DEFECTUOSA_ANTIGUA,
INS_AGUA,
INS_AGUA_CON_CONTADOR,
INS_AGUA_BUEN_ESTADO,
INS_AGUA_DEFECTUOSA_ANTIGUA,
INS_AGUA_CALIENTE_CENTRAL,
INS_AGUA_CALIENTE_GAS_NATURAL,
INS_GAS,
INS_GAS_CON_CONTADOR,
INS_GAS_INST_BUEN_ESTADO,
INS_GAS_DEFECTUOSA_ANTIGUA,
INS_CALEF,
INS_CALEF_CENTRAL,
INS_CALEF_GAS_NATURAL,
INS_CALEF_RADIADORES_ALU,
INS_CALEF_PREINSTALACION,
INS_AIRE,
INS_AIRE_PREINSTALACION,
INS_AIRE_INSTALACION,
INS_AIRE_FRIO_CALOR,
INS_INST_OTROS,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_INS_INSTALACION.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

'''||INS_ELECTR||''',
'''||INS_ELECTR_CON_CONTADOR||''',
'''||INS_ELECTR_BUEN_ESTADO||''',
'''||INS_ELECTR_DEFECTUOSA_ANTIGUA||''',
'''||INS_AGUA||''',
'''||INS_AGUA_CON_CONTADOR||''',
'''||INS_AGUA_BUEN_ESTADO||''',
'''||INS_AGUA_DEFECTUOSA_ANTIGUA||''',
'''||INS_AGUA_CALIENTE_CENTRAL||''',
'''||INS_AGUA_CALIENTE_GAS_NATURAL||''',
'''||INS_GAS||''',
'''||INS_GAS_CON_CONTADOR||''',
'''||INS_GAS_INST_BUEN_ESTADO||''',
'''||INS_GAS_DEFECTUOSA_ANTIGUA||''',
'''||INS_CALEF||''',
'''||INS_CALEF_CENTRAL||''',
'''||INS_CALEF_GAS_NATURAL||''',
'''||INS_CALEF_RADIADORES_ALU||''',
'''||INS_CALEF_PREINSTALACION||''',
'''||INS_AIRE||''',
'''||INS_AIRE_PREINSTALACION||''',
'''||INS_AIRE_INSTALACION||''',
'''||INS_AIRE_FRIO_CALOR||''',
'''||REPLACE(INS_INST_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_INS_INS);

  EXECUTE IMMEDIATE V_INS_INS;
  
  NEW_INS := NEW_INS + 1;
 
 ELSE
 
 ---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_INS := '
SELECT COUNT(*) FROM (
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CAL.INS_ELECTR,
CAL.INS_ELECTR_CON_CONTADOR,
CAL.INS_ELECTR_BUEN_ESTADO,
CAL.INS_ELECTR_DEFECTUOSA_ANTIGUA,
CAL.INS_AGUA,
CAL.INS_AGUA_CON_CONTADOR,
CAL.INS_AGUA_BUEN_ESTADO,
CAL.INS_AGUA_DEFECTUOSA_ANTIGUA,
CAL.INS_AGUA_CALIENTE_CENTRAL,
CAL.INS_AGUA_CALIENTE_GAS_NATURAL,
CAL.INS_GAS,
CAL.INS_GAS_CON_CONTADOR,
CAL.INS_GAS_INST_BUEN_ESTADO,
CAL.INS_GAS_DEFECTUOSA_ANTIGUA,
CAL.INS_CALEF,
CAL.INS_CALEF_CENTRAL,
CAL.INS_CALEF_GAS_NATURAL,
CAL.INS_CALEF_RADIADORES_ALU,
CAL.INS_CALEF_PREINSTALACION,
CAL.INS_AIRE,
CAL.INS_AIRE_PREINSTALACION,
CAL.INS_AIRE_INSTALACION,
CAL.INS_AIRE_FRIO_CALOR,
CAL.INS_INST_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_INS_INSTALACION INS
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = INS.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
INS.INS_ELECTR,
INS.INS_ELECTR_CON_CONTADOR,
INS.INS_ELECTR_BUEN_ESTADO,
INS.INS_ELECTR_DEFECTUOSA_ANTIGUA,
INS.INS_AGUA,
INS.INS_AGUA_CON_CONTADOR,
INS.INS_AGUA_BUEN_ESTADO,
INS.INS_AGUA_DEFECTUOSA_ANTIGUA,
INS.INS_AGUA_CALIENTE_CENTRAL,
INS.INS_AGUA_CALIENTE_GAS_NATURAL,
INS.INS_GAS,
INS.INS_GAS_CON_CONTADOR,
INS.INS_GAS_INST_BUEN_ESTADO,
INS.INS_GAS_DEFECTUOSA_ANTIGUA,
INS.INS_CALEF,
INS.INS_CALEF_CENTRAL,
INS.INS_CALEF_GAS_NATURAL,
INS.INS_CALEF_RADIADORES_ALU,
INS.INS_CALEF_PREINSTALACION,
INS.INS_AIRE,
INS.INS_AIRE_PREINSTALACION,
INS.INS_AIRE_INSTALACION,
INS.INS_AIRE_FRIO_CALOR,
INS.INS_INST_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_INS_INSTALACION INS
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = INS.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_INS INTO R_INS;

  IF R_INS > 0 THEN
 
  ---ACTUALIZAMOS  ACT_INS_INSTALACION  - CALIDADES ACTIVO    
    
V_MSQL_INS := 'UPDATE '||V_ESQUEMA||'.ACT_INS_INSTALACION
  SET 
      INS_ELECTR = '''||INS_ELECTR||''',
      INS_ELECTR_CON_CONTADOR = '''||INS_ELECTR_CON_CONTADOR||''',
      INS_ELECTR_BUEN_ESTADO = '''||INS_ELECTR_BUEN_ESTADO||''',
      INS_ELECTR_DEFECTUOSA_ANTIGUA = '''||INS_ELECTR_DEFECTUOSA_ANTIGUA||''',
      INS_AGUA = '''||INS_AGUA||''',
      INS_AGUA_CON_CONTADOR = '''||INS_AGUA_CON_CONTADOR||''',
      INS_AGUA_BUEN_ESTADO = '''||INS_AGUA_BUEN_ESTADO||''',
      INS_AGUA_DEFECTUOSA_ANTIGUA = '''||INS_AGUA_DEFECTUOSA_ANTIGUA||''',
      INS_AGUA_CALIENTE_CENTRAL = '''||INS_AGUA_CALIENTE_CENTRAL||''',
      INS_AGUA_CALIENTE_GAS_NATURAL = '''||INS_AGUA_CALIENTE_GAS_NATURAL||''',
      INS_GAS = '''||INS_GAS||''',
      INS_GAS_CON_CONTADOR = '''||INS_GAS_CON_CONTADOR||''',
      INS_GAS_INST_BUEN_ESTADO = '''||INS_GAS_INST_BUEN_ESTADO||''',
      INS_GAS_DEFECTUOSA_ANTIGUA = '''||INS_GAS_DEFECTUOSA_ANTIGUA||''',
      INS_CALEF = '''||INS_CALEF||''',
      INS_CALEF_CENTRAL = '''||INS_CALEF_CENTRAL||''',
      INS_CALEF_GAS_NATURAL = '''||INS_CALEF_GAS_NATURAL||''',
      INS_CALEF_RADIADORES_ALU = '''||INS_CALEF_RADIADORES_ALU||''',
      INS_CALEF_PREINSTALACION = '''||INS_CALEF_PREINSTALACION||''',
      INS_AIRE = '''||INS_AIRE||''',
      INS_AIRE_PREINSTALACION = '''||INS_AIRE_PREINSTALACION||''',
      INS_AIRE_INSTALACION = '''||INS_AIRE_INSTALACION||''',
      INS_AIRE_FRIO_CALOR = '''||INS_AIRE_FRIO_CALOR||''',
      INS_INST_OTROS = '''||REPLACE(INS_INST_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';


--DBMS_OUTPUT.PUT_LINE(V_MSQL_INS);

    EXECUTE IMMEDIATE V_MSQL_INS;
    
    MODIF_INS := MODIF_INS + 1;
    
    END IF;
    
END IF;

 IF BNY_ICO_ID IS NULL THEN
 
 ---- INSERTAMOS EN ACT_BNY_BANYO  - CALIDADES ACTIVO 

V_BNY_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_BNY_BANYO (
BNY_ID,
ICO_ID,
BNY_DUCHA_BANYERA,
BNY_DUCHA,
BNY_BANYERA,
BNY_BANYERA_HIDROMASAJE,
BNY_COLUMNA_HIDROMASAJE,
BNY_ALICATADO_MARMOL,
BNY_ALICATADO_GRANITO,
BNY_ALICATADO_AZULEJO,
BNY_ENCIMERA,
BNY_MARMOL,
BNY_GRANITO,
BNY_OTRO_MATERIAL,
BNY_SANITARIOS,
BNY_SANITARIOS_EST,
BNY_SUELOS,
BNY_GRIFO_MONOMANDO,
BNY_GRIFO_MONOMANDO_EST,
BNY_BANYO_OTROS,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_BNY_BANYO.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

'''||BNY_DUCHA_BANYERA||''',
'''||BNY_DUCHA||''',
'''||BNY_BANYERA||''',
'''||BNY_BANYERA_HIDROMASAJE||''',
'''||BNY_COLUMNA_HIDROMASAJE||''',
'''||BNY_ALICATADO_MARMOL||''',
'''||BNY_ALICATADO_GRANITO||''',
'''||BNY_ALICATADO_AZULEJO||''',
'''||BNY_ENCIMERA||''',
'''||BNY_MARMOL||''',
'''||BNY_GRANITO||''',
'''||BNY_OTRO_MATERIAL||''',
'''||BNY_SANITARIOS||''',
'''||BNY_SANITARIOS_EST||''',
'''||BNY_SUELOS||''',
'''||BNY_GRIFO_MONOMANDO||''',
'''||BNY_GRIFO_MONOMANDO_EST||''',
'''||REPLACE(BNY_BANYO_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

--DBMS_OUTPUT.PUT_LINE(V_BNY_INS);

   EXECUTE IMMEDIATE V_BNY_INS;

NEW_BNY := NEW_BNY + 1;
  
  ELSE
  
  ---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_BNY := '
SELECT COUNT(*) FROM (
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CAL.BNY_DUCHA_BANYERA,
CAL.BNY_DUCHA,
CAL.BNY_BANYERA,
CAL.BNY_BANYERA_HIDROMASAJE,
CAL.BNY_COLUMNA_HIDROMASAJE,
CAL.BNY_ALICATADO_MARMOL,
CAL.BNY_ALICATADO_GRANITO,
CAL.BNY_ALICATADO_AZULEJO,
CAL.BNY_ENCIMERA,
CAL.BNY_MARMOL,
CAL.BNY_GRANITO,
CAL.BNY_OTRO_MATERIAL,
CAL.BNY_SANITARIOS,
CAL.BNY_SANITARIOS_EST,
CAL.BNY_SUELOS,
CAL.BNY_GRIFO_MONOMANDO,
CAL.BNY_GRIFO_MONOMANDO_EST,
CAL.BNY_BANYO_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_BNY_BANYO BNY
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = BNY.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
BNY.BNY_DUCHA_BANYERA,
BNY.BNY_DUCHA,
BNY.BNY_BANYERA,
BNY.BNY_BANYERA_HIDROMASAJE,
BNY.BNY_COLUMNA_HIDROMASAJE,
BNY.BNY_ALICATADO_MARMOL,
BNY.BNY_ALICATADO_GRANITO,
BNY.BNY_ALICATADO_AZULEJO,
BNY.BNY_ENCIMERA,
BNY.BNY_MARMOL,
BNY.BNY_GRANITO,
BNY.BNY_OTRO_MATERIAL,
BNY.BNY_SANITARIOS,
BNY.BNY_SANITARIOS_EST,
BNY.BNY_SUELOS,
BNY.BNY_GRIFO_MONOMANDO,
BNY.BNY_GRIFO_MONOMANDO_EST,
BNY.BNY_BANYO_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_BNY_BANYO BNY
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = BNY.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_BNY INTO R_BNY;

  IF R_BNY > 0 THEN
  
   ---ACTUALIZAMOS ACT_BNY_BANYO   - CALIDADES ACTIVO    
    
V_MSQL_BNY := 'UPDATE '||V_ESQUEMA||'.ACT_BNY_BANYO
  SET 
      BNY_DUCHA_BANYERA = '''||BNY_DUCHA_BANYERA||''',
      BNY_DUCHA = '''||BNY_DUCHA||''',
      BNY_BANYERA = '''||BNY_BANYERA||''',
      BNY_BANYERA_HIDROMASAJE = '''||BNY_BANYERA_HIDROMASAJE||''',
      BNY_COLUMNA_HIDROMASAJE = '''||BNY_COLUMNA_HIDROMASAJE||''',
      BNY_ALICATADO_MARMOL = '''||BNY_ALICATADO_MARMOL||''',
      BNY_ALICATADO_GRANITO = '''||BNY_ALICATADO_GRANITO||''',
      BNY_ALICATADO_AZULEJO = '''||BNY_ALICATADO_AZULEJO||''',
      BNY_ENCIMERA = '''||BNY_ENCIMERA||''',
      BNY_MARMOL = '''||BNY_MARMOL||''',
      BNY_GRANITO = '''||BNY_GRANITO||''',
      BNY_OTRO_MATERIAL = '''||BNY_OTRO_MATERIAL||''',
      BNY_SANITARIOS = '''||BNY_SANITARIOS||''',
      BNY_SANITARIOS_EST = '''||BNY_SANITARIOS_EST||''',
      BNY_SUELOS = '''||BNY_SUELOS||''',
      BNY_GRIFO_MONOMANDO = '''||BNY_GRIFO_MONOMANDO||''',
      BNY_GRIFO_MONOMANDO_EST = '''||BNY_GRIFO_MONOMANDO_EST||''',
      BNY_BANYO_OTROS = '''||REPLACE(BNY_BANYO_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';

--DBMS_OUTPUT.PUT_LINE(V_MSQL_BNY);

    EXECUTE IMMEDIATE V_MSQL_BNY;
    
    MODIF_BNY := MODIF_BNY + 1;
    
    END IF;
  
  END IF;

 IF COC_ICO_ID IS NULL THEN

---- INSERTAMOS EN ACT_COC_COCINA   - CALIDADES ACTIVO 

V_COC_INS := 'INSERT INTO '||V_ESQUEMA||'.ACT_COC_COCINA (
COC_ID,
ICO_ID,
COC_AMUEBLADA,
COC_AMUEBLADA_EST,
COC_ENCIMERA,
COC_ENCI_GRANITO,
COC_ENCI_MARMOL,
COC_ENCI_OTRO_MATERIAL,
COC_VITRO,
COC_LAVADORA,
COC_FRIGORIFICO,
COC_LAVAVAJILLAS,
COC_MICROONDAS,
COC_HORNO,
COC_SUELOS,
COC_AZULEJOS,
COC_AZULEJOS_EST,
COC_GRIFOS_MONOMANDO,
COC_GRIFOS_MONOMANDO_EST,
COC_COCINA_OTROS,
USUARIOCREAR, 
 FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_COC_COCINA.NEXTVAL,

(SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
'''||COC_AMUEBLADA||''',
'''||COC_AMUEBLADA_EST||''',
'''||COC_ENCIMERA||''',
'''||COC_ENCI_GRANITO||''',
'''||COC_ENCI_MARMOL||''',
'''||COC_ENCI_OTRO_MATERIAL||''',
'''||COC_VITRO||''',
'''||COC_LAVADORA||''',
'''||COC_FRIGORIFICO||''',
'''||COC_LAVAVAJILLAS||''',
'''||COC_MICROONDAS||''',
'''||COC_HORNO||''',
'''||COC_SUELOS||''',
'''||COC_AZULEJOS||''',
'''||COC_AZULEJOS_EST||''',
'''||COC_GRIFOS_MONOMANDO||''',
'''||COC_GRIFOS_MONOMANDO_EST||''',
'''||REPLACE(COC_COCINA_OTROS,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';
   
   --DBMS_OUTPUT.PUT_LINE(V_COC_INS);
   
   EXECUTE IMMEDIATE V_COC_INS;
   
       NEW_COC := NEW_COC + 1;

ELSE

---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_COC := '
SELECT COUNT(*) FROM (
SELECT 
CAL.ACT_NUMERO_ACTIVO,
CAL.COC_AMUEBLADA,
CAL.COC_AMUEBLADA_EST,
CAL.COC_ENCIMERA,
CAL.COC_ENCI_GRANITO,
CAL.COC_ENCI_MARMOL,
CAL.COC_ENCI_OTRO_MATERIAL,
CAL.COC_VITRO,
CAL.COC_LAVADORA,
CAL.COC_FRIGORIFICO,
CAL.COC_LAVAVAJILLAS,
CAL.COC_MICROONDAS,
CAL.COC_HORNO,
CAL.COC_SUELOS,
CAL.COC_AZULEJOS,
CAL.COC_AZULEJOS_EST,
CAL.COC_GRIFOS_MONOMANDO,
CAL.COC_GRIFOS_MONOMANDO_EST,
CAL.COC_COCINA_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_COC_COCINA COC
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = COC.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
MINUS
SELECT 
CAL.ACT_NUMERO_ACTIVO,
COC.COC_AMUEBLADA,
COC.COC_AMUEBLADA_EST,
COC.COC_ENCIMERA,
COC.COC_ENCI_GRANITO,
COC.COC_ENCI_MARMOL,
COC.COC_ENCI_OTRO_MATERIAL,
COC.COC_VITRO,
COC.COC_LAVADORA,
COC.COC_FRIGORIFICO,
COC.COC_LAVAVAJILLAS,
COC.COC_MICROONDAS,
COC.COC_HORNO,
COC.COC_SUELOS,
COC.COC_AZULEJOS,
COC.COC_AZULEJOS_EST,
COC.COC_GRIFOS_MONOMANDO,
COC.COC_GRIFOS_MONOMANDO_EST,
COC.COC_COCINA_OTROS
  FROM    
   '||V_ESQUEMA||'.APR_AUX_CALIDADES_ACTIVOS CAL,
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_COC_COCINA COC
WHERE 
CAL.ACT_NUMERO_ACTIVO = DAT.ACT_NUMERO_ACTIVO
AND DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = COC.ICO_ID 
AND CAL.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
)
  '
  ;
  
  EXECUTE IMMEDIATE REG_COC INTO R_COC;

  IF R_COC > 0 THEN

 ---ACTUALIZAMOS ACT_COC_COCINA   - CALIDADES ACTIVO    
    
V_MSQL_COC := 'UPDATE '||V_ESQUEMA||'.ACT_COC_COCINA
  SET 
      COC_AMUEBLADA = '''||COC_AMUEBLADA||''',
      COC_AMUEBLADA_EST = '''||COC_AMUEBLADA_EST||''',
      COC_ENCIMERA = '''||COC_ENCIMERA||''',
      COC_ENCI_GRANITO = '''||COC_ENCI_GRANITO||''',
      COC_ENCI_MARMOL = '''||COC_ENCI_MARMOL||''',
      COC_ENCI_OTRO_MATERIAL = '''||COC_ENCI_OTRO_MATERIAL||''',
      COC_VITRO = '''||COC_VITRO||''',
      COC_LAVADORA = '''||COC_LAVADORA||''',
      COC_FRIGORIFICO = '''||COC_FRIGORIFICO||''',
      COC_LAVAVAJILLAS = '''||COC_LAVAVAJILLAS||''',
      COC_MICROONDAS = '''||COC_MICROONDAS||''',
      COC_HORNO = '''||COC_HORNO||''',
      COC_SUELOS = '''||COC_SUELOS||''',
      COC_AZULEJOS = '''||COC_AZULEJOS||''',
      COC_AZULEJOS_EST = '''||COC_AZULEJOS_EST||''',
      COC_GRIFOS_MONOMANDO = '''||COC_GRIFOS_MONOMANDO||''',
      COC_GRIFOS_MONOMANDO_EST = '''||COC_GRIFOS_MONOMANDO_EST||''',
      COC_COCINA_OTROS = '''||REPLACE(COC_COCINA_OTROS,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR =  SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';


   --DBMS_OUTPUT.PUT_LINE(V_MSQL_COC);

    EXECUTE IMMEDIATE V_MSQL_COC;
    
        MODIF_COC := MODIF_COC + 1;
        
        END IF;
    
 END IF;

END IF; -- IF FINAL DE CALIDADES ACTIVO



-------------------------------------------------FIN CALIDADES ACTIVOS---------------------------------------------


FETCH SEQ_TAB INTO
    ACT_ID,
    BIE_LOC_ID,
    ACT_NUMERO_ACTIVO,
    ACT_NUMERO_UVEM,
    ACT_NUMERO_PRINEX,
    ESTADO_ADMISION,
    DD_TVI_ID,
    LOC_NOMBRE_VIA,
    LOC_NUMERO_DOMICILIO,
    LOC_ESCALERA,
    LOC_PISO,
    LOC_PUERTA,
    LOC_COD_POST,
    BIE_LOC_NOMBRE_VIA,
    BIE_LOC_NUMERO_DOMICILIO,
    BIE_LOC_ESCALERA,
    BIE_LOC_PISO,
    BIE_LOC_PUERTA,
    BIE_LOC_COD_POST,
    DD_UPO_ID,
    DD_LOC_ID,
    DD_PRV_ID,
    DD_CIC_ID,
    ICO_ACTIVOS_VINC,
    ICO_FECHA_EMISION_INFORME,
    ICO_FECHA_ULTIMA_VISITA,
    ICO_FECHA_ACEPTACION,
    ICO_FECHA_RECHAZO,
    ACT_ID_INFO,
    ICO_CONDICIONES_LEGALES,
    ICO_ID,
    EDI_ANO_REHABILITACION,
    EDI_NUM_PLANTAS,
    EDI_ASCENSOR,
    EDI_NUM_ASCENSORES,
    EDI_REFORMA_FACHADA,
    EDI_REFORMA_ESCALERA,
    EDI_REFORMA_PORTAL,
    EDI_REFORMA_ASCENSOR,
    EDI_REFORMA_CUBIERTA,
    EDI_REFORMA_OTRA_ZONA,
    EDI_REFORMA_OTRO,
    EDI_REFORMA_OTRO_ZONA_COM_DES,
    EDI_REFORMA_OTRO_DESC,
    EDI_DESCRIPCION,
    EDI_ENTORNO_INFRAESTRUCTURA,
    EDI_ENTORNO_COMUNICACION,
    VIV_ULTIMA_PLANTA,
    VIV_NUM_PLANTAS_INTERIOR,
    VIV_REFORMA_CARP_INT,
    VIV_REFORMA_CARP_EXT,
    VIV_REFORMA_COCINA,
    VIV_REFORMA_BANYO,
    VIV_REFORMA_SUELO,
    VIV_REFORMA_PINTURA,
    VIV_REFORMA_INTEGRAL,
    VIV_REFORMA_OTRO,
    VIV_REFORMA_OTRO_DESC,
    VIV_REFORMA_PRESUPUESTO,
    VIV_DISTRIBUCION_TXT,
    LCO_MTS_FACHADA_PPAL,
    LCO_MTS_FACHADA_LAT,
    LCO_MTS_LUZ_LIBRE,
    LCO_MTS_ALTURA_LIBRE,
    LCO_MTS_LINEALES_PROF,
    LCO_DIAFANO,
    LCO_USO_IDONEO,
    LCO_USO_ANTERIOR,
    LCO_OBSERVACIONES,
    APR_DESTINO_COCHE,
    APR_DESTINO_MOTO,
    APR_DESTINO_DOBLE,
    APR_ANCHURA,
    APR_PROFUNDIDAD,
    APR_FORMA_IRREGULAR
;
    END LOOP;
    CLOSE SEQ_TAB;
    
    -------------------------------------       #########    INFOCOMERCIAL-DISTRIBUCIÓN   ######### --------------------------------------------
    ----------- ABRIMOS EL CURSOR CON INFOCOMERCIAL DISTRIBUCION PARA HACER LOS UPDATE E INSERT-------------------

    
    OPEN C_INFO_DIST;
    FETCH C_INFO_DIST INTO 
    ICO_ACT_DIST,
    ICO_ID_DIST,
    DIS_NUM_PLANTA,
    DD_TPH_ID,
    DIS_CANTIDAD,
    DIS_SUPERFICIE,
    DIS_ID
    ;
    WHILE C_INFO_DIST%found
    LOOP
    
    

  
  IF ICO_ACT_DIST IS NULL THEN
  
 
 
 
  ---------- VALIDAMOS ANTES DE INSERTAR QUE EL ICO_ID EXISTE EN ACT_VIV_VIVIENDA
    
    V_VALIDA_VIV := '
  SELECT COUNT(*) FROM 
'||V_ESQUEMA||'.ACT_VIV_VIVIENDA VIV
WHERE 
VIV.ICO_ID = '||ICO_ID_DIST||'
  '
  ;
  

  
  EXECUTE IMMEDIATE V_VALIDA_VIV INTO V_VIV;

  IF V_VIV > 0 THEN
  
  

  
  V_MSQL_DIST_I := 'INSERT INTO '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION (
DIS_ID,
ICO_ID,
DIS_NUM_PLANTA,
DD_TPH_ID,
DIS_CANTIDAD,
DIS_SUPERFICIE,
USUARIOCREAR,
FECHACREAR
 )
  VALUES (
  
  '||V_ESQUEMA||'.S_ACT_DIS_DISTRIBUCION.NEXTVAL,
  '||ICO_ID_DIST||',
  '||DIS_NUM_PLANTA||',
  '||DD_TPH_ID||',
  '||DIS_CANTIDAD||',
  '||DIS_SUPERFICIE||',
   ''ACT_UVEM'',
   SYSDATE
   )';

EXECUTE IMMEDIATE V_MSQL_DIST_I;
 
--DBMS_OUTPUT.PUT_LINE(V_MSQL_DIST_I);
 
  NUEVOS_DIST := NUEVOS_DIST + 1;
  END IF;
  
  ELSE 
  
  
  ---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_DIST := '
SELECT COUNT(*) FROM (
SELECT 
DIS.DIS_ID,
DIST.DIS_NUM_PLANTA,
TPH.DD_TPH_ID,
DIST.DIS_CANTIDAD,
DIST.DIS_SUPERFICIE
FROM 
'||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION  DIS,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.APR_AUX_INFOCOMERCIAL_DIST DIST,
'||V_ESQUEMA||'.DD_TPH_TIPO_HABITACULO TPH
WHERE 
DIS.ICO_ID = ICO.ICO_ID
AND ACT.ACT_ID = ICO.ACT_ID
AND ACT.ACT_NUM_ACTIVO = DIST.ACT_NUMERO_ACTIVO
AND DIST.TIPO_HABITACULO = TPH.DD_TPH_CODIGO
AND DIST.DIS_NUM_PLANTA = DIS.DIS_NUM_PLANTA
AND DIS.DD_TPH_ID = TPH.DD_TPH_ID
AND DIS_ID = '||DIS_ID||'
MINUS
SELECT 
DIS.DIS_ID,
DIS.DIS_NUM_PLANTA,
DIS.DD_TPH_ID,
DIS.DIS_CANTIDAD,
DIS.DIS_SUPERFICIE
FROM 
'||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION  DIS,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.APR_AUX_INFOCOMERCIAL_DIST DIST,
'||V_ESQUEMA||'.DD_TPH_TIPO_HABITACULO TPH
WHERE 
DIS.ICO_ID = ICO.ICO_ID
AND ACT.ACT_ID = ICO.ACT_ID
AND ACT.ACT_NUM_ACTIVO = DIST.ACT_NUMERO_ACTIVO
AND DIST.TIPO_HABITACULO = TPH.DD_TPH_CODIGO
AND DIST.DIS_NUM_PLANTA = DIS.DIS_NUM_PLANTA
AND DIS.DD_TPH_ID = TPH.DD_TPH_ID
AND DIS_ID = '||DIS_ID||'
)
  '
  ;
  
  --DBMS_OUTPUT.PUT_LINE(REG_DIST);
  
  EXECUTE IMMEDIATE REG_DIST INTO R_DIST;

  IF R_DIST > 0 THEN
  
  
  V_MSQL_DIST := 'UPDATE '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION
  SET 
      DIS_NUM_PLANTA = '''||DIS_NUM_PLANTA||''',
      DD_TPH_ID = '''||DD_TPH_ID||''',
      DIS_CANTIDAD = '''||DIS_CANTIDAD||''',
      DIS_SUPERFICIE = '''||DIS_SUPERFICIE||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
      WHERE DIS_ID = '||DIS_ID||'
      ';

--DBMS_OUTPUT.PUT_LINE(V_MSQL_DIST);

EXECUTE IMMEDIATE V_MSQL_DIST;

  
     UPDATE_DIST :=  UPDATE_DIST + 1;
     
     END IF;
  
  END IF;
  
 
 

 
 FETCH C_INFO_DIST INTO
    ICO_ACT_DIST,
    ICO_ID_DIST,
    DIS_NUM_PLANTA,
    DD_TPH_ID,
    DIS_CANTIDAD,
    DIS_SUPERFICIE,
    DIS_ID
    ;
    END LOOP;
    CLOSE C_INFO_DIST;
    

--COMMIT;


  
  
  
  
  DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_ACTIVO  : '||UPDATE_ACTIVOS||'');
  
  P_ACT_ACTIVO := 'REGISTROS ACTUALIZADOS EN ACT_ACTIVO  : '||UPDATE_ACTIVOS||'';
  
--DBMS_OUTPUT.PUT_LINE('ACTUALIZADOS EN BIE_LOCALIZACION QUE ESTABAN EN NULL :  '||UPDATE_DATOS_NULL||'');

  TOTAL_BIE_LOCALI := UPDATES_COUNT_ADM + UPDATE_DATOS_NULL;

DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION  : '||TOTAL_BIE_LOCALI||'');

  P_BIE_LOCALIZACION := 'REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION  : '||TOTAL_BIE_LOCALI||'';

          DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_ICO_INFO_COMERCIAL : '||UPDATES_INFO||'');
          
           P_INFOCOMERCIAL_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_ICO_INFO_COMERCIAL : '||UPDATES_INFO||'';
       
        DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_ICO_INFO_COMERCIAL  : '||NUEVOS_COUNT||'');
        
               P_INFOCOMERCIAL_NEW := 'REGISTROS INSERTADOS EN ACT_ICO_INFO_COMERCIAL  : '||NUEVOS_COUNT||'';
              
        
        DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_EDI_EDIFICIO : '||UPDATES_EDIFICIO||'');
        
          P_EDIFICIO_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_EDI_EDIFICIO : '||UPDATES_EDIFICIO||'';
       
        DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_EDI_EDIFICIO  : '||NUEVOS_COUNT||'');
        
           P_EDIFICIO_NEW := 'REGISTROS INSERTADOS EN ACT_EDI_EDIFICIO  : '||NUEVOS_COUNT||'';
        
         DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_VIV_VIVIENDA  : '||UPDATE_VIVIENDAS||'');
         
                  P_VIVIENDA_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_VIV_VIVIENDA  : '||UPDATE_VIVIENDAS||'';
         
          DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_VIV_VIVIENDA  : '||NUEVOS_VIVIENDAS||'');
          
            P_VIVIENDA_NEW := 'REGISTROS INSERTADOS EN ACT_VIV_VIVIENDA  : '||NUEVOS_VIVIENDAS||'';
          
             DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||UPDATE_LOCAL||'');
             
                  P_LOCAL_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||UPDATE_LOCAL||'';
             
             DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||NUEVOS_LOCAL||'');
             
               P_LOCAL_NEW := 'REGISTROS INSERTADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||NUEVOS_LOCAL||'';
             
               DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_APR_PLAZA_APARCAMIENTO  : '||UPDATE_APARCAMIENTO||'');
               
                     P_APARCA_MODIFI := 'REGISTROS ACTUALIZADOS EN ACT_APR_PLAZA_APARCAMIENTO  : '||UPDATE_APARCAMIENTO||'';
               
               DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_APR_PLAZA_APARCAMIENTO : '||NUEVOS_APARCAMIENTO||'');
               
                P_APARCA_NEW := 'REGISTROS INSERTADOS EN ACT_APR_PLAZA_APARCAMIENTO : '||NUEVOS_APARCAMIENTO||'';


            DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_CRI_CARPINTERIA_INT : '||NEW_CRI||'');
            
            P_CRI_NEW := 'REGISTROS INSERTADOS EN ACT_CRI_CARPINTERIA_INT : '||NEW_CRI||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN  ACT_CRI_CARPINTERIA_INT : '||MODIF_CRI||'');
              
              P_CRI_MODIF := 'REGISTROS ACTUALIZADOS EN  ACT_CRI_CARPINTERIA_INT : '||MODIF_CRI||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_CRE_CARPINTERIA_EXT : '||NEW_CRE||'');
              
              P_CRE_NEW := 'REGISTROS INSERTADOS EN ACT_CRE_CARPINTERIA_EXT : '||NEW_CRE||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_CRE_CARPINTERIA_EXT  : '||MODIF_CRE||'');
              
              P_CRE_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_CRE_CARPINTERIA_EXT  : '||MODIF_CRE||'';
              
              DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_PRV_PARAMENTO_VERTICAL : '||NEW_PRV||'');
              
              P_PRV_NEW := 'REGISTROS INSERTADOS EN ACT_PRV_PARAMENTO_VERTICAL : '||NEW_PRV||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_PRV_PARAMENTO_VERTICAL  : '||MODIF_PRV||'');
              
              P_PRV_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_PRV_PARAMENTO_VERTICAL  : '||MODIF_PRV||'';
              
             DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_SOL_SOLADO : '||NEW_SOL||'');
             
             P_SOL_NEW := 'REGISTROS INSERTADOS EN ACT_SOL_SOLADO : '||NEW_SOL||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_SOL_SOLADO  : '||MODIF_SOL||'');
              
              P_SOL_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_SOL_SOLADO  : '||MODIF_SOL||'';
                            
             DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_INF_INFRAESTRUCTURA : '||NEW_INF||'');
             
             P_INF_NEW := 'REGISTROS INSERTADOS EN ACT_INF_INFRAESTRUCTURA : '||NEW_INF||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN  ACT_INF_INFRAESTRUCTURA : '||MODIF_INF||'');
              
              P_INF_MODIF := 'REGISTROS ACTUALIZADOS EN  ACT_INF_INFRAESTRUCTURA : '||MODIF_INF||'';

            DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_ZCO_ZONA_COMUN : '||NEW_ZCO||'');
            
            P_ZCO_NEW := 'REGISTROS INSERTADOS EN ACT_ZCO_ZONA_COMUN : '||NEW_ZCO||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_ZCO_ZONA_COMUN  : '||MODIF_ZCO||'');

          P_ZCO_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_ZCO_ZONA_COMUN  : '||MODIF_ZCO||'';

         DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_INS_INSTALACION : '||NEW_INS||'');
         
         P_INS_NEW := 'REGISTROS INSERTADOS EN ACT_INS_INSTALACION : '||NEW_INS||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_INS_INSTALACION  : '||MODIF_INS||'');
              
              P_INS_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_INS_INSTALACION  : '||MODIF_INS||'';
              
               DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_BNY_BANYO : '||NEW_BNY||'');
               
               P_BNY_NEW := 'REGISTROS INSERTADOS EN ACT_BNY_BANYO : '||NEW_BNY||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_BNY_BANYO  : '||MODIF_BNY||'');
              
              P_BNY_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_BNY_BANYO  : '||MODIF_BNY||'';
              
              DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_COC_COCINA : '||NEW_COC||'');
              
              P_COC_NEW := 'REGISTROS INSERTADOS EN ACT_COC_COCINA : '||NEW_COC||'';

              DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_COC_COCINA  : '||MODIF_COC||'');    
              
              P_COC_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_COC_COCINA  : '||MODIF_COC||'';
              
               DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN  ACT_DIS_DISTRIBUCION : '||UPDATE_DIST||'');
               
                P_DIST_MODIF := 'REGISTROS ACTUALIZADOS EN  ACT_DIS_DISTRIBUCION : '||UPDATE_DIST||'';
               
                DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_DIS_DISTRIBUCION : '||NUEVOS_DIST||'');
                
                 P_DIST_NEW := 'REGISTROS INSERTADOS EN ACT_DIS_DISTRIBUCION : '||NUEVOS_DIST||'';
              
              
      


 


 EXCEPTION

 WHEN OTHERS THEN
   err_num := SQLCODE;
   err_msg := SQLERRM;

   DBMS_OUTPUT.put_line('Error:'||TO_CHAR(err_num));
   DBMS_OUTPUT.put_line(err_msg);
   P_TEXTO := 'Error:'||TO_CHAR(err_num)||'['||err_msg||']'; 

   ROLLBACK;
 


   RAISE;
END SP_UPDATE_ACTIVOS_UVEM_REM;

/
