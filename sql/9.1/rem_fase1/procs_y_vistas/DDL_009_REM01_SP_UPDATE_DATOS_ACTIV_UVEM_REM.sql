--/*
--##########################################
--## AUTOR=JAVIER DIAZ
--## FECHA_CREACION=20160627
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.1
--## INCIDENCIA_LINK=0
--## PRODUCTO=NO
--## Finalidad: Procedimiento que actualiza información de los activos a partir de un fichero proveniente de UVEM- 
--##			tabla APR_AUX_DATOS_ACTIVO, con datos procedentes de UVEM. DATOS-ACTIVOS
--##           
--## INSTRUCCIONES: Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;

create or replace PROCEDURE SP_UPDATE_DATOS_ACTIV_UVEM_REM (P_TEXTO OUT VARCHAR2,
P_ACT_ACTIVO OUT VARCHAR2,
P_BIE_LOCALIZACION OUT VARCHAR2,
P_INFOCOMERCIAL_NEW OUT VARCHAR2,
P_INFOCOMERCIAL_MODIF OUT VARCHAR2,
P_EDIFICIO_NEW OUT VARCHAR2,
P_EDIFICIO_MODIF OUT VARCHAR2,
P_VIVIENDA_NEW OUT VARCHAR2,
P_VIVIENDA_MODIF OUT VARCHAR2,
P_LOCAL_NEW OUT VARCHAR2,
P_LOCAL_MODIF OUT VARCHAR2,
P_APARCA_NEW OUT VARCHAR2,
P_APARCA_MODIFI OUT VARCHAR2

) AS
--V0.1 Versión  hito : 1.0.8-rem


V_ESQUEMA VARCHAR2(15 CHAR) := '#ESQUEMA#';
V_ESQUEMA_MASTER VARCHAR2(15 CHAR) := '#ESQUEMA_MASTER#';
  V_TABLA_AUX VARCHAR2(40 CHAR) := 'APR_AUX_DATOS_ACTIVO';
 V_TABLA VARCHAR2(40 CHAR) := 'APR_AUX_DATOS_ACTIVO';
 V_TABLA_VIV VARCHAR2(40 CHAR) := 'ACT_VIV_VIVIENDA';
 V_TABLA_INFO VARCHAR2(40 CHAR) := 'ACT_ICO_INFO_COMERCIAL';
 V_TABLA_LOCAL  VARCHAR2(40 CHAR) := 'ACT_LCO_LOCAL_COMERCIAL';
 V_TABLA_APARC VARCHAR2(40 CHAR) := 'ACT_APR_PLAZA_APARCAMIENTO';

 err_num NUMBER;
 err_msg VARCHAR2(2048);

 TABLE_COUNT NUMBER(10,0) := 0;
  TABLE_COUNT2 NUMBER(10,0) := 0;
 TABLE_COUNT3 NUMBER(10,0) := 0;

 TABLE_VIVIENDA NUMBER(10,0) := 0;
  TABLE_LOCAL NUMBER(10,0) := 0;
  TABLE_APARCA NUMBER(10,0) := 0;

 NUEVOS_COUNT NUMBER(10,0) := 0;
 UPDATES_COUNT NUMBER(10,0) := 0;
  UPDATES_COUNT_ADM NUMBER(10,0) := 0;

   UPDATE_VIVIENDAS NUMBER(10,0) := 0;
   UPDATE_LOCAL  NUMBER(10,0) := 0;
   UPDATE_APARCAMIENTO  NUMBER(10,0) := 0;
   UPDATE_DATOS_NULL NUMBER(10,0) := 0;
   TOTAL_BIE_LOCALI NUMBER(10,0) := 0;
   UPDATE_ACTIVOS NUMBER(10,0) := 0;
   UPDATES_INFO NUMBER(10,0) := 0;
   UPDATES_EDIFICIO NUMBER(10,0) := 0;

   NUEVOS_VIVIENDAS NUMBER(10,0) := 0;
   NUEVOS_LOCAL NUMBER(10,0) := 0;
   NUEVOS_APARCAMIENTO NUMBER(10,0) := 0;
   
   R_ACTIVO NUMBER(10,0) := 0;
   R_LOCALIZACION NUMBER(10,0) := 0;
   R_LOC_ESCALERA NUMBER(10,0) := 0;
   R_DD_TVI_ID NUMBER(10,0) := 0;
   R_NOMBRE_VIA NUMBER(10,0) := 0;
   R_NUMERO_DOMICILIO NUMBER(10,0) := 0;
   R_LOC_PISO NUMBER(10,0) := 0;
   R_LOC_PUERTA NUMBER(10,0) := 0;
   R_LOC_COD_POST NUMBER(10,0) := 0;
   R_UPO_ID NUMBER(10,0) := 0;
   R_LOC_ID NUMBER(10,0) := 0;
   R_PRV_ID NUMBER(10,0) := 0;
   R_CIC_ID NUMBER(10,0) := 0;
   R_INFOCOMERCIAL NUMBER(10,0) := 0;
   R_EDIFICIO NUMBER(10,0) := 0;
   R_VIVIENDA NUMBER(10,0) := 0;
   R_LOCAL NUMBER(10,0) := 0;
   R_APARCA NUMBER(10,0) := 0;

CAMPO_ACTUALIZADO VARCHAR2(2 CHAR);

 V_MSQL_ACT VARCHAR2(8500 CHAR);
 V_MSQL1 VARCHAR2(8500 CHAR);

  V_MSQL2 VARCHAR2(8500 CHAR);
  V_MSQL3 VARCHAR2(8500 CHAR);
    V_MSQL4 VARCHAR2(8500 CHAR);
        V_MSQL5 VARCHAR2(8500 CHAR);
  V_MSQL6 VARCHAR2(8500 CHAR);
  V_MSQL7 VARCHAR2(8500 CHAR);
    V_MSQL8 VARCHAR2(8500 CHAR);
   V_MSQL9 VARCHAR2(8500 CHAR);
      V_MSQL10 VARCHAR2(8500 CHAR);
      V_MSQL11 VARCHAR2(8500 CHAR);
      V_MSQL12 VARCHAR2(8500 CHAR);
      V_MSQL13 VARCHAR2(8500 CHAR);
      V_MSQL14 VARCHAR2(8500 CHAR);
      V_MSQL15 VARCHAR2(8500 CHAR);
      
      
      REG_ACTIVO VARCHAR2(4000 CHAR);
      REG_LOCALIZACION VARCHAR2(4000 CHAR);
      REG_LOC_ESCALERA VARCHAR2(4000 CHAR);
      REG_DD_TVI_ID VARCHAR2(4000 CHAR);
      REG_NOMBRE_VIA VARCHAR2(4000 CHAR);
      REG_NUMERO_DOMICILIO VARCHAR2(4000 CHAR);
      REG_LOC_PISO VARCHAR2(4000 CHAR);
      REG_LOC_PUERTA VARCHAR2(4000 CHAR);
      REG_LOC_COD_POST VARCHAR2(4000 CHAR);
      REG_UPO_ID VARCHAR2(4000 CHAR);
      REG_LOC_ID VARCHAR2(4000 CHAR);
      REG_PRV_ID VARCHAR2(4000 CHAR);
      REG_CIC_ID VARCHAR2(4000 CHAR);
      REG_INFOCOMERCIAL VARCHAR2(4000 CHAR);
      REG_EDIFICIO VARCHAR2(4000 CHAR);
      REG_VIVIENDA VARCHAR2(4000 CHAR);
      REG_LOCAL VARCHAR2(4000 CHAR);
      REG_APARCA VARCHAR2(4000 CHAR);
      
UPDATE_NULL1  VARCHAR2(8500 CHAR);
UPDATE_NULL2  VARCHAR2(8500 CHAR);
UPDATE_NULL3  VARCHAR2(8500 CHAR);
UPDATE_NULL4  VARCHAR2(8500 CHAR);
UPDATE_NULL5  VARCHAR2(8500 CHAR);
UPDATE_NULL6  VARCHAR2(8500 CHAR);
UPDATE_NULL7  VARCHAR2(8500 CHAR);
UPDATE_NULL8  VARCHAR2(8500 CHAR);
UPDATE_NULL9  VARCHAR2(8500 CHAR);
UPDATE_NULL10 VARCHAR2(8500 CHAR);
UPDATE_NULL11 VARCHAR2(8500 CHAR);
UPDATE_NULL12 VARCHAR2(8500 CHAR);

   V_SENTENCIA1 VARCHAR2(1600 CHAR);
   V_SENTENCIA2 VARCHAR2(1600 CHAR);
V_SENTENCIA3 VARCHAR2(1600 CHAR);
V_VALIDA_DIST VARCHAR2(1600 CHAR);
V_VALIDA_VIV VARCHAR2(1600 CHAR);

V_VIVIENDA VARCHAR2(1600 CHAR);
V_LOCAL VARCHAR2(1600 CHAR);
V_APARCA VARCHAR2(1600 CHAR);

ACT_ID  NUMBER(17);
ACT_ID_INFO NUMBER(17);

BIE_LOC_ID  NUMBER(17);
ACT_NUMERO_ACTIVO NUMBER(17);

DD_TPH_ID NUMBER(2);

ACTIVOS_CON_CAMBIOS CLOB;

ACT_NUMERO_UVEM NUMBER(16);
ACT_NUMERO_PRINEX NUMBER(16);

ESTADO_ADMISION NUMBER(1);
DD_TVI_ID VARCHAR2(20 CHAR);
LOC_NOMBRE_VIA VARCHAR2(100 CHAR);
BIE_LOC_NOMBRE_VIA VARCHAR2(100 CHAR);

LOC_NUMERO_DOMICILIO VARCHAR2(100 CHAR);
BIE_LOC_NUMERO_DOMICILIO VARCHAR2(100 CHAR);

LOC_ESCALERA VARCHAR2(10 CHAR);
BIE_LOC_ESCALERA VARCHAR2(10 CHAR);
BIE_LOC_PISO VARCHAR2(11 CHAR);
BIE_LOC_PUERTA VARCHAR2(17 CHAR);
BIE_LOC_COD_POST VARCHAR2(250 CHAR);
DD_UPO_ID NUMBER(16);
DD_LOC_ID NUMBER(16);
DD_PRV_ID NUMBER(16);
DD_CIC_ID NUMBER(16);
ICO_ID NUMBER(16);
ICO_ID_DIST NUMBER(16);
DIS_ID NUMBER(16);



EDI_ANO_REHABILITACION NUMBER(8);
EDI_NUM_PLANTAS NUMBER(8);
EDI_ASCENSOR NUMBER(1);
EDI_NUM_ASCENSORES NUMBER(8);
EDI_REFORMA_FACHADA NUMBER(1);
EDI_REFORMA_ESCALERA NUMBER(1);
EDI_REFORMA_PORTAL NUMBER(1);
EDI_REFORMA_ASCENSOR NUMBER(1);
EDI_REFORMA_CUBIERTA NUMBER(1);
EDI_REFORMA_OTRA_ZONA NUMBER(1);
EDI_REFORMA_OTRO NUMBER(1);
EDI_REFORMA_OTRO_ZONA_COM_DES VARCHAR2(250 CHAR);
EDI_REFORMA_OTRO_DESC  VARCHAR2(250 CHAR);
EDI_DESCRIPCION  VARCHAR2(512 CHAR);
EDI_ENTORNO_INFRAESTRUCTURA VARCHAR2(1024 CHAR);
EDI_ENTORNO_COMUNICACION VARCHAR2(3000 CHAR);

VIV_ULTIMA_PLANTA NUMBER(1);
VIV_NUM_PLANTAS_INTERIOR NUMBER(8);
VIV_REFORMA_CARP_INT NUMBER(1);
VIV_REFORMA_CARP_EXT NUMBER(1);
VIV_REFORMA_COCINA NUMBER(1);
VIV_REFORMA_BANYO NUMBER(1);
VIV_REFORMA_SUELO NUMBER(1);
VIV_REFORMA_PINTURA NUMBER(1);
VIV_REFORMA_INTEGRAL NUMBER(1);
VIV_REFORMA_OTRO NUMBER(1);
VIV_REFORMA_OTRO_DESC VARCHAR2(250 CHAR);
VIV_REFORMA_PRESUPUESTO NUMBER(16,2);
VIV_DISTRIBUCION_TXT VARCHAR2(1500 CHAR);

LCO_MTS_FACHADA_PPAL NUMBER(16,2);
LCO_MTS_FACHADA_LAT NUMBER(16,2);
LCO_MTS_LUZ_LIBRE NUMBER(16,2);
LCO_MTS_ALTURA_LIBRE NUMBER(16,2);
LCO_MTS_LINEALES_PROF NUMBER(16,2);
LCO_DIAFANO NUMBER(16,2);
LCO_USO_IDONEO VARCHAR2(250 CHAR);
LCO_USO_ANTERIOR VARCHAR2(250 CHAR);
LCO_OBSERVACIONES VARCHAR2(512 CHAR);

APR_DESTINO_COCHE NUMBER(1);
APR_DESTINO_MOTO NUMBER(1);
APR_DESTINO_DOBLE NUMBER(1);
APR_ANCHURA NUMBER(16,2);
APR_PROFUNDIDAD NUMBER(16,2);
APR_FORMA_IRREGULAR NUMBER(1);

ICO_ACTIVOS_VINC VARCHAR2(250 CHAR);
ICO_FECHA_EMISION_INFORME DATE;
ICO_FECHA_ULTIMA_VISITA DATE;
ICO_FECHA_ACEPTACION DATE;
ICO_FECHA_RECHAZO DATE;
ICO_CONDICIONES_LEGALES VARCHAR2(1024 CHAR);
LOC_PISO VARCHAR2(11 CHAR);
LOC_PUERTA VARCHAR2(17 CHAR);
LOC_COD_POST VARCHAR2(250 CHAR);
DAT_ROWID ROWID;


CURSOR SEQ_TAB
    IS
   SELECT
DAT.ROWID DAT_ROWID  , 
ACT.ACT_ID,
BLO.BIE_LOC_ID,
DAT.ACT_NUMERO_ACTIVO ,
DAT.ACT_NUMERO_UVEM,
DAT.ACT_NUMERO_PRINEX,
ESTADO_ADMISION,
BLO.DD_TVI_ID,
DAT.LOC_NOMBRE_VIA,
DAT.LOC_NUMERO_DOMICILIO,
DAT.LOC_ESCALERA,
DAT.LOC_PISO,
DAT.LOC_PUERTA,
DAT.LOC_COD_POST,
BLO.BIE_LOC_NOMBRE_VIA,
BLO.BIE_LOC_NUMERO_DOMICILIO,
BLO.BIE_LOC_ESCALERA,
BLO.BIE_LOC_PISO,
BLO.BIE_LOC_PUERTA,
BLO.BIE_LOC_COD_POST,
BLO.DD_UPO_ID,
BLO.DD_LOC_ID,
BLO.DD_PRV_ID,
BLO.DD_CIC_ID,
DAT.ICO_ACTIVOS_VINC,
DAT.ICO_FECHA_EMISION_INFORME,
DAT.ICO_FECHA_ULTIMA_VISITA,
DAT.ICO_FECHA_ACEPTACION,
DAT.ICO_FECHA_RECHAZO,
INFO.ACT_ID ACT_ID_INFO,
DAT.ICO_CONDICIONES_LEGALES,
INFO.ICO_ID,
DAT.EDI_ANO_REHABILITACION,
DAT.EDI_NUM_PLANTAS,
DAT.EDI_ASCENSOR,
DAT.EDI_NUM_ASCENSORES,
DAT.EDI_REFORMA_FACHADA,
DAT.EDI_REFORMA_ESCALERA,
DAT.EDI_REFORMA_PORTAL,
DAT.EDI_REFORMA_ASCENSOR,
DAT.EDI_REFORMA_CUBIERTA,
DAT.EDI_REFORMA_OTRA_ZONA,
DAT.EDI_REFORMA_OTRO,
DAT.EDI_REFORMA_OTRO_ZONA_COM_DES,
DAT.EDI_REFORMA_OTRO_DESC,
DAT.EDI_DESCRIPCION,
DAT.EDI_ENTORNO_INFRAESTRUCTURA,
DAT.EDI_ENTORNO_COMUNICACION,
DAT.VIV_ULTIMA_PLANTA,
DAT.VIV_NUM_PLANTAS_INTERIOR,
DAT.VIV_REFORMA_CARP_INT,
DAT.VIV_REFORMA_CARP_EXT,
DAT.VIV_REFORMA_COCINA,
DAT.VIV_REFORMA_BANYO,
DAT.VIV_REFORMA_SUELO,
DAT.VIV_REFORMA_PINTURA,
DAT.VIV_REFORMA_INTEGRAL,
DAT.VIV_REFORMA_OTRO,
DAT.VIV_REFORMA_OTRO_DESC,
DAT.VIV_REFORMA_PRESUPUESTO,
DAT.VIV_DISTRIBUCION_TXT,
DAT.LCO_MTS_FACHADA_PPAL,
DAT.LCO_MTS_FACHADA_LAT,
DAT.LCO_MTS_LUZ_LIBRE,
DAT.LCO_MTS_ALTURA_LIBRE,
DAT.LCO_MTS_LINEALES_PROF,
DAT.LCO_DIAFANO,
DAT.LCO_USO_IDONEO,
DAT.LCO_USO_ANTERIOR,
DAT.LCO_OBSERVACIONES,
DAT.APR_DESTINO_COCHE,
DAT.APR_DESTINO_MOTO,
DAT.APR_DESTINO_DOBLE,
DAT.APR_ANCHURA,
DAT.APR_PROFUNDIDAD,
DAT.APR_FORMA_IRREGULAR
FROM
REM01.APR_AUX_DATOS_ACTIVO DAT,
REM01.ACT_ACTIVO ACT,
REM01.ACT_LOC_LOCALIZACION LOC,
REM01.BIE_LOCALIZACION BLO,
REM01.ACT_ICO_INFO_COMERCIAL INFO
WHERE
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = LOC.ACT_ID
AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
AND ACT.ACT_ID = INFO.ACT_ID (+)
;

BEGIN


/*****************************TABLA TEMPORAL CON LOS ACTIVOS A ACTUALIZAR*********************************/

ACTIVOS_CON_CAMBIOS :='
INSERT INTO '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS (ACT_NUMERO_ACTIVO,TABLA)
SELECT ACT_NUMERO_ACTIVO, ''BIE_LOCALIZACION_ADMI''  FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
TVI.DD_TVI_ID,
DAT.LOC_NOMBRE_VIA,
DAT.LOC_NUMERO_DOMICILIO,
DAT.LOC_ESCALERA,
DAT.LOC_PISO,
DAT.LOC_PUERTA,
DAT.LOC_COD_POST,
UPO.DD_UPO_ID,
LOC.DD_LOC_ID,
PRV.DD_PRV_ID,
CIC.DD_CIC_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ESTADO_ADMISION = 1
MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_TVI_ID,
BLO.BIE_LOC_NOMBRE_VIA,
BLO.BIE_LOC_NUMERO_DOMICILIO,
BLO.BIE_LOC_ESCALERA,
BLO.BIE_LOC_PISO,
BLO.BIE_LOC_PUERTA,
BLO.BIE_LOC_COD_POST,
BLO.DD_UPO_ID,
BLO.DD_LOC_ID,
BLO.DD_PRV_ID,
BLO.DD_CIC_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 1
  )
  
  UNION ALL
  
SELECT ACT_NUMERO_ACTIVO, ''BIE_DD_TVI_ID_NULL''  FROM (  
SELECT 
DAT.ACT_NUMERO_ACTIVO,
TVI.DD_TVI_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO (+)
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_TVI_ID IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_TVI_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
   AND DAT.ESTADO_ADMISION = 0
   AND BLO.DD_TVI_ID IS NULL
    
)
  UNION ALL
  SELECT ACT_NUMERO_ACTIVO, ''BIE_LOC_NOMBRE_VIA_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_NOMBRE_VIA
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_NOMBRE_VIA IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_NOMBRE_VIA
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_NOMBRE_VIA IS NULL
  )
  
  UNION ALL
  
  SELECT ACT_NUMERO_ACTIVO, ''BIE_LOC_NRO_DOMICILIO_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_NUMERO_DOMICILIO
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_NUMERO_DOMICILIO IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_NUMERO_DOMICILIO
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
   AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_NUMERO_DOMICILIO IS NULL
 )
  
  UNION ALL

  SELECT ACT_NUMERO_ACTIVO, ''BIE_LOC_ESCALERA_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_ESCALERA
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_ESCALERA IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_ESCALERA
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_ESCALERA IS NULL
  )
  
  UNION ALL

  SELECT ACT_NUMERO_ACTIVO, ''BIE_LOC_PISO_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_PISO
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_PISO IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_PISO
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_PISO IS NULL
)
  
  
  UNION ALL

  SELECT ACT_NUMERO_ACTIVO, ''BIE_LOC_PUERTA_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_PUERTA
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_PUERTA IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_PUERTA
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_PUERTA IS NULL
  )
  
  UNION ALL
  
  SELECT ACT_NUMERO_ACTIVO, ''BIE_LOC_COD_POST_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
DAT.LOC_COD_POST
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_COD_POST IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.BIE_LOC_COD_POST
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.BIE_LOC_COD_POST IS NULL
  )
  
  UNION ALL

  
  SELECT ACT_NUMERO_ACTIVO, ''BIE_DD_UPO_ID_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
UPO.DD_UPO_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO (+)
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_UPO_ID IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_UPO_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
   AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_UPO_ID IS NULL
)
   UNION ALL

  SELECT ACT_NUMERO_ACTIVO, ''BIE_DD_LOC_ID_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
LOC.DD_LOC_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO (+)
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_LOC_ID IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_LOC_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_LOC_ID IS NULL
  )
  
  
  UNION ALL



SELECT ACT_NUMERO_ACTIVO, ''BIE_DD_PRV_ID_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
PRV.DD_PRV_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO (+)
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_PRV_ID IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_PRV_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_PRV_ID IS NULL
  )
  
  UNION ALL
  
  SELECT ACT_NUMERO_ACTIVO, ''BIE_DD_CIC_ID_NULL''  FROM ( 
SELECT 
DAT.ACT_NUMERO_ACTIVO,
CIC.DD_CIC_ID
FROM
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.ACT_ACTIVO ACT,
 '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
  '||V_ESQUEMA||'.BIE_LOCALIZACION BLO,
  '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.PAIS   =  CIC.DD_CIC_CODIGO (+)
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_CIC_ID IS NULL
  MINUS
  SELECT 
 DAT.ACT_NUMERO_ACTIVO, 
BLO.DD_CIC_ID
FROM
  '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
   '||V_ESQUEMA||'.ACT_ACTIVO ACT,
   '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION LOC,
   '||V_ESQUEMA||'.BIE_LOCALIZACION BLO
  WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
  AND  ACT.ACT_ID = LOC.ACT_ID
  AND LOC.BIE_LOC_ID = BLO.BIE_LOC_ID
  AND DAT.ESTADO_ADMISION = 0
  AND BLO.DD_CIC_ID IS NULL
  )
  
  UNION ALL
  
  
SELECT ACT_NUMERO_ACTIVO, ''ACT_ACTIVO''  FROM (
  SELECT 
SCM.DD_SCM_ID,
DAT.ACT_NUMERO_ACTIVO,
DAT.ACT_NUMERO_UVEM,
DAT.ACT_NUMERO_PRINEX
FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.DD_SCM_SITUACION_COMERCIAL SCM
WHERE SCM.DD_SCM_CODIGO = DAT.SITUACION_COMERCIAL
AND   ACT.ACT_NUM_ACTIVO = DAT.ACT_NUMERO_ACTIVO
MINUS
SELECT 
ACT.DD_SCM_ID,
ACT.ACT_NUM_ACTIVO,
ACT.ACT_NUM_ACTIVO_UVEM,
ACT.ACT_NUM_ACTIVO_PRINEX
FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT
WHERE 
ACT.ACT_NUM_ACTIVO = DAT.ACT_NUMERO_ACTIVO
)

UNION ALL

SELECT ACT_NUMERO_ACTIVO, ''ACT_ICO_INFO_COMERCIAL''  FROM (
  SELECT 
  DAT.ACT_NUMERO_ACTIVO,
  UAC.DD_UAC_ID,
  DAT.ICO_ACTIVOS_VINC,
  PRO.PVE_ID ICO_MEDIADOR_ID,
  DAT.ICO_FECHA_EMISION_INFORME,
  DAT.ICO_FECHA_ULTIMA_VISITA,
  DAT.ICO_FECHA_ACEPTACION,
  DAT.ICO_FECHA_RECHAZO,
  DAT.ICO_CONDICIONES_LEGALES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.DD_UAC_UBICACION_ACTIVO UAC,
  '||V_ESQUEMA||'.ACT_PVE_PROVEEDOR PRO
  WHERE 
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND DAT.UBICACION_ACTIVO   =  UAC.DD_UAC_CODIGO (+)
AND DAT.PVE_CODIGO = PRO.PVE_COD_UVEM (+)
MINUS
SELECT 
DAT.ACT_NUMERO_ACTIVO,
INFO.DD_UAC_ID,
INFO.ICO_ACTIVOS_VINC,
INFO.ICO_MEDIADOR_ID,
INFO.ICO_FECHA_EMISION_INFORME,
  INFO.ICO_FECHA_ULTIMA_VISITA,
  INFO.ICO_FECHA_ACEPTACION,
  INFO.ICO_FECHA_RECHAZO,
  INFO.ICO_CONDICIONES_LEGALES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
  WHERE 
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
)


UNION ALL
  
  
 SELECT ACT_NUMERO_ACTIVO, ''ACT_EDI_EDIFICIO''  FROM (
SELECT 
  DAT.ACT_NUMERO_ACTIVO,
  TPF.DD_TPF_ID,
  DAT.EDI_ANO_REHABILITACION,
  DAT.EDI_NUM_PLANTAS,
  DAT.EDI_ASCENSOR,
  DAT.EDI_NUM_ASCENSORES  ,
  DAT.EDI_REFORMA_FACHADA ,
  DAT.EDI_REFORMA_ESCALERA,
  DAT.EDI_REFORMA_PORTAL,
  DAT.EDI_REFORMA_ASCENSOR,
  DAT.EDI_REFORMA_CUBIERTA,
  DAT.EDI_REFORMA_OTRA_ZONA,
  DAT.EDI_REFORMA_OTRO,
  DAT.EDI_REFORMA_OTRO_ZONA_COM_DES,
  DAT.EDI_REFORMA_OTRO_DESC,
  DAT.EDI_DESCRIPCION,
  DAT.EDI_ENTORNO_INFRAESTRUCTURA,
  DAT.EDI_ENTORNO_COMUNICACION,
  ECV.DD_ECV_ID
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_EDI_EDIFICIO EDI,
  '||V_ESQUEMA||'.DD_TPF_TIPO_FACHADA TPF,
  '||V_ESQUEMA||'.DD_ECV_ESTADO_CONSERVACION ECV
WHERE 
DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = EDI.ICO_ID
AND DAT.TIPO_FACHADA_EDIFICIO   =  TPF.DD_TPF_CODIGO (+)
AND DAT.ESTADO_CONSERVACION_EDIFICIO   =  ECV.DD_ECV_CODIGO (+)
MINUS
SELECT 
DAT.ACT_NUMERO_ACTIVO,
 EDI.DD_TPF_ID,
 EDI.EDI_ANO_REHABILITACION,
  EDI.EDI_NUM_PLANTAS,
  EDI.EDI_ASCENSOR,
  EDI.EDI_NUM_ASCENSORES  ,
  EDI.EDI_REFORMA_FACHADA ,
  EDI.EDI_REFORMA_ESCALERA,
  EDI.EDI_REFORMA_PORTAL,
  EDI.EDI_REFORMA_ASCENSOR,
  EDI.EDI_REFORMA_CUBIERTA,
  EDI.EDI_REFORMA_OTRA_ZONA,
  EDI.EDI_REFORMA_OTRO,
  EDI.EDI_REFORMA_OTRO_ZONA_COM_DES,
  EDI.EDI_REFORMA_OTRO_DESC,
  EDI.EDI_DESCRIPCION,
  EDI.EDI_ENTORNO_INFRAESTRUCTURA,
  EDI.EDI_ENTORNO_COMUNICACION,
  EDI.DD_ECV_ID
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_EDI_EDIFICIO EDI
  WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = EDI.ICO_ID)

UNION ALL

 SELECT ACT_NUMERO_ACTIVO, ''ACT_VIV_VIVIENDA''  FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
 TPV.DD_TPV_ID,
 TPO.DD_TPO_ID,
 TPR.DD_TPR_ID,
 DAT.VIV_ULTIMA_PLANTA,
DAT.VIV_NUM_PLANTAS_INTERIOR,
DAT.VIV_REFORMA_CARP_INT,
DAT.VIV_REFORMA_CARP_EXT,
DAT.VIV_REFORMA_COCINA,
DAT.VIV_REFORMA_BANYO,
DAT.VIV_REFORMA_SUELO,
DAT.VIV_REFORMA_PINTURA,
DAT.VIV_REFORMA_INTEGRAL,
DAT.VIV_REFORMA_OTRO,
DAT.VIV_REFORMA_OTRO_DESC,
DAT.VIV_REFORMA_PRESUPUESTO,
DAT.VIV_DISTRIBUCION_TXT
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_VIV_VIVIENDA VIV,
  '||V_ESQUEMA||'.DD_TPV_TIPO_VIVIENDA TPV,
  '||V_ESQUEMA||'.DD_TPO_TIPO_ORIENTACION TPO,
  '||V_ESQUEMA||'.DD_TPR_TIPO_RENTA TPR,
  '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = VIV.ICO_ID --14.191
AND DAT.TIPO_VIVIENDA   =  TPV.DD_TPV_CODIGO (+)
AND DAT.TIPO_ORIENTACION   =  TPO.DD_TPO_CODIGO (+)
AND DAT.TIPO_RENTA   =  TPR.DD_TPR_CODIGO (+)
AND SAC.DD_SAC_ID = ACT.DD_SAC_ID
AND SAC.DD_SAC_CODIGO IN  (''05'',''06'',''07'',''08'',''09'',''10'',''11'',''12'',''20'')
MINUS
SELECT 
DAT.ACT_NUMERO_ACTIVO,
 VIV.DD_TPV_ID,
VIV.DD_TPO_ID,
VIV.DD_TPR_ID,
VIV.VIV_ULTIMA_PLANTA,
VIV.VIV_NUM_PLANTAS_INTERIOR,
VIV.VIV_REFORMA_CARP_INT,
VIV.VIV_REFORMA_CARP_EXT,
VIV.VIV_REFORMA_COCINA,
VIV.VIV_REFORMA_BANYO,
VIV.VIV_REFORMA_SUELO,
VIV.VIV_REFORMA_PINTURA,
VIV.VIV_REFORMA_INTEGRAL,
VIV.VIV_REFORMA_OTRO,
VIV.VIV_REFORMA_OTRO_DESC,
VIV.VIV_REFORMA_PRESUPUESTO,
VIV.VIV_DISTRIBUCION_TXT
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_VIV_VIVIENDA VIV,
    '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
  WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = VIV.ICO_ID
AND SAC.DD_SAC_ID = ACT.DD_SAC_ID
AND SAC.DD_SAC_CODIGO IN  (''05'',''06'',''07'',''08'',''09'',''10'',''11'',''12'',''20'')
)

UNION ALL

 SELECT ACT_NUMERO_ACTIVO, ''ACT_LCO_LOCAL_COMERCIAL''  FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
 DAT.LCO_MTS_FACHADA_PPAL,
DAT.LCO_MTS_FACHADA_LAT,
DAT.LCO_MTS_LUZ_LIBRE,
DAT.LCO_MTS_ALTURA_LIBRE,
DAT.LCO_MTS_LINEALES_PROF,
DAT.LCO_DIAFANO,
DAT.LCO_USO_IDONEO,
DAT.LCO_USO_ANTERIOR,
DAT.LCO_OBSERVACIONES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
 '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL LCO,
   '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = LCO.ICO_ID
AND SAC.DD_SAC_ID = ACT.DD_SAC_ID
AND SAC.DD_SAC_CODIGO IN  (''13'',''14'',''15'',''16'')
MINUS
SELECT 
DAT.ACT_NUMERO_ACTIVO,
 LCO.LCO_MTS_FACHADA_PPAL,
LCO.LCO_MTS_FACHADA_LAT,
LCO.LCO_MTS_LUZ_LIBRE,
LCO.LCO_MTS_ALTURA_LIBRE,
LCO.LCO_MTS_LINEALES_PROF,
LCO.LCO_DIAFANO,
LCO.LCO_USO_IDONEO,
LCO.LCO_USO_ANTERIOR,
LCO.LCO_OBSERVACIONES
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
 '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL LCO,
   '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = LCO.ICO_ID
AND SAC.DD_SAC_ID = ACT.DD_SAC_ID
AND SAC.DD_SAC_CODIGO IN  (''13'',''14'',''15'',''16'')
)

UNION ALL


 SELECT ACT_NUMERO_ACTIVO, ''ACT_APR_PLAZA_APARCAMIENTO''  FROM (
SELECT 
DAT.ACT_NUMERO_ACTIVO,
 DAT.APR_DESTINO_COCHE,
DAT.APR_DESTINO_MOTO,
DAT.APR_DESTINO_DOBLE,
TUA.DD_TUA_ID,
APR.DD_TCA_ID,
DAT.APR_ANCHURA,
DAT.APR_PROFUNDIDAD,
DAT.APR_FORMA_IRREGULAR
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO APR,
  '||V_ESQUEMA||'.DD_TUA_TIPO_UBICA_APARCA TUA,
  '||V_ESQUEMA||'.DD_TCA_TIPO_CALIDAD TCA,
  '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = APR.ICO_ID
AND DAT.DD_TUA_ID   =  TUA.DD_TUA_CODIGO (+)
AND DAT.DD_TCA_ID   =  TCA.DD_TCA_CODIGO (+)
AND SAC.DD_SAC_ID = ACT.DD_SAC_ID
AND SAC.DD_SAC_CODIGO IN  (''19'',''24'',''26'')
MINUS
SELECT 
DAT.ACT_NUMERO_ACTIVO,
 APR.APR_DESTINO_COCHE,
APR.APR_DESTINO_MOTO,
APR.APR_DESTINO_DOBLE,
APR.DD_TUA_ID,
APR.DD_TCA_ID,
APR.APR_ANCHURA,
APR.APR_PROFUNDIDAD,
APR.APR_FORMA_IRREGULAR
  FROM 
   '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
  '||V_ESQUEMA||'.ACT_ACTIVO ACT,
  '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO,
  '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO APR,
  '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
 WHERE 
  DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO 
AND INFO.ACT_ID = ACT.ACT_ID
AND INFO.ICO_ID = APR.ICO_ID
AND SAC.DD_SAC_ID = ACT.DD_SAC_ID
AND SAC.DD_SAC_CODIGO IN  (''19'',''24'',''26'')
)'
;

 
  
   
   EXECUTE IMMEDIATE ACTIVOS_CON_CAMBIOS;
   
   COMMIT;
/****************************************FIN DE LLENADO DE TABLA TEMPORAL************/

OPEN SEQ_TAB;
    FETCH SEQ_TAB INTO
    DAT_ROWID,
    ACT_ID,
    BIE_LOC_ID,
    ACT_NUMERO_ACTIVO,
    ACT_NUMERO_UVEM,
    ACT_NUMERO_PRINEX,
    ESTADO_ADMISION,
    DD_TVI_ID,
    LOC_NOMBRE_VIA,
    LOC_NUMERO_DOMICILIO,
    LOC_ESCALERA,
    LOC_PISO,
    LOC_PUERTA,
    LOC_COD_POST,
    BIE_LOC_NOMBRE_VIA,
    BIE_LOC_NUMERO_DOMICILIO,
    BIE_LOC_ESCALERA,
    BIE_LOC_PISO,
    BIE_LOC_PUERTA,
    BIE_LOC_COD_POST,
    DD_UPO_ID,
    DD_LOC_ID,
    DD_PRV_ID,
    DD_CIC_ID,
    ICO_ACTIVOS_VINC,
    ICO_FECHA_EMISION_INFORME,
    ICO_FECHA_ULTIMA_VISITA,
    ICO_FECHA_ACEPTACION,
    ICO_FECHA_RECHAZO,
    ACT_ID_INFO,
    ICO_CONDICIONES_LEGALES,
    ICO_ID,
    EDI_ANO_REHABILITACION,
    EDI_NUM_PLANTAS,
    EDI_ASCENSOR,
    EDI_NUM_ASCENSORES,
    EDI_REFORMA_FACHADA,
    EDI_REFORMA_ESCALERA,
    EDI_REFORMA_PORTAL,
    EDI_REFORMA_ASCENSOR,
    EDI_REFORMA_CUBIERTA,
    EDI_REFORMA_OTRA_ZONA,
    EDI_REFORMA_OTRO,
    EDI_REFORMA_OTRO_ZONA_COM_DES,
    EDI_REFORMA_OTRO_DESC,
    EDI_DESCRIPCION,
    EDI_ENTORNO_INFRAESTRUCTURA,
    EDI_ENTORNO_COMUNICACION,
    VIV_ULTIMA_PLANTA,
    VIV_NUM_PLANTAS_INTERIOR,
    VIV_REFORMA_CARP_INT,
    VIV_REFORMA_CARP_EXT,
    VIV_REFORMA_COCINA,
    VIV_REFORMA_BANYO,
    VIV_REFORMA_SUELO,
    VIV_REFORMA_PINTURA,
    VIV_REFORMA_INTEGRAL,
    VIV_REFORMA_OTRO,
    VIV_REFORMA_OTRO_DESC,
    VIV_REFORMA_PRESUPUESTO,
    VIV_DISTRIBUCION_TXT,
    LCO_MTS_FACHADA_PPAL,
    LCO_MTS_FACHADA_LAT,
    LCO_MTS_LUZ_LIBRE,
    LCO_MTS_ALTURA_LIBRE,
    LCO_MTS_LINEALES_PROF,
    LCO_DIAFANO,
    LCO_USO_IDONEO,
    LCO_USO_ANTERIOR,
    LCO_OBSERVACIONES,
    APR_DESTINO_COCHE,
    APR_DESTINO_MOTO,
    APR_DESTINO_DOBLE,
    APR_ANCHURA,
    APR_PROFUNDIDAD,
    APR_FORMA_IRREGULAR
    ;
    WHILE SEQ_TAB%found
    LOOP



P_TEXTO := 'INFO: EL PROCESO DE ACTUALIZACIÓN DE DATOS-ACTIVO HA FINALIZADO CORRECTAMENTE';


IF ESTADO_ADMISION = 1 THEN



--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOCALIZACION := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_LOCALIZACION_ADMI''
';

EXECUTE IMMEDIATE REG_LOCALIZACION INTO R_LOCALIZACION;

  IF R_LOCALIZACION > 0 THEN



 V_MSQL1 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_TVI_ID = (SELECT TVI.DD_TVI_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI
WHERE DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  BIE_LOC_NOMBRE_VIA = '''||REPLACE(LOC_NOMBRE_VIA,'''','''''')||''',
  BIE_LOC_NUMERO_DOMICILIO = '''||REPLACE(LOC_NUMERO_DOMICILIO,'''','''''')||''',
  BIE_LOC_ESCALERA = '''||REPLACE(LOC_ESCALERA,'''','''''')||''',
  BIE_LOC_PISO = '''||REPLACE(LOC_PISO,'''','''''')||''',
  BIE_LOC_PUERTA = '''||REPLACE(LOC_PUERTA,'''','''''')||''',
  BIE_LOC_COD_POST = '''||REPLACE(LOC_COD_POST,'''','''''')||''',
  DD_UPO_ID = (SELECT UPO.DD_UPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO
WHERE DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  DD_LOC_ID = (SELECT LOC.DD_LOC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC
WHERE DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
  DD_PRV_ID = (SELECT PRV.DD_PRV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV
WHERE DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),


  DD_CIC_ID = (SELECT CIC.DD_CIC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.PAIS   =  CIC.DD_CIC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),

  USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';




 EXECUTE IMMEDIATE V_MSQL1;



 UPDATES_COUNT_ADM := UPDATES_COUNT_ADM + 1 ;
 
 END IF;

----VALIDAMOS LOS ACTIVOS SIN ADMISIÓN PARA ACTUALIZAR SOLO LOS CAMPOS DE DIRECCION QUE ESTEN EN NULL

ELSIF ESTADO_ADMISION = 0 THEN

--INICIALIZAMOS LA VARIABLE QUE SIRVE DE CONTADOR DE REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION
CAMPO_ACTUALIZADO := 'NO';

 IF DD_TVI_ID IS NULL OR DD_TVI_ID = ''
 THEN
 
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_DD_TVI_ID := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_DD_TVI_ID_NULL''
';


EXECUTE IMMEDIATE REG_DD_TVI_ID INTO R_DD_TVI_ID;

  IF R_DD_TVI_ID > 0 THEN
 

--DBMS_OUTPUT.PUT_LINE('EL DD_TVI_ID ESTA NULLO EN BIE_LOCALIZACION');




 UPDATE_NULL1 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_TVI_ID = (SELECT TVI.DD_TVI_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_TVI_TIPO_VIA TVI
WHERE DAT.TIPO_VIA   =  TVI.DD_TVI_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL1;
  
  CAMPO_ACTUALIZADO := 'SI';

  

  END IF;
  
  END IF;

   IF BIE_LOC_NOMBRE_VIA IS NULL OR BIE_LOC_NOMBRE_VIA = ''
 THEN

--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_NOMBRE_VIA := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_LOC_NOMBRE_VIA_NULL''
';

EXECUTE IMMEDIATE REG_NOMBRE_VIA INTO R_NOMBRE_VIA;

  IF R_NOMBRE_VIA > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_NOMBRE_VIA ESTA NULLO EN BIE_LOCALIZACION');



 UPDATE_NULL2 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_NOMBRE_VIA = '''||REPLACE(LOC_NOMBRE_VIA,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



   EXECUTE IMMEDIATE UPDATE_NULL2;
     CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';

  END IF;
  
  END IF;

    IF BIE_LOC_NUMERO_DOMICILIO IS NULL OR BIE_LOC_NUMERO_DOMICILIO = ''
 THEN

  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_NUMERO_DOMICILIO := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_LOC_NRO_DOMICILIO_NULL''
';



--DBMS_OUTPUT.PUT_LINE(REG_NUMERO_DOMICILIO);

EXECUTE IMMEDIATE REG_NUMERO_DOMICILIO INTO R_NUMERO_DOMICILIO;

  IF R_NUMERO_DOMICILIO > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_NUMERO_DOMICILIO ESTA NULLO EN BIE_LOCALIZACION');


 UPDATE_NULL3 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_NUMERO_DOMICILIO = '''||REPLACE(LOC_NUMERO_DOMICILIO,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



EXECUTE IMMEDIATE UPDATE_NULL3;

    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';

  END IF;

  END IF;

    IF BIE_LOC_ESCALERA IS NULL OR BIE_LOC_ESCALERA = ''
  THEN
  
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_ESCALERA := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_LOC_ESCALERA_NULL''
';

EXECUTE IMMEDIATE REG_LOC_ESCALERA INTO R_LOC_ESCALERA;

  IF R_LOC_ESCALERA > 0 THEN
  

--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_ESCALERA ESTA NULLO EN BIE_LOCALIZACION');


  UPDATE_NULL4 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_ESCALERA = '''||REPLACE(LOC_ESCALERA,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



EXECUTE IMMEDIATE UPDATE_NULL4;


    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';


END IF;

END IF;

  IF BIE_LOC_PISO IS NULL OR BIE_LOC_PISO = ''
  THEN
  
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_PISO := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_LOC_PISO_NULL''
';

EXECUTE IMMEDIATE REG_LOC_PISO INTO R_LOC_PISO;

  IF R_LOC_PISO > 0 THEN
 

--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_PISO ESTA NULLO EN BIE_LOCALIZACION');

  UPDATE_NULL5 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_PISO = '''||REPLACE(LOC_PISO,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL5;
  
    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
END IF;

END IF;


 IF BIE_LOC_PUERTA IS NULL OR BIE_LOC_PUERTA = ''
 THEN

--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_PUERTA := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_LOC_PUERTA_NULL''
';


EXECUTE IMMEDIATE REG_LOC_PUERTA INTO R_LOC_PUERTA;

  IF R_LOC_PUERTA > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_PUERTA ESTA NULLO EN BIE_LOCALIZACION');


 UPDATE_NULL6 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_PUERTA = '''||REPLACE(LOC_PUERTA,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



    EXECUTE IMMEDIATE UPDATE_NULL6;
    
    CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
    
    END IF;

  END IF;

   IF BIE_LOC_COD_POST IS NULL OR BIE_LOC_COD_POST = ''
 THEN

--------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_COD_POST := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_LOC_COD_POST_NULL''
';

EXECUTE IMMEDIATE REG_LOC_COD_POST INTO R_LOC_COD_POST;

  IF R_LOC_COD_POST > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL BIE_LOC_COD_POST ESTA NULLO EN BIE_LOCALIZACION');

  UPDATE_NULL7 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET BIE_LOC_COD_POST = '''||REPLACE(LOC_COD_POST,'''','''''')||''',
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL7;
  
     CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';

END IF;

  END IF;



   IF DD_UPO_ID IS NULL OR DD_UPO_ID = ''
 THEN
 
 --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_UPO_ID := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_DD_UPO_ID_NULL''
';

EXECUTE IMMEDIATE REG_UPO_ID INTO R_UPO_ID;

  IF R_UPO_ID > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL DD_UPO_ID ESTA NULLO EN BIE_LOCALIZACION');


  UPDATE_NULL9 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_UPO_ID = (SELECT UPO.DD_UPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_UPO_UNID_POBLACIONAL UPO
WHERE DAT.UNIDAD_INFERIOR_MUNICIPIO   =  UPO.DD_UPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL9;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  END IF;

  END IF;

     IF DD_LOC_ID IS NULL OR DD_LOC_ID = ''
 THEN

 --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_LOC_ID := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_DD_LOC_ID_NULL''
';

EXECUTE IMMEDIATE REG_LOC_ID INTO R_LOC_ID;

  IF R_LOC_ID > 0 THEN


--DBMS_OUTPUT.PUT_LINE('EL DD_LOC_ID ESTA NULLO EN BIE_LOCALIZACION');

   UPDATE_NULL10 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_LOC_ID =  (SELECT LOC.DD_LOC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_LOC_LOCALIDAD LOC
WHERE DAT.MUNICIPIO   =  LOC.DD_LOC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL10;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  END IF;


  END IF;

       IF DD_PRV_ID IS NULL OR DD_PRV_ID = ''
 THEN
 
 --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_PRV_ID := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_DD_PRV_ID_NULL''
';

EXECUTE IMMEDIATE REG_PRV_ID INTO R_PRV_ID;

  IF R_PRV_ID > 0 THEN



--DBMS_OUTPUT.PUT_LINE('EL DD_PRV_ID ESTA NULLO EN BIE_LOCALIZACION');

 UPDATE_NULL11 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_PRV_ID = (SELECT PRV.DD_PRV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_PRV_PROVINCIA PRV
WHERE DAT.PROVINCIA   =  PRV.DD_PRV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL11;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  END IF;

  END IF;

  IF DD_CIC_ID IS NULL OR DD_CIC_ID = ''
 THEN
 
  --------------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS---------------

REG_CIC_ID := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''BIE_DD_CIC_ID_NULL''
';

EXECUTE IMMEDIATE REG_CIC_ID INTO R_CIC_ID;

  IF R_CIC_ID > 0 THEN

--DBMS_OUTPUT.PUT_LINE('EL DD_CIC_ID ESTA NULLO EN BIE_LOCALIZACION');

 UPDATE_NULL12 := 'UPDATE '||V_ESQUEMA||'.BIE_LOCALIZACION
  SET DD_CIC_ID =  (SELECT CIC.DD_CIC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA_MASTER||'.DD_CIC_CODIGO_ISO_CIRBE_BKP CIC
WHERE DAT.PAIS   =  CIC.DD_CIC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
),
      USUARIOMODIFICAR = ''ACT_UVEM'',
      FECHAMODIFICAR = SYSDATE
 WHERE BIE_LOC_ID = '||BIE_LOC_ID||'';



  EXECUTE IMMEDIATE UPDATE_NULL12;
  
      CAMPO_ACTUALIZADO := 'NO';
     CAMPO_ACTUALIZADO := 'SI';
  
  
  
  END IF;






  END IF;

------VALIDAMOS LOS REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION QUE ESTABAN EN NULL Y QUE EN EL FICHERO CONTIENEN INFORMACIÓN A ACTUALIZAR----

IF CAMPO_ACTUALIZADO = 'SI'

THEN 

UPDATE_DATOS_NULL := UPDATE_DATOS_NULL + 1;


END IF;





END IF;




--------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_ACTIVO := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''ACT_ACTIVO''
';

EXECUTE IMMEDIATE REG_ACTIVO INTO R_ACTIVO;

  IF R_ACTIVO > 0 THEN


----ACTUALIZAMOS ACTIVOS CON SITUACION COMERCIAL, NUMERO_UVEM Y PRINEX PROVENIENTES DEL FICHERO

V_MSQL_ACT := 'UPDATE '||V_ESQUEMA||'.ACT_ACTIVO
  SET DD_SCM_ID = (SELECT SCM.DD_SCM_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.DD_SCM_SITUACION_COMERCIAL SCM
WHERE DAT.SITUACION_COMERCIAL   =  SCM.DD_SCM_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
ACT_NUM_ACTIVO_UVEM = '''||ACT_NUMERO_UVEM||''',
ACT_NUM_ACTIVO_PRINEX =  '''||ACT_NUMERO_PRINEX||''',
USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE ACT_ID = '||ACT_ID||'';

UPDATE_ACTIVOS := UPDATE_ACTIVOS + 1;


   EXECUTE IMMEDIATE V_MSQL_ACT;

END IF;

----VALIDAMOS QUE EL ACTIVO TIENE INFORMACION COMERCIAL, SI EXISTE ACTUALIZAMOS.

IF ACT_ID_INFO IS NOT NULL THEN


---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_INFOCOMERCIAL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''ACT_ICO_INFO_COMERCIAL''
';
  
  
  
  EXECUTE IMMEDIATE REG_INFOCOMERCIAL INTO R_INFOCOMERCIAL;

  IF R_INFOCOMERCIAL > 0 THEN


 V_MSQL3 := 'UPDATE '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL
  SET
  DD_UAC_ID = (SELECT UAC.DD_UAC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_UAC_UBICACION_ACTIVO UAC
WHERE DAT.UBICACION_ACTIVO   =  UAC.DD_UAC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  ICO_ACTIVOS_VINC = '''||REPLACE(ICO_ACTIVOS_VINC,'''','''''')||''',
  ICO_MEDIADOR_ID =  (SELECT PRO.PVE_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_PVE_PROVEEDOR PRO
WHERE DAT.PVE_CODIGO = PRO.PVE_COD_UVEM
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  ICO_FECHA_EMISION_INFORME = '''||ICO_FECHA_EMISION_INFORME||''',
  ICO_FECHA_ULTIMA_VISITA = '''||ICO_FECHA_ULTIMA_VISITA||''',
  ICO_FECHA_ACEPTACION = '''||ICO_FECHA_ACEPTACION||''',
  ICO_FECHA_RECHAZO = '''||ICO_FECHA_RECHAZO||''',
  ICO_CONDICIONES_LEGALES = '''||REPLACE(ICO_CONDICIONES_LEGALES,'''','''''')||''',
  USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE ACT_ID = '||ACT_ID||'';



 EXECUTE IMMEDIATE V_MSQL3;

 UPDATES_INFO := UPDATES_INFO + 1;

END IF;




---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_EDIFICIO := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''ACT_EDI_EDIFICIO''
';
  
  
 
  
  EXECUTE IMMEDIATE REG_EDIFICIO INTO R_EDIFICIO;

  IF R_EDIFICIO > 0 THEN



   V_MSQL4 := 'UPDATE '||V_ESQUEMA||'.ACT_EDI_EDIFICIO
  SET
      DD_TPF_ID = (SELECT TPF.DD_TPF_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPF_TIPO_FACHADA TPF
WHERE DAT.TIPO_FACHADA_EDIFICIO   =  TPF.DD_TPF_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      EDI_ANO_REHABILITACION = '||EDI_ANO_REHABILITACION||',
      EDI_NUM_PLANTAS = '||EDI_NUM_PLANTAS||',
      EDI_ASCENSOR = '||EDI_ASCENSOR||',
      EDI_NUM_ASCENSORES = '||EDI_NUM_ASCENSORES||',
      EDI_REFORMA_FACHADA = '||EDI_REFORMA_FACHADA||',
      EDI_REFORMA_ESCALERA = '||EDI_REFORMA_ESCALERA||',
      EDI_REFORMA_PORTAL = '||EDI_REFORMA_PORTAL||',
      EDI_REFORMA_ASCENSOR = '||EDI_REFORMA_ASCENSOR||',
      EDI_REFORMA_CUBIERTA = '||EDI_REFORMA_CUBIERTA||',
      EDI_REFORMA_OTRA_ZONA = '||EDI_REFORMA_OTRA_ZONA||',
      EDI_REFORMA_OTRO = '||EDI_REFORMA_OTRO||',
       EDI_REFORMA_OTRO_ZONA_COM_DES = '''||REPLACE(EDI_REFORMA_OTRO_ZONA_COM_DES,'''','''''')||''',
       EDI_REFORMA_OTRO_DESC = '''||REPLACE(EDI_REFORMA_OTRO_DESC,'''','''''')||''',
       EDI_DESCRIPCION = '''||REPLACE(EDI_DESCRIPCION,'''','''''')||''',
       EDI_ENTORNO_INFRAESTRUCTURA = '''||REPLACE(EDI_ENTORNO_INFRAESTRUCTURA,'''','''''')||''',
       EDI_ENTORNO_COMUNICACION = '''||REPLACE(EDI_ENTORNO_COMUNICACION,'''','''''')||''',
       DD_ECV_ID = (SELECT ECV.DD_ECV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_ECV_ESTADO_CONSERVACION ECV
WHERE DAT.ESTADO_CONSERVACION_EDIFICIO   =  ECV.DD_ECV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
USUARIOMODIFICAR = ''ACT_UVEM'',
  FECHAMODIFICAR = SYSDATE
 WHERE ICO_ID = '||ICO_ID||'';
 
 
 --DBMS_OUTPUT.PUT_LINE(V_MSQL4);
 
  EXECUTE IMMEDIATE V_MSQL4;
 

 UPDATES_EDIFICIO := UPDATES_EDIFICIO + 1;

END IF;

----VALIDAMOS QUE EL ACTIVO ES SUBTIPO VIVIENDA

 V_VIVIENDA := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''05'',''06'',''07'',''08'',''09'',''10'',''11'',''12'',''20'')
  AND AUX.ROWID = '''||DAT_ROWID||'''
  '
  ;




 EXECUTE IMMEDIATE V_VIVIENDA INTO TABLE_VIVIENDA;

  IF TABLE_VIVIENDA > 0 THEN



---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_VIVIENDA := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''ACT_VIV_VIVIENDA''
';
  
   
  
  EXECUTE IMMEDIATE REG_VIVIENDA INTO R_VIVIENDA;

  IF R_VIVIENDA > 0 THEN



  V_MSQL5 := 'UPDATE '||V_ESQUEMA||'.ACT_VIV_VIVIENDA
  SET DD_TPV_ID = (SELECT TPV.DD_TPV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPV_TIPO_VIVIENDA TPV
WHERE DAT.TIPO_VIVIENDA   =  TPV.DD_TPV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      DD_TPO_ID = (SELECT TPO.DD_TPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPO_TIPO_ORIENTACION TPO
WHERE DAT.TIPO_ORIENTACION   =  TPO.DD_TPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      DD_TPR_ID = (SELECT TPR.DD_TPR_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPR_TIPO_RENTA TPR
WHERE DAT.TIPO_RENTA   =  TPR.DD_TPR_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      VIV_ULTIMA_PLANTA = '||VIV_ULTIMA_PLANTA||',
      VIV_NUM_PLANTAS_INTERIOR = '||VIV_NUM_PLANTAS_INTERIOR||',
      VIV_REFORMA_CARP_INT = '||VIV_REFORMA_CARP_INT||',
      VIV_REFORMA_CARP_EXT = '||VIV_REFORMA_CARP_EXT||',
      VIV_REFORMA_COCINA = '||VIV_REFORMA_COCINA||',
      VIV_REFORMA_BANYO = '||VIV_REFORMA_BANYO||',
      VIV_REFORMA_SUELO = '||VIV_REFORMA_SUELO||',
      VIV_REFORMA_PINTURA = '||VIV_REFORMA_PINTURA||',
      VIV_REFORMA_INTEGRAL = '||VIV_REFORMA_INTEGRAL||',
      VIV_REFORMA_OTRO = '||VIV_REFORMA_OTRO||',
      VIV_REFORMA_OTRO_DESC = '''||REPLACE(VIV_REFORMA_OTRO_DESC,'''','''''')||''',
      VIV_REFORMA_PRESUPUESTO = '||VIV_REFORMA_PRESUPUESTO||',
      VIV_DISTRIBUCION_TXT = '''||REPLACE(VIV_DISTRIBUCION_TXT,'''','''''')||'''
 WHERE ICO_ID = '||ICO_ID||'';





    EXECUTE IMMEDIATE V_MSQL5;

     UPDATE_VIVIENDAS := UPDATE_VIVIENDAS + 1;
     
     END IF;

   END IF ;



----VALIDAMOS QUE EL ACTIVO ES SUBTIPO LOCAL COMERCIAL



 V_LOCAL := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''13'',''14'',''15'',''16'')
  AND AUX.ROWID = '''||DAT_ROWID||'''
  '
  ;




 EXECUTE IMMEDIATE V_LOCAL INTO TABLE_LOCAL;

  IF TABLE_LOCAL > 0 THEN


---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_LOCAL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''ACT_LCO_LOCAL_COMERCIAL''
';
  
 
  
  EXECUTE IMMEDIATE REG_LOCAL INTO R_LOCAL;

  IF R_LOCAL > 0 THEN

  V_MSQL6 := 'UPDATE '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL
  SET LCO_MTS_FACHADA_PPAL = '''||LCO_MTS_FACHADA_PPAL||''',
      LCO_MTS_FACHADA_LAT = '''||LCO_MTS_FACHADA_LAT||''',
      LCO_MTS_LUZ_LIBRE = '''||LCO_MTS_LUZ_LIBRE||''',
      LCO_MTS_ALTURA_LIBRE = '''||LCO_MTS_ALTURA_LIBRE||''',
      LCO_MTS_LINEALES_PROF = '''||LCO_MTS_LINEALES_PROF||''',
      LCO_DIAFANO = '''||LCO_DIAFANO||''',
      LCO_USO_IDONEO = '''||REPLACE(LCO_USO_IDONEO,'''','''''')||''',
      LCO_USO_ANTERIOR = '''||REPLACE(LCO_USO_ANTERIOR,'''','''''')||''',
      LCO_OBSERVACIONES = '''||REPLACE(LCO_OBSERVACIONES,'''','''''')||'''
 WHERE ICO_ID = '||ICO_ID||'';






    EXECUTE IMMEDIATE V_MSQL6;
    
     UPDATE_LOCAL := UPDATE_LOCAL + 1;
     
     END IF;

  END IF;

----VALIDAMOS QUE EL ACTIVO ES SUBTIPO APARCAMIENTO

 V_APARCA := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''19'',''24'',''26'')
  AND AUX.ROWID = '''||DAT_ROWID||'''
  '
  ;




 EXECUTE IMMEDIATE V_APARCA INTO TABLE_APARCA;

  IF TABLE_APARCA > 0 THEN


---------COMPROBAMOS LAS FILAS CON DATOS NUEVOS PROVENIENTES DEL FICHERO PARA ACTUALIZAR SÓLO ESOS REGISTROS----------

REG_APARCA := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.APR_AUX_UPDATE_ACTIVOS
WHERE ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
AND TABLA = ''ACT_APR_PLAZA_APARCAMIENTO''
';
 
  
  EXECUTE IMMEDIATE REG_APARCA INTO R_APARCA;

  IF R_APARCA > 0 THEN


  V_MSQL7 := 'UPDATE '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO
  SET APR_DESTINO_COCHE = '''||APR_DESTINO_COCHE||''',
      APR_DESTINO_MOTO = '''||APR_DESTINO_MOTO||''',
      APR_DESTINO_DOBLE = '''||APR_DESTINO_DOBLE||''',
      DD_TUA_ID = (SELECT TUA.DD_TUA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TUA_TIPO_UBICA_APARCA TUA
WHERE DAT.DD_TUA_ID   =  TUA.DD_TUA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      DD_TCA_ID = (SELECT TCA.DD_TCA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TCA_TIPO_CALIDAD TCA
WHERE DAT.DD_TCA_ID   =  TCA.DD_TCA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
      APR_ANCHURA = '''||APR_ANCHURA||''',
      APR_PROFUNDIDAD = '''||APR_PROFUNDIDAD||''',
      APR_FORMA_IRREGULAR = '''||APR_FORMA_IRREGULAR||'''
 WHERE ICO_ID = '||ICO_ID||'';






 EXECUTE IMMEDIATE V_MSQL7;

  UPDATE_APARCAMIENTO := UPDATE_APARCAMIENTO + 1;
  
  END IF;
  
 END IF;
 

 ELSE

----INSERTAMOS INFORMACIÓN COMERCIAL A LOS ACTIVOS QUE NO TENÍAN DICHA INFORMACION

  V_MSQL8 := 'INSERT INTO '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL (ICO_ID, ACT_ID, DD_UAC_ID, ICO_ACTIVOS_VINC, ICO_MEDIADOR_ID, ICO_FECHA_EMISION_INFORME, ICO_FECHA_ULTIMA_VISITA, ICO_FECHA_ACEPTACION ,ICO_FECHA_RECHAZO, ICO_CONDICIONES_LEGALES, USUARIOCREAR, FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_ICO_INFO_COMERCIAL.NEXTVAL,
  '||ACT_ID||',
  (SELECT UAC.DD_UAC_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_UAC_UBICACION_ACTIVO UAC
WHERE DAT.UBICACION_ACTIVO   =  UAC.DD_UAC_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  '''||ICO_ACTIVOS_VINC||''',

  (SELECT PRO.PVE_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_PVE_PROVEEDOR PRO
WHERE DAT.PVE_CODIGO = PRO.PVE_COD_UVEM
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),


  '''||ICO_FECHA_EMISION_INFORME||''',
  '''||ICO_FECHA_ULTIMA_VISITA||''',
  '''||ICO_FECHA_ACEPTACION||''',
  '''||ICO_FECHA_RECHAZO||''',
   '''||REPLACE(ICO_CONDICIONES_LEGALES,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';


  EXECUTE IMMEDIATE V_MSQL8;

  NUEVOS_COUNT := NUEVOS_COUNT + 1;



 V_MSQL9 := 'INSERT INTO '||V_ESQUEMA||'.ACT_EDI_EDIFICIO (EDI_ID, ICO_ID, DD_ECV_ID, DD_TPF_ID, EDI_ANO_REHABILITACION, EDI_NUM_PLANTAS, EDI_ASCENSOR, EDI_NUM_ASCENSORES, EDI_REFORMA_FACHADA, EDI_REFORMA_ESCALERA,
 EDI_REFORMA_PORTAL,
 EDI_REFORMA_ASCENSOR,
EDI_REFORMA_CUBIERTA,
EDI_REFORMA_OTRA_ZONA,
EDI_REFORMA_OTRO,
EDI_REFORMA_OTRO_DESC,
EDI_REFORMA_OTRO_ZONA_COM_DES,
EDI_DESCRIPCION,
EDI_ENTORNO_INFRAESTRUCTURA,
EDI_ENTORNO_COMUNICACION,
 USUARIOCREAR, FECHACREAR )
  VALUES ('||V_ESQUEMA||'.S_ACT_EDI_EDIFICIO.NEXTVAL,

  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ROWID = '''||DAT_ROWID||'''),
(SELECT ECV.DD_ECV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
 '||V_ESQUEMA||'.DD_ECV_ESTADO_CONSERVACION ECV
WHERE DAT.ESTADO_CONSERVACION_EDIFICIO   =  ECV.DD_ECV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
(SELECT TPF.DD_TPF_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPF_TIPO_FACHADA TPF
WHERE DAT.TIPO_FACHADA_EDIFICIO   =  TPF.DD_TPF_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),

  '''||EDI_ANO_REHABILITACION||''',
  '''||EDI_NUM_PLANTAS||''',
  '''||EDI_ASCENSOR||''',
  '''||EDI_NUM_ASCENSORES||''',
  '''||EDI_REFORMA_FACHADA||''',
  '''||EDI_REFORMA_ESCALERA||''',
  '''||EDI_REFORMA_PORTAL||''',
  '''||EDI_REFORMA_ASCENSOR||''',
   '''||EDI_REFORMA_CUBIERTA||''',
      '''||EDI_REFORMA_OTRA_ZONA||''',
    '''||EDI_REFORMA_OTRO||''',
    '''||REPLACE(EDI_REFORMA_OTRO_DESC,'''','''''')||''',
    '''||REPLACE(EDI_REFORMA_OTRO_ZONA_COM_DES,'''','''''')||''',
    '''||REPLACE(EDI_DESCRIPCION,'''','''''')||''',
    '''||REPLACE(EDI_ENTORNO_INFRAESTRUCTURA,'''','''''')||''',
    '''||REPLACE(EDI_ENTORNO_COMUNICACION,'''','''''')||''',
   ''ACT_UVEM'',
   SYSDATE
   )';

  EXECUTE IMMEDIATE V_MSQL9;

----VALIDAMOS QUE EL SUBTIPO ES DE VIVIENDA PARA INSERTAR

 V_SENTENCIA1 := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''05'',''06'',''07'',''08'',''09'',''10'',''11'',''12'',''20'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_SENTENCIA1 INTO TABLE_COUNT;

  IF TABLE_COUNT > 0 THEN



 V_MSQL10 := 'INSERT INTO '||V_ESQUEMA||'.ACT_VIV_VIVIENDA (ICO_ID, DD_TPV_ID, DD_TPO_ID, DD_TPR_ID, VIV_ULTIMA_PLANTA, VIV_NUM_PLANTAS_INTERIOR, VIV_REFORMA_CARP_INT,
 VIV_REFORMA_CARP_EXT,
VIV_REFORMA_COCINA,
VIV_REFORMA_BANYO,
VIV_REFORMA_SUELO,
VIV_REFORMA_PINTURA,
VIV_REFORMA_INTEGRAL,
VIV_REFORMA_OTRO,
VIV_REFORMA_OTRO_DESC,
VIV_REFORMA_PRESUPUESTO,
VIV_DISTRIBUCION_TXT )
  VALUES (
  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ROWID = '''||DAT_ROWID||'''),

   (SELECT TPV.DD_TPV_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPV_TIPO_VIVIENDA TPV
WHERE DAT.TIPO_VIVIENDA   =  TPV.DD_TPV_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  (SELECT TPO.DD_TPO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPO_TIPO_ORIENTACION TPO
WHERE DAT.TIPO_ORIENTACION   =  TPO.DD_TPO_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  (SELECT TPR.DD_TPR_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TPR_TIPO_RENTA TPR
WHERE DAT.TIPO_RENTA   =  TPR.DD_TPR_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||')
 ,
  '''||VIV_ULTIMA_PLANTA||''',
  '''||VIV_NUM_PLANTAS_INTERIOR||''',
  '''||VIV_REFORMA_CARP_INT||''',
  '''||VIV_REFORMA_CARP_EXT||''',
  '''||VIV_REFORMA_COCINA||''',
   '''||VIV_REFORMA_BANYO||''',
      '''||VIV_REFORMA_SUELO||''',
    '''||VIV_REFORMA_PINTURA||''',
    '''||VIV_REFORMA_INTEGRAL||''',
    '''||VIV_REFORMA_OTRO||''',
  '''||REPLACE(VIV_REFORMA_OTRO_DESC,'''','''''')||''',
  '''||VIV_REFORMA_PRESUPUESTO||''',
  '''||REPLACE(VIV_DISTRIBUCION_TXT,'''','''''')||'''
   )';



  EXECUTE IMMEDIATE V_MSQL10;

  NUEVOS_VIVIENDAS := NUEVOS_VIVIENDAS + 1;





  V_MSQL11 := '
		UPDATE '||V_ESQUEMA||'.'||V_TABLA_INFO||' ICO
		SET DD_TIC_ID = 1
		WHERE EXISTS  (
		SELECT 1 FROM '||V_ESQUEMA||'.'||V_TABLA_VIV||' VIV
		WHERE ICO.ICO_ID = VIV.ICO_ID
    AND  ICO.ACT_ID = '||ACT_ID||'
    )
	  ';




EXECUTE IMMEDIATE V_MSQL11;


  END IF;

----VALIDAMOS QUE EL SUBTIPO ES DE LOCAL COMERCIAL PARA INSERTAR


 V_SENTENCIA2 := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''13'',''14'',''15'',''16'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_SENTENCIA2 INTO TABLE_COUNT2;

  IF TABLE_COUNT2 > 0 THEN



    V_MSQL12 := 'INSERT INTO '||V_ESQUEMA||'.ACT_LCO_LOCAL_COMERCIAL (ICO_ID,
LCO_MTS_FACHADA_PPAL,
LCO_MTS_FACHADA_LAT,
LCO_MTS_LUZ_LIBRE,
LCO_MTS_ALTURA_LIBRE,
LCO_MTS_LINEALES_PROF,
LCO_DIAFANO,
LCO_USO_IDONEO,
LCO_USO_ANTERIOR,
LCO_OBSERVACIONES )
  VALUES (
  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ROWID = '''||DAT_ROWID||'''),

  '''||LCO_MTS_FACHADA_PPAL||''',
  '''||LCO_MTS_FACHADA_LAT||''',
  '''||LCO_MTS_LUZ_LIBRE||''',
  '''||LCO_MTS_ALTURA_LIBRE||''',
  '''||LCO_MTS_LINEALES_PROF||''',
  '''||LCO_DIAFANO||''',
  '''||REPLACE(LCO_USO_IDONEO,'''','''''')||''',
  '''||REPLACE(LCO_USO_ANTERIOR,'''','''''')||''',
  '''||REPLACE(LCO_OBSERVACIONES,'''','''''')||'''
   )';



EXECUTE IMMEDIATE V_MSQL12;

    NUEVOS_LOCAL := NUEVOS_LOCAL + 1;




  V_MSQL13 := '
		UPDATE '||V_ESQUEMA||'.'||V_TABLA_INFO||' ICO
		SET DD_TIC_ID = 2
		WHERE EXISTS  (
		SELECT 1 FROM '||V_ESQUEMA||'.'||V_TABLA_LOCAL||' LOC
		WHERE ICO.ICO_ID = LOC.ICO_ID
    AND  ICO.ACT_ID = '||ACT_ID||'
    )
	  ';




EXECUTE IMMEDIATE V_MSQL13;

  END IF;


----VALIDAMOS QUE EL SUBTIPO ES DE APARCAMIENTO PARA INSERTAR

 V_SENTENCIA3 := '
  SELECT COUNT(DISTINCT AUX.ACT_NUMERO_ACTIVO)
  FROM '||V_ESQUEMA||'.'||V_TABLA_AUX||' AUX
  INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO = AUX.ACT_NUMERO_ACTIVO
  INNER JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC
    ON SAC.DD_SAC_ID = ACT.DD_SAC_ID
  WHERE SAC.DD_SAC_CODIGO IN  (''19'',''24'',''26'')
  AND AUX.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'
  '
  ;




 EXECUTE IMMEDIATE V_SENTENCIA3 INTO TABLE_COUNT3;

  IF TABLE_COUNT3 > 0 THEN



  V_MSQL14 := 'INSERT INTO '||V_ESQUEMA||'.ACT_APR_PLAZA_APARCAMIENTO (
ICO_ID,
APR_DESTINO_COCHE,
APR_DESTINO_MOTO,
APR_DESTINO_DOBLE,
DD_TUA_ID,
DD_TCA_ID,
APR_ANCHURA,
APR_PROFUNDIDAD,
APR_FORMA_IRREGULAR
 )
  VALUES (
  (SELECT INFO.ICO_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
'||V_ESQUEMA||'.ACT_ACTIVO ACT,
'||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL INFO
WHERE DAT.ACT_NUMERO_ACTIVO = ACT.ACT_NUM_ACTIVO
AND ACT.ACT_ID = INFO.ACT_ID
AND DAT.ROWID = '''||DAT_ROWID||'''),

  '''||APR_DESTINO_COCHE||''',
  '''||APR_DESTINO_MOTO||''',
  '''||APR_DESTINO_DOBLE||''',
  (SELECT TUA.DD_TUA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TUA_TIPO_UBICA_APARCA TUA
WHERE DAT.DD_TUA_ID   =  TUA.DD_TUA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  (SELECT TCA.DD_TCA_ID FROM '||V_ESQUEMA||'.APR_AUX_DATOS_ACTIVO DAT,
    '||V_ESQUEMA||'.DD_TCA_TIPO_CALIDAD TCA
WHERE DAT.DD_TCA_ID   =  TCA.DD_TCA_CODIGO
AND   DAT.ACT_NUMERO_ACTIVO = '||ACT_NUMERO_ACTIVO||'),
  '''||APR_ANCHURA||''',
  '''||APR_PROFUNDIDAD||''',
  '''||APR_FORMA_IRREGULAR||'''
   )';



EXECUTE IMMEDIATE V_MSQL14;

  NUEVOS_APARCAMIENTO := NUEVOS_APARCAMIENTO + 1;





  V_MSQL15 := '
		UPDATE '||V_ESQUEMA||'.'||V_TABLA_INFO||' ICO
		SET DD_TIC_ID = 3
		WHERE EXISTS  (
		SELECT 1 FROM '||V_ESQUEMA||'.'||V_TABLA_APARC||' APAR
		WHERE ICO.ICO_ID = APAR.ICO_ID
    AND  ICO.ACT_ID = '||ACT_ID||'
    )
	  ';




EXECUTE IMMEDIATE V_MSQL15;


  END IF;


END IF;




FETCH SEQ_TAB INTO
DAT_ROWID,
    ACT_ID,
    BIE_LOC_ID,
    ACT_NUMERO_ACTIVO,
    ACT_NUMERO_UVEM,
    ACT_NUMERO_PRINEX,
    ESTADO_ADMISION,
    DD_TVI_ID,
    LOC_NOMBRE_VIA,
    LOC_NUMERO_DOMICILIO,
    LOC_ESCALERA,
    LOC_PISO,
    LOC_PUERTA,
    LOC_COD_POST,
    BIE_LOC_NOMBRE_VIA,
    BIE_LOC_NUMERO_DOMICILIO,
    BIE_LOC_ESCALERA,
    BIE_LOC_PISO,
    BIE_LOC_PUERTA,
    BIE_LOC_COD_POST,
    DD_UPO_ID,
    DD_LOC_ID,
    DD_PRV_ID,
    DD_CIC_ID,
    ICO_ACTIVOS_VINC,
    ICO_FECHA_EMISION_INFORME,
    ICO_FECHA_ULTIMA_VISITA,
    ICO_FECHA_ACEPTACION,
    ICO_FECHA_RECHAZO,
    ACT_ID_INFO,
    ICO_CONDICIONES_LEGALES,
    ICO_ID,
    EDI_ANO_REHABILITACION,
    EDI_NUM_PLANTAS,
    EDI_ASCENSOR,
    EDI_NUM_ASCENSORES,
    EDI_REFORMA_FACHADA,
    EDI_REFORMA_ESCALERA,
    EDI_REFORMA_PORTAL,
    EDI_REFORMA_ASCENSOR,
    EDI_REFORMA_CUBIERTA,
    EDI_REFORMA_OTRA_ZONA,
    EDI_REFORMA_OTRO,
    EDI_REFORMA_OTRO_ZONA_COM_DES,
    EDI_REFORMA_OTRO_DESC,
    EDI_DESCRIPCION,
    EDI_ENTORNO_INFRAESTRUCTURA,
    EDI_ENTORNO_COMUNICACION,
    VIV_ULTIMA_PLANTA,
    VIV_NUM_PLANTAS_INTERIOR,
    VIV_REFORMA_CARP_INT,
    VIV_REFORMA_CARP_EXT,
    VIV_REFORMA_COCINA,
    VIV_REFORMA_BANYO,
    VIV_REFORMA_SUELO,
    VIV_REFORMA_PINTURA,
    VIV_REFORMA_INTEGRAL,
    VIV_REFORMA_OTRO,
    VIV_REFORMA_OTRO_DESC,
    VIV_REFORMA_PRESUPUESTO,
    VIV_DISTRIBUCION_TXT,
    LCO_MTS_FACHADA_PPAL,
    LCO_MTS_FACHADA_LAT,
    LCO_MTS_LUZ_LIBRE,
    LCO_MTS_ALTURA_LIBRE,
    LCO_MTS_LINEALES_PROF,
    LCO_DIAFANO,
    LCO_USO_IDONEO,
    LCO_USO_ANTERIOR,
    LCO_OBSERVACIONES,
    APR_DESTINO_COCHE,
    APR_DESTINO_MOTO,
    APR_DESTINO_DOBLE,
    APR_ANCHURA,
    APR_PROFUNDIDAD,
    APR_FORMA_IRREGULAR
;
    END LOOP;
    CLOSE SEQ_TAB;
    
    
COMMIT;


  
  
  
  
  DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_ACTIVO  : '||UPDATE_ACTIVOS||'');
  
  P_ACT_ACTIVO := 'REGISTROS ACTUALIZADOS EN ACT_ACTIVO  : '||UPDATE_ACTIVOS||'';
  
--DBMS_OUTPUT.PUT_LINE('ACTUALIZADOS EN BIE_LOCALIZACION QUE ESTABAN EN NULL :  '||UPDATE_DATOS_NULL||'');

  TOTAL_BIE_LOCALI := UPDATES_COUNT_ADM + UPDATE_DATOS_NULL;

DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION  : '||TOTAL_BIE_LOCALI||'');

  P_BIE_LOCALIZACION := 'REGISTROS ACTUALIZADOS EN BIE_LOCALIZACION  : '||TOTAL_BIE_LOCALI||'';

          DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_ICO_INFO_COMERCIAL : '||UPDATES_INFO||'');
          
           P_INFOCOMERCIAL_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_ICO_INFO_COMERCIAL : '||UPDATES_INFO||'';
       
        DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_ICO_INFO_COMERCIAL  : '||NUEVOS_COUNT||'');
        
               P_INFOCOMERCIAL_NEW := 'REGISTROS INSERTADOS EN ACT_ICO_INFO_COMERCIAL  : '||NUEVOS_COUNT||'';
              
        
        DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_EDI_EDIFICIO : '||UPDATES_EDIFICIO||'');
        
          P_EDIFICIO_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_EDI_EDIFICIO : '||UPDATES_EDIFICIO||'';
       
        DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_EDI_EDIFICIO  : '||NUEVOS_COUNT||'');
        
           P_EDIFICIO_NEW := 'REGISTROS INSERTADOS EN ACT_EDI_EDIFICIO  : '||NUEVOS_COUNT||'';
        
         DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_VIV_VIVIENDA  : '||UPDATE_VIVIENDAS||'');
         
                  P_VIVIENDA_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_VIV_VIVIENDA  : '||UPDATE_VIVIENDAS||'';
         
          DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_VIV_VIVIENDA  : '||NUEVOS_VIVIENDAS||'');
          
            P_VIVIENDA_NEW := 'REGISTROS INSERTADOS EN ACT_VIV_VIVIENDA  : '||NUEVOS_VIVIENDAS||'';
          
             DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||UPDATE_LOCAL||'');
             
                  P_LOCAL_MODIF := 'REGISTROS ACTUALIZADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||UPDATE_LOCAL||'';
             
             DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||NUEVOS_LOCAL||'');
             
               P_LOCAL_NEW := 'REGISTROS INSERTADOS EN ACT_LCO_LOCAL_COMERCIAL  : '||NUEVOS_LOCAL||'';
             
               DBMS_OUTPUT.PUT_LINE('REGISTROS ACTUALIZADOS EN ACT_APR_PLAZA_APARCAMIENTO  : '||UPDATE_APARCAMIENTO||'');
               
                     P_APARCA_MODIFI := 'REGISTROS ACTUALIZADOS EN ACT_APR_PLAZA_APARCAMIENTO  : '||UPDATE_APARCAMIENTO||'';
               
               DBMS_OUTPUT.PUT_LINE('REGISTROS INSERTADOS EN ACT_APR_PLAZA_APARCAMIENTO : '||NUEVOS_APARCAMIENTO||'');
               
                P_APARCA_NEW := 'REGISTROS INSERTADOS EN ACT_APR_PLAZA_APARCAMIENTO : '||NUEVOS_APARCAMIENTO||'';


 


 EXCEPTION

 WHEN OTHERS THEN
   err_num := SQLCODE;
   err_msg := SQLERRM;

   DBMS_OUTPUT.put_line('Error:'||TO_CHAR(err_num));
   DBMS_OUTPUT.put_line(err_msg);
   P_TEXTO := 'Error:'||TO_CHAR(err_num)||'['||err_msg||']'; 

   ROLLBACK;
   RAISE;


END SP_UPDATE_DATOS_ACTIV_UVEM_REM;

/
