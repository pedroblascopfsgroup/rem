--/*
--##########################################
--## AUTOR=Guillermo Llidó Parra
--## FECHA_CREACION=20180807
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-1495
--## PRODUCTO=NO
--##
--## Finalidad: Crear la tabla APR_AUX_STOCK_COOPER.
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE
    V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar         
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_COUNT NUMBER(16); -- Vble. para contar.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_TABLA VARCHAR2(27 CHAR) := 'APR_AUX_STOCK_COOPER'; -- Vble. auxiliar para almacenar el nombre de la tabla de ref.
	V_USUARIO VARCHAR2(32 CHAR) := 'REMVIP-1495';
    USUARIO_CONSULTA_REM VARCHAR2(50 CHAR):= 'REM_QUERY';
    
 BEGIN
 
	V_SQL := 'SELECT COUNT(1) FROM ALL_SEQUENCES WHERE SEQUENCE_NAME = ''S_'||V_TABLA||''' and SEQUENCE_OWNER = '''||V_ESQUEMA||'''';
	 
	EXECUTE IMMEDIATE V_SQL INTO V_COUNT; 
 
	IF V_COUNT = 0 THEN
	 
		V_SQL := 'CREATE SEQUENCE '||V_ESQUEMA||'.S_'||V_TABLA||'';
		
		EXECUTE IMMEDIATE V_SQL;
			
		DBMS_OUTPUT.PUT_LINE('[INFO] Creada la SECUENCIA S_'||V_TABLA);

	ELSE
		
		DBMS_OUTPUT.PUT_LINE('[INFO] Ya existia la secuencia S_'||V_TABLA);	
	  
	END IF;
 
		V_SQL := 'SELECT COUNT(1) FROM SYS.ALL_TABLES WHERE OWNER = '''||V_ESQUEMA||''' AND TABLE_NAME = '''||V_TABLA||'''';

	EXECUTE IMMEDIATE V_SQL INTO V_COUNT;
		
	IF V_COUNT = 1 THEN
 
		V_SQL := 'DROP TABLE '||V_ESQUEMA||'.'||V_TABLA;
		
		EXECUTE IMMEDIATE V_SQL;

		DBMS_OUTPUT.PUT_LINE('[INFO] Se ha borrado la tabla '||V_TABLA);	
	
	END IF;
	
	V_SQL := 'CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA||' (
					CORTOR VARCHAR2(8 CHAR), 
					CORTOR_DES VARCHAR2(43 CHAR), 
					COACES VARCHAR2(36 CHAR), 
					COENGP VARCHAR2(5 CHAR), 
					COENGP_DES VARCHAR2(17 CHAR), 
					COSPAT VARCHAR2(20 CHAR), 
					COSPAT_DES VARCHAR2(100 CHAR), 
					COTSIN VARCHAR2(4 CHAR), 
					COTSIN_DES VARCHAR2(38 CHAR), 
					NUINMU VARCHAR2(9 CHAR), 
					FEFOAC VARCHAR2(8 CHAR), 
					COENAE VARCHAR2(2 CHAR), 
					COENAE_DES VARCHAR2(100 CHAR), 
					COESEN VARCHAR2(2 CHAR), 
					COESEN_DES VARCHAR2(22 CHAR), 
					COESVE VARCHAR2(2 CHAR), 
					COESVE_DES VARCHAR2(32 CHAR), 
					FEBAJA VARCHAR2(8 CHAR), 
					POPROP NUMBER(6,3), 
					COGRAP VARCHAR2(2 CHAR), 
					COGRAP_DES VARCHAR2(25 CHAR), 
					CONIAP VARCHAR2(2 CHAR), 
					CONIAP_DES VARCHAR2(14 CHAR), 
					COENOR VARCHAR2(5 CHAR), 
					COENOR_DES VARCHAR2(14 CHAR), 
					IDCOEQ VARCHAR2(5 CHAR), 
					XCOEMP VARCHAR2(5 CHAR), 
					COPSER VARCHAR2(5 CHAR), 
					IDPRIG NUMBER(17,0), 
					IDCOEC NUMBER(15,0), 
					COPRDW NUMBER(16,0), 
					FETASA VARCHAR2(8 CHAR), 
					IMVATA VARCHAR2(15 CHAR), 
					COFITA VARCHAR2(5 CHAR), 
					COFITA_DES VARCHAR2(50 CHAR), 
					COMOTA VARCHAR2(2 CHAR), 
					COMOTA_DES VARCHAR2(25 CHAR), 
					IMRESU VARCHAR2(15 CHAR), 
					IMCONS VARCHAR2(15 CHAR), 
					BINECO VARCHAR2(1 CHAR), 
					BINECO_DES VARCHAR2(11 CHAR), 
					FETECO VARCHAR2(8 CHAR), 
					IMVECO NUMBER(15,2), 
					COTECO VARCHAR2(5 CHAR), 
					COTECO_DES VARCHAR2(50 CHAR), 
					CO1ECO VARCHAR2(2 CHAR), 
					CO1ECO_DES VARCHAR2(11 CHAR), 
					COTIRG VARCHAR2(20 CHAR), 
					NUIDOP VARCHAR2(100 CHAR), 
					COSTIT VARCHAR2(20 CHAR), 
					COSTIT_DES VARCHAR2(100 CHAR), 
					COREAE VARCHAR2(5 CHAR), 
					COREAE_DES VARCHAR2(14 CHAR), 
					FEREAI VARCHAR2(8 CHAR), 
					FEPHAC VARCHAR2(8 CHAR), 
					FEPREG VARCHAR2(8 CHAR), 
					FEINAU VARCHAR2(8 CHAR), 
					FEADAC VARCHAR2(8 CHAR), 
					FETIFI VARCHAR2(8 CHAR), 
					BIPOPO VARCHAR2(1 CHAR), 
					BIPOPO_DES VARCHAR2(11 CHAR), 
					BINELA NUMBER(1,0), 
					BINELA_DES VARCHAR2(11 CHAR), 
					FESEPO VARCHAR2(8 CHAR), 
					FEREPO VARCHAR2(8 CHAR), 
					FESELA VARCHAR2(8 CHAR), 
					FERELA VARCHAR2(8 CHAR), 
					CODISC VARCHAR2(2 CHAR), 
					CODISC_DES VARCHAR2(25 CHAR), 
					NULIBE VARCHAR2(24 CHAR), 
					NUTOME VARCHAR2(24 CHAR), 
					NUFOLE VARCHAR2(24 CHAR), 
					NUINSR NUMBER(8,0), 
					COPRDI VARCHAR2(12 CHAR), 
					IMPADJ VARCHAR2(60 CHAR), 
					BINOCU CHAR(1 CHAR), 
					BINOCU_DES VARCHAR2(2 CHAR), 
					FEENAG VARCHAR2(8 CHAR), 
					FEEAAU VARCHAR2(8 CHAR), 
					FESEPR VARCHAR2(8 CHAR), 
					FESUBT VARCHAR2(8 CHAR), 
					CORESB NUMBER(2,0), 
					CORESB_DES VARCHAR2(39 CHAR), 
					FECRES VARCHAR2(8 CHAR), 
					IMVAJU NUMBER(15,2), 
					COSOCU VARCHAR2(2 CHAR), 
					FICOAR DATE, 
					NOARRE VARCHAR2(35 CHAR), 
					BIPOLA VARCHAR2(1 CHAR), 
					BIPOLA_DES VARCHAR2(2 CHAR), 
					FESOLA VARCHAR2(8 CHAR), 
					QAVDAH VARCHAR2(1 CHAR), 
					QAVDAH_DES VARCHAR2(2 CHAR), 
					QANFZP VARCHAR2(1 CHAR), 
					QANFZP_DES VARCHAR2(2 CHAR), 
					QAOCPV VARCHAR2(1 CHAR), 
					QAOCPV_DES VARCHAR2(2 CHAR), 
					QFSLMR VARCHAR2(8 CHAR), 
					QCRSMR VARCHAR2(1 CHAR), 
					QCRSMR_DES VARCHAR2(12 CHAR), 
					QFRSMR VARCHAR2(8 CHAR), 
					FESOPO VARCHAR2(8 CHAR), 
					QAEVPS VARCHAR2(1 CHAR), 
					BIACSI VARCHAR2(1 CHAR), 
					BIACSI_DES VARCHAR2(11 CHAR), 
					FERLL6 VARCHAR2(8 CHAR), 
					FENLLA VARCHAR2(8 CHAR), 
					IMREMA VARCHAR2(15 CHAR), 
					IMVACE VARCHAR2(15 CHAR), 
					COSIAU VARCHAR2(1 CHAR), 
					COSIAU_DES VARCHAR2(15 CHAR), 
					BIEXMU VARCHAR2(1 CHAR), 
					BIEXMU_DES VARCHAR2(11 CHAR), 
					BIDEMU VARCHAR2(1 CHAR), 
					BIDEMU_DES VARCHAR2(11 CHAR), 
					FECESI VARCHAR2(8 CHAR), 
					NORESP VARCHAR2(30 CHAR), 
					CODIJU VARCHAR2(2 CHAR), 
					CODIJU_DES VARCHAR2(52 CHAR), 
					BIREAR VARCHAR2(1 CHAR), 
					BIREAR_DES VARCHAR2(11 CHAR), 
					IDAUTO VARCHAR2(10 CHAR), 
					NOCURA VARCHAR2(40 CHAR), 
					OBRECO VARCHAR2(6 CHAR), 
					NUJUZD NUMBER(2,0), 
					TIJUZD VARCHAR2(3 CHAR), 
					TIJUZD_DES VARCHAR2(38 CHAR), 
					NOLOJZ VARCHAR2(30 CHAR), 
					NOSALA VARCHAR2(20 CHAR), 
					NONOES VARCHAR2(50 CHAR), 
					NUPROT VARCHAR2(8 CHAR), 
					IMDEMA VARCHAR2(15 CHAR), 
					FEDEMA VARCHAR2(8 CHAR), 
					FEREDE VARCHAR2(8 CHAR), 
					COTICO NUMBER(2,0), 
					COTICO_DES VARCHAR2(11 CHAR), 
					COSBIC NUMBER(2,0), 
					COSBIC_DES VARCHAR2(25 CHAR), 
					POICOM NUMBER(5,2), 
					QCIVAC VARCHAR2(3 CHAR), 
					QCIVAC_DES VARCHAR2(60 CHAR), 
					BIREXE VARCHAR2(1 CHAR), 
					BIREXE_DES VARCHAR2(11 CHAR), 
					COTIVI NUMBER(2,0), 
					COTIVI_DES VARCHAR2(12 CHAR), 
					NOVIAS VARCHAR2(60 CHAR), 
					NUPOAC VARCHAR2(17 CHAR), 
					NUESAC VARCHAR2(5 CHAR), 
					NUPIAC VARCHAR2(11 CHAR), 
					NUPUAC VARCHAR2(17 CHAR), 
					COPOIN NUMBER(5,0), 
					COMUIN NUMBER(9,0), 
					COPRAE NUMBER(2,0), 
					NUMFIN VARCHAR2(14 CHAR), 
					NUREGP NUMBER(3,0), 
					COMUIX NUMBER(9,0), 
					COEXCA NUMBER(2,0), 
					COEXCA_DES VARCHAR2(14 CHAR), 
					BIOBNU VARCHAR2(1 CHAR), 
					BIOBNU_DES VARCHAR2(20 CHAR), 
					PORBRA NUMBER(6,3), 
					POPROC NUMBER(6,3), 
					NURCAT VARCHAR2(20 CHAR), 
					BIASIN VARCHAR2(1 CHAR), 
					BIASIN_DES VARCHAR2(11 CHAR), 
					BISILO VARCHAR2(1 CHAR), 
					DESLO2 VARCHAR2(17 CHAR), 
					BISILA VARCHAR2(1 CHAR), 
					DESLA2 VARCHAR2(17 CHAR), 
					CASUTR NUMBER(11,2), 
					CASUTG NUMBER(11,2), 
					CASUTC NUMBER(11,2), 
					CADORM NUMBER(4,0), 
					CABANO NUMBER(4,0), 
					BIGAPA VARCHAR2(1 CHAR), 
					CAGAPA NUMBER(5,0), 
					BIARRE VARCHAR2(1 CHAR), 
					BIARRE_DES VARCHAR2(11 CHAR), 
					BIASCE VARCHAR2(1 CHAR), 
					BIASCE_DES VARCHAR2(11 CHAR), 
					BITRAS VARCHAR2(1 CHAR), 
					BITRAS_DES VARCHAR2(11 CHAR), 
					TIPOVT VARCHAR2(1 CHAR), 
					TIPOVT_DES VARCHAR2(26 CHAR), 
					CANTDE NUMBER(4,0), 
					CORPRO VARCHAR2(2 CHAR), 
					CORPRO_DES VARCHAR2(14 CHAR), 
					FEACON VARCHAR2(4 CHAR), 
					FEREHA VARCHAR2(4 CHAR), 
					FEPORI DATE, 
					IMAPOW NUMBER(15,0), 
					FAFADE VARCHAR2(8 CHAR), 
					FECULV VARCHAR2(8 CHAR), 
					OBTTEX VARCHAR2(110 CHAR), 
					NPROMO VARCHAR2(5 CHAR), 
					FFCOAR VARCHAR2(8 CHAR), 
					APRESH VARCHAR2(1 CHAR), 
					APRESH_DES VARCHAR2(14 CHAR), 
					BIACSU VARCHAR2(1 CHAR), 
					BIACSU_DES VARCHAR2(11 CHAR), 
					GETEIN VARCHAR2(40 CHAR), 
					COEFEN VARCHAR2(1 CHAR), 
					FEEMEE VARCHAR2(8 CHAR), 
					FEFIEE VARCHAR2(8 CHAR), 
					BINAST VARCHAR2(1 CHAR), 
					BINAST_DES VARCHAR2(59 CHAR), 
					BINSMO VARCHAR2(3 CHAR), 
					BINSMO_DES VARCHAR2(15 CHAR), 
					COPUMO NUMBER(2,0), 
					COPUMO_DES VARCHAR2(11 CHAR), 
					NUVISR NUMBER(8,0), 
					NUOFET NUMBER(8,0), 
					FEOFUL DATE, 
					IMOFUC NUMBER(15,2), 
					NUOFDE NUMBER(9,0), 
					IMOFMA NUMBER(15,2), 
					COTSRE VARCHAR2(16 CHAR), 
					COTSRE_DES VARCHAR2(100 CHAR), 
					IMVACO NUMBER(15,2), 
					FEVACO VARCHAR2(8 CHAR), 
					QMREFP NUMBER(15,2), 
					QFRIRP VARCHAR2(8 CHAR), 
					IMALRE VARCHAR2(15 CHAR), 
					IMORAL VARCHAR2(15 CHAR), 
					IMVAPR VARCHAR2(15 CHAR), 
					IMPINE VARCHAR2(15 CHAR), 
					IMVACT NUMBER(15,2), 
					FEVACT VARCHAR2(8 CHAR), 
					OBRTOR VARCHAR2(40 CHAR), 
					COCDIN NUMBER(4,0), 
					IMAREN VARCHAR2(15 CHAR), 
					FEAREN VARCHAR2(8 CHAR), 
					IMPEAW VARCHAR2(15 CHAR), 
					FECEVT VARCHAR2(8 CHAR), 
					IDPROV NUMBER(9,0), 
					CASPRE NUMBER(9,2), 
					CASUCS NUMBER(7,2), 
					CASUCB NUMBER(7,2), 
					IMVLIQ NUMBER(15,2), 
					IMVFSV NUMBER(15,2), 
					COACHA NUMBER(13,0), 
					COSPT1 VARCHAR2(1 CHAR), 
					COSPT1_DES VARCHAR2(40 CHAR), 
					COSJUR NUMBER(2,0), 
					COSJUR_DES VARCHAR2(43 CHAR)  
)';

		EXECUTE IMMEDIATE V_SQL;
 
		DBMS_OUTPUT.PUT_LINE('[INFO] Creada la tabla '||V_TABLA);

COMMIT;
 
EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
