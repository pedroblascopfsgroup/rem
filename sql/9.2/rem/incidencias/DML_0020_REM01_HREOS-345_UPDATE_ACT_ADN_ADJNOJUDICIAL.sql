--/*
--#########################################
--## AUTOR=PABLO MESEGUER
--## FECHA_CREACION=20160429
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=0.1
--## INCIDENCIA_LINK=HREOS-345
--## PRODUCTO=NO
--## 
--## Finalidad: Insertar los datos de ACT_ADN_ADJNOJUDICIAL   
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
----*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
  V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
  V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
  V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
  V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
  V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.      
  ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
  ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.

  TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
  TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
  V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
		-- ACT_PRINEX - FCH_TIT - EEJ - VALOR_ADQUISICION
T_TIPO_DATA('41853','03/11/1983','17','180370.69'),
T_TIPO_DATA('47921','19/01/1988','17','235058.84'),
T_TIPO_DATA('28192','05/04/2000','17','525041.53'),
T_TIPO_DATA('30800','06/02/2007','17','338658.02'),
T_TIPO_DATA('28813','12/02/2002','17','262687.68'),
T_TIPO_DATA('29690','08/11/2004','37','234240.59'),
T_TIPO_DATA('45665','09/06/1989','17','297810.6'),
T_TIPO_DATA('12386','03/07/2001','17','200728.86'),
T_TIPO_DATA('46942','11/06/1982','17','331757.9'),
T_TIPO_DATA('28125','30/10/1982','17','317498.65'),
T_TIPO_DATA('29799','04/06/1999','17','169816.33'),
T_TIPO_DATA('42986','16/09/1999','17','220346.95'),
T_TIPO_DATA('52061','05/06/2008','17','260428.27'),
T_TIPO_DATA('41511','22/12/2005','17','244306.07'),
T_TIPO_DATA('28199','29/10/2004','17','312659.05'),
T_TIPO_DATA('15464','23/03/2012','17','2916143.39'),
T_TIPO_DATA('34337','21/01/1994','17','195178.33'),
T_TIPO_DATA('28124','22/07/1992','17','302559.91'),
T_TIPO_DATA('29798','24/03/1999','17','149566.31'),
T_TIPO_DATA('28121','22/03/2000','17','340180.68'),
T_TIPO_DATA('46012','08/06/2012','17','283755.51'),
T_TIPO_DATA('40354','22/06/2007','17','642151.98'),
T_TIPO_DATA('28120','08/06/2004','17','438691.69'),
T_TIPO_DATA('28291','04/01/2007','17','262221.33'),
T_TIPO_DATA('46017','10/01/2007','17','224771.23'),
T_TIPO_DATA('28341','18/05/2007','17','393447.37'),
T_TIPO_DATA('54158','26/08/2010','17','795240.97'),
T_TIPO_DATA('30802','14/12/2006','17','412467.13'),
T_TIPO_DATA('15471','31/10/1989','17','95212.84'),
T_TIPO_DATA('11819','31/12/1997','17','341830.24'),
T_TIPO_DATA('43039','12/09/2008','17','759949.6'),
T_TIPO_DATA('43040','03/06/2005','17','581705.03'),
T_TIPO_DATA('30788','07/05/1997','24','551069.61'),
T_TIPO_DATA('51541','01/08/2003','24','321541.47'),
T_TIPO_DATA('28187','21/07/1998','17','231323.97'),
T_TIPO_DATA('28193','18/07/2000','17','212337.61'),
T_TIPO_DATA('28198','01/07/2004','17','311469.62'),
T_TIPO_DATA('28202','09/08/2006','17','301213.25'),
T_TIPO_DATA('46943','09/08/2006','17','441136.78'),
T_TIPO_DATA('28715','04/10/1996','17','161486.7'),
T_TIPO_DATA('31330','23/06/1976','17','315822.58'),
T_TIPO_DATA('28119','02/01/1993','17','45348.84'),
T_TIPO_DATA('54151','24/01/2000','17','204434.63'),
T_TIPO_DATA('30804','23/02/1995','17','221665.44'),
T_TIPO_DATA('28127','13/06/1997','17','462581.62'),
T_TIPO_DATA('50556','21/06/2004','17','172258.42'),
T_TIPO_DATA('54154','04/11/2004','17','162620.2'),
T_TIPO_DATA('32845','30/05/2008','18','186187.65'),
T_TIPO_DATA('22741','30/01/2007','18','273226'),
T_TIPO_DATA('32842','30/01/2008','17','395514.99'),
T_TIPO_DATA('12407','25/09/1987','17','21666.74'),
T_TIPO_DATA('28195','04/04/2001','17','337816.25'),
T_TIPO_DATA('44701','03/05/2002','17','139689.96'),
T_TIPO_DATA('2207','14/06/2002','17','368223.85'),
T_TIPO_DATA('28716','29/10/2002','17','284491.76'),
T_TIPO_DATA('1153','15/05/1997','17','321595.93'),
T_TIPO_DATA('1395','31/10/1996','17','200569.76'),
T_TIPO_DATA('28748','29/05/2007','17','520874.11'),
T_TIPO_DATA('32176','04/04/2007','17','419918.52'),
T_TIPO_DATA('28343','29/11/2007','17','522726.52'),
T_TIPO_DATA('29787','22/04/2009','17','583274.91'),
T_TIPO_DATA('31329','18/06/2003','17','157107.75'),
T_TIPO_DATA('28334','02/02/2007','17','243698.47'),
T_TIPO_DATA('20138','04/06/2008','18','625232.45'),
T_TIPO_DATA('67942','08/04/2016','17','71550.74'),
T_TIPO_DATA('22742','08/05/2006','18','335996.52'),
T_TIPO_DATA('67945','14/04/2016','17','8008.3'),
T_TIPO_DATA('67944','14/04/2016','17','122170.78'),
T_TIPO_DATA('11347','11/04/1989','17','30292.84'),
T_TIPO_DATA('25977','14/12/2010','17','193675.63'),
T_TIPO_DATA('43885','23/01/2001','17','382422.97'),
T_TIPO_DATA('28293','27/12/2006','17','482618.06'),
T_TIPO_DATA('67946','14/04/2016','17','177057.76'),
T_TIPO_DATA('67938','06/04/2016','17','98181.09'),
T_TIPO_DATA('67941','07/04/2016','17','60840'),
T_TIPO_DATA('67398','21/03/2016','17','63700'),
T_TIPO_DATA('67485','23/03/2016','17','131240'),
T_TIPO_DATA('6829','31/12/1983','17','92785.85'),
T_TIPO_DATA('15452','25/01/2000','17','559081.28'),
T_TIPO_DATA('44694','06/11/2002','17','219075'),
T_TIPO_DATA('1087','27/02/2001','17','136684.73'),
T_TIPO_DATA('6832','31/10/1995','17','146507.76'),
T_TIPO_DATA('44705','03/12/2004','17','23495.44'),
T_TIPO_DATA('1135','04/02/2000','17','162420.38'),
T_TIPO_DATA('44526','11/08/2004','16','271275.33'),
T_TIPO_DATA('11814','31/12/1993','17','118086.14'),
T_TIPO_DATA('15470','31/01/2011','17','78031.48'),
T_TIPO_DATA('40356','23/03/2000','17','182432.26'),
T_TIPO_DATA('1616','12/02/2004','17','259654.11'),
T_TIPO_DATA('6803','30/09/2002','17','693675.7'),
T_TIPO_DATA('44703','24/07/2008','17','268423.68'),
T_TIPO_DATA('28753','24/04/1996','17','240597.71'),
T_TIPO_DATA('28814','09/05/2002','17','174596.38'),
T_TIPO_DATA('29803','09/12/1988','17','195351.97'),
T_TIPO_DATA('44704','12/02/1999','17','219737.71'),
T_TIPO_DATA('30805','11/07/1997','17','200167.73'),
T_TIPO_DATA('28123','09/07/1991','17','214385.72'),
T_TIPO_DATA('28126','13/12/1995','17','235566.22'),
T_TIPO_DATA('27749','10/06/1998','17','134210.11'),
T_TIPO_DATA('42987','10/04/2001','17','176544.42'),
T_TIPO_DATA('40896','12/04/2002','17','75748.52'),
T_TIPO_DATA('40359','01/10/2004','17','315611.01'),
T_TIPO_DATA('41854','17/07/2006','17','373825.86'),
T_TIPO_DATA('32846','09/06/2008','17','217980.62'),
T_TIPO_DATA('67943','13/04/2016','17','48708'),
T_TIPO_DATA('40885','22/12/2006','34','144544.9'),
T_TIPO_DATA('43887','09/06/2006','17','256516.41'),
T_TIPO_DATA('43884','23/12/2005','17','485975.65'),
T_TIPO_DATA('41855','22/05/2008','17','397637.99'),
T_TIPO_DATA('41512','30/12/1992','17','198001.29'),
T_TIPO_DATA('28194','15/01/2004','17','447756.12'),
T_TIPO_DATA('15450','12/07/2006','17','963996.32'),
T_TIPO_DATA('28756','03/03/1998','17','341187.28'),
T_TIPO_DATA('28130','06/05/1999','17','267435'),
T_TIPO_DATA('40357','24/03/2003','17','321235.09'),
T_TIPO_DATA('43882','22/05/2003','17','1104940.32'),
T_TIPO_DATA('29800','12/05/2004','17','385103.24'),
T_TIPO_DATA('44381','20/03/2014','17','94717.91'),
T_TIPO_DATA('43886','08/06/2007','17','474257.46'),
T_TIPO_DATA('34339','04/09/2009','17','366701.3'),
T_TIPO_DATA('43881','03/07/2009','17','146809.11'),
T_TIPO_DATA('28128','26/05/1997','17','180271.56'),
T_TIPO_DATA('28196','26/05/2000','17','296512.4'),
T_TIPO_DATA('4916','31/12/1981','17','139008.93'),
T_TIPO_DATA('8572','31/12/1983','17','299849.32'),
T_TIPO_DATA('11718','12/11/1998','17','347777.54'),
T_TIPO_DATA('11344','10/09/1998','17','308432.63'),
T_TIPO_DATA('3814','13/02/1997','17','280767.54'),
T_TIPO_DATA('8561','04/03/2008','17','2546775.96'),
T_TIPO_DATA('28755','20/02/1998','17','351744.3'),
T_TIPO_DATA('28294','29/12/2006','17','781449.29'),
T_TIPO_DATA('34336','11/05/2007','17','334465.15'),
T_TIPO_DATA('15457','13/09/2011','17','240000'),
T_TIPO_DATA('15449','22/03/2012','17','343281.59'),
T_TIPO_DATA('28757','02/03/1995','17','194300.81'),
T_TIPO_DATA('40895','08/05/1979','17','48462.49'),
T_TIPO_DATA('28340','08/02/2007','17','562794.39'),
T_TIPO_DATA('40346','30/12/1997','17','224304.76'),
T_TIPO_DATA('40350','09/06/2006','17','632780.66'),
T_TIPO_DATA('8562','31/03/2008','17','1616705.11'),
T_TIPO_DATA('20626','21/07/2011','18','248180.11'),
T_TIPO_DATA('31327','27/09/2006','17','474890.18'),
T_TIPO_DATA('31260','28/03/2001','17','289025.97'),
T_TIPO_DATA('13353','30/06/1987','17','30601.55'),
T_TIPO_DATA('28743','01/07/1986','15','11152.78'),
T_TIPO_DATA('32263','05/08/2005','15','292786.29'),
T_TIPO_DATA('22739','28/07/2005','18','333779.73'),
T_TIPO_DATA('22735','21/08/2007','18','343053.02'),
T_TIPO_DATA('1042','20/09/2001','17','358376.67'),
T_TIPO_DATA('13701','22/06/2009','17','288365.46'),
T_TIPO_DATA('2416','08/06/2005','17','287990.28'),
T_TIPO_DATA('40353','08/06/2005','17','316784.92'),
T_TIPO_DATA('15463','22/05/2002','17','15096.62'),
T_TIPO_DATA('2208','15/10/1998','17','210681.09'),
T_TIPO_DATA('40355','18/05/2010','17','279284.02'),
T_TIPO_DATA('8563','25/03/1996','17','251367.7'),
T_TIPO_DATA('46026','14/12/1995','17','363996.86'),
T_TIPO_DATA('13823','26/03/2007','17','481084.21'),
T_TIPO_DATA('30797','15/05/1997','17','225763.93'),
T_TIPO_DATA('11818','11/06/1998','17','211844.8'),
T_TIPO_DATA('33707','20/12/2006','17','595505.73'),
T_TIPO_DATA('29804','10/09/1997','17','290007.16'),
T_TIPO_DATA('25971','08/10/2002','17','268831.5'),
T_TIPO_DATA('40351','28/12/2004','17','608559.13'),
T_TIPO_DATA('15465','23/03/2012','17','1408883.19'),
T_TIPO_DATA('30795','25/09/1990','17','118680.91'),
T_TIPO_DATA('12403','09/02/1996','17','467256.51'),
T_TIPO_DATA('42988','15/07/2002','17','136153.36'),
T_TIPO_DATA('46018','10/04/2008','17','221116.04'),
T_TIPO_DATA('42981','09/04/1990','15','40346.79'),
T_TIPO_DATA('64236','02/02/1996','15','20915.22'),
T_TIPO_DATA('2271','10/07/2006','17','578677.32'),
T_TIPO_DATA('15469','29/10/2008','17','115478.71'),
T_TIPO_DATA('43036','31/12/2013','17','175000'),
T_TIPO_DATA('28750','11/04/2008','17','325583.74'),
T_TIPO_DATA('27709','31/12/2012','16','480193.11'),
T_TIPO_DATA('22632','29/05/2009','17','378511.53'),
T_TIPO_DATA('22633','29/05/2009','17','447295.21'),
T_TIPO_DATA('31328','13/03/2002','17','316964.87'),
T_TIPO_DATA('43883','14/04/2005','17','203603.29'),
T_TIPO_DATA('67212',null,'21','225559.4'),
T_TIPO_DATA('46022','28/06/2000','24','311638.36'),
T_TIPO_DATA('40347','03/12/1998','17','150237.9'),
T_TIPO_DATA('29796','30/11/1995','17','367785.54'),
T_TIPO_DATA('1136','18/08/2008','17','518116.35'),
T_TIPO_DATA('46027','22/02/2001','17','102520.07'),
T_TIPO_DATA('27762','27/10/1982','17','57381.55'),
T_TIPO_DATA('45666','02/11/2005','17','387926.23'),
T_TIPO_DATA('25967','07/01/1980','17','153776.73'),
T_TIPO_DATA('11813','13/02/1998','17','147404.37'),
T_TIPO_DATA('65384','18/06/2000','17','366659.5'),
T_TIPO_DATA('1080','17/06/1997','17','144543.15'),
T_TIPO_DATA('6894','05/04/1999','17','401148.43'),
T_TIPO_DATA('33158','28/02/2007','17','401498.37'),
T_TIPO_DATA('32844','04/03/2009','17','383188.26'),
T_TIPO_DATA('28759','22/03/2007','17','591837.98'),
T_TIPO_DATA('2488','28/06/1991','17','148602.46'),
T_TIPO_DATA('32847','19/02/2002','17','336399.55'),
T_TIPO_DATA('51540','18/02/2003','24','349981.37'),
T_TIPO_DATA('51538','19/12/2006','24','307039.1'),
T_TIPO_DATA('31332','13/04/2007','17','543530'),
T_TIPO_DATA('40894','29/12/1981','17','130314.82'),
T_TIPO_DATA('22942','23/01/2007','26','191670.04'),
T_TIPO_DATA('57528','06/06/1997','28','92818.5'),
T_TIPO_DATA('32848','11/01/2000','17','51769.86'),
T_TIPO_DATA('30801','13/04/2007','17','288592'),
T_TIPO_DATA('22761','05/04/2001','18','73773.52'),
T_TIPO_DATA('13354','28/09/1990','17','198878.27'),
T_TIPO_DATA('9480','18/03/1999','17','170052.63'),
T_TIPO_DATA('28760','05/04/2001','17','136953.79'),
T_TIPO_DATA('52051','11/02/1966','17','364906.77'),
T_TIPO_DATA('6565','19/04/2010','17','569691.55'),
T_TIPO_DATA('30793','17/12/2008','17','599817.95'),
T_TIPO_DATA('30794','23/11/2007','17','1176185'),
T_TIPO_DATA('20746','03/06/2005','18','203891.29'),
T_TIPO_DATA('22762','05/04/2001','18','99277.58'),
T_TIPO_DATA('40352','15/11/2005','17','610667.74'),
T_TIPO_DATA('33155','28/02/2006','17','485858.63'),
T_TIPO_DATA('1041','07/09/2000','17','186441.92'),
T_TIPO_DATA('27750','14/04/1981','17','54916.38'),
T_TIPO_DATA('31331','01/12/1998','17','256993.24'),
T_TIPO_DATA('31262','27/09/2002','17','187858.37'),
T_TIPO_DATA('28122','27/04/1988','17','27424.63'),
T_TIPO_DATA('28758','03/01/2001','17','251592.09'),
T_TIPO_DATA('56005','06/02/2007','15','175211.28'),
T_TIPO_DATA('22740','27/05/2005','18','458333.71'),
T_TIPO_DATA('15466','23/03/2012','17','2263940.27'),
T_TIPO_DATA('29731','24/09/2010','20','1980775.96'),
T_TIPO_DATA('8451','21/07/2006','17','532207.51'),
T_TIPO_DATA('11817','18/03/1998','17','125826.47'),
T_TIPO_DATA('47475','25/04/2001','17','300850.59'),
T_TIPO_DATA('28749','17/12/2007','17','446350.43'),
T_TIPO_DATA('40515','04/12/2007','17','516206.98'),
T_TIPO_DATA('1194','31/08/1971','17','345090.76'),
T_TIPO_DATA('11346','22/12/2005','17','661569.21'),
T_TIPO_DATA('52052','02/12/1998','17','118435.8'),
T_TIPO_DATA('44702','19/11/2001','17','80742.33'),
T_TIPO_DATA('40075','22/09/2004','17','365118.35'),
T_TIPO_DATA('29692','11/04/2005','37','281037.1'),
T_TIPO_DATA('20876','27/03/2003','18','339335.76'),
T_TIPO_DATA('51578','03/07/1989','24','254864.98'),
T_TIPO_DATA('52063','02/03/2000','28','92890.11'),
T_TIPO_DATA('48522','10/09/2013','24','284757.96'),
T_TIPO_DATA('22941','22/02/2001','25','457732.03'),
T_TIPO_DATA('30803','10/07/2009','17','588906.94'),
T_TIPO_DATA('28751','13/11/2002','17','398407.85'),
T_TIPO_DATA('22743','19/12/2007','18','437832.2'),
T_TIPO_DATA('39549','25/06/1987','17','61117.61'),
T_TIPO_DATA('20132','17/11/2006','18','462482.12'),
T_TIPO_DATA('20139','28/01/1999','18','171766.21'),
T_TIPO_DATA('22744','07/02/2005','18','522026.62'),
T_TIPO_DATA('44375','01/10/2010','17','236539.05'),
T_TIPO_DATA('28754','14/02/2001','17','304160.88'),
T_TIPO_DATA('40897','10/11/1981','17','19761.92'),
T_TIPO_DATA('28129','31/12/1993','17','314722.71'),
T_TIPO_DATA('34338','07/02/1996','17','264939.01'),
T_TIPO_DATA('32843','22/02/2010','17','502136.29'),
T_TIPO_DATA('40902','12/04/2002','17','63170.32'),
T_TIPO_DATA('44376','02/02/2005','17','247078.94')

  ); 
  V_TMP_TIPO_DATA T_TIPO_DATA;
  
BEGIN

   DBMS_OUTPUT.PUT_LINE('[INFO] INICIO DEL PROCESO, DE INSERCION DE NUEVOS REGISTROS EN ACT_ADN_ADJNOJUDICIAL');
   
   V_SQL := '
   ALTER SESSION SET NLS_DATE_FORMAT = ''DD/MM/RR''
   '
   ;
   
   EXECUTE IMMEDIATE V_SQL;
   
   FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
     LOOP
    
       V_TMP_TIPO_DATA := V_TIPO_DATA(I);
       	
       --COMPROBAMOS AL EXISTENCIA DEL ACTIVO MEDIANTE EL ACT_NUM_ACTIVO_PRINEX EN ACT_ACTIVO
       
       V_SQL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT 
       WHERE ACT_NUM_ACTIVO_PRINEX = '||V_TMP_TIPO_DATA(1)||'';
       EXECUTE IMMEDIATE V_SQL INTO V_NUM_TABLAS;
       
       --SI EXISTE, ACTUALIZAMOS SU TIPO Y SUBTIPO DE TITULO EN ACT_ACTIVO 
       IF V_NUM_TABLAS > 0 THEN		         
			                                        
          V_SQL := '
		  MERGE INTO '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL ADN
		  USING
		  (
		  SELECT ACT.ACT_ID AS ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT
		  WHERE ACT.ACT_NUM_ACTIVO_PRINEX = '||V_TMP_TIPO_DATA(1)||'
		  ) TMP
		  ON (ADN.ACT_ID = TMP.ACT_ID)      
		  WHEN MATCHED THEN UPDATE 
		  SET 
		  DD_EEJ_ID = (SELECT DD_EEJ_ID FROM '||V_ESQUEMA||'.DD_EEJ_ENTIDAD_EJECUTANTE EEJ WHERE EEJ.DD_EEJ_CODIGO = '||V_TMP_TIPO_DATA(3)||') ,
		  ADN_FECHA_TITULO = '''||(V_TMP_TIPO_DATA(2))||''',  
		  ADN_FECHA_FIRMA_TITULO = NULL,
		  ADN_VALOR_ADQUISICION = '''||V_TMP_TIPO_DATA(4)||''',
		  ADN_TRAMITADOR_TITULO = NULL,
		  ADN_NUM_REFERENCIA = NULL,
		  USUARIOMODIFICAR = ''HREOS-345'',
		  FECHAMODIFICAR = SYSDATE
		  WHEN NOT MATCHED THEN INSERT
		  (ADN_ID,
		  ACT_ID,
		  DD_EEJ_ID,
		  ADN_FECHA_TITULO,
		  ADN_FECHA_FIRMA_TITULO,
		  ADN_VALOR_ADQUISICION,
		  ADN_TRAMITADOR_TITULO,
		  ADN_NUM_REFERENCIA,
		  USUARIOCREAR,
		  FECHACREAR)
		  VALUES
		  ('||V_ESQUEMA||'.S_ACT_ADN_ADJNOJUDICIAL.NEXTVAL,
		  (SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT
		  WHERE ACT.ACT_NUM_ACTIVO_PRINEX = '||V_TMP_TIPO_DATA(1)||'),                                        
		  (SELECT DD_EEJ_ID FROM '||V_ESQUEMA||'.DD_EEJ_ENTIDAD_EJECUTANTE EEJ
		  WHERE EEJ.DD_EEJ_CODIGO = '||V_TMP_TIPO_DATA(3)||'),                                                   
		  '''||(V_TMP_TIPO_DATA(2))||''',                                                                  
		  NULL,                                                                              
		  '''||V_TMP_TIPO_DATA(4)||''',                                                                               
		  NULL,                                                                              
		  NULL,                                                                                    
		  ''HREOS-345'',                                                                                    
		  SYSDATE)
          '
          ;
                            
          EXECUTE IMMEDIATE V_SQL;                  
          
       ELSE
       
                DBMS_OUTPUT.PUT_LINE('[INFO] EL ACTIVO DE PRINEX INFORMADO '||V_TMP_TIPO_DATA(1)||' NO EXISTE EN ACT_ACTIVO');
                
       END IF; 
      
    END LOOP;
    
    COMMIT;
  
    EXECUTE IMMEDIATE('ANALYZE TABLE '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL COMPUTE STATISTICS');
  
    DBMS_OUTPUT.PUT_LINE('[INFO] '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL ANALIZADA.');
      
    DBMS_OUTPUT.PUT_LINE('[FIN] LA TABLA ACT_ADN_ADJNOJUDICIAL SE HA ACTUALIZADO CORRECTAMENTE');
 
 
EXCEPTION

   WHEN OTHERS THEN
        err_num := SQLCODE;
        err_msg := SQLERRM;

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);

        ROLLBACK;
        RAISE;          

END;

/

EXIT
