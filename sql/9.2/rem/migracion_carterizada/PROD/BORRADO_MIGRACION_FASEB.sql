--/*
--#########################################
--## AUTOR=DAP
--## FECHA_CREACION=20170614
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=0.1
--## INCIDENCIA_LINK=HREOS-2273
--## PRODUCTO=NO
--## 
--## Finalidad: Proceso de migración 'MIG_ACA_CATASTRO_ACTIVO' -> 'ACT_CAT_CATASTRO'
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE

	TABLE_COUNT NUMBER(3);
	EXISTE    NUMBER;
	V_SQL VARCHAR2(4000 CHAR);
	V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01';

	ERR_NUM NUMBER(25);  
	ERR_MSG VARCHAR2(1024 CHAR);     
	TYPE T_TABLAS IS TABLE OF VARCHAR2(150);      
	TYPE T_ARRAY_TABLAS IS TABLE OF T_TABLAS;          
	V_TEMP_TABLAS  T_TABLAS;
	V_NUMBER    NUMBER;    

	V_TABLA T_ARRAY_TABLAS := T_ARRAY_TABLAS(
		T_TABLAS('REM01','CLC_CLIENTE_COMERCIAL'),
		T_TABLAS('REM01','VIS_VISITAS'), 
		T_TABLAS('REM01','OFR_OFERTAS'),
		T_TABLAS('REM01','ECO_EXPEDIENTE_COMERCIAL'),		
		T_TABLAS('REM01','ACT_OFR'),
		T_TABLAS('REM01','COE_CONDICIONANTES_EXPEDIENTE'),
		T_TABLAS('REM01','RES_RESERVAS'),
		T_TABLAS('REM01','OFR_TIA_TITULARES_ADICIONALES'),
		T_TABLAS('REM01','COM_COMPRADOR'),
		T_TABLAS('REM01','CEX_COMPRADOR_EXPEDIENTE'),
		T_TABLAS('REM01','GEX_GASTOS_EXPEDIENTE'),
		T_TABLAS('REM01','TXO_TEXTOS_OFERTA'),
		T_TABLAS('REM01','FOR_FORMALIZACION'),
		T_TABLAS('REM01','POS_POSICIONAMIENTO'),
		T_TABLAS('REM01','SUB_SUBSANACIONES'),
		T_TABLAS('REM01','ACT_HEP_HIST_EST_PUBLICACION'),
		T_TABLAS('REM01','ACT_COE_CONDICION_ESPECIFICA'),
		T_TABLAS('REM01','ACT_HVA_HIST_VALORACIONES'),
		T_TABLAS('REM01','PRP_PROPUESTAS_PRECIOS'),		
		T_TABLAS('REM01','ACT_PRP'),
		T_TABLAS('REM01','GPV_GASTOS_PROVEEDOR'),
		T_TABLAS('REM01','GPV_ACT'),
		T_TABLAS('REM01','GPV_TBJ'),
		T_TABLAS('REM01','GDE_GASTOS_DETALLE_ECONOMICO'),		
		T_TABLAS('REM01','GGE_GASTOS_GESTION'),
		T_TABLAS('REM01','GIM_GASTOS_IMPUGNACION'),		
		T_TABLAS('REM01','GIC_GASTOS_INFO_CONTABILIDAD'),
		T_TABLAS('REM01','PRG_PROVISION_GASTOS'),
		T_TABLAS('REM01','ACT_PAC_PERIMETRO_ACTIVO'),
		T_TABLAS('REM01','ACT_HAL_HIST_ALQUILERES'),
		T_TABLAS('REM01','ACT_ACTIVO'),		
		T_TABLAS('REM01','ACT_AGR_AGRUPACION'),
		T_TABLAS('REM01','ACT_PAC_PROPIETARIO_ACTIVO'),		
		T_TABLAS('REM01','ACT_TBJ'),
		T_TABLAS('REM01','ACT_TBJ_TRABAJO'),
		T_TABLAS('REM01','ACT_TRA_TRAMITE'),
		T_TABLAS('REM01','TAR_TAREAS_NOTIFICACIONES'),
		T_TABLAS('REM01','ETN_EXTAREAS_NOTIFICACIONES'),
		T_TABLAS('REM01','TEX_TAREA_EXTERNA'),
		T_TABLAS('REM01','TAC_TAREAS_ACTIVOS'),
		T_TABLAS('REM01','GCO_GESTOR_ADD_ECO'),
		T_TABLAS('REM01','GCH_GESTOR_ECO_HISTORICO'),
		T_TABLAS('REM01','ACT_ADM_INF_ADMINISTRATIVA'),
	    T_TABLAS('REM01','ACT_ADN_ADJNOJUDICIAL'),
	    T_TABLAS('REM01','ACT_AGO_AGRUPACION_OBS'),
	    T_TABLAS('REM01','ACT_AJD_ADJJUDICIAL'),
	    T_TABLAS('REM01','ACT_BNY_BANYO'),
	    T_TABLAS('REM01','ACT_CAT_CATASTRO'),
	    T_TABLAS('REM01','ACT_COC_COCINA'),
	    T_TABLAS('REM01','ACT_CPR_COM_PROPIETARIOS'),
	    T_TABLAS('REM01','ACT_CRE_CARPINTERIA_EXT'),
	    T_TABLAS('REM01','ACT_CRG_CARGAS'),
	    T_TABLAS('REM01','ACT_CRI_CARPINTERIA_INT'),
	    T_TABLAS('REM01','ACT_DIS_DISTRIBUCION'),
	    T_TABLAS('REM01','ACT_EDI_EDIFICIO'),
	    T_TABLAS('REM01','ACT_INF_INFRAESTRUCTURA'),
	    T_TABLAS('REM01','ACT_INS_INSTALACION'),
	    T_TABLAS('REM01','ACT_LLV_LLAVE'),
	    T_TABLAS('REM01','ACT_LOC_LOCALIZACION'),
	    T_TABLAS('REM01','ACT_MLV_MOVIMIENTO_LLAVE'),
	    T_TABLAS('REM01','ACT_PDV_PLAN_DIN_VENTAS'),
	    T_TABLAS('REM01','ACT_PRO_PROPIETARIO'),
	    T_TABLAS('REM01','ACT_PRT_PRESUPUESTO_TRABAJO'),
	    T_TABLAS('REM01','ACT_PRV_PARAMENTO_VERTICAL'),
	    T_TABLAS('REM01','ACT_PVC_PROVEEDOR_CONTACTO'),
	    T_TABLAS('REM01','ACT_PAC_PROPIETARIO_ACTIVO'),
	    T_TABLAS('REM01','ACT_ETP_ENTIDAD_PROVEEDOR ETP'),
	    T_TABLAS('REM01','ACT_PVE_PROVEEDOR'),
	    T_TABLAS('REM01','ACT_REG_INFO_REGISTRAL'),
	    T_TABLAS('REM01','ACT_ONV_OBRA_NUEVA ONV'),
	    T_TABLAS('REM01','ACT_RES_RESTRINGIDA RES'),
	    T_TABLAS('REM01','ACT_AGA_AGRUPACION_ACTIVO'),
	    T_TABLAS('REM01','ACT_SDV_SUBDIVISION_ACTIVO'),
	    T_TABLAS('REM01','ACT_SOL_SOLADO'),
	    T_TABLAS('REM01','ACT_SPS_SIT_POSESORIA'),
	    T_TABLAS('REM01','ACT_PRD_PROVEEDOR_DIRECCION'),
	    T_TABLAS('REM01','ACT_TAS_TASACION'),
	    T_TABLAS('REM01','ACT_TBJ TBJ'),
	    T_TABLAS('REM01','ACT_TBJ_TRABAJO'),
	    T_TABLAS('REM01','ACT_TIT_TITULO'),
	    T_TABLAS('REM01','ACT_VAL_VALORACIONES'),
	    T_TABLAS('REM01','ACT_LCO_LOCAL_COMERCIAL'),
	    T_TABLAS('REM01','ACT_APR_PLAZA_APARCAMIENTO'),
	    T_TABLAS('REM01','ACT_VIV_VIVIENDA VIV'),
	    T_TABLAS('REM01','ACT_ZCO_ZONA_COMUN'),
	    T_TABLAS('REM01','ACT_ICO_INFO_COMERCIAL'),
	    T_TABLAS('REM01','BIE_ADJ_ADJUDICACION'),
	    T_TABLAS('REM01','lob_lote_bien'),
	    T_TABLAS('REM01','BIE_CAR_CARGAS'),
	    T_TABLAS('REM01','BIE_DATOS_REGISTRALES'),
	    T_TABLAS('REM01','BIE_LOCALIZACION'),
	    T_TABLAS('REM01','BIE_VALORACIONES'),
	    T_TABLAS('REM01','ACT_GES_DISTRIBUCION'),
	    T_TABLAS('REM01','ACT_ADA_ADJUNTO_ACTIVO'),
	    T_TABLAS('REM01','GEE_GESTOR_ENTIDAD'),
	    T_TABLAS('REM01','GEH_GESTOR_ENTIDAD_HIST'),
	    T_TABLAS('REM01','BIE_BIEN'),
	    T_TABLAS('REM01','bie_adicional'),
	    T_TABLAS('REM01','bie_anc_analisis_contratos'),
	    T_TABLAS('REM01','bie_bien_entidad'),
	    T_TABLAS('REM01','bie_sui_subasta_instrucciones'),
	    T_TABLAS('REM01','emp_nmbembargos_procedimientos'),
	    T_TABLAS('REM01','GAH_GESTOR_ACTIVO_HISTORICO'),
	    T_TABLAS('REM01','GAC_GESTOR_ADD_ACTIVO'),
	    T_TABLAS('REM01','ACT_ACTIVO'),
	    T_TABLAS('REM01','ACT_LCO_LOTE_COMERCIAL'),
	    T_TABLAS('REM01','ACT_ABA_ACTIVO_BANCARIO'),
	    T_TABLAS('REM01','ACT_ADO_ADMISION_DOCUMENTO')
	);

BEGIN
 
  DBMS_OUTPUT.PUT_LINE('********************' );
  DBMS_OUTPUT.PUT_LINE('**DESACTIVAMOS RESTRICCIONES CLAVE AJENA**' );
  DBMS_OUTPUT.PUT_LINE('********************' );
  
  FOR I IN V_TABLA.FIRST .. V_TABLA.LAST
  LOOP
     BEGIN
       V_TEMP_TABLAS := V_TABLA(I);
       
       FOR J IN (SELECT TABLE_NAME, CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE CONSTRAINT_TYPE='R' AND STATUS='ENABLED' AND TABLE_NAME = V_TEMP_TABLAS(2))
       LOOP
           BEGIN
               
                  DBMS_OUTPUT.PUT_LINE('Desactivando : '|| J.table_name ||'.'|| J.constraint_name );    
                  EXECUTE IMMEDIATE 'ALTER TABLE ' || J.TABLE_NAME || ' DISABLE CONSTRAINT ' || J.CONSTRAINT_NAME;        
           END;    
       END LOOP;    
       
    EXCEPTION WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('ERROR al desactivar la constraint ' || TO_CHAR(SQLCODE) || ' ' || SQLERRM );
    END;
  END LOOP;
  COMMIT;   
 
  DBMS_OUTPUT.PUT_LINE('********************' );
  DBMS_OUTPUT.PUT_LINE('**DESACTIVAMOS RESTRICCIONES CLAVE PRIMARIA**' );
  DBMS_OUTPUT.PUT_LINE('********************' );
  
  FOR I IN V_TABLA.FIRST .. V_TABLA.LAST
  LOOP
     BEGIN
       V_TEMP_TABLAS := V_TABLA(I);
       
       FOR J IN (SELECT TABLE_NAME, CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE CONSTRAINT_TYPE='P' AND STATUS='ENABLED' AND TABLE_NAME = V_TEMP_TABLAS(2))
       LOOP
           BEGIN
               
                  DBMS_OUTPUT.PUT_LINE('Desactivando : '|| J.table_name ||'.'|| J.constraint_name );    
                  EXECUTE IMMEDIATE 'ALTER TABLE ' || J.TABLE_NAME || ' DISABLE CONSTRAINT ' || J.CONSTRAINT_NAME || ' CASCADE ';        
           END;    
       END LOOP;    
       
    EXCEPTION WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('ERROR al desactivar la constraint ' || TO_CHAR(SQLCODE) || ' ' || SQLERRM );
    END;
  END LOOP;
  COMMIT;   
 
    /*BORRADO*/
    DELETE FROM REM01.ACT_ACTIVO ACT WHERE ACT.USUARIOCREAR = '#USUARIO_MIGRACION#'; 
    UPDATE REM01.ACT_ACTIVO ACT SET
       ACT.ACT_BLOQUEO_PRECIO_FECHA_INI = NULL
      ,ACT.ACT_BLOQUEO_PRECIO_USU_ID = NULL
      ,ACT.DD_TPU_ID = NULL
      ,ACT.DD_EPU_ID = NULL
      ,ACT.DD_TCO_ID = NULL
      ,ACT.ACT_FECHA_IND_PRECIAR = NULL
      ,ACT.ACT_FECHA_IND_REPRECIAR = NULL
      ,ACT.ACT_FECHA_IND_DESCUENTO = NULL
      ,ACT.USUARIOMODIFICAR = NULL
      ,ACT.FECHAMODIFICAR = NULL
    WHERE ACT.USUARIOMODIFICAR = '#USUARIO_MIGRACION#';       
          	
    UPDATE REM01.ACT_AGR_AGRUPACION AGR
       SET
		   AGR.DD_TAG_ID = NULL
		  ,AGR.AGR_PUBLICADO = 0
		  ,AGR.USUARIOMODIFICAR = NULL
		  ,AGR.FECHAMODIFICAR = NULL
    WHERE AGR.USUARIOMODIFICAR = '#USUARIO_MIGRACION#';	
	
	COMMIT;
	DELETE FROM ACT_PAC_PERIMETRO_ACTIVO WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM PRG_PROVISION_GASTOS WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	--DELETE FROM GIC_GASTOS_INFO_CONTABILIDAD WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	--DELETE FROM GIM_GASTOS_IMPUGNACION WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GIC_GASTOS_INFO_CONTABILIDAD');
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GIM_GASTOS_IMPUGNACION');
	COMMIT;
	--DELETE FROM GGE_GASTOS_GESTION WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	--DELETE FROM GDE_GASTOS_DETALLE_ECONOMICO WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	--DELETE FROM GPV_TBJ GT WHERE EXISTS (SELECT 1 FROM GPV_GASTOS_PROVEEDOR GPV WHERE GPV.GPV_ID = GT.GPV_ID AND USUARIOCREAR = '#USUARIO_MIGRACION#');
	--DELETE FROM GPV_ACT GA WHERE EXISTS (SELECT 1 FROM GPV_GASTOS_PROVEEDOR GPV WHERE GPV.GPV_ID = GA.GPV_ID AND USUARIOCREAR = '#USUARIO_MIGRACION#');
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GGE_GASTOS_GESTION');
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GDE_GASTOS_DETALLE_ECONOMICO');
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GPV_TBJ');
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GPV_ACT');
	COMMIT;
	--DELETE FROM GPV_GASTOS_PROVEEDOR WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GPV_GASTOS_PROVEEDOR');
	COMMIT;
	DELETE FROM ACT_PRP AP WHERE EXISTS (SELECT 1 FROM PRP_PROPUESTAS_PRECIOS PRP WHERE PRP.PRP_ID = AP.PRP_ID AND USUARIOCREAR = '#USUARIO_MIGRACION#');
	DELETE FROM PRP_PROPUESTAS_PRECIOS WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM ACT_HVA_HIST_VALORACIONES WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM ACT_COE_CONDICION_ESPECIFICA WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM ACT_HEP_HIST_EST_PUBLICACION WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	COMMIT;
	DELETE FROM SUB_SUBSANACIONES WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM POS_POSICIONAMIENTO WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM FOR_FORMALIZACION WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM TXO_TEXTOS_OFERTA WHERE USUARIOCREAR = '#USUARIO_MIGRACION#'; 
	COMMIT;
	DELETE FROM GEX_GASTOS_EXPEDIENTE WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM CEX_COMPRADOR_EXPEDIENTE CEX WHERE EXISTS (SELECT 1 FROM COM_COMPRADOR COM WHERE COM.COM_ID = CEX.COM_ID AND USUARIOCREAR = '#USUARIO_MIGRACION#');
	DELETE FROM COM_COMPRADOR WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM OFR_TIA_TITULARES_ADICIONALES WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	COMMIT;
	DELETE FROM ACT_HAL_HIST_ALQUILERES WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM RES_RESERVAS WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM COE_CONDICIONANTES_EXPEDIENTE WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM ACT_OFR AO WHERE EXISTS (SELECT 1 FROM OFR_OFERTAS OFR WHERE OFR.OFR_ID = AO.OFR_ID AND USUARIOCREAR = '#USUARIO_MIGRACION#');
	COMMIT;
	DELETE FROM ECO_EXPEDIENTE_COMERCIAL WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM OFR_OFERTAS WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM VIS_VISITAS WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM CLC_CLIENTE_COMERCIAL WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	COMMIT;
	DELETE FROM ACT_TBJ ATBJ WHERE EXISTS (SELECT 1 FROM ACT_TBJ_TRABAJO TBJ WHERE TBJ.TBJ_ID = ATBJ.TBJ_ID AND USUARIOCREAR = '#USUARIO_MIGRACION#');
	DELETE FROM ACT_TBJ_TRABAJO WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM ACT_TRA_TRAMITE WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	COMMIT;	
	DELETE FROM ETN_EXTAREAS_NOTIFICACIONES ETN WHERE EXISTS (SELECT 1 FROM TAR_TAREAS_NOTIFICACIONES TAR WHERE TAR.TAR_ID = ETN.TAR_ID AND USUARIOCREAR = '#USUARIO_MIGRACION#');
	DELETE FROM TAR_TAREAS_NOTIFICACIONES WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM TEX_TAREA_EXTERNA WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	DELETE FROM TAC_TAREAS_ACTIVOS WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GCO_GESTOR_ADD_ECO');
	OPERACION_DDL.DDL_TABLE('TRUNCATE', 'GCH_GESTOR_ECO_HISTORICO');
	
	/*QUERYS BORRADOS AUXILIARES*/
	
	DELETE FROM ADG_ADJUNTOS_GASTO ADJ
	WHERE ADJ.GPV_ID IN (
	select gpv_id from ADG_ADJUNTOS_GASTO adg
	where not exists (
	  select 1 from GPV_GASTOS_PROVEEDOR gpv where gpv.GPV_ID = adg.GPV_ID));

	DELETE FROM ADE_ADJUNTO_EXPEDIENTE ADJ
	WHERE ADJ.ECO_ID IN (
	select ADG.ECO_ID from ADE_ADJUNTO_EXPEDIENTE adg
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON adg.ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	  
	DELETE FROM FOR_FORMALIZACION ADJ
	WHERE ADJ.ECO_ID IN (
	select ADG.ECO_ID from FOR_FORMALIZACION adg
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON adg.ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	  
	DELETE FROM COE_CONDICIONANTES_EXPEDIENTE ADJ
	WHERE ADJ.ECO_ID IN (
	select ADG.ECO_ID from COE_CONDICIONANTES_EXPEDIENTE adg
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON adg.ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	  
	DELETE FROM POS_POSICIONAMIENTO ADJ
	WHERE ADJ.ECO_ID IN (
	select ADG.ECO_ID from POS_POSICIONAMIENTO adg
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON adg.ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	  
	DELETE FROM ACT_BEX_BLOQ_EXP_FORMALIZAR ADJ
	WHERE ADJ.ACT_BEX_ECO_ID IN (
	select ADG.ACT_BEX_ECO_ID from ACT_BEX_BLOQ_EXP_FORMALIZAR adg
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON adg.ACT_BEX_ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	  
	DELETE FROM OEX_OBS_EXPEDIENTE ADJ
	WHERE ADJ.ECO_ID IN (
	select ADG.ECO_ID from OEX_OBS_EXPEDIENTE adg
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON adg.ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	  
	DELETE FROM ERE_ENTREGAS_RESERVA ADJ
	WHERE ADJ.RES_ID IN (
	select ADG.RES_ID from ERE_ENTREGAS_RESERVA adg
	INNER JOIN RES_RESERVAS RES
	  ON RES.RES_ID = ADG.RES_ID
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON RES.ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	 
	DELETE FROM RES_RESERVAS ADJ
	WHERE ADJ.ECO_ID IN (
	select ADG.ECO_ID from RES_RESERVAS adg
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON adg.ECO_ID = ECO.ECO_ID
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = ECO.OFR_ID));
	  
	DELETE FROM ECO_EXPEDIENTE_COMERCIAL ADJ
	WHERE ADJ.OFR_ID IN (
	select OFR_ID from ECO_EXPEDIENTE_COMERCIAL adg
	where not exists (
	  select 1 from OFR_OFERTAS gpv where gpv.OFR_ID = adg.OFR_ID));
	  
	DELETE FROM POS_POSICIONAMIENTO GEX2
	WHERE GEX2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM POS_POSICIONAMIENTO GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ECO_EXPEDIENTE_COMERCIAL ECO WHERE GEX.ECO_ID = ECO.ECO_ID));
	  
	DELETE FROM GEX_GASTOS_EXPEDIENTE GEX2
	WHERE GEX2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM GEX_GASTOS_EXPEDIENTE GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ECO_EXPEDIENTE_COMERCIAL ECO WHERE GEX.ECO_ID = ECO.ECO_ID));
	  
	DELETE FROM COM_COMPRADOR GEX2
	WHERE GEX2.CLC_ID IN (
	SELECT GEX.CLC_ID FROM COM_COMPRADOR GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE GEX.CLC_ID = ECO.CLC_ID));
  
	DELETE FROM CEX_COMPRADOR_EXPEDIENTE GEX2
	WHERE GEX2.COM_ID IN (
	SELECT GEX.COM_ID FROM CEX_COMPRADOR_EXPEDIENTE CEX
	INNER JOIN COM_COMPRADOR GEX
	  ON GEX.COM_ID = CEX.COM_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE GEX.CLC_ID = ECO.CLC_ID));
	  
	DELETE FROM RES_RESERVAS GEX2
	WHERE GEX2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM RES_RESERVAS GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ECO_EXPEDIENTE_COMERCIAL ECO WHERE GEX.ECO_ID = ECO.ECO_ID));
	  
	DELETE FROM COE_CONDICIONANTES_EXPEDIENTE GEX2
	WHERE GEX2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM COE_CONDICIONANTES_EXPEDIENTE GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ECO_EXPEDIENTE_COMERCIAL ECO WHERE GEX.ECO_ID = ECO.ECO_ID));
	  
	DELETE FROM DGG_DOC_GES_GASTOS GEX2
	WHERE GEX2.GPV_ID IN (
	SELECT GEX.GPV_ID FROM DGG_DOC_GES_GASTOS GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM GPV_GASTOS_PROVEEDOR ECO WHERE GEX.GPV_ID = ECO.GPV_ID));
	  
	DELETE FROM TEV_TAREA_EXTERNA_VALOR GEX2
	WHERE GEX2.TEX_ID IN (
	SELECT GEX.TEX_ID FROM TEV_TAREA_EXTERNA_VALOR GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM TEX_TAREA_EXTERNA ECO WHERE GEX.TEX_ID = ECO.TEX_ID));
	  
	DELETE FROM ADE_ADJUNTO_EXPEDIENTE ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT ADE.ECO_ID FROM ADE_ADJUNTO_EXPEDIENTE ADE
	WHERE ADE.ECO_ID NOT IN (
	  SELECT ECO.ECO_ID FROM ECO_EXPEDIENTE_COMERCIAL ECO WHERE ADE.ECO_ID = ECO.ECO_ID));
	  
	DELETE FROM ACT_OFR ADE2
	WHERE ADE2.OFR_ID IN (
	SELECT ADE.OFR_ID FROM ACT_OFR ACT_OFR
	INNER JOIN OFR_OFERTAS ADE
	  ON ACT_OFR.OFR_ID = ADE.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
  );
	
	DELETE FROM GEX_GASTOS_EXPEDIENTE ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM GEX_GASTOS_EXPEDIENTE GEX
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ACT_OFR 
	  ON GEX.ECO_ID = ACT_OFR.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ACT_OFR.OFR_ID = ADE.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
	  );
	  
	DELETE FROM FOR_FORMALIZACION ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM FOR_FORMALIZACION GEX
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ACT_OFR 
	  ON GEX.ECO_ID = ACT_OFR.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ACT_OFR.OFR_ID = ADE.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
	  );
	  
	 DELETE FROM RES_RESERVAS ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM RES_RESERVAS GEX
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ACT_OFR 
	  ON GEX.ECO_ID = ACT_OFR.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ACT_OFR.OFR_ID = ADE.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
	  );
	  
	DELETE FROM COE_CONDICIONANTES_EXPEDIENTE ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT GEX.ECO_ID FROM COE_CONDICIONANTES_EXPEDIENTE GEX
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ACT_OFR 
	  ON GEX.ECO_ID = ACT_OFR.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ACT_OFR.OFR_ID = ADE.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
	  );
	  
	DELETE FROM OFR_OFERTAS ADE2
	WHERE ADE2.CLC_ID IN (
	SELECT ADE.CLC_ID FROM OFR_OFERTAS ADE
	WHERE ADE.CLC_ID NOT IN (
	  SELECT ECO.CLC_ID FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
	  );
	  
	  
	DELETE FROM ECO_EXPEDIENTE_COMERCIAL ADE2
	WHERE ADE2.OFR_ID IN (
	SELECT ADE.OFR_ID FROM ECO_EXPEDIENTE_COMERCIAL ACT_OFR
	INNER JOIN OFR_OFERTAS ADE
	  ON ACT_OFR.OFR_ID = ADE.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
	  );
	  
	DELETE FROM VIS_VISITAS ADE2
	WHERE ADE2.CLC_ID IN (
	SELECT ADE.CLC_ID FROM VIS_VISITAS ADE
	WHERE NOT EXISTS (
	  SELECT 1 FROM CLC_CLIENTE_COMERCIAL ECO WHERE ADE.CLC_ID = ECO.CLC_ID)
	  );
	  
	DELETE FROM ERE_ENTREGAS_RESERVA ADE2
	WHERE ADE2.RES_ID IN (
	SELECT ADE.RES_ID FROM ERE_ENTREGAS_RESERVA ADE
	WHERE NOT EXISTS (
	  SELECT 1 FROM RES_RESERVAS ECO WHERE ADE.RES_ID = ECO.RES_ID)
	  );
	  
	DELETE FROM CEX_COMPRADOR_EXPEDIENTE ADE2
	WHERE ADE2.COM_ID IN (
	SELECT ADE.COM_ID FROM CEX_COMPRADOR_EXPEDIENTE ADE
	WHERE NOT EXISTS (
	  SELECT 1 FROM COM_COMPRADOR ECO WHERE ADE.COM_ID = ECO.COM_ID)
	  );
	/*FIN BORRADO QUERYS AUXILIARES*/

	/*BORRADO*/
  delete from rem01.ACT_ADM_INF_ADMINISTRATIVA where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_ADN_ADJNOJUDICIAL where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_AGO_AGRUPACION_OBS where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_AJD_ADJJUDICIAL where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_BNY_BANYO');
  delete from rem01.ACT_BNY_BANYO where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_CAT_CATASTRO where usuariocrear= '#USUARIO_MIGRACION#';
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_COC_COCINA');
  delete from rem01.ACT_COC_COCINA where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_CPR_COM_PROPIETARIOS where usuariocrear= '#USUARIO_MIGRACION#';
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_CRE_CARPINTERIA_EXT');
  delete from rem01.ACT_CRE_CARPINTERIA_EXT where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  delete from rem01.ACT_CRG_CARGAS where usuariocrear= '#USUARIO_MIGRACION#';
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_CRI_CARPINTERIA_INT');
  delete from rem01.ACT_CRI_CARPINTERIA_INT where usuariocrear= '#USUARIO_MIGRACION#';
   --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_DIS_DISTRIBUCION');
  delete from rem01.ACT_DIS_DISTRIBUCION where usuariocrear= '#USUARIO_MIGRACION#';
  OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_EDI_EDIFICIO');
  --delete from rem01.ACT_EDI_EDIFICIO where usuariocrear= '#USUARIO_MIGRACION#';
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_INF_INFRAESTRUCTURA');
  delete from rem01.ACT_INF_INFRAESTRUCTURA where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_INS_INSTALACION');
  delete from rem01.ACT_INS_INSTALACION where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_LLV_LLAVE where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_LOC_LOCALIZACION where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_MLV_MOVIMIENTO_LLAVE where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  delete from rem01.ACT_PDV_PLAN_DIN_VENTAS where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_ABA_ACTIVO_BANCARIO where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_PRO_PROPIETARIO where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_PRT_PRESUPUESTO_TRABAJO where usuariocrear= '#USUARIO_MIGRACION#';
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_PRV_PARAMENTO_VERTICAL');
  delete from rem01.ACT_PRV_PARAMENTO_VERTICAL where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_PVC_PROVEEDOR_CONTACTO where usuariocrear= '#USUARIO_MIGRACION#';
  DELETE FROM rem01.ACT_PRD_PROVEEDOR_DIRECCION WHERE USUARIOCREAR = '#USUARIO_MIGRACION#';
  delete from rem01.ACT_PAC_PROPIETARIO_ACTIVO where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  delete from rem01.ACT_ETP_ENTIDAD_PROVEEDOR ETP where EXISTS (SELECT 1 FROM REM01.ACT_PVE_PROVEEDOR PVE WHERE PVE.PVE_ID = ETP.PVE_ID AND PVE.usuariocrear= '#USUARIO_MIGRACION#');
  delete from rem01.ACT_PVE_PROVEEDOR where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_REG_INFO_REGISTRAL where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_ONV_OBRA_NUEVA ONV where EXISTS (SELECT 1 FROM REM01.ACT_AGR_AGRUPACION AGR WHERE AGR.AGR_ID = ONV.AGR_ID AND AGR.usuariocrear= '#USUARIO_MIGRACION#');
  delete from rem01.ACT_RES_RESTRINGIDA RES where EXISTS (SELECT 1 FROM REM01.ACT_AGR_AGRUPACION AGR WHERE AGR.AGR_ID = RES.AGR_ID AND AGR.usuariocrear= '#USUARIO_MIGRACION#');
  delete from rem01.ACT_LCO_LOTE_COMERCIAL LCO WHERE EXISTS (SELECT 1 FROM REM01.ACT_AGR_AGRUPACION AGR WHERE AGR.AGR_ID = LCO.AGR_ID AND AGR.usuariocrear= '#USUARIO_MIGRACION#');
  delete from rem01.ACT_AGR_AGRUPACION where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_AGA_AGRUPACION_ACTIVO where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  delete from rem01.ACT_SDV_SUBDIVISION_ACTIVO where usuariocrear= '#USUARIO_MIGRACION#';
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_SOL_SOLADO');
  delete from rem01.ACT_SOL_SOLADO where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_SPS_SIT_POSESORIA where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_TAS_TASACION where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_TBJ TBJ where EXISTS (SELECT 1 FROM rem01.ACT_TBJ_TRABAJO TBJT WHERE TBJT.TBJ_ID = TBJ.TBJ_ID AND TBJT.usuariocrear= '#USUARIO_MIGRACION#');
  delete from rem01.ACT_TBJ_TRABAJO where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_TIT_TITULO where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_VAL_VALORACIONES');
  delete from rem01.ACT_VAL_VALORACIONES where usuariocrear= '#USUARIO_MIGRACION#';
  OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_LCO_LOCAL_COMERCIAL');
  --delete from rem01.ACT_LCO_LOCAL_COMERCIAL LCO WHERE EXISTS (SELECT 1 FROM rem01.ACT_ICO_INFO_COMERCIAL ICO WHERE LCO.ICO_ID = ICO.ICO_ID AND ICO.usuariocrear= '#USUARIO_MIGRACION#');
  OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_APR_PLAZA_APARCAMIENTO');
  --delete from rem01.ACT_APR_PLAZA_APARCAMIENTO APR WHERE EXISTS (SELECT 1 FROM rem01.ACT_ICO_INFO_COMERCIAL ICO WHERE APR.ICO_ID = ICO.ICO_ID AND ICO.usuariocrear= '#USUARIO_MIGRACION#');
  OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_VIV_VIVIENDA');
  --delete from rem01.ACT_VIV_VIVIENDA VIV where EXISTS (SELECT 1 FROM rem01.ACT_ICO_INFO_COMERCIAL ICO WHERE VIV.ICO_ID = ICO.ICO_ID AND ICO.usuariocrear= '#USUARIO_MIGRACION#');
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_ZCO_ZONA_COMUN');
  delete from rem01.ACT_ZCO_ZONA_COMUN where usuariocrear= '#USUARIO_MIGRACION#';
  --OPERACION_DDL.DDL_TABLE('TRUNCATE', 'ACT_ICO_INFO_COMERCIAL');
  delete from rem01.ACT_ICO_INFO_COMERCIAL where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.BIE_ADJ_ADJUDICACION where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.lob_lote_bien lob1 where exists (select 1 from rem01.BIE_BIEN bie where bie.BIE_ID = lob1.bie_id and BIE.usuariocrear= '#USUARIO_MIGRACION#');
  delete from rem01.BIE_CAR_CARGAS where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.BIE_DATOS_REGISTRALES where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  delete from rem01.BIE_LOCALIZACION where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.BIE_VALORACIONES where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_GES_DISTRIBUCION where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_ADA_ADJUNTO_ACTIVO where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.GEE_GESTOR_ENTIDAD where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.GEH_GESTOR_ENTIDAD_HIST where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.BIE_BIEN where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  delete from rem01.bie_adicional where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.bie_anc_analisis_contratos where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.bie_bien_entidad where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.bie_sui_subasta_instrucciones where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.emp_nmbembargos_procedimientos where usuariocrear= '#USUARIO_MIGRACION#';
  delete from rem01.ACT_ADO_ADMISION_DOCUMENTO where usuariocrear= '#USUARIO_MIGRACION#';
  commit;
  delete from rem01.GAH_GESTOR_ACTIVO_HISTORICO GAH where EXISTS (SELECT 1 FROM rem01.ACT_ACTIVO ACT WHERE ACT.ACT_ID = GAH.ACT_ID AND ACT.usuariocrear= '#USUARIO_MIGRACION#');
  delete from rem01.GAC_GESTOR_ADD_ACTIVO GAC where EXISTS (SELECT 1 FROM rem01.ACT_ACTIVO ACT WHERE ACT.ACT_ID = GAC.ACT_ID AND ACT.usuariocrear= '#USUARIO_MIGRACION#');
  commit;
  delete from rem01.VIS_VISITAS vis where EXISTS (SELECT 1 FROM rem01.ACT_ACTIVO ACT WHERE ACT.ACT_ID = VIS.ACT_ID AND ACT.usuariocrear= '#USUARIO_MIGRACION#');
  commit;
  delete from rem01.ACT_ACTIVO where usuariocrear= '#USUARIO_MIGRACION#';
  commit; 
  
  UPDATE REM01.ACT_PVE_PROVEEDOR PVE 
      SET
	   PVE.DD_TPC_ID = NULL
	  ,PVE.DD_TPE_ID = NULL
	  ,PVE.PVE_NIF = NULL
	  ,PVE.PVE_FECHA_ALTA = NULL
	  ,PVE.PVE_FECHA_BAJA = NULL
	  ,PVE.PVE_LOCALIZADA = NULL
	  ,PVE.DD_EPR_ID = NULL
	  ,PVE.PVE_FECHA_CONSTITUCION = NULL
	  ,PVE.PVE_AMBITO = NULL
	  ,PVE.PVE_OBSERVACIONES = NULL
	  ,PVE.PVE_HOMOLOGADO = NULL
	  ,PVE.DD_CPR_ID = NULL
	  ,PVE.PVE_TOP = NULL
	  ,PVE.PVE_TITULAR_CUENTA = NULL
	  ,PVE.PVE_RETENER = NULL
	  ,PVE.DD_MRE_ID = NULL
	  ,PVE.PVE_FECHA_RETENCION = NULL
	  ,PVE.PVE_FECHA_PBC = NULL
	  ,PVE.DD_RPB_ID = NULL
      ,PVE.USUARIOMODIFICAR = NULL
      ,PVE.FECHAMODIFICAR = NULL
  WHERE PVE.USUARIOMODIFICAR = '#USUARIO_MIGRACION#';
  
  UPDATE REM01.ACT_PRO_PROPIETARIO PRO
       SET	
	       PRO.DD_CRA_ID = NULL
	       /*FALTA AÑADIR LA SUBCARTERA CUANDO SE CREE EL CAMPO*/
          ,PRO.USUARIOMODIFICAR = NULL
          ,PRO.FECHAMODIFICAR = NULL;
	--WHERE PRO.USUARIOMODIFICAR = '#USUARIO_MIGRACION#';
	
	
	/*Borrado querys adicionales */

	DELETE FROM AIN_ACTIVO_INTEGRADO AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM AIN_ACTIVO_INTEGRADO AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_VAL_VALORACIONES AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_VAL_VALORACIONES AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_TRA_TRAMITE AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_TRA_TRAMITE AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_HEP_HIST_EST_PUBLICACION AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_HEP_HIST_EST_PUBLICACION AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_HIC_EST_INF_COMER_HIST AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_HIC_EST_INF_COMER_HIST AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_OFR AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_OFR AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM TAC_TAREAS_ACTIVOS AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM TAC_TAREAS_ACTIVOS AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_ADA_ADJUNTO_ACTIVO AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_ADA_ADJUNTO_ACTIVO AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_CAT_CATASTRO AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_CAT_CATASTRO AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_TBJ AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_TBJ AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_TBJ_TRABAJO AIN
	WHERE ACT_ID IN(
	SELECT ACT_ID FROM ACT_TBJ_TRABAJO AIN WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE AIN.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM ACT_PRT_PRESUPUESTO_TRABAJO AIN
	WHERE AIN.TBJ_ID IN(
	SELECT AIN.TBJ_ID FROM ACT_PRT_PRESUPUESTO_TRABAJO AIN 
	INNER JOIN ACT_TBJ_TRABAJO ACT_TBJ
	  ON ACT_TBJ.TBJ_ID = AIN.TBJ_ID
	WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_ACTIVO ACT WHERE ACT_TBJ.ACT_ID = ACT.ACT_ID)
	);

	DELETE FROM PRG_PROVISION_GASTOS AIN
	WHERE AIN.PVE_ID_GESTORIA IN(
	SELECT AIN.PVE_ID_GESTORIA FROM PRG_PROVISION_GASTOS AIN 
	WHERE NOT EXISTS (  
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ACT WHERE AIN.PVE_ID_GESTORIA = ACT.PVE_ID)
	);
	
	DELETE FROM ACT_PRD_PROVEEDOR_DIRECCION GEX2
	WHERE GEX2.PVE_ID IN (
	SELECT GEX.PVE_ID FROM ACT_PRD_PROVEEDOR_DIRECCION GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.PVE_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_TAS_TASACION GEX2
	WHERE GEX2.BIE_VAL_ID IN (
	SELECT GEX.BIE_VAL_ID FROM ACT_TAS_TASACION TAS
	INNER JOIN BIE_VALORACIONES GEX
	  ON TAS.BIE_VAL_ID = GEX.BIE_VAL_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM BIE_BIEN ECO WHERE GEX.BIE_ID = ECO.BIE_ID));
	  
	DELETE FROM BIE_VALORACIONES GEX2
	WHERE GEX2.BIE_ID IN (
	SELECT GEX.BIE_ID FROM BIE_VALORACIONES GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM BIE_BIEN ECO WHERE GEX.BIE_ID = ECO.BIE_ID));
	  
	DELETE FROM ACT_OLE_OCUPANTE_LEGAL GEX2
	WHERE GEX2.SPS_ID IN (
	SELECT GEX.SPS_ID FROM ACT_OLE_OCUPANTE_LEGAL GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_SPS_SIT_POSESORIA ECO WHERE GEX.SPS_ID = ECO.SPS_ID));
	  
	DELETE FROM ACT_MLV_MOVIMIENTO_LLAVE GEX2
	WHERE GEX2.LLV_ID IN (
	SELECT GEX.LLV_ID FROM ACT_MLV_MOVIMIENTO_LLAVE GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_LLV_LLAVE ECO WHERE GEX.LLV_ID = ECO.LLV_ID));
	 
	DELETE FROM ACT_ADO_ADMISION_DOCUMENTO GEX2
	WHERE GEX2.ACT_ID IN (
	SELECT GEX.ACT_ID FROM ACT_ADO_ADMISION_DOCUMENTO GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.ACT_ID = ECO.ACT_ID));
	  
	DELETE FROM ACT_ETP_ENTIDAD_PROVEEDOR GEX2
	WHERE GEX2.PVE_ID IN (
	SELECT GEX.PVE_ID FROM ACT_ETP_ENTIDAD_PROVEEDOR GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.PVE_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_PVC_PROVEEDOR_CONTACTO GEX2
	WHERE GEX2.PVE_ID IN (
	SELECT GEX.PVE_ID FROM ACT_PVC_PROVEEDOR_CONTACTO GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.PVE_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_RES_RESTRINGIDA GEX2
	WHERE GEX2.AGR_ID IN (
	SELECT GEX.AGR_ID FROM ACT_RES_RESTRINGIDA RES
	INNER JOIN ACT_AGR_AGRUPACION GEX
	  ON GEX.AGR_ID = RES.AGR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.AGR_ACT_PRINCIPAL = ECO.ACT_ID));
	  	  
	DELETE FROM ACT_AGA_AGRUPACION_ACTIVO GEX2
	WHERE GEX2.AGR_ID IN (
	SELECT GEX.AGR_ID FROM ACT_AGA_AGRUPACION_ACTIVO RES
	INNER JOIN ACT_AGR_AGRUPACION GEX
	  ON GEX.AGR_ID = RES.AGR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.AGR_ACT_PRINCIPAL = ECO.ACT_ID));
	  
	DELETE FROM ACT_AAH_AGRUP_ACTIVO_HIST GEX2
	WHERE GEX2.AGR_ID IN (
	SELECT GEX.AGR_ID FROM ACT_AAH_AGRUP_ACTIVO_HIST RES
	INNER JOIN ACT_AGR_AGRUPACION GEX
	  ON GEX.AGR_ID = RES.AGR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.AGR_ACT_PRINCIPAL = ECO.ACT_ID));
	
	DELETE FROM ACT_AGR_AGRUPACION GEX2
	WHERE GEX2.AGR_ACT_PRINCIPAL IN (
	SELECT GEX.AGR_ACT_PRINCIPAL FROM ACT_AGR_AGRUPACION GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.AGR_ACT_PRINCIPAL = ECO.ACT_ID));
	  
	DELETE FROM ACT_TRA_TRAMITE GEX2
	WHERE GEX2.TBJ_ID IN (
	SELECT GEX.TBJ_ID FROM ACT_TRA_TRAMITE GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO ECO WHERE GEX.TBJ_ID = ECO.TBJ_ID));
	  
	DELETE FROM ACT_COE_CONDICION_ESPECIFICA GEX2
	WHERE GEX2.ACT_ID IN (
	SELECT GEX.ACT_ID FROM ACT_COE_CONDICION_ESPECIFICA GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.ACT_ID = ECO.ACT_ID));
	  
	DELETE FROM GEX_GASTOS_EXPEDIENTE GEX2
	WHERE GEX2.GEX_PROVEEDOR IN (
	SELECT GEX.GEX_PROVEEDOR FROM GEX_GASTOS_EXPEDIENTE GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.GEX_PROVEEDOR = ECO.PVE_ID));
	  
	DELETE FROM ACT_ICM_INF_COMER_HIST_MEDI GEX2
	WHERE GEX2.ICO_MEDIADOR_ID IN (
	SELECT GEX.ICO_MEDIADOR_ID FROM ACT_ICM_INF_COMER_HIST_MEDI GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_ICM_INF_COMER_HIST_MEDI GEX2
	WHERE GEX2.ACT_ID IN (
	SELECT GEX.ACT_ID FROM ACT_ICM_INF_COMER_HIST_MEDI GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.ACT_ID = ECO.ACT_ID));
	  
	DELETE FROM ACT_PTE_PROVEED_TERRITORIAL GEX2
	WHERE GEX2.PVE_ID IN (
	SELECT GEX.PVE_ID FROM ACT_PTE_PROVEED_TERRITORIAL GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.PVE_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_PRT_PRESUPUESTO_TRABAJO GEX2
	WHERE GEX2.TBJ_ID IN (
	SELECT GEX.TBJ_ID FROM ACT_PRT_PRESUPUESTO_TRABAJO GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO ECO WHERE GEX.TBJ_ID = ECO.TBJ_ID));
	  
	DELETE FROM ACT_PTO_PRESUPUESTO GEX2
	WHERE GEX2.ACT_ID IN (
	SELECT GEX.ACT_ID FROM ACT_PTO_PRESUPUESTO GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.ACT_ID = ECO.ACT_ID));
	  
	DELETE FROM ACT_ADT_ADJUNTO_TRABAJO GEX2
	WHERE GEX2.TBJ_ID IN (
	SELECT GEX.TBJ_ID FROM ACT_ADT_ADJUNTO_TRABAJO GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO ECO WHERE GEX.TBJ_ID = ECO.TBJ_ID));
	  
	DELETE FROM ACT_CRG_CARGAS GEX2
	WHERE GEX2.ACT_ID IN (
	SELECT GEX.ACT_ID FROM ACT_CRG_CARGAS GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ACTIVO ECO WHERE GEX.ACT_ID = ECO.ACT_ID));
	  
	DELETE FROM ACT_EDI_EDIFICIO GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_EDI_EDIFICIO EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_PRV_PARAMENTO_VERTICAL GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_PRV_PARAMENTO_VERTICAL EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_SOL_SOLADO GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_SOL_SOLADO EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_COC_COCINA GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_COC_COCINA EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_BNY_BANYO GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_BNY_BANYO EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_INS_INSTALACION GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_INS_INSTALACION EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_ZCO_ZONA_COMUN GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_ZCO_ZONA_COMUN EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_INF_INFRAESTRUCTURA GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_INF_INFRAESTRUCTURA EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_CRI_CARPINTERIA_INT GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_CRI_CARPINTERIA_INT EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_CRE_CARPINTERIA_EXT GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_CRE_CARPINTERIA_EXT EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_VIV_VIVIENDA GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT EDI.ICO_ID FROM ACT_VIV_VIVIENDA EDI
	INNER JOIN ACT_ICO_INFO_COMERCIAL GEX
	  ON EDI.ICO_ID = GEX.ICO_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM ACT_ICO_INFO_COMERCIAL GEX2
	WHERE GEX2.ICO_MEDIADOR_ID IN (
	SELECT GEX.ICO_MEDIADOR_ID FROM ACT_ICO_INFO_COMERCIAL GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_PVE_PROVEEDOR ECO WHERE GEX.ICO_MEDIADOR_ID = ECO.PVE_ID));
	  
	DELETE FROM BIE_CAR_CARGAS GEX2
	WHERE GEX2.BIE_ID IN (
	SELECT GEX.BIE_ID FROM BIE_CAR_CARGAS GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM BIE_BIEN ECO WHERE GEX.BIE_ID = ECO.BIE_ID));
	  
	DELETE FROM ACT_DIS_DISTRIBUCION GEX2
	WHERE GEX2.ICO_ID IN (
	SELECT GEX.ICO_ID FROM ACT_DIS_DISTRIBUCION GEX
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_ICO_INFO_COMERCIAL ECO WHERE GEX.ICO_ID = ECO.ICO_ID));
	  
	DELETE FROM FOR_FORMALIZACION ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT FORA.ECO_ID FROM FOR_FORMALIZACION FORA
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE ADE.AGR_ID NOT IN (
	  SELECT ECO.AGR_ID FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
	  
	DELETE FROM RES_RESERVAS ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT FORA.ECO_ID FROM RES_RESERVAS FORA
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
	  
	DELETE FROM ERE_ENTREGAS_RESERVA ADE2
	WHERE ADE2.RES_ID IN (
	SELECT ERE.RES_ID FROM ERE_ENTREGAS_RESERVA ERE
	inner join RES_RESERVAS FORA
	  ON FORA.RES_ID = ERE.RES_ID
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
	  
	DELETE FROM COE_CONDICIONANTES_EXPEDIENTE ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT FORA.ECO_ID FROM COE_CONDICIONANTES_EXPEDIENTE FORA
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
  
	DELETE FROM CEX_COMPRADOR_EXPEDIENTE ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT FORA.ECO_ID FROM CEX_COMPRADOR_EXPEDIENTE FORA
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
  
	DELETE FROM ADE_ADJUNTO_EXPEDIENTE ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT FORA.ECO_ID FROM ADE_ADJUNTO_EXPEDIENTE FORA
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
	  
	DELETE FROM POS_POSICIONAMIENTO ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT FORA.ECO_ID FROM POS_POSICIONAMIENTO FORA
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
	 
	  
	DELETE FROM OEX_OBS_EXPEDIENTE ADE2
	WHERE ADE2.ECO_ID IN (
	SELECT FORA.ECO_ID FROM OEX_OBS_EXPEDIENTE FORA
	INNER JOIN ECO_EXPEDIENTE_COMERCIAL ECO
	  ON ECO.ECO_ID = FORA.ECO_ID
	INNER JOIN OFR_OFERTAS ADE
	  ON ADE.OFR_ID = ECO.OFR_ID
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
	  
	DELETE FROM OFR_OFERTAS ADE2
	WHERE ADE2.AGR_ID IN (
	SELECT ADE.AGR_ID FROM OFR_OFERTAS ADE
	WHERE NOT EXISTS (
	  SELECT 1 FROM ACT_AGR_AGRUPACION ECO WHERE ADE.AGR_ID = ECO.AGR_ID)
	  );
	  
	DELETE FROM ACT_PAC_PROPIETARIO_ACTIVO ADE2
	WHERE ADE2.PRO_ID IN (
	SELECT ADE.PRO_ID FROM ACT_PAC_PROPIETARIO_ACTIVO ADE
	WHERE ADE.PRO_ID NOT IN (
	  SELECT ECO.PRO_ID FROM ACT_PRO_PROPIETARIO ECO WHERE ADE.PRO_ID = ECO.PRO_ID)
	  );
	  
	DELETE FROM ACT_AAH_AGRUP_ACTIVO_HIST ADE2
	WHERE ADE2.ACT_ID IN (
	SELECT ADE.ACT_ID FROM ACT_AAH_AGRUP_ACTIVO_HIST ADE
	WHERE ADE.ACT_ID NOT IN (
	  SELECT ECO.ACT_ID FROM ACT_ACTIVO ECO WHERE ADE.ACT_ID = ECO.ACT_ID)
	  );
	  
	DELETE FROM ACT_PRP ADE2
	WHERE ADE2.ACT_ID IN (
	SELECT ADE.ACT_ID FROM ACT_PRP ADE
	WHERE ADE.ACT_ID NOT IN (
	  SELECT ECO.ACT_ID FROM ACT_ACTIVO ECO WHERE ADE.ACT_ID = ECO.ACT_ID)
	  );

	DELETE FROM GEX_GASTOS_EXPEDIENTE GEX
	WHERE EXISTS (
	  SELECT 1 FROM ECO_EXPEDIENTE_COMERCIAL ECO WHERE NOT EXISTS (SELECT 1 FROM OFR_OFERTAS OFR WHERE OFR.OFR_ID = ECO.OFR_ID) AND ECO.ECO_ID = GEX.ECO_ID
	)
	;

	DELETE FROM ACT_TBJ A
	WHERE EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID) AND A.TBJ_ID = T1.TBJ_ID
	)
	;

	DELETE FROM ACT_PRT_PRESUPUESTO_TRABAJO A
	WHERE EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID) AND A.TBJ_ID = T1.TBJ_ID
	)
	;

	DELETE FROM ACT_TBO_TRABAJO_OBS A
	WHERE EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID) AND A.TBJ_ID = T1.TBJ_ID
	)
	;

	DELETE FROM ACT_ADT_ADJUNTO_TRABAJO A
	WHERE EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID) AND A.TBJ_ID = T1.TBJ_ID
	)
	;

	DELETE FROM ACT_TCT_TRABAJO_CFGTARIFA A
	WHERE EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID) AND A.TBJ_ID = T1.TBJ_ID
	)
	;

	DELETE FROM ACT_PSU_PROVISION_SUPLIDO A
	WHERE EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID) AND A.TBJ_ID = T1.TBJ_ID
	)
	;

	DELETE FROM ACT_RPV_RECARGOS_PROVEEDOR A
	WHERE EXISTS (
	  SELECT 1 FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID) AND A.TBJ_ID = T1.TBJ_ID
	)
	;

	DELETE FROM ACT_MLV_MOVIMIENTO_LLAVE M WHERE EXISTS (SELECT 1 FROM ACT_LLV_LLAVE K WHERE K.LLV_ID = M.LLV_ID AND NOT EXISTS (SELECT 1 FROM ACT_ACTIVO A WHERE A.ACT_ID = K.ACT_ID));
	DELETE FROM ACT_LLV_LLAVE K WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO A WHERE A.ACT_ID = K.ACT_ID);
	DELETE FROM BIE_ADJ_ADJUDICACION BA WHERE NOT EXISTS (SELECT 1 FROM BIE_BIEN B WHERE B.BIE_ID = BA.BIE_ID);
	DELETE FROM ACT_AJD_ADJJUDICIAL A WHERE NOT EXISTS (SELECT 1 FROM BIE_ADJ_ADJUDICACION B WHERE B.BIE_ADJ_ID = A.BIE_ADJ_ID);
	DELETE FROM VIS_VISITAS V WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO A WHERE A.ACT_ID = V.ACT_ID);

	DELETE FROM VIS_VISITAS V WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR A WHERE A.PVE_ID = V.PVE_ID_API_CUSTODIO);
	DELETE FROM VIS_VISITAS V WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR A WHERE A.PVE_ID = V.PVE_ID_FDV);
	DELETE FROM VIS_VISITAS V WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR A WHERE A.PVE_ID = V.PVE_ID_PRESCRIPTOR);
	DELETE FROM VIS_VISITAS V WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR A WHERE A.PVE_ID = V.PVE_ID_PVE_VISITA);
	DELETE FROM ACT_TBJ_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID);

	DELETE FROM ECO_EXPEDIENTE_COMERCIAL T1 WHERE NOT EXISTS (SELECT 1 FROM OFR_OFERTAS T2 WHERE T2.OFR_ID = T1.OFR_ID);
	DELETE FROM OFR_OFERTAS O WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR A WHERE A.PVE_ID = O.PVE_ID_CUSTODIO);
	DELETE FROM OFR_OFERTAS O WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR A WHERE A.PVE_ID = O.PVE_ID_PRESCRIPTOR);
	DELETE FROM OFR_OFERTAS O WHERE NOT EXISTS (SELECT 1 FROM VIS_VISITAS V WHERE V.VIS_ID = O.VIS_ID);

	DELETE FROM GEX_GASTOS_EXPEDIENTE T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);
	DELETE FROM GAH_GESTOR_ACTIVO_HISTORICO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);
	DELETE FROM GAH_GESTOR_ACTIVO_HISTORICO T1 WHERE NOT EXISTS (SELECT 1 FROM GEH_GESTOR_ENTIDAD_HIST T2 WHERE T2.GEH_ID = T1.GEH_ID);
	DELETE FROM ACT_FOT_FOTO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);
	DELETE FROM TXO_TEXTOS_OFERTA T1 WHERE NOT EXISTS (SELECT 1 FROM OFR_OFERTAS T2 WHERE T2.OFR_ID = T1.OFR_ID);

	DELETE FROM ACT_OFR T1 WHERE NOT EXISTS (SELECT 1 FROM OFR_OFERTAS T2 WHERE T2.OFR_ID = T1.OFR_ID);
	DELETE FROM GAC_GESTOR_ADD_ACTIVO T1 WHERE NOT EXISTS (SELECT 1 FROM GEE_GESTOR_ENTIDAD T2 WHERE T2.GEE_ID = T1.GEE_ID);
	DELETE FROM GAC_GESTOR_ADD_ACTIVO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);
	DELETE FROM ACT_AGA_AGRUPACION_ACTIVO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);

	DELETE FROM ACT_AGA_AGRUPACION_ACTIVO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID);
	DELETE FROM ACT_TBO_TRABAJO_OBS T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_TBJ_TRABAJO T2 WHERE T2.TBJ_ID = T1.TBJ_ID);
	DELETE FROM ACT_ADN_ADJNOJUDICIAL T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);
	DELETE FROM ECB_ESTADOS_COMERCIAL_BK T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);
	DELETE FROM ECB_ESTADOS_COMERCIAL_BK T1 WHERE NOT EXISTS (SELECT 1 FROM OFR_OFERTAS T2 WHERE T2.OFR_ID = T1.OFR_ID);

	DELETE FROM ACT_ASI_ASISTIDA T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_AGR_AGRUPACION T2 WHERE T2.AGR_ID = T1.AGR_ID);
	DELETE FROM RCB_RESOL_COMITE_BANKIA T1 WHERE NOT EXISTS (SELECT 1 FROM ECO_EXPEDIENTE_COMERCIAL T2 WHERE T2.ECO_ID = T1.ECO_ID);
	DELETE FROM CLC_CLIENTE_COMERCIAL T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR T2 WHERE T2.PVE_ID = T1.PVE_ID_PRESCRIPTOR);
	DELETE FROM ACT_BEX_BLOQ_EXP_FORMALIZAR T1 WHERE NOT EXISTS (SELECT 1 FROM ECO_EXPEDIENTE_COMERCIAL T2 WHERE T2.ECO_ID = T1.ACT_BEX_ECO_ID);
	DELETE FROM ACT_HVA_HIST_VALORACIONES T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);

	DELETE FROM ACT_AOB_ACTIVO_OBS T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_ACTIVO T2 WHERE T2.ACT_ID = T1.ACT_ID);
	DELETE FROM ACT_PRT_PRESUPUESTO_TRABAJO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_PVE_PROVEEDOR T2 WHERE T2.PVE_ID = T1.PVE_ID);
	DELETE FROM ACT_TCT_TRABAJO_CFGTARIFA T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_TBJ_TRABAJO T2 WHERE T2.TBJ_ID = T1.TBJ_ID);
	DELETE FROM ACT_PSU_PROVISION_SUPLIDO T1 WHERE NOT EXISTS (SELECT 1 FROM ACT_TBJ_TRABAJO T2 WHERE T2.TBJ_ID = T1.TBJ_ID);	

	UPDATE ACT_ACTIVO AC SET AC.CPR_ID = NULL WHERE NOT EXISTS (SELECT 1 FROM ACT_CPR_COM_PROPIETARIOS A WHERE A.CPR_ID = AC.CPR_ID);

	COMMIT; 

  /*FIN BORRADO*/
  
  DBMS_OUTPUT.PUT_LINE('********************' );
  DBMS_OUTPUT.PUT_LINE('**ACTIVAMOS RESTRICCIONES CLAVE PRIMARIA**' );
  DBMS_OUTPUT.PUT_LINE('********************' );
  
  FOR I IN V_TABLA.FIRST .. V_TABLA.LAST
  LOOP
       V_TEMP_TABLAS := V_TABLA(I);
       
       FOR J IN (SELECT TABLE_NAME, CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE CONSTRAINT_TYPE='P'
                 AND STATUS='DISABLED' AND TABLE_NAME = V_TEMP_TABLAS(2) AND TRUNC(LAST_CHANGE) = TRUNC(SYSDATE))
       LOOP
           BEGIN              
                      DBMS_OUTPUT.PUT_LINE('Activando : '|| J.table_name ||'.'|| J.constraint_name );    
                      EXECUTE IMMEDIATE 'ALTER TABLE ' || J.TABLE_NAME || ' ENABLE CONSTRAINT ' || J.CONSTRAINT_NAME;        
 
 
                      FOR H IN (SELECT TABLE_NAME, CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE R_CONSTRAINT_NAME=J.CONSTRAINT_NAME )
                       LOOP
                           BEGIN              
                               DBMS_OUTPUT.PUT_LINE('Activando : '|| H.table_name ||'.'|| H.constraint_name );    
                               EXECUTE IMMEDIATE 'ALTER TABLE ' || H.TABLE_NAME || ' ENABLE CONSTRAINT ' || H.CONSTRAINT_NAME;
                             
                           EXCEPTION WHEN OTHERS THEN
                               DBMS_OUTPUT.PUT_LINE('ERROR al activar la constraint' || TO_CHAR(SQLCODE) || ' ' || SQLERRM );
                           END;
                       END LOOP H;            
                     
        EXCEPTION WHEN OTHERS THEN
              DBMS_OUTPUT.PUT_LINE('ERROR al activar la constraint' || TO_CHAR(SQLCODE) || ' ' || SQLERRM );
        END;
       END LOOP;            
  END LOOP;
  COMMIT;   

 
  DBMS_OUTPUT.PUT_LINE('********************' );
  DBMS_OUTPUT.PUT_LINE('**ACTIVAMOS RESTRICCIONES CLAVE AJENA**' );
  DBMS_OUTPUT.PUT_LINE('********************' );
  
  FOR I IN V_TABLA.FIRST .. V_TABLA.LAST
  LOOP
       V_TEMP_TABLAS := V_TABLA(I);
       
       FOR J IN (SELECT TABLE_NAME, CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE CONSTRAINT_TYPE='R'
                 AND STATUS='DISABLED' AND TABLE_NAME = V_TEMP_TABLAS(2) AND TRUNC(LAST_CHANGE) = TRUNC(SYSDATE))
       LOOP
           BEGIN              
                      DBMS_OUTPUT.PUT_LINE('Activando : '|| J.table_name ||'.'|| J.constraint_name );    
                      EXECUTE IMMEDIATE 'ALTER TABLE ' || J.TABLE_NAME || ' ENABLE CONSTRAINT ' || J.CONSTRAINT_NAME;
                      
        EXCEPTION WHEN OTHERS THEN
              DBMS_OUTPUT.PUT_LINE('ERROR al activar la constraint' || TO_CHAR(SQLCODE) || ' ' || SQLERRM );
        END;
       END LOOP;            
  END LOOP;
  COMMIT;   
 
  DBMS_OUTPUT.PUT_LINE('*******************************' );
  DBMS_OUTPUT.PUT_LINE('**FALTA ACTIVAR RESTRICCIONES**' );
  DBMS_OUTPUT.PUT_LINE('*******************************' );
 
       FOR J IN (SELECT TABLE_NAME, CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE  STATUS='DISABLED'
               AND TRUNC(LAST_CHANGE) = TRUNC(SYSDATE))
       LOOP
           BEGIN              
               DBMS_OUTPUT.PUT_LINE('Activación extra : '|| J.table_name ||'.'|| J.constraint_name );    
                EXECUTE IMMEDIATE 'ALTER TABLE ' || J.TABLE_NAME || ' ENABLE CONSTRAINT ' || J.CONSTRAINT_NAME;
                      
        EXCEPTION WHEN OTHERS THEN
              DBMS_OUTPUT.PUT_LINE('ERROR al activar la constraint' || TO_CHAR(SQLCODE) || ' ' || SQLERRM );
        END;
       END LOOP;       

DBMS_OUTPUT.PUT_LINE( 'FIN DEL PROCESO' );

  EXCEPTION
    WHEN OTHERS THEN
      ERR_NUM := SQLCODE;
      ERR_MSG := SQLERRM;
      DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
      DBMS_OUTPUT.put_line(V_SQL);
      DBMS_OUTPUT.put_line('-------------------------'); 
      DBMS_OUTPUT.put_line(ERR_MSG);
      ROLLBACK;
      RAISE;   

END;

/

EXIT;