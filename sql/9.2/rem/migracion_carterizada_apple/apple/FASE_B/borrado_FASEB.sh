#!/bin/bash
##############################################################################################
#1.- Se comprueba que los parámetros de ejecución son correctos.
##############################################################################################
if [ "$#" -ne 2 ]; then
    echo "Parametros:"
    echo "$ ./borrado_FASEB.sh usuario/pass@host:puerto/ORACLE_SID USUARIO_MIGRACION"
    echo "*************************************************************************************************"
    echo "USUARIO_MIGRACION ---> MIG_SAREB, MIG_CAJAMAR, MIG_BANKIA, MIG_COOPER, MIG_LIBERBANK, MIG_APPLE"
    echo "Ejecutar desde: /migracion_carterizada_apple/FASE_B/"
    exit 1
fi

migracion_correcta=0
for resultado in $2; do
    if [[ $resultado = "MIG_"* ]] ; then 
		if [ $resultado = $2 ] ; then	
			migracion_correcta=1
	    fi
	fi
done

if [ $migracion_correcta = 1 ] ; then
    echo ""
    echo "#########################################################################"
	echo "####### [INFO] USUARIO DE LA MIGRACIÓN CORRECTO ["$2"]"
	echo "#########################################################################"

else
	echo ""
    echo "#########################################################################"
	echo "####### [ERROR] USUARIO DE LA MIGRACIÓN INCORRECTO ["$2"]"
	echo "####### [ERROR] El usuario [$2] no existe en la tabla REM01.MIG2_USUARIOCREAR_CARTERIZADO"
	echo "#########################################################################"

	exit 1
fi

hora=`date +%H:%M:%S`
inicio=`date +%s`
echo " "
echo "#########################################################################"
echo "####### [INICIO] [`date +%H:%M:%S`] Comienza el borrado (FASE_B) de $2"
echo "#########################################################################"
echo " "

$ORACLE_HOME/bin/sqlplus -S $1 << EOF
SET SERVEROUTPUT ON;
PROMPT .
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_APU_ACTIVO_PUBLICACION...
DELETE FROM REM01.ACT_APU_ACTIVO_PUBLICACION    WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_AHP_HIST_PUBLICACION...
DELETE FROM REM01.ACT_AHP_HIST_PUBLICACION      WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.AIN_ACTIVO_INTEGRADO...
DELETE FROM REM01.AIN_ACTIVO_INTEGRADO          WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_PTO_PRESUPUESTO...
DELETE FROM REM01.ACT_PTO_PRESUPUESTO           WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.GAH_GESTOR_ACTIVO_HISTORICO...
DELETE FROM REM01.GAH_GESTOR_ACTIVO_HISTORICO GAH   WHERE EXISTS (SELECT 1 FROM REM01.ACT_ACTIVO ACT WHERE ACT.ACT_ID = GAH.ACT_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.GEH_GESTOR_ENTIDAD_HIST...
DELETE FROM REM01.GEH_GESTOR_ENTIDAD_HIST       WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.GAC_GESTOR_ADD_ACTIVO...
DELETE FROM REM01.GAC_GESTOR_ADD_ACTIVO GAC   WHERE EXISTS (SELECT 1 FROM REM01.ACT_ACTIVO ACT WHERE ACT.ACT_ID = GAC.ACT_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.GEE_GESTOR_ENTIDAD...
DELETE FROM REM01.GEE_GESTOR_ENTIDAD            WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_AOB_ACTIVO_OBS...
DELETE FROM REM01.ACT_AOB_ACTIVO_OBS            WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ABA_ACTIVO_BANCARIO...
DELETE FROM REM01.ACT_ABA_ACTIVO_BANCARIO       WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_PAC_PERIMETRO_ACTIVO...
DELETE FROM REM01.ACT_PAC_PERIMETRO_ACTIVO      WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_PRP...
DELETE FROM REM01.ACT_PRP PRP   WHERE EXISTS (SELECT 1 FROM REM01.ACT_ACTIVO ACT WHERE ACT.ACT_ID = PRP.ACT_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ADO_ADMISION_DOCUMENTO...
DELETE FROM REM01.ACT_ADO_ADMISION_DOCUMENTO    WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_MLV_MOVIMIENTO_LLAVE...
DELETE FROM REM01.ACT_MLV_MOVIMIENTO_LLAVE      WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_LLV_LLAVE...
DELETE FROM REM01.ACT_LLV_LLAVE                 WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_CAT_CATASTRO...
DELETE FROM REM01.ACT_CAT_CATASTRO              WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_AGO_AGRUPACION_OBS...
DELETE FROM REM01.ACT_AGO_AGRUPACION_OBS        WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_AGA_AGRUPACION_ACTIVO...
DELETE FROM REM01.ACT_AGA_AGRUPACION_ACTIVO     WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ASI_ASISTIDA...
DELETE FROM REM01.ACT_ASI_ASISTIDA ASI   WHERE EXISTS (SELECT 1 FROM REM01.ACT_AGA_AGRUPACION_ACTIVO ACT WHERE ACT.AGR_ID = ASI.AGR_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_LCO_LOTE_COMERCIAL...
DELETE FROM REM01.ACT_LCO_LOTE_COMERCIAL LCO  WHERE EXISTS (SELECT 1 FROM REM01.ACT_AGA_AGRUPACION_ACTIVO ACT WHERE ACT.AGR_ID = LCO.AGR_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ONV_OBRA_NUEVA...
DELETE FROM REM01.ACT_ONV_OBRA_NUEVA  ONV  WHERE EXISTS (SELECT 1 FROM REM01.ACT_AGA_AGRUPACION_ACTIVO ACT WHERE ACT.AGR_ID = ONV.AGR_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_RES_RESTRINGIDA...
DELETE FROM REM01.ACT_RES_RESTRINGIDA  RES  WHERE EXISTS (SELECT 1 FROM REM01.ACT_AGA_AGRUPACION_ACTIVO ACT WHERE ACT.AGR_ID = RES.AGR_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_AGR_AGRUPACION...
DELETE FROM REM01.ACT_AGR_AGRUPACION            WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_DIS_DISTRIBUCION...
DELETE FROM REM01.ACT_DIS_DISTRIBUCION          WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_APR_PLAZA_APARCAMIENTO...
DELETE FROM REM01.ACT_APR_PLAZA_APARCAMIENTO  APR  WHERE EXISTS (SELECT 1 FROM REM01.ACT_ICO_INFO_COMERCIAL ACT WHERE ACT.ICO_ID = APR.ICO_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_LCO_LOCAL_COMERCIAL...
DELETE FROM REM01.ACT_LCO_LOCAL_COMERCIAL  LCO  WHERE EXISTS (SELECT 1 FROM REM01.ACT_ICO_INFO_COMERCIAL ACT WHERE ACT.ICO_ID = LCO.ICO_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_VIV_VIVIENDA...
DELETE FROM REM01.ACT_VIV_VIVIENDA  VIV  WHERE EXISTS (SELECT 1 FROM REM01.ACT_ICO_INFO_COMERCIAL ACT WHERE ACT.ICO_ID = VIV.ICO_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_EDI_EDIFICIO...
DELETE FROM REM01.ACT_EDI_EDIFICIO  EDI  WHERE EXISTS (SELECT 1 FROM REM01.ACT_ICO_INFO_COMERCIAL ACT WHERE ACT.ICO_ID = EDI.ICO_ID AND ACT.USUARIOCREAR = 'MIG_APPLE');
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_HIC_EST_INF_COMER_HIST...
DELETE FROM REM01.ACT_HIC_EST_INF_COMER_HIST    WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ICO_INFO_COMERCIAL...
DELETE FROM REM01.ACT_ICO_INFO_COMERCIAL        WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_PAC_PROPIETARIO_ACTIVO...
DELETE FROM REM01.ACT_PAC_PROPIETARIO_ACTIVO    WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_PRO_PROPIETARIO...
DELETE FROM REM01.ACT_PRO_PROPIETARIO           WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_TAS_TASACION...
DELETE FROM REM01.ACT_TAS_TASACION              WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.BIE_VALORACIONES...
DELETE FROM REM01.BIE_VALORACIONES              WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_CRG_CARGAS...
DELETE FROM REM01.ACT_CRG_CARGAS                WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.BIE_CAR_CARGAS...
DELETE FROM REM01.BIE_CAR_CARGAS                WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ADN_ADJNOJUDICIAL...
DELETE FROM REM01.ACT_ADN_ADJNOJUDICIAL         WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_AJD_ADJJUDICIAL...
DELETE FROM REM01.ACT_AJD_ADJJUDICIAL           WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_PDV_PLAN_DIN_VENTAS...
DELETE FROM REM01.ACT_PDV_PLAN_DIN_VENTAS       WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_VAL_VALORACIONES...
DELETE FROM REM01.ACT_VAL_VALORACIONES          WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_TIT_TITULO...
DELETE FROM REM01.ACT_TIT_TITULO                WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_LOC_LOCALIZACION...
DELETE FROM REM01.ACT_LOC_LOCALIZACION          WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.BIE_LOCALIZACION...
DELETE FROM REM01.BIE_LOCALIZACION              WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_REG_INFO_REGISTRAL...
DELETE FROM REM01.ACT_REG_INFO_REGISTRAL        WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.BIE_DATOS_REGISTRALES...
DELETE FROM REM01.BIE_DATOS_REGISTRALES         WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_SPS_SIT_POSESORIA...
DELETE FROM REM01.ACT_SPS_SIT_POSESORIA         WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ADM_INF_ADMINISTRATIVA...
DELETE FROM REM01.ACT_ADM_INF_ADMINISTRATIVA    WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.BIE_ADJ_ADJUDICACION...
DELETE FROM REM01.BIE_ADJ_ADJUDICACION          WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.BIE_BIEN...
DELETE FROM REM01.BIE_BIEN                      WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_ACTIVO...
DELETE FROM REM01.ACT_ACTIVO                    WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ACT_CPR_COM_PROPIETARIOS...
DELETE FROM REM01.ACT_CPR_COM_PROPIETARIOS      WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.USD_USUARIOS_DESPACHOS...
DELETE FROM REM01.USD_USUARIOS_DESPACHOS        WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REM01.ZON_PEF_USU...
DELETE FROM REM01.ZON_PEF_USU                   WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REMMASTER.GRU_GRUPOS_USUARIOS...
DELETE FROM REMMASTER.GRU_GRUPOS_USUARIOS 		WHERE USUARIOCREAR = 'MIG_APPLE';
PROMPT [INFO] BORRANDO DE LA TABLA REMMASTER.USU_USUARIOS...
DELETE FROM REMMASTER.USU_USUARIOS        		WHERE USUARIOCREAR = 'MIG_APPLE';
/
EOF

rm -f sqlnet.log
fin=`date +%s`
let total=($fin-$inicio)/60
echo "#########################################################################"
echo "####### [FIN] [`date +%H:%M:%S`] Borrado Fase B completada en [$total] minutos"
echo "#########################################################################"
echo " "
exit 0
