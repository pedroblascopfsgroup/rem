--/*
--######################################### 
--## AUTOR=MANUEL RODRIGUEZ
--## FECHA_CREACION=20170229
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=HREOS-2043
--## PRODUCTO=NO
--##            
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;

DECLARE

    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; -- #ESQUEMA# Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; -- #ESQUEMA_MASTER# Configuracion Esquema Master
    V_TABLESPACE_IDX VARCHAR2(25 CHAR):= 'REM_IDX'; -- #TABLESPACE_INDEX# Configuracion Tablespace de Indices
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.  
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.     
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_NUM_SEQUENCE NUMBER(16); --Vble .aux para almacenar el valor de la sequencia
    V_NUM_MAXID NUMBER(16); --Vble .aux para almacenar el valor maximo de ID
    
    V_TABLA VARCHAR2(30 CHAR) := 'VALIDACIONES_FUNCIONALES';  -- Tabla objetivo
    V_TABLA_SEQ VARCHAR2(30 CHAR) := 'S_VALIDACIONES_FUNCIONALES';  --  Sequencia de la tabla objetivo
    
    --Array que contiene los registros que se van a actualizar
    TYPE T_VAL is table of VARCHAR2(4000); 
    TYPE T_ARRAY_VAL IS TABLE OF T_VAL;
    V_VAL T_ARRAY_VAL := T_ARRAY_VAL
    (
        ----- CODIGO -- SEVERIDAD -- VALIDACION ------------------------------------------------------------------------------------------------------------------------------------------------------- NOMBRE_INTERFAZ -------------------- QUERY --------------------------------------
		/*
			1er bloque: Activos y Agrupaciones
		*/
		--ACTIVOS
		----------------------------------------------------------------------------------------------------------------------------																	                                                                          
        T_VAL('ACT_005'   ,'1' ,'Activos en estado "Disponible para la venta con oferta" creados por la migración que no posean oferta en estado distinto a "Rechazada"'                                ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.SITUACION_COMERCIAL = ''''03'''' AND NOT EXISTS ( SELECT 1 FROM REM01.MIG_ACA_CABECERA AUX2 INNER JOIN REM01.MIG2_OFA_OFERTAS_ACTIVO OFA ON AUX2.ACT_NUMERO_ACTIVO = OFA.OFA_ACT_NUMERO_ACTIVO INNER JOIN REM01.MIG2_OFR_OFERTAS OFR ON OFA.OFA_COD_OFERTA = OFR.OFR_COD_OFERTA WHERE AUX2.SITUACION_COMERCIAL = ''''03'''' AND OFR.OFR_COD_ESTADO_OFERTA != ''''02'''' AND AUX2.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO)'),
        T_VAL('ACT_006'   ,'1' ,'Activos en estado "Disponible para la venta con reserva" creados por la migración que no dispongan de reserva'                                                         ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON AUX.ACT_NUMERO_ACTIVO = ACT.ACT_NUMERO_ACTIVO WHERE AUX.SITUACION_COMERCIAL = ''''04'''' AND (ACT.ACT_COD_CARTERA,ACT.ACT_COD_SUBCARTERA) IN ((''''02'''',''''04''''),(''''03'''',''''06''''),(''''03'''',''''07''''),(''''03'''',''''08''''),(''''03'''',''''09''''),(''''03'''',''''14''''),(''''03'''',''''15''''),(''''03'''',''''19'''')) AND NOT EXISTS (SELECT 1 FROM REM01.MIG_ACA_CABECERA AUX2 JOIN REM01.MIG2_OFA_OFERTAS_ACTIVO OFA ON OFA.OFA_ACT_NUMERO_ACTIVO = AUX2.ACT_NUMERO_ACTIVO JOIN REM01.MIG2_RES_RESERVAS RES ON RES.RES_COD_OFERTA = OFA.OFA_COD_OFERTA WHERE AUX2.SITUACION_COMERCIAL = ''''04'''' AND AUX2.ACT_NUMERO_ACTIVO  = AUX.ACT_NUMERO_ACTIVO)'),
        T_VAL('ACT_007'   ,'1' ,'Activos con situación comercial "Disponible" sin oferta asociada'                                                                                                      ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG2_OFA_OFERTAS_ACTIVO OFA ON OFA.OFA_ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE AUX.SITUACION_COMERCIAL = ''''03'''' AND OFA.OFA_COD_OFERTA IS NULL'),
        T_VAL('ACT_008'   ,'1' ,'Activos con situación comercial "Vendido" sin fecha de venta o fecha de venta externa'                                                                                 ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT2 ON ACT2.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE AUX.SITUACION_COMERCIAL = ''''05'''' AND ACT2.ACT_FECHA_VENTA IS NULL AND ACT2.ACT_VENTA_EXTERNA_FECHA IS NULL'),
        T_VAL('ACT_009'   ,'1' ,'Activos ocupados con titulo sin título posesorio'                                                                                                                      ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADA_DATOS_ADI ADA ON ADA.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ADA.SPS_OCUPADO = 1 AND ADA.SPS_CON_TITULO = 1 AND AUX.TIPO_TITULO IS NULL'),           
        T_VAL('ACT_011'   ,'1' ,'Activos Financieros sin alguno de los gestores mínimos/obligatorios que debe tener'                                                                                    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG2_ACT_ACTIVO ACT2 ON ACT2.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO LEFT JOIN REM01.DD_CRA_CARTERA CRA ON CRA.DD_CRA_CODIGO = ACT2.ACT_COD_CARTERA LEFT JOIN REM01.DD_SCR_SUBCARTERA SCR ON SCR.DD_CRA_ID = CRA.DD_CRA_ID AND SCR.DD_SCR_CODIGO = ACT2.ACT_COD_SUBCARTERA LEFT JOIN REM01.MIG2_TIPO_GESTOR_OBLIGATORIOS GEO ON GEO.CARTERA = CRA.DD_CRA_CODIGO AND GEO.ELEMENTO_BASE = ''''AAFF'''' WHERE ACT2.ACT_COD_SUBCARTERA = DECODE (CRA.DD_CRA_CODIGO, ''''01'''', ''''01'''',     ''''02'''', ''''03'''',     ''''03'''', ''''05'''',     ''''04'''', ''''20'''',     ''''05'''', ''''12'''') AND NOT EXISTS ( SELECT 1 FROM REM01.MIG2_GEA_GESTORES_ACTIVOS GEA WHERE GEA.GEA_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND GEA.GEA_TIPO_GESTOR = GEO.TIPO_GESTOR AND GEA.VALIDACION = 0)'),
        T_VAL('ACT_012'   ,'1' ,'Activos Inmobiliario sin alguno de los gestores mínimos/obligatorios que debe tener'                                                                                   ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG2_ACT_ACTIVO ACT2 ON ACT2.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO LEFT JOIN REM01.DD_CRA_CARTERA CRA ON CRA.DD_CRA_CODIGO = ACT2.ACT_COD_CARTERA LEFT JOIN REM01.DD_SCR_SUBCARTERA SCR ON SCR.DD_CRA_ID = CRA.DD_CRA_ID AND SCR.DD_SCR_CODIGO = ACT2.ACT_COD_SUBCARTERA LEFT JOIN REM01.MIG2_TIPO_GESTOR_OBLIGATORIOS GEO ON GEO.CARTERA = CRA.DD_CRA_CODIGO AND GEO.ELEMENTO_BASE = ''''AAII'''' WHERE ACT2.ACT_COD_SUBCARTERA <> DECODE (CRA.DD_CRA_CODIGO, ''''01'''', ''''01'''',     ''''02'''', ''''03'''',     ''''03'''', ''''05'''',     ''''04'''', ''''20'''',     ''''05'''', ''''12'''') AND NOT EXISTS ( SELECT 1 FROM REM01.MIG2_GEA_GESTORES_ACTIVOS GEA WHERE GEA.GEA_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND GEA.GEA_TIPO_GESTOR = GEO.TIPO_GESTOR AND GEA.VALIDACION = 0)'),
        T_VAL('ACT_013'   ,'1' ,'Activos marcados como sin cargas que tienen cargas con estado distinto de "Cancelada"'                                                                                 ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ACA_CARGAS_ACTIVO CAR ON CAR.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE AUX.ACT_CON_CARGAS = 0 AND CAR.SITUACION_CARGA != ''''CAN'''''),
        T_VAL('ACT_014'   ,'1' ,'Activos con el indicador "Gestión HRE" vacio'                                                                                                                          ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.GESTION_HRE IS NULL'),
        T_VAL('ACT_015'   ,'0' ,'Activos con el indicador "Ocupado" en "No" y el indicador "Con titulo" con valor'                                                                                      ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADA_DATOS_ADI ADA ON ADA.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ADA.SPS_CON_TITULO IS NOT NULL AND ADA.SPS_OCUPADO = 0'),
        T_VAL('ACT_016'   ,'1' ,'Activos con "Llaves en poder de HRE" con valor "Si" y el campo "Fecha toma posesión inicial" sin informar'                                                             ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADA_DATOS_ADI ADA ON ADA.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ADA.ACT_LLV_LLAVES_HRE = 1 AND ADA.SPS_FECHA_TOMA_POSESION IS NULL'),
        T_VAL('ACT_017'   ,'0' ,'Activos sin fecha de recepción de llaves y el indicador "Llaves en poder de HRE" con valor "Sí"'                                                                       ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADA_DATOS_ADI ADA ON ADA.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE (ADA.ACT_LLV_FECHA_RECEPCION IS NULL AND ADA.ACT_LLV_LLAVES_HRE = 1) OR (ADA.ACT_LLV_FECHA_RECEPCION IS NOT NULL AND ADA.ACT_LLV_LLAVES_HRE = 0)'),
        T_VAL('ACT_018'   ,'0' ,'Activos sin municipio de registro o con el municipio de registro fuera de la provincia del activo'                                                                     ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADA_DATOS_ADI ADA ON AUX.ACT_NUMERO_ACTIVO = ADA.ACT_NUMERO_ACTIVO WHERE NOT EXISTS ( SELECT 1 FROM REMMASTER.DD_LOC_LOCALIDAD LOC WHERE LOC.DD_PRV_ID = (SELECT DD_PRV_ID FROM REMMASTER.DD_PRV_PROVINCIA WHERE DD_PRV_CODIGO = ADA.PROVINCIA) AND TO_NUMBER(LOC.DD_LOC_CODIGO) = TO_NUMBER(ADA.MUNICIPIO_REGISTRO) )'),      
        T_VAL('ACT_020'   ,'0' ,'Activos judiciales con fecha toma posesion anterior a la fecha firmeza del auto de adjudicación'                                                                       ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADJ_JUDICIAL ADJ ON AUX.ACT_NUMERO_ACTIVO = ADJ.ACT_NUMERO_ACTIVO INNER JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO  WHERE (AUX.TIPO_TITULO != ''''01'''') OR (AUX.TIPO_TITULO = ''''01'''' AND ADI.SPS_FECHA_TOMA_POSESION < ADJ.AJD_FECHA_ADJUDICACION)'),
        T_VAL('ACT_021'   ,'0' ,'Activos no judiciales con fecha toma posesion anterior a la fecha de titulo'                                                                                           ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADJ_NO_JUDICIAL ADJ ON AUX.ACT_NUMERO_ACTIVO = ADJ.ACT_NUMERO_ACTIVO INNER JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE (AUX.TIPO_TITULO != ''''02'''') OR (AUX.TIPO_TITULO = ''''02'''' AND ADI.SPS_FECHA_TOMA_POSESION < ADJ.ADN_FECHA_TITULO)'),
        T_VAL('ACT_022'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Fecha de inscripción del titulo'                                                                             ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ATI_TITULO TIT ON TIT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND TIT.TIT_FECHA_INSC_REG IS NULL'),
        T_VAL('ACT_023'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Fecha de toma de posesión inicial'                                                                           ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADA_DATOS_ADI ADI ON ADI.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND ADI.SPS_FECHA_TOMA_POSESION IS NULL'),
        T_VAL('ACT_024'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Fecha de validación de cargas'                                                                               ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.ESTADO_ADMISION = 1 AND AUX.ACT_FECHA_REV_CARGAS IS NULL'),
        T_VAL('ACT_025'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Tipo de vía'                                                                                                 ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND ADI.TIPO_VIA IS NULL'),
        T_VAL('ACT_026'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Nombre de vía'                                                                                               ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND ADI.LOC_NOMBRE_VIA IS NULL'),
        T_VAL('ACT_027'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Nº'                                                                                                          ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND ADI.LOC_NUMERO_DOMICILIO IS NULL'),
        T_VAL('ACT_028'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Provincia'                                                                                                   ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.PROVINCIA IS NULL OR ADI.PROVINCIA = ''''0'''')'),
        T_VAL('ACT_029'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Municipio'                                                                                                   ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.MUNICIPIO IS NULL OR ADI.MUNICIPIO = ''''0'''')'),
        T_VAL('ACT_030'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Código Postal'                                                                                               ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.LOC_COD_POST IS NULL OR ADI.LOC_COD_POST = ''''0'''')'),
        T_VAL('ACT_031'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Latitud'                                                                                                     ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.LOC_LATITUD IS NULL OR ADI.LOC_LATITUD = 0)'),
        T_VAL('ACT_032'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Longitud'                                                                                                    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.LOC_LONGITUD IS NULL OR ADI.LOC_LONGITUD = 0)'),
        T_VAL('ACT_033'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Población del registro'                                                                                      ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.MUNICIPIO_REGISTRO IS NULL OR ADI.MUNICIPIO_REGISTRO = ''''0'''')'),
        T_VAL('ACT_034'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: nº de registro'                                                                                              ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.REG_NUM_REGISTRO IS NULL OR ADI.REG_NUM_REGISTRO = ''''0'''')'),
        T_VAL('ACT_035'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Tomo'                                                                                                        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.REG_TOMO IS NULL OR ADI.REG_TOMO = ''''0'''')'),
        T_VAL('ACT_036'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Libro'                                                                                                       ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.REG_LIBRO IS NULL OR ADI.REG_LIBRO = ''''0'''')'),
        T_VAL('ACT_037'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Folio'                                                                                                       ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.REG_FOLIO IS NULL OR ADI.REG_FOLIO = ''''0'''')'),
        T_VAL('ACT_038'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Finca'                                                                                                       ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ADA_DATOS_ADI ADI ON AUX.ACT_NUMERO_ACTIVO = ADI.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADI.REG_NUM_FINCA IS NULL OR ADI.REG_NUM_FINCA = ''''0'''')'),
        T_VAL('ACT_039'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Referencia catastral'                                                                                        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_ACA_CATASTRO_ACTIVO CAT ON AUX.ACT_NUMERO_ACTIVO = CAT.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND CAT.CAT_REF_CATASTRAL IS NULL'),
        T_VAL('ACT_040'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Fecha título (en caso de adjudicación no judicial)'                                                          ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADJ_NO_JUDICIAL ADN ON AUX.ACT_NUMERO_ACTIVO = ADN.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND ADN.ADN_FECHA_TITULO IS NULL'),
        T_VAL('ACT_041'   ,'1' ,'Activos marcados con "Sí" en el estado de admisión y sin: Fecha auto adjudicación y fecha firmeza auto adjudicación (en caso de adjudicación judicial)'                ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG_ADJ_JUDICIAL ADJ ON AUX.ACT_NUMERO_ACTIVO = ADJ.ACT_NUMERO_ACTIVO WHERE AUX.ESTADO_ADMISION = 1 AND (ADJ.AJD_FECHA_ADJUDICACION IS NULL OR ADJ.AJD_FECHA_DECRETO_FIRME IS NULL)'),
        T_VAL('ACT_042'   ,'1' ,'Activos en el que el estado de publicación es "Publicado" y no tienen OK de admisión y gestión'                                                                        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX INNER JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_COD_ESTADO_PUBLICACION = ''''01'''' AND (AUX.ESTADO_ADMISION <> 1 OR AUX.ESTADO_GESTION <> 1)'),
        T_VAL('ACT_043'   ,'1' ,'Activos en el que el estado de publicación es "Publicado" y no tienen fecha aceptación del informe del mediador'                                                       ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO MIG ON MIG.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO JOIN REM01.MIG_AIA_INFCOMERCIAL_ACT ICO ON ICO.ACT_NUMERO_ACTIVO = MIG.ACT_NUMERO_ACTIVO WHERE MIG.ACT_COD_ESTADO_PUBLICACION = ''''01'''' AND (ICO.ICO_FECHA_ACEPTACION IS NULL OR ICO.ICO_FECHA_RECHAZO IS NOT NULL)'),
        --T_VAL('ACT_044'   ,'1' ,'Activos con fecha de aceptación y rechazo para el informe comercial'                                                                                                   ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX LEFT JOIN REM01.MIG_AIA_INFCOMERCIAL_ACT AIA ON AIA.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE AIA.ACT_NUMERO_ACTIVO IS NULL OR (AIA.ICO_FECHA_ACEPTACION IS NOT NULL AND AIA.ICO_FECHA_RECHAZO IS NOT NULL)'),
        T_VAL('ACT_045'   ,'1' ,'Activos financieros sin agrupación asistida'                                                                                                                           ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO T1 ON T1.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND AUX.SITUACION_COMERCIAL NOT IN (''''05'''') AND (T1.ACT_COD_CARTERA, T1.ACT_COD_SUBCARTERA) IN ((''''01'''', ''''01''''),(''''02'''', ''''03''''),(''''03'''', ''''05''''),(''''04'''', ''''20''''),(''''05'''', ''''12'''')) and AUX.ACT_NUMERO_ACTIVO not in (select T2.ACT_NUMERO_ACTIVO from REM01.MIG_AAA_AGRUPACION_ACTIVO T2 LEFT JOIN REM01.MIG_AAG_AGRUPACIONES T3 ON T3.AGR_EXTERNO = T2.AGR_EXTERNO AND T3.TIPO_AGRUPACION = ''''13'''' AND T3.VALIDACION IN (0,1) AND T2.VALIDACION IN (0,1) )'),
        T_VAL('ACT_046'   ,'1' ,'Activos financieros que están en varias agrupaciones asistidas vigentes'                                                                                               ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM (SELECT AUX.ACT_NUMERO_ACTIVO, COUNT(1) FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO T1 ON T1.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND (T1.ACT_COD_CARTERA, T1.ACT_COD_SUBCARTERA) IN ((''''01'''', ''''01''''),(''''02'''', ''''03''''),(''''03'''', ''''05''''),(''''04'''', ''''20''''),(''''05'''', ''''12'''')) JOIN REM01.MIG_AAA_AGRUPACION_ACTIVO T2 ON T2.ACT_NUMERO_ACTIVO = T1.ACT_NUMERO_ACTIVO AND T2.VALIDACION IN (0,1) JOIN REM01.MIG_AAG_AGRUPACIONES T3 ON T3.AGR_EXTERNO = T2.AGR_EXTERNO AND T3.TIPO_AGRUPACION = ''''13'''' AND T3.VALIDACION IN (0,1) GROUP BY AUX.ACT_NUMERO_ACTIVO HAVING COUNT(1) > 1) AUX JOIN REM01.MIG_AAA_AGRUPACION_ACTIVO T2 ON T2.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND T2.VALIDACION IN (0,1) JOIN REM01.MIG_AAG_AGRUPACIONES T3 ON T3.AGR_EXTERNO = T2.AGR_EXTERNO AND T3.TIPO_AGRUPACION = ''''13'''' AND T3.VALIDACION IN (0,1) WHERE T3.AGR_FECHA_VENCIMIENTO > SYSDATE GROUP BY AUX.ACT_NUMERO_ACTIVO HAVING COUNT (1) > 1'),
        T_VAL('ACT_047'   ,'1' ,'Activos financieros incluidos en agrupaciones de obra nueva'                                                                                                           ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO T1 ON T1.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND (T1.ACT_COD_CARTERA, T1.ACT_COD_SUBCARTERA) IN ((''''01'''', ''''01''''),(''''02'''', ''''03''''),(''''03'''', ''''05''''),(''''04'''', ''''20''''),(''''05'''', ''''12'''')) JOIN REM01.MIG_AAA_AGRUPACION_ACTIVO T2 ON T2.ACT_NUMERO_ACTIVO = T1.ACT_NUMERO_ACTIVO JOIN REM01.MIG_AAG_AGRUPACIONES T3 ON T3.AGR_EXTERNO = T2.AGR_EXTERNO AND T3.TIPO_AGRUPACION = ''''01'''''),
        T_VAL('ACT_048'   ,'1' ,'Activos publicados sin histórico de publicación en el mismo estado'                                                                                                    ,'MIG_ACA_CABECERA'                  ,'WITH ULTIMO_HIST_PUBLI AS ( SELECT AHP_CODIGO_ACTIVO, CASE WHEN DD_TCO_COD IN (''''01'''',''''02'''') THEN DD_EPV_COD WHEN DD_TCO_COD IN (''''03'''',''''04'''') THEN DD_EPA_COD END AS COD_PUBLICACION, CASE WHEN DD_TCO_COD IN (''''01'''',''''02'''') THEN ROW_NUMBER() OVER(PARTITION BY AHP_CODIGO_ACTIVO ORDER BY AHP_FECHA_INI_VENTA DESC, AHP_FECHA_FIN_VENTA DESC NULLS FIRST) WHEN DD_TCO_COD IN (''''03'''',''''04'''') THEN ROW_NUMBER() OVER(PARTITION BY AHP_CODIGO_ACTIVO ORDER BY AHP_FECHA_INI_ALQUILER DESC, AHP_FECHA_FIN_ALQUILER DESC NULLS FIRST) END AS RN FROM REM01.MIG2_ACT_AHP_HIST_PUBLICACION WHERE VALIDACION = 0  ) SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA             AUX  JOIN REM01.MIG2_ACT_ACTIVO              T2 ON T2.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND T2.ACT_COD_ESTADO_PUBLICACION NOT IN (''''05'''',''''06'''') LEFT JOIN ULTIMO_HIST_PUBLI             T3 ON T3.AHP_CODIGO_ACTIVO = T2.ACT_NUMERO_ACTIVO AND T3.COD_PUBLICACION = T2.ACT_COD_ESTADO_PUBLICACION AND T3.RN = 1  WHERE T3.AHP_CODIGO_ACTIVO IS NULL'),
        --T_VAL('ACT_049'   ,'1' ,'Activos publicados con histórico de publicación en el mismo estado, pero sin informe comercial'                                                                        ,'MIG_ACA_CABECERA'                  ,'WITH ULTIMO_HIST_PUBLI AS ( SELECT AHP_CODIGO_ACTIVO, CASE WHEN DD_TCO_COD IN (''''01'''',''''02'''') THEN DD_EPV_COD WHEN DD_TCO_COD IN (''''03'''',''''04'''') THEN DD_EPA_COD  END AS COD_PUBLICACION, CASE WHEN DD_TCO_COD IN (''''01'''',''''02'''') THEN ROW_NUMBER() OVER(PARTITION BY AHP_CODIGO_ACTIVO ORDER BY AHP_FECHA_INI_VENTA DESC, AHP_FECHA_FIN_VENTA DESC NULLS FIRST) WHEN DD_TCO_COD IN (''''03'''',''''04'''') THEN ROW_NUMBER() OVER(PARTITION BY AHP_CODIGO_ACTIVO ORDER BY AHP_FECHA_INI_ALQUILER DESC, AHP_FECHA_FIN_ALQUILER DESC NULLS FIRST) END AS RN, CASE WHEN DD_TCO_COD IN (''''01'''',''''02'''') THEN DD_TPU_V_CODIGO WHEN DD_TCO_COD IN (''''03'''',''''04'''') THEN DD_TPU_A_CODIGO END AS TIPO_PUBLICACION FROM REM01.MIG2_ACT_AHP_HIST_PUBLICACION WHERE VALIDACION = 0  ) SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA                 AUX  JOIN REM01.MIG2_ACT_ACTIVO                  T2 ON T2.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND T2.ACT_COD_ESTADO_PUBLICACION NOT IN (''''05'''',''''06'''') JOIN ULTIMO_HIST_PUBLI                      T3 ON T3.AHP_CODIGO_ACTIVO = T2.ACT_NUMERO_ACTIVO AND T3.COD_PUBLICACION = T2.ACT_COD_ESTADO_PUBLICACION AND T3.RN = 1 AND (T3.COD_PUBLICACION,T3.TIPO_PUBLICACION) IN ((''''01'''',''''01''''),(''''03'''',''''01''''),(''''04'''',''''01''''))  LEFT JOIN REM01.MIG_AIA_INFCOMERCIAL_ACT    T4 ON T4.ACT_NUMERO_ACTIVO = T2.ACT_NUMERO_ACTIVO AND T4.ICO_FECHA_ACEPTACION IS NOT NULL AND T4.ICO_FECHA_RECHAZO IS NULL  WHERE T4.ACT_NUMERO_ACTIVO IS NULL'),
        T_VAL('ACT_050'   ,'1' ,'Activos despublicados sin un estado en el histórico de publicación'                                                                                                    ,'MIG_ACA_CABECERA'                  ,'WITH ULTIMO_HIST_PUBLI AS ( SELECT AHP_CODIGO_ACTIVO FROM REM01.MIG2_ACT_AHP_HIST_PUBLICACION WHERE VALIDACION = 0  ) SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA             AUX  JOIN REM01.MIG2_ACT_ACTIVO              T1 ON T1.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND T1.ACT_COD_ESTADO_PUBLICACION = ''''05'''' LEFT JOIN ULTIMO_HIST_PUBLI             T2 ON T2.AHP_CODIGO_ACTIVO = AUX.ACT_NUMERO_ACTIVO  WHERE T2.AHP_CODIGO_ACTIVO IS NULL'),
        T_VAL('ACT_051'   ,'1' ,'Activos financieros con tipo de título distinto de Colateral'                                                                                                          ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO T1 ON T1.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND (T1.ACT_COD_CARTERA, T1.ACT_COD_SUBCARTERA) IN ((''''01'''', ''''01''''),(''''02'''', ''''03''''),(''''03'''', ''''05''''),(''''04'''', ''''20''''),(''''05'''', ''''12'''')) AND AUX.TIPO_TITULO <> ''''03'''''),
        T_VAL('ACT_052'   ,'0' ,'Activos inmobiliarios con tipo de título distinto de judicial o no judicial'                                                                                           ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO T1 ON T1.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO AND (T1.ACT_COD_CARTERA, T1.ACT_COD_SUBCARTERA) NOT IN ((''''01'''', ''''01''''),(''''02'''', ''''03''''),(''''03'''', ''''05''''),(''''04'''', ''''20''''),(''''05'''', ''''12'''')) AND AUX.TIPO_TITULO NOT IN (''''01'''',''''02'''')'),
		--Nuevas (APPLE):
        T_VAL('ACT_101'   ,'1' ,'Activos con situación comercial distinta a: disponible para la venta, no disponible (Alquilado, Traspasado, Vendido o No comercializable) o disponible condicionado'   ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.SITUACION_COMERCIAL NOT IN (''''01'''',''''05'''',''''06'''',''''10'''',''''02'''',''''09'''')'),
        --T_VAL('ACT_102'   ,'1' ,'Activo con fecha de venta externa' 																			                                                        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_VENTA_EXTERNA_FECHA IS NOT NULL'),
        --T_VAL('ACT_103'   ,'1' ,'Activo con fecha de venta' 																			                                                                ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_FECHA_VENTA IS NOT NULL'),
        --T_VAL('ACT_104'   ,'1' ,'Activo con importe de venta' 																			                                                      	        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_IMPORTE_VENTA IS NOT NULL'),
        --T_VAL('ACT_105'   ,'1' ,'Activo con importe de venta externa' 																			                                                        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_VENTA_EXTERNA_IMPORTE IS NOT NULL'),
        T_VAL('ACT_107'   ,'1' ,'Activos con situación comercial "Vendido" sin importe de venta o importe de venta externa' 					                                                        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE AUX.SITUACION_COMERCIAL = ''''05'''' AND ACT.ACT_IMPORTE_VENTA IS NULL AND ACT.ACT_VENTA_EXTERNA_IMPORTE IS NULL'),
        --T_VAL('ACT_108'   ,'1' ,'Activo con fecha de venta externa sin importe de venta externo'				                                                  									    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_VENTA_EXTERNA_FECHA IS NOT NULL AND ACT.ACT_VENTA_EXTERNA_IMPORTE IS NULL'),
        --T_VAL('ACT_109'   ,'1' ,'Activo con fecha de venta externa con fecha de venta o importe de venta' 																			                    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_VENTA_EXTERNA_FECHA IS NOT NULL AND (ACT.ACT_FECHA_VENTA IS NOT NULL OR ACT.ACT_IMPORTE_VENTA IS NOT NULL)'),
        --T_VAL('ACT_110'   ,'1' ,'Activo con fecha de venta sin importe de venta' 																			                                            ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_FECHA_VENTA IS NOT NULL AND ACT.ACT_IMPORTE_VENTA IS NULL'),
        --T_VAL('ACT_111'   ,'1' ,'Activo con fecha de venta con fecha de venta externa o importe de venta externo' 																			            ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG2_ACT_ACTIVO ACT ON ACT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE ACT.ACT_FECHA_VENTA IS NOT NULL AND (ACT.ACT_VENTA_EXTERNA_FECHA IS NOT NULL OR ACT.ACT_VENTA_EXTERNA_IMPORTE IS NOT NULL)'),
        T_VAL('ACT_112'   ,'0' ,'Municipio de registro fuera de la provincia de registro del activo' 																			        				,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ADA_DATOS_ADI ADA ON AUX.ACT_NUMERO_ACTIVO = ADA.ACT_NUMERO_ACTIVO WHERE (SELECT DD_PRV_ID FROM REMMASTER.DD_PRV_PROVINCIA PRV WHERE PRV.DD_PRV_CODIGO = ADA.PROVINCIA) NOT IN (SELECT DD_PRV_ID FROM REMMASTER.DD_LOC_LOCALIDAD LOC WHERE LOC.DD_LOC_CODIGO = ADA.MUNICIPIO_REGISTRO)'),
        T_VAL('ACT_113'   ,'0' ,'Municipio fuera de la provincia del activo' 																			                   							    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ADA_DATOS_ADI ADA ON AUX.ACT_NUMERO_ACTIVO = ADA.ACT_NUMERO_ACTIVO WHERE (SELECT DD_PRV_ID FROM REMMASTER.DD_PRV_PROVINCIA PRV WHERE PRV.DD_PRV_CODIGO = ADA.PROVINCIA) NOT IN (SELECT DD_PRV_ID FROM REMMASTER.DD_LOC_LOCALIDAD LOC WHERE LOC.DD_LOC_CODIGO = ADA.MUNICIPIO)'),
        T_VAL('ACT_116'   ,'0' ,'Activo con fecha de titulo y estado de titulo distinto de inscrito' 					                                        									    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ATI_TITULO TIT ON AUX.ACT_NUMERO_ACTIVO = TIT.ACT_NUMERO_ACTIVO WHERE TIT.TIT_FECHA_INSC_REG IS NOT NULL AND TIT.ESTADO_TITULO NOT IN (''''02'''')'),
        T_VAL('ACT_117'   ,'0' ,'Activo con fecha de lanzamiento o de lanzamiento efectivo y sin indicador de lanzamiento necesario' 			       					      						    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ADA_DATOS_ADI ADA ON ADA.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO JOIN REM01.MIG_ADJ_JUDICIAL ADJ ON ADJ.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE (ADJ.BIE_ADJ_LANZAMIENTO_NECES = 0 OR ADJ.BIE_ADJ_LANZAMIENTO_NECES IS NULL) AND (ADA.SPS_FECHA_LANZAMIENTO IS NOT NULL OR ADA.SPS_FECHA_LANZAMIENTO_EFECTIVO IS NOT NULL)'),
	    T_VAL('ACT_120'   ,'1' ,'Activo con fecha de presentación en el registro posterior a la fecha de inscripción'                                            									    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ATI_TITULO TIT ON TIT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE TRUNC(TIT.TIT_FECHA_PRESENT1_REG) > TRUNC(TIT.TIT_FECHA_INSC_REG)'),
        T_VAL('ACT_121'   ,'1' ,'Activo con subtipo de título fuera del tipo título' 																			                                        ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE (SELECT DD_TTA_ID FROM REM01.DD_TTA_TIPO_TITULO_ACTIVO TTA WHERE TTA.DD_TTA_CODIGO = AUX.TIPO_TITULO) NOT IN (SELECT DD_TTA_ID FROM REM01.DD_STA_SUBTIPO_TITULO_ACTIVO STA WHERE STA.DD_STA_CODIGO = AUX.SUBTIPO_TITULO)'),
        T_VAL('ACT_123'   ,'0' ,'Activo con código postal fuera de la provincia del activo' 		   	                                                  									            ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ADA_DATOS_ADI ADA ON AUX.ACT_NUMERO_ACTIVO = ADA.ACT_NUMERO_ACTIVO WHERE SUBSTR(LPAD(ADA.LOC_COD_POST,5,''''0''''),0,2) <> LPAD(ADA.PROVINCIA,2,''''0'''')'),
        T_VAL('ACT_124'   ,'1' ,'Activo con fecha de de realización anterior a la de señalamiento' 																			                		    ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ADJ_JUDICIAL ADJ ON ADJ.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE TRUNC(ADJ.BIE_ADJ_F_REA_POSESION) < TRUNC(ADJ.BIE_ADJ_F_SEN_POSESION)'),
        T_VAL('ACT_125'   ,'1' ,'Activo con segunda fecha de presentación del registro anterior a la primera' 																			                ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX JOIN REM01.MIG_ATI_TITULO TIT ON TIT.ACT_NUMERO_ACTIVO = AUX.ACT_NUMERO_ACTIVO WHERE TRUNC(TIT.TIT_FECHA_PRESENT2_REG) < TRUNC(TIT.TIT_FECHA_PRESENT1_REG)'),
              
        --AGRUPACIONES
		----------------------------------------------------------------------------------------------------------------------------																	                                                                          
        T_VAL('AGR_001'   ,'1' ,'Agrupaciones que tienen activos con distinta cartera'                                                                                                                  ,'MIG_AAG_AGRUPACIONES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM (SELECT AAA.AGR_EXTERNO, ACT2.ACT_COD_CARTERA FROM REM01.MIG_AAA_AGRUPACION_ACTIVO AAA INNER JOIN REM01.MIG_ACA_CABECERA ACA ON ACA.ACT_NUMERO_ACTIVO = AAA.ACT_NUMERO_ACTIVO INNER JOIN REM01.MIG2_ACT_ACTIVO ACT2 ON ACT2.ACT_NUMERO_ACTIVO = ACA.ACT_NUMERO_ACTIVO GROUP BY AAA.AGR_EXTERNO, ACT2.ACT_COD_CARTERA) AUX GROUP BY AGR_EXTERNO HAVING COUNT(1) > 1'),
        T_VAL('AGR_002'   ,'1' ,'Agrupaciones sin activos'                                                                                                                                              ,'MIG_AAG_AGRUPACIONES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_AAG_AGRUPACIONES AUX LEFT JOIN REM01.MIG_AAA_AGRUPACION_ACTIVO AAA ON AAA.AGR_EXTERNO = AUX.AGR_EXTERNO LEFT JOIN REM01.MIG_ACA_CABECERA ACT ON ACT.ACT_NUMERO_ACTIVO = AAA.ACT_NUMERO_ACTIVO WHERE ACT.ACT_NUMERO_ACTIVO IS NULL'),
        --Nuevas (APPLE):
        T_VAL('AGR_101'   ,'0' ,'Municipio de la agrupación tiene que estar dentro de la provincia correcta'                                                                                            ,'MIG_AAG_AGRUPACIONES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_AAG_AGRUPACIONES AUX WHERE (AUX.TIPO_AGRUPACION = ''''02'''' AND ((SELECT DD_PRV_ID FROM REMMASTER.DD_PRV_PROVINCIA PRV WHERE PRV.DD_PRV_CODIGO = AUX.PRO_AGRUP_LOTE_RESTRINGIDO) NOT IN (SELECT DD_PRV_ID FROM REMMASTER.DD_LOC_LOCALIDAD LOC WHERE LOC.DD_LOC_CODIGO = AUX.LOC_AGRUP_LOTE_RESTRINGIDO))) OR (AUX.TIPO_AGRUPACION = ''''01'''' AND ((SELECT DD_PRV_ID FROM REMMASTER.DD_PRV_PROVINCIA PRV WHERE PRV.DD_PRV_CODIGO = AUX.PROV_AGRUP_OBRA_NUEVA) NOT IN (SELECT DD_PRV_ID FROM REMMASTER.DD_LOC_LOCALIDAD LOC WHERE LOC.DD_LOC_CODIGO = AUX.LOC_AGRUP_OBRA_NUEVA)))'),
        T_VAL('AGR_102'   ,'0' ,'CP, municipio, provincia de la agrupación tiene que coincidir con el CP, municipio y la provincia de los activos que la componen'                                      ,'MIG_AAG_AGRUPACIONES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_AAG_AGRUPACIONES AUX JOIN REM01.MIG_AAA_AGRUPACION_ACTIVO AAA ON AUX.AGR_EXTERNO = AAA.AGR_EXTERNO JOIN REM01.MIG_ACA_CABECERA ACA ON ACA.ACT_NUMERO_ACTIVO = AAA.ACT_NUMERO_ACTIVO JOIN REM01.MIG_ADA_DATOS_ADI ADA  ON ACA.ACT_NUMERO_ACTIVO = ADA.ACT_NUMERO_ACTIVO WHERE (AUX.TIPO_AGRUPACION = ''''02'''' AND ((TO_CHAR(LPAD(AUX.RES_CP_AGRUP_LOTE_RESTRINGIDO,5,''''0'''')) <> ADA.LOC_COD_POST) OR (AUX.LOC_AGRUP_LOTE_RESTRINGIDO <> ADA.MUNICIPIO) OR (AUX.PRO_AGRUP_LOTE_RESTRINGIDO <> ADA.PROVINCIA))) OR (AUX.TIPO_AGRUPACION = ''''01'''' AND ((TO_CHAR(LPAD(AUX.ONV_CP_AGRUP_OBRA_NUEVA,5,''''0'''')) <> ADA.LOC_COD_POST) OR (AUX.LOC_AGRUP_OBRA_NUEVA <> ADA.MUNICIPIO) OR (AUX.PROV_AGRUP_OBRA_NUEVA <> ADA.PROVINCIA)))')
        

        /*
			Resto de bloques
		*/
        --Validaciones para ofertas
        /*T_VAL('OFR_001'   ,'1' ,'Ofertas en estado distinto a anulación con motivo de anulación informado'                                                                                        ,'MIG2_OFR_OFERTAS'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_OFR_OFERTAS AUX WHERE (AUX.OFR_COD_ESTADO_OFERTA != ''''01-07'''' AND AUX.OFR_FECHA_ANULACION IS NULL AND AUX.OFR_COD_MOTIVO_ANULACION != 0) '),
        T_VAL('OFR_002'   ,'1' ,'Ofertas que o bien se solicita financiación y no está informada la entidad financiadora o bien no se solicita y viene informada'                                   ,'MIG2_OFR_OFERTAS'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_OFR_OFERTAS AUX INNER JOIN REM01.MIG2_COE_CONDICIONAN_OFR_ACEP COE ON AUX.OFR_COD_OFERTA = COE.COE_COD_OFERTA WHERE (COE.COE_SOLICITA_FINANCIACION = 1 AND COE.COE_ENTIDAD_FINANCIACION_AJENA IS NULL) OR ((COE.COE_SOLICITA_FINANCIACION = 0 OR COE.COE_SOLICITA_FINANCIACION IS NULL) AND COE.COE_ENTIDAD_FINANCIACION_AJENA IS NOT NULL)'),
        T_VAL('OFR_003'   ,'1' ,'Ofertas aceptadas sin importes'                                                                                                                                    ,'MIG2_OFR_OFERTAS'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_OFR_OFERTAS AUX WHERE AUX.OFR_COD_ESTADO_OFERTA LIKE ''''01%'''' AND AUX.OFR_IMPORTE IS NULL'),
        T_VAL('OFR_004'   ,'1' ,'Ofertas con contraoferta sin importe contraoferta o fecha de contraoferta'                                                                                         ,'MIG2_OFR_OFERTAS'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_OFR_OFERTAS AUX WHERE AUX.OFR_COD_ESTADO_OFERTA = ''''01-04'''' AND ((AUX.OFR_IMPORTE_CONTRAOFERTA IS NULL AND AUX.OFR_FECHA_CONTRAOFERTA IS NOT NULL) OR (AUX.OFR_IMPORTE_CONTRAOFERTA IS NOT NULL AND AUX.OFR_FECHA_CONTRAOFERTA IS NULL))'),
        T_VAL('OFR_005'   ,'1' ,'Ofertas sin registro en MIG2_COE_CONDICIONAN_OFR_ACEP'                                                                                                             ,'MIG2_OFR_OFERTAS'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_OFR_OFERTAS AUX LEFT JOIN MIG2_COE_CONDICIONAN_OFR_ACEP COE ON COE.COE_COD_OFERTA = AUX.OFR_COD_OFERTA WHERE SUBSTR(AUX.OFR_COD_ESTADO_OFERTA,1,2) = ''''01'''' AND COE.COE_COD_OFERTA IS NULL'),
        T_VAL('OFR_006'   ,'1' ,'Ofertas con mismo webcom ID que ofertas ya existentes'                                                                                                             ,'MIG2_OFR_OFERTAS'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_OFR_OFERTAS AUX JOIN REM01.OFR_OFERTAS OFR ON AUX.OFR_WEBCOM_ID = OFR.OFR_WEBCOM_ID'),

        --Validaciones para proveedores                                                            
        T_VAL('PVE_001'   ,'1' ,'Proveedores sin estado "Vigente" / "Baja"'                                                                                                                         ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_ESTADO IS NULL OR AUX.PVE_COD_ESTADO NOT IN (''''04'''',''''07'''')'),
        T_VAL('PVE_002'   ,'1' ,'Proveedores sin "Fecha de alta"'                                                                                                                                   ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_FECHA_ALTA IS NULL'),
        T_VAL('PVE_003'   ,'1' ,'Proveedores en estado "Vigente" sin contacto con usuario o email'                                                                                                  ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX LEFT JOIN REM01.MIG2_PVC_PROVEEDOR_CONTACTO PVC ON PVC.PVE_COD_UVEM = AUX.PVE_COD_UVEM WHERE AUX.PVE_COD_ESTADO = ''''04'''' AND (PVC.PVC_COD_USUARIO IS NULL OR PVC.PVC_EMAIL IS NULL)'),
        T_VAL('PVE_004'   ,'0' ,'Proveedores con un tipo de documento identificativo distinto al NIF'                                                                                               ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_TIPO_DOCUMENTO != ''''15'''''),
        --T_VAL('PVE_005'   ,'1' ,'Proveedores con documento identificativo duplicado y distinto código UVEM (Únicamente para proveedores vigentes y sin contar las oficinas)'                      ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX INNER JOIN ( SELECT UPPER(REPLACE(TRANSLATE(PVE_DOCUMENTO_ID, ''''-_.'''', ''''#''''), ''''#'''', '''''''')) PVE_DOCUMENTO_ID FROM (SELECT DISTINCT PVE_COD_UVEM, PVE_DOCUMENTO_ID FROM REM01.MIG2_PVE_PROVEEDORES WHERE PVE_COD_TIPO_PROVEEDOR NOT IN (''''28'''',''''29'''') AND PVE_COD_ESTADO = ''''04'''') AUX GROUP BY UPPER(REPLACE(TRANSLATE(PVE_DOCUMENTO_ID, ''''-_.'''', ''''#''''), ''''#'''', '''''''')) HAVING COUNT(1) > 1 ) SQLI ON UPPER(REPLACE(TRANSLATE(AUX.PVE_DOCUMENTO_ID, ''''-_.'''', ''''#''''), ''''#'''', '''''''')) = SQLI.PVE_DOCUMENTO_ID'),
        T_VAL('PVE_006'   ,'0' ,'Proveedores en estado "Vigente" sin numero de cuenta'                                                                                                              ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_ESTADO = ''''04'''' AND AUX.PVE_NUM_CUENTA IS NULL'),
        T_VAL('PVE_007'   ,'0' ,'Proveedores en estado "Vigente" sin titular'                                                                                                                       ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_ESTADO = ''''04'''' AND AUX.PVE_TITULAR IS NULL'),
        T_VAL('PVE_008'   ,'1' ,'Proveedores con localidad informada y no tienen informada la provincia'                                                                                            ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_LOCALIDAD IS NOT NULL AND AUX.PVE_COD_PROVINCIA IS NULL'),
        T_VAL('PVE_009'   ,'1' ,'Proveedores en estado "Baja" sin fecha de baja informada'                                                                                                          ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_ESTADO = ''''07'''' AND AUX.PVE_FECHA_BAJA IS NULL'),
        T_VAL('PVE_010'   ,'1' ,'Proveedores sin estado'                                                                                                                                            ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_ESTADO IS NULL'),
        T_VAL('PVE_011'   ,'1' ,'Proveedores duplicados con el mismo NIF y misma tipologia (Únicamente para proveedores vigentes)'                                                                  ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX INNER JOIN ( SELECT UPPER(REPLACE(TRANSLATE(PVE_DOCUMENTO_ID, ''''-_.'''', ''''#''''), ''''#'''', '''''''')) PVE_DOCUMENTO_ID FROM REM01.MIG2_PVE_PROVEEDORES WHERE PVE_COD_TIPO_PROVEEDOR NOT IN (''''28'''',''''29'''',''''23'''',''''30'''',''''31'''') AND PVE_COD_ESTADO = ''''04'''' GROUP BY UPPER(REPLACE(TRANSLATE(PVE_DOCUMENTO_ID, ''''-_.'''', ''''#''''), ''''#'''', '''''''')), PVE_COD_TIPO_PROVEEDOR HAVING COUNT(1) > 1) SQLI ON UPPER(REPLACE(TRANSLATE(AUX.PVE_DOCUMENTO_ID, ''''-_.'''', ''''#''''), ''''#'''', '''''''')) = SQLI.PVE_DOCUMENTO_ID'),
        T_VAL('PVE_012'   ,'1' ,'Proveedores en estado distinto a "Vigente" sin fecha de baja informada'                                                                                            ,'MIG2_PVE_PROVEEDORES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_PVE_PROVEEDORES AUX WHERE AUX.PVE_COD_ESTADO != ''''04'''' AND AUX.PVE_FECHA_BAJA IS NULL'),
        T_VAL('GPV_001'   ,'1' ,'Gastos que no tengan el tipo de gasto informado'                                                                                                                   ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_GPV_GASTOS_PROVEEDORES AUX WHERE AUX.GPV_COD_TIPO_GASTO IS NULL'),
        T_VAL('GPV_002'   ,'1' ,'Gastos que no tengan el subtipo de gasto informado'                                                                                                                ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_GPV_GASTOS_PROVEEDORES AUX WHERE AUX.GPV_COD_SUBTIPO_GASTO IS NULL'),
        T_VAL('GPV_003'   ,'1' ,'Gastos sin IVA que no tengan la periodicidad informada'                                                                                                            ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_GPV_GASTOS_PROVEEDORES AUX JOIN REM01.MIG2_GDE_GASTOS_DET_ECONOMICO T2 ON AUX.GPV_ID = T2.GDE_GPV_ID WHERE AUX.GPV_COD_PERIODICIDAD IS NULL AND T2.GDE_COD_TIPO_IMPUESTO IS NULL'),
        T_VAL('GPV_004'   ,'1' ,'Gastos que no tengan la fecha de emision informada'                                                                                                                ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_GPV_GASTOS_PROVEEDORES AUX WHERE AUX.GPV_FECHA_EMISION IS NULL'),
        --T_VAL('GPV_005'   ,'1' ,'Gastos que puedan generar un estado'                                                                                                                             ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_GPV_GASTOS_PROVEEDORES AUX JOIN MIG2_GGE_GASTOS_GESTION T2 ON T2.GGE_GPV_ID = AUX.GPV_ID JOIN MIG2_GDE_GASTOS_DET_ECONOMICO T3 ON T3.GDE_GPV_ID = AUX.GPV_ID JOIN MIG2_GIC_GASTOS_INFO_CONTABI T4 ON T4.GIC_GPV_ID = AUX.GPV_ID WHERE (T2.GGE_COD_EST_AUTORIZ_HAYA, T2.GGE_COD_EST_AUTORIZ_PROP) NOT IN ((''''01'''',''''01''''),(''''02'''',''''01''''),(''''03'''',''''01''''),(''''02'''',''''02''''),(''''02'''',''''03''''),(''''02'''',''''04''''),(''''03'''',''''02''''),(''''03'''',''''05''''),(''''03'''',''''06''''), (''''03'''',''''07'''')) OR (T2.GGE_COD_EST_AUTORIZ_HAYA IS NULL OR T2.GGE_COD_EST_AUTORIZ_PROP IS NULL)'),
        T_VAL('GPV_006'   ,'1' ,'Gastos cuyo tipo de operacion no sea Pago gasto, Pago gasto inversion o Abono/Factura rectificativa'                                                               ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GPV_GASTOS_PROVEEDORES AUX WHERE NVL(AUX.GPV_COD_TIPO_OPERACION,''''00'''') NOT IN (''''01'''',''''02'''',''''03'''')'),
        T_VAL('GPV_007'   ,'1' ,'Gastos sin autorizar por HAYA'                                                                                                                                     ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GPV_GASTOS_PROVEEDORES AUX WHERE NVL(AUX.GPV_COD_TIPO_OPERACION,''''00'''') NOT IN (''''01'''',''''02'''',''''03'''')'),
        T_VAL('GPV_008'   ,'1' ,'Gastos sin IVA que no tienen provisión de fondos.'                                                                                                                 ,'MIG2_GPV_GASTOS_PROVEEDORES'       ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG2_GPV_GASTOS_PROVEEDORES AUX JOIN REM01.MIG2_GDE_GASTOS_DET_ECONOMICO T2 ON AUX.GPV_ID = T2.GDE_GPV_ID AND T2.GDE_COD_TIPO_IMPUESTO IS NULL WHERE NOT EXISTS (SELECT 1 FROM REM01.MIG2_GPR_PROVISION_GASTOS T3 WHERE T3.GPR_NUMERO_PROVISION_FONDOS = AUX.GPV_NUMERO_PROVISION_FONDOS)'),
    
        --T_VAL('GPT_001'   ,'1' ,'Gastos activo trabajo, cuyo sumatorio de la base imponible agrupado por gasto, no coincida con el total especificado en el propio detalle del gasto'             ,'MIG2_GPV_ACT_TBJ'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM (SELECT AUX.GPT_ACT_NUMERO_ACTIVO, SUM(AUX.GPT_BASE_IMPONIBLE) BASE FROM MIG2_GPV_ACT_TBJ AUX GROUP BY AUX.GPT_ACT_NUMERO_ACTIVO) T2 JOIN MIG2_GPV_ACT_TBJ AUX ON AUX.GPT_ACT_NUMERO_ACTIVO = T2.GPT_ACT_NUMERO_ACTIVO WHERE T2.BASE <> 100 UNION SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GPV_ACT_TBJ AUX WHERE AUX.GPT_BASE_IMPONIBLE IS NULL'),
        T_VAL('GDE_001'   ,'1' ,'Gastos detalle económico, el principal está informado sin tener IVA o viceversa'                                                                                   ,'MIG2_GDE_GASTOS_DET_ECONOMICO'     ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GDE_GASTOS_DET_ECONOMICO AUX WHERE NVL(GDE_COD_TIPO_IMPUESTO,''''00'''') = ''''01'''' AND NVL(GDE_PRINCIPAL_SUJETO,0) = 0 UNION SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GDE_GASTOS_DET_ECONOMICO AUX WHERE GDE_COD_TIPO_IMPUESTO IS NULL AND NVL(GDE_PRINCIPAL_SUJETO,0)<>0'),
        T_VAL('GDE_002'   ,'1' ,'Gastos detalle económico, el impuesto indirecto por renuncia exención sólo puede tener valor en caso de que el impuesto indirecto exento sea SÍ'                   ,'MIG2_GDE_GASTOS_DET_ECONOMICO'     ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GDE_GASTOS_DET_ECONOMICO AUX WHERE NVL(AUX.GDE_IND_IMP_INDIRECTO_EXENTO,1)=1 AND AUX.GDE_IND_IMP_INDIR_RENUN_EXENC IS NOT NULL'),
        T_VAL('GDE_003'   ,'1' ,'Gastos detalle económico, el indicador de inclusión de pago provisión está informado pero la fecha y/o el importe de dicho pago no lo están'                       ,'MIG2_GDE_GASTOS_DET_ECONOMICO'     ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GDE_GASTOS_DET_ECONOMICO AUX WHERE AUX.GDE_INCLUIR_PAGO_PROVISION IS NOT NULL AND (AUX.GDE_FECHA_PAGO IS NULL OR AUX.GDE_IMPORTE_PAGADO IS NULL)'),
        T_VAL('GDE_004'   ,'1' ,'Gastos detalle económico, la cuenta de abono debe ser distinta a la del emisor del gasto'                                                                          ,'MIG2_GDE_GASTOS_DET_ECONOMICO'     ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GDE_GASTOS_DET_ECONOMICO AUX JOIN MIG2_GPV_GASTOS_PROVEEDORES GPV ON AUX.GDE_GPV_ID = GPV.GPV_ID JOIN MIG2_PVE_PROVEEDORES PVE ON GPV.GPV_COD_PVE_UVEM_EMISOR = PVE.PVE_COD_UVEM WHERE AUX.GDE_ABONO_CUENTA = 1 AND AUX.GDE_IBAN = PVE.PVE_NUM_CUENTA AND ((GPV.GPV_COD_TIPO_GASTO = ''''01'''' AND PVE.PVE_COD_TIPO_PROVEEDOR IN (''''13'''', ''''15'''')) OR (GPV.GPV_COD_TIPO_GASTO = ''''02'''' AND PVE.PVE_COD_TIPO_PROVEEDOR IN (''''13'''', ''''16'''')) OR (GPV.GPV_COD_TIPO_GASTO = ''''03'''' AND PVE.PVE_COD_TIPO_PROVEEDOR IN (''''13'''', ''''17'''')) OR (GPV.GPV_COD_TIPO_GASTO = ''''04'''' AND PVE.PVE_COD_TIPO_PROVEEDOR IN (''''13'''',''''16'''',''''17'''')))'),
        T_VAL('GGE_001'   ,'0' ,'Gastos de gestión autorizados por el propietario sin fecha de autorización informada'                                                                              ,'MIG2_GGE_GASTOS_GESTION'           ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GGE_GASTOS_GESTION AUX WHERE GGE_FECHA_EST_AUTORIZ_PROP IS NULL AND GGE_COD_EST_AUTORIZ_PROP IS NOT NULL'),
        T_VAL('GPR_001'   ,'1' ,'Gastos proveedores provisión sin número de provisión de fondos informado cuando el gasto es sin IVA'                                                               ,'MIG2_GPR_PROVISION_GASTOS'         ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GPR_PROVISION_GASTOS AUX JOIN MIG2_GPV_GASTOS_PROVEEDORES GPV ON AUX.GPR_NUMERO_PROVISION_FONDOS = GPV.GPV_NUMERO_PROVISION_FONDOS JOIN MIG2_GDE_GASTOS_DET_ECONOMICO GDE ON GPV.GPV_ID = GDE.GDE_GPV_ID WHERE GDE.GDE_COD_TIPO_IMPUESTO IS NULL AND AUX.GPR_NUMERO_PROVISION_FONDOS IS NULL'),
        T_VAL('GPR_002'   ,'1' ,'Gastos proveedores provisión sin fecha de envío cuando existe fecha de respuesta o con fecha de envío más antigua que la fecha de alta'                            ,'MIG2_GPR_PROVISION_GASTOS'         ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GPR_PROVISION_GASTOS AUX WHERE (AUX.GPR_FECHA_ALTA IS NOT NULL AND AUX.GPR_FECHA_ENVIO < AUX.GPR_FECHA_ALTA) OR (AUX.GPR_FECHA_RESPUESTA IS NOT NULL AND AUX.GPR_FECHA_ENVIO IS NULL)'),
        T_VAL('GPR_003'   ,'1' ,'Gastos proveedores provisión con fecha de respuesta anterior a fecha de envío'                                                                                     ,'MIG2_GPR_PROVISION_GASTOS'         ,'SELECT DISTINCT #SELECT_STATEMENT# FROM MIG2_GPR_PROVISION_GASTOS AUX WHERE AUX.GPR_FECHA_RESPUESTA IS NOT NULL AND AUX.GPR_FECHA_RESPUESTA < AUX.GPR_FECHA_ENVIO'),
        */
        
        /*
			Validaciones funcionales excluidas
        */
        --T_VAL('ACT_001'   ,'1' ,'Activos sin tipo de activo'                                                                                                                                            ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.TIPO_ACTIVO IS NULL'),
        --T_VAL('ACT_002'   ,'1' ,'Activos sin subtipo de activo'                                                                                                                                         ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.SUBTIPO_ACTIVO IS NULL'),
        --T_VAL('ACT_003'   ,'1' ,'Activos sin estado de activo'                                                                                                                                          ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.ESTADO_ACTIVO IS NULL'),
        --T_VAL('ACT_004'   ,'1' ,'Activos sin tipo titulo'                                                                                                                                               ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.TIPO_TITULO IS NULL'),
        --T_VAL('ACT_010'   ,'1' ,'Activos con tipo y subtipo de activo incorrecto'                                                                                                                       ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE NOT EXISTS (SELECT 1 FROM REM01.DD_SAC_SUBTIPO_ACTIVO SAC WHERE SAC.DD_TPA_ID = (SELECT DD_TPA_ID FROM REM01.DD_TPA_TIPO_ACTIVO DD_TPA WHERE DD_TPA.DD_TPA_CODIGO = AUX.TIPO_ACTIVO) AND SAC.DD_SAC_CODIGO = AUX.SUBTIPO_ACTIVO)'),
        --T_VAL('ACT_019'   ,'1' ,'Activos sin tipo titulo'                                                                                                                                               ,'MIG_ACA_CABECERA'                  ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_ACA_CABECERA AUX WHERE AUX.TIPO_TITULO IS NULL'),
        --T_VAL('AGR_003'   ,'1' ,'Agrupaciones restringidas sin activo principal'                                                                                                                    ,'MIG_AAG_AGRUPACIONES'              ,'SELECT DISTINCT #SELECT_STATEMENT# FROM (SELECT AAG.AGR_UVEM , AAA.ACT_NUMERO_ACTIVO , AAA.AGA_PRINCIPAL , ROW_NUMBER () OVER (PARTITION BY AAG.AGR_UVEM ORDER BY AAA.AGA_PRINCIPAL DESC) RANK FROM REM01.MIG_AAG_AGRUPACIONES AAG LEFT JOIN REM01.MIG_AAA_AGRUPACION_ACTIVO AAA ON AAA.AGR_UVEM = AAG.AGR_UVEM WHERE AAG.TIPO_AGRUPACION = ''''02'''') AUX WHERE RANK = 1 AND AGA_PRINCIPAL <> 1')
        --T_VAL('VAL_001'   ,'1' ,'Activos preciados con importes menores de un euro'                                                                                                                 ,'MIG_APC_PRECIO'                    ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_APC_PRECIO AUX WHERE AUX.VAL_IMPORTE < 1 AND AUX.TIPO_PRECIO IN (''''02'''',''''04'''')'),
        --T_VAL('ACT_119'   ,'1' ,'Propietario sin Nif o tipo de propietario' 									                                                  									  ,'MIG_APC_PROP_CABECERA'             ,'SELECT DISTINCT #SELECT_STATEMENT# FROM REM01.MIG_APC_PROP_CABECERA AUX WHERE AUX.PRO_NIF IS NULL OR AUX.TIPO_PERSONA IS NULL'),
    );
    
    V_TMP_VAL T_VAL;  
    
BEGIN
  
    DBMS_OUTPUT.PUT_LINE('[INICIO]');
    
    -- Verificar si la tabla existe
    V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA||''' AND OWNER = '''||V_ESQUEMA||'''';
    EXECUTE IMMEDIATE V_MSQL INTO V_NUM_TABLAS;   
    
    IF V_NUM_TABLAS > 0 THEN    
        DBMS_OUTPUT.PUT_LINE('  [INFO] La tabla '||V_ESQUEMA|| '.'||V_TABLA||'... Existe.');
        
        -- Verificar si la sequencia existe
        V_MSQL := 'SELECT COUNT(1) FROM ALL_SEQUENCES WHERE SEQUENCE_NAME = '''||V_TABLA_SEQ||''' AND SEQUENCE_OWNER = '''||V_ESQUEMA||'''';
        EXECUTE IMMEDIATE V_MSQL INTO V_NUM_TABLAS;   
        
        IF V_NUM_TABLAS > 0 THEN
            
            EXECUTE IMMEDIATE 'TRUNCATE TABLE '||V_ESQUEMA||'.'||V_TABLA;
            DBMS_OUTPUT.PUT_LINE('    [INFO] La sequencia '||V_ESQUEMA|| '.'||V_TABLA_SEQ||'... Existe.');
            
            -- Comprobamos el estado de la sequencia
            -- Obtenemos el valor en el que se encuentra la sequencia
            V_SQL := 'SELECT '||V_ESQUEMA||'.'||V_TABLA_SEQ||'.NEXTVAL FROM DUAL';
            EXECUTE IMMEDIATE V_SQL INTO V_NUM_SEQUENCE;
            
            -- Obtenemos el maximo valor de ID
            V_SQL := 'SELECT NVL(MAX(VALIDACION_ID), 0) FROM '||V_ESQUEMA||'.'||V_TABLA||'';
            EXECUTE IMMEDIATE V_SQL INTO V_NUM_MAXID;
            
            -- Igualamos la sequencia al maximo valor de ID
            WHILE V_NUM_SEQUENCE < V_NUM_MAXID LOOP
                EXECUTE IMMEDIATE 'SELECT '||V_ESQUEMA||'.'||V_TABLA_SEQ||'.NEXTVAL FROM DUAL';
            END LOOP;
    
            FOR I IN V_VAL.FIRST .. V_VAL.LAST 
            LOOP
                V_TMP_VAL := V_VAL(I);  
                
                V_SQL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.'||V_TABLA||' WHERE CODIGO = '''||V_TMP_VAL(1)||''' AND BORRADO = 0';
                EXECUTE IMMEDIATE V_SQL INTO V_NUM_TABLAS;
                
                IF V_NUM_TABLAS = 0 THEN
                
                    DBMS_OUTPUT.PUT_LINE('      [INFO] Insertando validación: '''||V_TMP_VAL(3)||'''...');
                    EXECUTE IMMEDIATE '
                    INSERT INTO '||V_ESQUEMA||'.'||V_TABLA||' (
                        VALIDACION_ID  
                        ,CODIGO         
                        ,SEVERIDAD      
                        ,VALIDACION     
                        ,NOMBRE_INTERFAZ
                        ,QUERY          
                        ,BORRADO        
                    )
                    SELECT
                        '||V_ESQUEMA||'.'||V_TABLA_SEQ||'.NEXTVAL
                        , '''||V_TMP_VAL(1)||'''
                        , '''||V_TMP_VAL(2)||'''
                        , '''||V_TMP_VAL(3)||'''
                        , '''||V_TMP_VAL(4)||'''
                        , '''||V_TMP_VAL(5)||'''
                        , 0
                    FROM DUAL
                    '
                    ;
                
                ELSE
                    DBMS_OUTPUT.PUT_LINE('      [INFO] La validacion '''||V_TMP_VAL(3)||'''... Existe.');
                END IF;
                
            END LOOP;
        
        ELSE
            DBMS_OUTPUT.PUT_LINE('    [INFO] La sequencia '||V_ESQUEMA|| '.'||V_TABLA_SEQ||'... No existe.');
        END IF;  
    
    ELSE
        DBMS_OUTPUT.PUT_LINE('  [INFO] La tabla '||V_ESQUEMA|| '.'||V_TABLA||'... No existe.');
    END IF;
    
    COMMIT;
    
    DBMS_OUTPUT.PUT_LINE('[FIN]');    

EXCEPTION
  WHEN OTHERS THEN 
    DBMS_OUTPUT.PUT_LINE('KO!');
    err_num := SQLCODE;
    err_msg := SQLERRM;
    
    DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
    DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
    DBMS_OUTPUT.put_line(err_msg);
    
    ROLLBACK;
    RAISE;          

END;

/

EXIT;
