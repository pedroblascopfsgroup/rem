--/*
--##########################################
--## AUTOR=DAP
--## FECHA_CREACION=20180418
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=2.0.16
--## INCIDENCIA_LINK=REMVIP-536
--## PRODUCTO=NO
--## Finalidad: Interfax Stock REM - UVEM. Nuevas columnas. Anula DDL_99900087
--##           
--## INSTRUCCIONES: Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/
--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;

create or replace PROCEDURE SP_UPA_UPDATE_ACTIVES_UVEM (
      V_USUARIO VARCHAR2 DEFAULT 'SP_UPA_UVEM',
      PL_OUTPUT       OUT VARCHAR2
)
AS

V_ESQUEMA VARCHAR2(15 CHAR) := '#ESQUEMA#';
V_ESQUEMA_MASTER VARCHAR2(15 CHAR) := '#ESQUEMA_MASTER#';
V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
V_SQL2 VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
V_NOT_UPDATE VARCHAR2(2000 CHAR) := '';

  --[1]TABLA BIE_BIEN
                      --BIE_VIVIENDA_HABITUAL
                      --BIE_PORCT_IMP_COMPRA
  --[2]TABLA BIE_DATOS_REGISTRALES
                      --BIE_DREG_LIBRO, BIE_DREG_TOMO Y BIE_DREG_FOLIO
  --[3]TABLA BIE_ADJ_ADJUDICACION
                      --BIE_ADJ_IMPORTE_ADJUDICACION
                      --BIE_ADJ_LANZAMIENTO_NECES
                      --BIE_ADJ_F_SEN_POSESION
                      --BIE_ADJ_F_SEN_LANZAMIENTO
                      --BIE_ADJ_F_REA_LANZAMIENTO
                      --BIE_ADJ_FSOLMORATORIA
                      --BIE_ADJ_F_RES_MORATORIA
                      --BIE_ADJ_F_DECRETO_FIRME
  --[4]TABLA ACT_ACTIVO
                       --ACT_VPO
                       --ACT_LLAVES_NECESARIAS
                       --ACT_LLAVES_FECHA_RECEP
                       --ACT_NUM_INMOVILIZADO_BNK
                       --DD_ENA_ID
  --[5]TABLA ACT_AJD_ADJJUDICIAL
                      --AJD_NUM_AUTO
                      --AJD_PROCURADOR
                      --DD_PLA_ID
  --[6]TABLA ACT_ADN_AJDNOJUDICIAL
                      --ADN_FECHA_FIRMA_TITULO
                      --ADN_TRAMITADOR_TITULO
                      --ADN_NUM_REFERENCIA
  --[7]TABLA ACT_SPS_SIT_POSESORIA
                      --SPS_FECHA_TITULO
                      --SPS_FECHA_TOMA_POSESION
                      --SPS_OCUPADO
                      --DD_TPO_ID
                      --DD_SIJ_ID
  --[8]TABLA ACT_ADM_INF_ADMINISTRATIVA
                      --DD_TVP_ID
  --[9]TABLA ACT_TIT_TITULO
  TYPE T_TIPO_TABLA10 IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_TABLA10 IS TABLE OF T_TIPO_TABLA10;
    V_TIPO_TABLA10 T_ARRAY_TABLA10 := T_ARRAY_TABLA10(
      T_TIPO_TABLA10('FEC_PRESENTACION_HACIENDA','TIT_FECHA_PRESENT_HACIENDA'),
      T_TIPO_TABLA10('FEC_PRESENTACION_REGISTRO','TIT_FECHA_PRESENT1_REG'),
      T_TIPO_TABLA10('FEC_ENTREGA_TITULO_GESTOR','TIT_FECHA_ENTREGA_GESTORIA'),
      T_TIPO_TABLA10('FEC_ENVIO_AUTO_ADICCION','TIT_FECHA_ENVIO_AUTO'),
      T_TIPO_TABLA10('FEC_SEGUNDA_PRESEN_REG','TIT_FECHA_PRESENT2_REG'),
      T_TIPO_TABLA10('FEC_INSCRIPCION_TITULO','TIT_FECHA_INSC_REG')
      --T_TIPO_TABLA10('','DD_ETI_ID')
    );
    V_TMP_TIPO_TABLA10 T_TIPO_TABLA10;
  --[10]TABLA ACT_OLE_OCUPANTE_LEGAL
                      --OLE_NOMBRE
  --[11]TABLA ACT_CFD_CONFIG_DOCUMENTO
                      --CFD_APLICA_F_CADUCIDAD
  --[12]TABLA ACT_MLV_MOVIMIENTO_LLAVE
                      --MLV_FECHA_ENTREGA
  --[13]TABLA ACT_PAC_PROPIETARIO_ACTIVO
                      --[13.1]--GOGRAP (GRADO_PROPIEDAD)
					  --[13.2]--POPROP -> PORCENTAJE_PROPIEDAD
					  --[13.3]--COSPAT -> Código de Sociedad Patrimonial
  --[14]TABLA ACT_EDI_EDIFICIO
                      --ASCEMSPRES
  --[15]TABLA ACT_VIV_VIVIENDA
  --[16]TABLA ACT_DIS_DISTRIBUCION
                      --DORMITORIOS
                      --BAÑOS
                      --TRASTEROS
                      --TERRAZAS
                      --GARAJES
  --[17]TABLA ACT_ABA_ACTIVO_BANCARIO
  		--[17.1]-- COTIRG --> TIPO RIESGO, (ABA_TIPO_PRODUCTO)
  		--[17.2]-- NUIDOP --> NUM_EXP_RIESGO, (ABA_NEXPRIESGO)	
  --[18]TABLA ACT_ABA_ACTIVO_BANCARIO
                --[18.1]-- QMREFP --> PRECIO_REFERENCIA, (VAL_IMPORTE, DD_TPC_CODIGO = '14')
                --[18.2]-- IMVLIQ --> PRECIO_REFERENCIA, (VAL_IMPORTE, DD_TPC_CODIGO = '16')
  --[19]TABLA ACT_REG_INFO_COMERCIAL
  		--[19.1] CASUTR --> SUP_TOTAL_REAL_UTIL (REG_SUPERFICIE_UTIL)
  --[20]TABLA BIE_DATOS_REGISTRALES
		--[20.1] CASUTG --> BIE_DREG_SUPERFICIE  (SUP_TOTAL_REGISTRAL_UTIL)
		--[20.2] CASUTC --> BIE_DREG_SUPERFICIE_CONSTRUIDA (SUP_TOTAL_REAL_CONSTRUIDA)
  --[21]TABLA ACT_ACTIVO_BNK ---
  		--[21.1] COTSIN --> ACB_COTSIN
  		--[21.2] COREAE --> ACB_COREAE  
  --[22]TABLA BIE_LOCALIZACION
      --[22.1] NOVIAS --> BIE_LOC_DIRECCION
      --[22.2] NUPOAC --> BIE_LOC_NUMERO_DOMICILIO
      --[22.3] NUESAC --> BIE_LOC_ESCALERA
      --[22.4] NUPIAC --> BIE_LOC_PISO
      --[22.5] COTIVI --> DD_TVI_ID
      --[22.6] COPRAE --> BIE_LOC_PROVINCIA
      --[22.6] COPRAE --> DD_PRV_ID
      --[22.7] COMUIX --> BIE_LOC_MUNICIPIO
      --[22.7] COMUIX --> UPO_ID
      --[22.8] NUPUAC --> BIE_LOC_PUERTA
      --[22.9] COPOIN --> BIE_LOC_COD_POST
  --[23]TABLA ACT_LOC_LOCALIZACION
      --[23.1] DESLO2 --> LOC_LONGITUD
      --[23.2] DESLA2 --> LOC_LATITUD
  --[24]TABLA ACT_ICO_INFO_COMERCIAL
      --[24.1] FEACON --> ICO_ANO_CONSTRUCCION
      --[24.2] FEREHA --> ICO_ANO_REHABILITACION
  		
BEGIN

  PL_OUTPUT := ' ';

  DBMS_OUTPUT.PUT_LINE('[INFO] INICIO DEL PROCESO DE ACTUALIZACIÓN DE INFORMACIÓN DE ACTIVOS.');
  DBMS_OUTPUT.PUT_LINE('---------------------------------------------------------------------');

----------------------
---- [1] BIE_BIEN ----
----------------------
--[1.1]--BIE_VIVIENDA_HABITUAL
        V_SQL := '
        MERGE INTO '||V_ESQUEMA||'.BIE_BIEN BIE USING
        (
          WITH TEMP AS (
          SELECT DISTINCT
          DECODE(APR.RESIDENCIA_HABITUAL,''0'',0,''1'',1,''2'',0,''3'',0,''S'',1,''N'',0,NULL) AS RESIDENCIA_HABITUAL, APR_ID, ACT_NUMERO_UVEM, REM
          FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
          )
          SELECT TEMP.*, BIE.BIE_VIVIENDA_HABITUAL, BIE.BIE_ID
          FROM TEMP
          INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
            ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
          INNER JOIN '||V_ESQUEMA||'.BIE_BIEN BIE
            ON BIE.BIE_ID = ACT.BIE_ID
           INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
          WHERE
            TEMP.REM = 1
            AND CRA.DD_CRA_CODIGO = ''03''
            AND
             BIE.BIE_VIVIENDA_HABITUAL IS NULL
              AND
              TEMP.RESIDENCIA_HABITUAL IS NOT NULL
               and act.borrado = 0
        ) TMP
        ON (TMP.BIE_ID = BIE.BIE_ID)
        WHEN MATCHED THEN UPDATE SET
        BIE.BIE_VIVIENDA_HABITUAL = TMP.RESIDENCIA_HABITUAL,
        BIE.USUARIOMODIFICAR = '''||V_USUARIO||''',
        BIE.FECHAMODIFICAR = SYSDATE
        '
        ;
        EXECUTE IMMEDIATE V_SQL;
        V_NUM_TABLAS := SQL%ROWCOUNT;

--[1.2]--BIE_PORCT_IMP_COMPRA
        V_SQL := '
        MERGE INTO '||V_ESQUEMA||'.BIE_BIEN BIE USING
        (
          WITH TEMP AS (
          SELECT DISTINCT
          APR.PORCENTAJE_IMPUESTO_COMPRA, APR_ID, ACT_NUMERO_UVEM, REM
          FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
          WHERE APR.PORCENTAJE_IMPUESTO_COMPRA != 0
          )
          SELECT TEMP.*, BIE.BIE_PORCT_IMP_COMPRA, BIE.BIE_ID
          FROM TEMP
          INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
            ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
          INNER JOIN '||V_ESQUEMA||'.BIE_BIEN BIE
            ON BIE.BIE_ID = ACT.BIE_ID
          INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
          WHERE
            TEMP.REM = 1
            AND CRA.DD_CRA_CODIGO = ''03''
            AND
             BIE.BIE_PORCT_IMP_COMPRA IS NULL
              AND
              TEMP.PORCENTAJE_IMPUESTO_COMPRA IS NOT NULL
               and act.borrado = 0
        ) TMP
        ON (TMP.BIE_ID = BIE.BIE_ID)
        WHEN MATCHED THEN UPDATE SET
        BIE.BIE_PORCT_IMP_COMPRA = TMP.PORCENTAJE_IMPUESTO_COMPRA,
        BIE.USUARIOMODIFICAR = '''||V_USUARIO||''',
        BIE.FECHAMODIFICAR = SYSDATE
        '
        ;
        EXECUTE IMMEDIATE V_SQL;
        V_NUM_TABLAS := SQL%ROWCOUNT + V_NUM_TABLAS;


        IF V_NUM_TABLAS != 0 THEN

          DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_BIEN '||V_NUM_TABLAS||' Registros.');
          PL_OUTPUT := '[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_BIEN '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
          DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

          COMMIT;

        END IF;


-----------------------------------
---- [2] BIE_DATOS_REGISTRALES ----
-----------------------------------
--[2.1]--BIE_DREG_LIBRO, BIE_DREG_TOMO Y BIE_DREG_FOLIO
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES BIE USING
          (
            SELECT TEMP.NUM_LIBRO_ESCRITURA, TEMP.NUM_TOMO_ESCRITURA, TEMP.NUM_FOLIO_ESCRITURA, TEMP.APR_ID, TEMP.ACT_NUMERO_UVEM, TEMP.REM
                 , BIE.BIE_DREG_LIBRO, BIE.BIE_DREG_TOMO, BIE.BIE_DREG_FOLIO, BIE.BIE_ID
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT             ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES BIE  ON BIE.BIE_ID = ACT.BIE_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE TEMP.REM = 1
            AND CRA.DD_CRA_CODIGO = ''03''
               AND  (     BIE.BIE_DREG_LIBRO <> TEMP.NUM_LIBRO_ESCRITURA 
                      OR  BIE.BIE_DREG_TOMO <> TEMP.NUM_TOMO_ESCRITURA 
                      OR  BIE.BIE_DREG_FOLIO <> TEMP.NUM_FOLIO_ESCRITURA 
                      OR  BIE.BIE_DREG_LIBRO IS NULL OR TEMP.NUM_LIBRO_ESCRITURA IS NULL
                      OR  BIE.BIE_DREG_TOMO IS NULL OR TEMP.NUM_TOMO_ESCRITURA IS NULL
                      OR  BIE.BIE_DREG_FOLIO IS NULL OR TEMP.NUM_FOLIO_ESCRITURA IS NULL
                    )
               and act.borrado = 0
          ) TMP
          ON (TMP.BIE_ID = BIE.BIE_ID)
          WHEN MATCHED THEN UPDATE SET
          BIE.BIE_DREG_LIBRO = TMP.NUM_LIBRO_ESCRITURA,
          BIE.BIE_DREG_TOMO = TMP.NUM_TOMO_ESCRITURA,
          BIE.BIE_DREG_FOLIO = TMP.NUM_FOLIO_ESCRITURA,
          BIE.USUARIOMODIFICAR = '''||V_USUARIO||''',
          BIE.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


----------------------------------
---- [3] BIE_ADJ_ADJUDICACION ----
----------------------------------
--[3.1]--BIE_ADJ_IMPORTE_ADJUDICACION
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION BIE USING
          (
            WITH TEMP AS (
              SELECT DISTINCT
              APR.IMPORTE_ADJUDICACION, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
              WHERE APR.IMPORTE_ADJUDICACION != 0
            )
            SELECT TEMP.*, BIE.BIE_ADJ_IMPORTE_ADJUDICACION, BIE.BIE_ID, ROW_NUMBER() OVER(PARTITION BY BIE.BIE_ID ORDER BY BIE.BIE_ADJ_ID DESC) RN
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT           ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION BIE ON BIE.BIE_ID = ACT.BIE_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE  TEMP.REM = 1 
            AND CRA.DD_CRA_CODIGO = ''03''
               AND (BIE.BIE_ADJ_IMPORTE_ADJUDICACION <> TEMP.IMPORTE_ADJUDICACION OR BIE.BIE_ADJ_IMPORTE_ADJUDICACION IS NULL OR TEMP.IMPORTE_ADJUDICACION IS NULL)
               and act.borrado = 0
          ) TMP
          ON (TMP.BIE_ID = BIE.BIE_ID AND TMP.RN = 1)
          WHEN MATCHED THEN UPDATE SET
          BIE.BIE_ADJ_IMPORTE_ADJUDICACION = TMP.IMPORTE_ADJUDICACION,
          BIE.USUARIOMODIFICAR = '''||V_USUARIO||''',
          BIE.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION T1
            USING (SELECT BIE.BIE_ID, DECODE(APR.INDICADOR_NECES_LANZAMIENTO,''S'',1,''N'', 0, NULL) BIE_ADJ_LANZAMIENTO_NECES, ROW_NUMBER() OVER(PARTITION BY BIE.BIE_ID ORDER BY BIE.BIE_ADJ_ID DESC) RN
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
                    ON APR_FIL.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION BIE
                    ON BIE.BIE_ID = APR_FIL.BIE_ID
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
            WHERE CRA.DD_CRA_CODIGO = ''03''
            ) T2
          ON (T1.BIE_ID = T2.BIE_ID AND T2.RN = 1)
          WHEN MATCHED THEN UPDATE SET
            T1.BIE_ADJ_LANZAMIENTO_NECES = T2.BIE_ADJ_LANZAMIENTO_NECES,
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
          WHERE (T1.BIE_ADJ_LANZAMIENTO_NECES <> T2.BIE_ADJ_LANZAMIENTO_NECES OR T1.BIE_ADJ_LANZAMIENTO_NECES IS NULL OR T2.BIE_ADJ_LANZAMIENTO_NECES IS NULL)
          ';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION T1
            USING (SELECT BIE.BIE_ID, APR.FESEPO, ROW_NUMBER() OVER(PARTITION BY BIE.BIE_ID ORDER BY BIE.BIE_ADJ_ID DESC) RN
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
                    ON APR_FIL.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION BIE
                    ON BIE.BIE_ID = APR_FIL.BIE_ID
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
            WHERE CRA.DD_CRA_CODIGO = ''03''
                    ) T2
          ON (T1.BIE_ID = T2.BIE_ID AND T2.RN = 1)
          WHEN MATCHED THEN UPDATE SET
            T1.BIE_ADJ_F_SEN_POSESION = DECODE(T2.FESEPO,''00000000'',NULL,TO_DATE(T2.FESEPO,''YYYYMMDD'')),
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
          WHERE (T1.BIE_ADJ_F_SEN_POSESION <> DECODE(T2.FESEPO,''00000000'',NULL,TO_DATE(T2.FESEPO,''YYYYMMDD'')) OR T1.BIE_ADJ_F_SEN_POSESION IS NULL OR T2.FESEPO IS NULL)
          ';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION T1
            USING (SELECT BIE.BIE_ID, APR.FESELA, ROW_NUMBER() OVER(PARTITION BY BIE.BIE_ID ORDER BY BIE.BIE_ADJ_ID DESC) RN
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
                    ON APR_FIL.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION BIE
                    ON BIE.BIE_ID = APR_FIL.BIE_ID
	    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
	    WHERE CRA.DD_CRA_CODIGO = ''03''
                    ) T2
          ON (T1.BIE_ID = T2.BIE_ID AND T2.RN = 1)
          WHEN MATCHED THEN UPDATE SET
            T1.BIE_ADJ_F_SEN_LANZAMIENTO = DECODE(T2.FESELA,''00000000'',NULL,TO_DATE(T2.FESELA,''YYYYMMDD'')),
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
	    WHERE (T1.BIE_ADJ_F_REA_LANZAMIENTO <> DECODE(T2.FESELA,''00000000'',NULL,TO_DATE(T2.FESELA,''YYYYMMDD'')) OR T1.BIE_ADJ_F_REA_LANZAMIENTO IS NULL OR T2.FESELA IS NULL)
	    ';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION T1
            USING (SELECT BIE.BIE_ID, APR.FERELA, ROW_NUMBER() OVER(PARTITION BY BIE.BIE_ID ORDER BY BIE.BIE_ADJ_ID DESC) RN
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
                    ON APR_FIL.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION BIE
                    ON BIE.BIE_ID = APR_FIL.BIE_ID
	    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
	    WHERE CRA.DD_CRA_CODIGO = ''03''
	    ) T2
          ON (T1.BIE_ID = T2.BIE_ID AND T2.RN = 1)
          WHEN MATCHED THEN UPDATE SET
            T1.BIE_ADJ_F_REA_LANZAMIENTO = DECODE(T2.FERELA,''00000000'',NULL,TO_DATE(T2.FERELA,''YYYYMMDD'')),
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
          WHERE (T1.BIE_ADJ_F_REA_LANZAMIENTO <> DECODE(T2.FERELA,''00000000'',NULL,TO_DATE(T2.FERELA,''YYYYMMDD'')) OR T1.BIE_ADJ_F_REA_LANZAMIENTO IS NULL OR T2.FERELA IS NULL)
          ';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION T1
            USING (SELECT BIE.BIE_ID, APR.FEC_SOLICITUD_MORATORIA, APR.FEC_RESOL_MORATORIA, ROW_NUMBER() OVER(PARTITION BY BIE.BIE_ID ORDER BY BIE.BIE_ADJ_ID DESC) RN
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
                    ON APR_FIL.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION BIE
                    ON BIE.BIE_ID = APR_FIL.BIE_ID
	    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID     
	    WHERE CRA.DD_CRA_CODIGO = ''03''               
                    ) T2
          ON (T1.BIE_ID = T2.BIE_ID AND T2.RN = 1)
          WHEN MATCHED THEN UPDATE SET
            T1.BIE_ADJ_F_SOL_MORATORIA = DECODE(T2.FEC_SOLICITUD_MORATORIA,''00000000'',NULL,T2.FEC_SOLICITUD_MORATORIA), T1.BIE_ADJ_F_RES_MORATORIA = DECODE(T2.FEC_RESOL_MORATORIA,''00000000'',NULL,T2.FEC_RESOL_MORATORIA),
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
            WHERE (T1.BIE_ADJ_F_SOL_MORATORIA <> DECODE(T2.FEC_SOLICITUD_MORATORIA,''00000000'',NULL,T2.FEC_SOLICITUD_MORATORIA) OR
                  T1.BIE_ADJ_F_RES_MORATORIA <> DECODE(T2.FEC_RESOL_MORATORIA,''00000000'',NULL,T2.FEC_RESOL_MORATORIA) 
            OR T1.BIE_ADJ_F_SOL_MORATORIA IS NULL OR T2.FEC_SOLICITUD_MORATORIA IS NULL
            OR T1.BIE_ADJ_F_RES_MORATORIA IS NULL OR T2.FEC_RESOL_MORATORIA IS NULL)
            ';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


	V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION ADJ_OLD
	USING (
	  WITH T1 AS (
	      SELECT DECODE(APR.COD_RESOL_MORATORIA,''F'',''01'',''D'',''02'',NULL,APR.COD_RESOL_MORATORIA) AS COD_RESOL_MORATORIA,
		  ADJ.DD_FAV_ID,
		  ADJ.BIE_ID, ROW_NUMBER() OVER(PARTITION BY ADJ.BIE_ID ORDER BY ADJ.BIE_ADJ_ID DESC) RN
	      FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
	      JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
	      JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
	      JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION ADJ ON ADJ.BIE_ID = ACT.BIE_ID
	      JOIN '||V_ESQUEMA_MASTER||'.DD_FAV_FAVORABLE FAV ON DECODE(APR.COD_RESOL_MORATORIA,''F'',''01'',''D'',''02'',NULL,APR.COD_RESOL_MORATORIA) = FAV.DD_FAV_CODIGO
	      WHERE APR.REM = 1
	      AND CRA.DD_CRA_CODIGO = ''03''
	      AND ACT.BORRADO = 0
	  ) SELECT T1.* FROM T1
	  WHERE T1.RN = 1 AND (T1.COD_RESOL_MORATORIA <> (SELECT DD_FAV_ID FROM '||V_ESQUEMA_MASTER||'.DD_FAV_FAVORABLE WHERE DD_FAV_CODIGO = T1.DD_FAV_ID) OR T1.DD_FAV_ID IS NULL
	  OR T1.COD_RESOL_MORATORIA IS NULL) ) ADJ_NEW 
	  ON (ADJ_OLD.BIE_ID = ADJ_NEW.BIE_ID)
	  WHEN MATCHED THEN UPDATE SET
	    ADJ_OLD.DD_FAV_ID = ADJ_NEW.DD_FAV_ID,
	    ADJ_OLD.USUARIOMODIFICAR = '''||V_USUARIO||''',
	    ADJ_OLD.FECHAMODIFICAR = SYSDATE
   	   '
	   ;
	   

          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;	   
          
	  
	  V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION T1 
	  USING (
	    SELECT DECODE(APR.FETIFI,''00000000'',NULL,TO_DATE(APR.FETIFI,''YYYYMMDD'')) AS FECHA, ADJ.BIE_ADJ_F_DECRETO_FIRME, ACT.ACT_ID, BIE.BIE_ID, ROW_NUMBER() OVER(PARTITION BY ADJ.BIE_ID ORDER BY ADJ.BIE_ADJ_ID DESC) RN
	    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
	    	JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
	    	JOIN '||V_ESQUEMA||'.BIE_BIEN BIE ON BIE.BIE_ID = ACT.BIE_ID
	    	JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
	   	JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION ADJ ON ADJ.BIE_ID = BIE.BIE_ID
	    	WHERE APR.COD_ENTRADA_ACTIVO IN (''01'',''02'')
	    	AND APR.REM = 1
   		AND ACT.BORRADO = 0
   		AND CRA.DD_CRA_CODIGO = ''03''
	       ) T2 ON (T1.BIE_ID = T2.BIE_ID AND T2.RN = 1)
	    	WHEN MATCHED THEN UPDATE SET
	    	T1.BIE_ADJ_F_DECRETO_FIRME = T2.FECHA,
	    	T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
	    	T1.FECHAMODIFICAR = SYSDATE
	  	'
	  	;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

		
		
	V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION T1
	USING (
		SELECT DISTINCT ADJ.BIE_ID, APR.FEC_REALIZADA_POSESION, ROW_NUMBER() OVER(PARTITION BY ADJ.BIE_ID ORDER BY ADJ.BIE_ADJ_ID DESC) RN
		FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
		INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
		ON APR_FIL.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION ADJ
		ON ADJ.BIE_ID = APR_FIL.BIE_ID
		JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
		WHERE APR.REM = 1
		AND APR_FIL.BORRADO = 0
		AND CRA.DD_CRA_CODIGO = ''03''
		AND (ADJ.BIE_ADJ_F_REA_POSESION <> APR.FEC_REALIZADA_POSESION
		OR ADJ.BIE_ADJ_F_REA_POSESION IS NULL OR APR.FEC_REALIZADA_POSESION IS NULL) 
	      ) T2 ON (T1.BIE_ID = T2.BIE_ID AND T2.RN = 1)
		WHEN MATCHED THEN UPDATE SET
		T1.BIE_ADJ_F_REA_POSESION = T2.FEC_REALIZADA_POSESION,
		T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
		'
		;
		
	EXECUTE IMMEDIATE V_SQL;
	V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

		
          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


------------------------
---- [4] ACT_ACTIVO ----
------------------------
--[4.1]--ACT_VPO
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              DECODE(APR.REGIMEN_PROTECCION,''01'',1,''02'',1,''03'',1,''04'',1,NULL) AS REGIMEN_PROTECCION, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.ACT_VPO, ACT.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
              ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE
              TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.ACT_VPO IS NULL
              AND
              TEMP.REGIMEN_PROTECCION IS NOT NULL)
               and act.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.ACT_VPO = TMP.REGIMEN_PROTECCION,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

--[4.2]--ACT_LLAVES_NECESARIAS
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              DECODE(APR.LLAVES_NECESARIAS,''N'',0,''S'',1,NULL) AS LLAVES_NECESARIAS, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.ACT_LLAVES_NECESARIAS, ACT.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
              ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE 
                  TEMP.REM = 1
                  AND CRA.DD_CRA_CODIGO = ''03''
	          AND act.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.ACT_LLAVES_NECESARIAS = TMP.LLAVES_NECESARIAS,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          WHERE (ACT.ACT_LLAVES_NECESARIAS <> TMP.LLAVES_NECESARIAS
          OR ACT.ACT_LLAVES_NECESARIAS IS NULL
          OR TMP.LLAVES_NECESARIAS IS NULL)
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

--[4.3]--ACT_LLAVES_FECHA_RECEP
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.FEC_RECEP_LLAVES, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.ACT_LLAVES_FECHA_RECEP, ACT.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
              ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE
              TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.ACT_LLAVES_FECHA_RECEP IS NULL
              AND
              TEMP.FEC_RECEP_LLAVES IS NOT NULL)
               and act.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.ACT_LLAVES_FECHA_RECEP = TMP.FEC_RECEP_LLAVES,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


--[4.4]--ACT_NUM_INMOVILIZADO_BNK
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.NUINMU, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.ACT_NUM_INMOVILIZADO_BNK, ACT.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
              ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE
              TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
              AND (ACT.ACT_NUM_INMOVILIZADO_BNK <> TEMP.NUINMU OR ACT.ACT_NUM_INMOVILIZADO_BNK IS NULL OR TEMP.NUINMU IS NULL)
              AND ACT.BORRADO = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.ACT_NUM_INMOVILIZADO_BNK = TMP.NUINMU,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


--[4.5]--DD_ENA_ID

          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO ACT USING
          (
           WITH TEMP AS (
             SELECT DISTINCT
  	      (SELECT ENA.DD_ENA_ID FROM '||V_ESQUEMA||'.DD_ENA_ENTRADA_ACTIVO_BNK ENA WHERE ENA.DD_ENA_CODIGO = APR.COD_ENTRADA_ACTIVO) AS ENA,
  		APR_ID, ACT_NUMERO_UVEM, REM
  	    	FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
		)
            SELECT TEMP.*, ACT.DD_ENA_ID, ACT.ACT_ID
            FROM TEMP 
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT  ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
              AND (ACT.DD_ENA_ID <> TEMP.ENA OR ACT.DD_ENA_ID IS NULL OR TEMP.ENA IS NULL)
              AND ACT.BORRADO = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.DD_ENA_ID = TMP.ENA,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


--[4.6] COTSIN -> DD_SAC_ID (SUBTIPO ACTIVO)
         
         V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO ACT USING
          (  WITH TEMP AS (
                SELECT DISTINCT SAC.DD_SAC_ID, APR.ACT_NUMERO_UVEM, APR.REM
                FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
                    JOIN '||V_ESQUEMA||'.DD_EQV_BANKIA_REM EQV ON EQV.DD_CODIGO_BANKIA = APR.COTSIN
                    JOIN '||V_ESQUEMA||'.DD_SAC_SUBTIPO_ACTIVO SAC ON SAC.DD_SAC_CODIGO = EQV.DD_CODIGO_REM
     			)	
            SELECT TEMP.*, ACT.DD_SAC_ID AS ACT_SAC_ID, ACT.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT  ON ACT.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            WHERE TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
              AND (ACT.DD_SAC_ID <> TEMP.DD_SAC_ID OR ACT.DD_SAC_ID IS NULL OR TEMP.DD_SAC_ID IS NULL)
              AND act.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.DD_SAC_ID = TMP.DD_SAC_ID,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
	

	
--[4.7] COEXCA -> ACT_CON_CARGAS (EXISTEN_CARGAS_RECOVERY)

 	V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO T1 USING(
    		SELECT DECODE(APR.EXISTEN_CARGAS_RECOVERY, 1, 0, 2, 0, 3, 1, null, 0) AS CARGAS_UVEM, ACT.ACT_CON_CARGAS, ACT.ACT_ID FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    		JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
   		WHERE APR.REM = 1
   		AND CRA.DD_CRA_CODIGO = ''03''
		AND ACT.BORRADO = 0
		AND (DECODE(EXISTEN_CARGAS_RECOVERY, 1, 0, 2, 0, 3, 1, null, 0) <> ACT.ACT_CON_CARGAS OR EXISTEN_CARGAS_RECOVERY IS NULL OR ACT.ACT_CON_CARGAS IS NULL)
	     ) T2 ON (T2.ACT_ID = T1.ACT_ID)
		WHEN MATCHED THEN UPDATE SET
		T1.ACT_CON_CARGAS = T2.CARGAS_UVEM,
		T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
		T1.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

--[4.8] DD_SCR_ID -> ACTUALIZAR SUBCARTERA

 	V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO T1 
		USING(
			SELECT ACT.ACT_ID, SCR.DD_SCR_CODIGO AS SUBCARTERA_ACTIVO, EQV.DD_CODIGO_REM AS SUBCARTERA_NUEVA, CRA.DD_CRA_ID FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
			INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
			INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
			INNER JOIN '||V_ESQUEMA||'.DD_EQV_BANKIA_REM EQV ON APR.COD_SOC_PATRIMONIAL = EQV.DD_CODIGO_BANKIA
			INNER JOIN '||V_ESQUEMA||'.DD_SCR_SUBCARTERA SCR ON SCR.DD_SCR_ID = ACT.DD_SCR_ID
			WHERE CRA.DD_CRA_CODIGO = ''03'' AND EQV.DD_NOMBRE_BANKIA = ''DD_SCR_CODIGO'' AND EQV.DD_NOMBRE_REM = ''DD_SCR_SUBCARTERA'' AND EQV.DD_CODIGO_REM <> SCR.DD_SCR_CODIGO
			AND SCR.DD_SCR_CODIGO <> ''05'' AND EQV.DD_CODIGO_REM <> ''05'' AND ACT.BORRADO = 0 AND EQV.BORRADO = 0 AND APR.REM = 1    		
		
		) T2 ON (T2.ACT_ID = T1.ACT_ID)
		WHEN MATCHED THEN UPDATE SET
		T1.DD_SCR_ID = (SELECT DD_SCR_ID FROM '||V_ESQUEMA||'.DD_SCR_SUBCARTERA WHERE DD_SCR_CODIGO = T2.SUBCARTERA_NUEVA),
		T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
		T1.FECHAMODIFICAR = SYSDATE
          '
          ;

          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

--[4.9] IMPORTE_VENTA y FECHA_VENTA -> ACT_VENTA_EXTERNA_IMPORTE y ACT_VENTA_EXTERNA_FECHA

	V_SQL2 := '
	MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO ACT USING
       		(
		WITH ACTIVOS_VENDIDOS_O_FIRMADOS AS (
		    SELECT DISTINCT ACT.ACT_ID 
		    FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT
		    JOIN '||V_ESQUEMA||'.ACT_OFR AFR ON AFR.ACT_ID = ACT.ACT_ID
		    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
		    JOIN '||V_ESQUEMA||'.OFR_OFERTAS   OFR ON OFR.OFR_ID = AFR.OFR_ID
		    JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL ECO ON ECO.OFR_ID = OFR.OFR_ID
		    JOIN '||V_ESQUEMA||'.DD_EEC_EST_EXP_COMERCIAL EEC ON EEC.DD_EEC_ID = ECO.DD_EEC_ID
		    WHERE EOF.DD_EOF_CODIGO IN (''01'') AND CRA.DD_CRA_CODIGO = ''03''
		)
		SELECT ACT.ACT_ID, ACT.ACT_VENTA_EXTERNA_FECHA, APR.FEC_VENTA, 	ACT.ACT_VENTA_EXTERNA_IMPORTE, APR.IMPORTE_VENTA
		FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM   APR
		JOIN '||V_ESQUEMA||'.ACT_ACTIVO                   ACT 
		  ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		LEFT JOIN ACTIVOS_VENDIDOS_O_FIRMADOS   AUX
		  ON AUX.ACT_ID = ACT.ACT_ID
		WHERE AUX.ACT_ID IS NULL AND (((APR.IMPORTE_VENTA IS NOT NULL 
		  OR APR.FEC_VENTA IS NOT NULL) 
		  AND (ACT.ACT_VENTA_EXTERNA_FECHA IS NULL
		  OR NVL(ACT.ACT_VENTA_EXTERNA_IMPORTE,0) = 0))
		  OR (APR.IMPORTE_VENTA <> ACT.ACT_VENTA_EXTERNA_IMPORTE OR APR.FEC_VENTA <> ACT.ACT_VENTA_EXTERNA_FECHA))
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.ACT_VENTA_EXTERNA_IMPORTE = TMP.IMPORTE_VENTA,
          ACT.ACT_VENTA_EXTERNA_FECHA = TMP.FEC_VENTA,
          ACT.DD_SCM_ID = (SELECT DD_SCM_ID FROM DD_SCM_SITUACION_COMERCIAL WHERE DD_SCM_CODIGO = ''05''),
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE'     
          ;
          EXECUTE IMMEDIATE V_SQL2;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
          
          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ACTIVO '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ACTIVO '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;

---------------------------------
---- [5] ACT_AJD_ADJJUDICIAL ----
---------------------------------
--[5.1]--AJD_NUM_AUTO
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.NUM_AUTOS_JUZGADO, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.AJD_NUM_AUTO, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            WHERE TEMP.REM = 1
               AND CRA.DD_CRA_CODIGO = ''03''
               AND LINK.BORRADO = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.AJD_NUM_AUTO = TMP.NUM_AUTOS_JUZGADO,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          WHERE (ACT.AJD_NUM_AUTO <> TMP.NUM_AUTOS_JUZGADO
          OR ACT.AJD_NUM_AUTO IS NULL OR TMP.NUM_AUTOS_JUZGADO IS NULL)
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

--[5.2]--AJD_PROCURADOR
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.NOMBRE_PROCURADOR, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.AJD_PROCURADOR, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            WHERE (ACT.AJD_PROCURADOR <> TEMP.NOMBRE_PROCURADOR OR ACT.AJD_PROCURADOR IS NULL OR TEMP.NOMBRE_PROCURADOR IS NULL)
            AND TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
              AND LINK.BORRADO = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.AJD_PROCURADOR = TMP.NOMBRE_PROCURADOR,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

         /* V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL T1
            USING (SELECT APR_FIL.ACT_ID, PLZ.DD_PLA_ID
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
              ON APR.ACT_NUMERO_UVEM = APR_FIL.ACT_NUM_ACTIVO_UVEM
            INNER JOIN '||V_ESQUEMA||'.BIE_BIEN BIE
              ON BIE.BIE_ID = APR_FIL.BIE_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
            INNER JOIN '||V_ESQUEMA||'.BIE_ADJ_ADJUDICACION ADJ
              ON ADJ.BIE_ID = BIE.BIE_ID
            LEFT JOIN '||V_ESQUEMA||'.DD_PLA_PLAZAS PLZ
              ON PLZ.DD_PLA_DESCRIPCION = APR.NOM_LOCALIDAD_JUZGADO
            WHERE APR.COD_ENTRADA_ACTIVO IN (''01'',''02'')
            AND CRA.DD_CRA_CODIGO = ''03''
            ) T2
          ON (T1.ACT_ID = T2.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
            T1.DD_PLA_ID = T2.DD_PLA_ID,
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
          WHERE T1.DD_PLA_ID IS NULL';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;*/
          
          
--[5.3]--AJD_FECHA_ADJUDICACION
	 V_SQL := '
	MERGE INTO '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL AJD_OLD USING (
	    SELECT AJD.AJD_FECHA_ADJUDICACION AS FECHA_ADJ_REM, APR.FEC_ADJUDICACION AS FECHA_ADJ_UVEM, ACT.ACT_ID, ACT.ACT_NUM_ACTIVO_UVEM AS REM_NUM_UVEM, APR.ACT_NUMERO_UVEM AS NUM_UVEM
	    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
	    JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON  ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
	    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
	    JOIN '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL AJD ON ACT.ACT_ID = AJD.ACT_ID
	    WHERE (AJD.AJD_FECHA_ADJUDICACION <> APR.FEC_ADJUDICACION OR AJD.AJD_FECHA_ADJUDICACION IS NULL OR APR.FEC_ADJUDICACION IS NULL)
	    AND APR.REM = 1
	    AND CRA.DD_CRA_CODIGO = ''03''
	    AND ACT.BORRADO = 0
	) AJD_NEW ON (AJD_OLD.ACT_ID = AJD_NEW.ACT_ID)
	    WHEN MATCHED THEN UPDATE SET
	    AJD_OLD.AJD_FECHA_ADJUDICACION = AJD_NEW.FECHA_ADJ_UVEM,
	    AJD_OLD.USUARIOMODIFICAR = '''||V_USUARIO||''',
	    AJD_OLD.FECHAMODIFICAR = SYSDATE
	    '
            ;
          
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
    

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


-----------------------------------
---- [6] ACT_ADN_ADJNOJUDICIAL ----
-----------------------------------
--[6.1]--ADN_FECHA_FIRMA_TITULO
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.FEC_RESOLUCION, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.ADN_FECHA_FIRMA_TITULO, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            WHERE
              TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.ADN_FECHA_FIRMA_TITULO IS NULL
              AND
              TEMP.FEC_RESOLUCION IS NOT NULL)
               and link.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.ADN_FECHA_FIRMA_TITULO = TMP.FEC_RESOLUCION,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL T1
            USING (SELECT APR_FIL.ACT_ID, APR.NOM_NOTARIO_ESCRITURA
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
              ON APR.ACT_NUMERO_UVEM = APR_FIL.ACT_NUM_ACTIVO_UVEM
            INNER JOIN '||V_ESQUEMA||'.BIE_BIEN BIE
              ON BIE.BIE_ID = APR_FIL.BIE_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
            WHERE APR.COD_ENTRADA_ACTIVO IN (''03'',''04'',''05'',''06'',''07'',''08'', ''12'', ''13'', ''14'')
            AND CRA.DD_CRA_CODIGO = ''03''
            ) T2
          ON (T1.ACT_ID = T2.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
            T1.ADN_TRAMITADOR_TITULO = T2.NOM_NOTARIO_ESCRITURA,
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
	    WHERE (T1.ADN_TRAMITADOR_TITULO <> T2.NOM_NOTARIO_ESCRITURA
             OR T1.ADN_TRAMITADOR_TITULO IS NULL OR  T2.NOM_NOTARIO_ESCRITURA IS NULL)';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL T1
            USING (SELECT APR_FIL.ACT_ID, APR.NUM_PROTOCOLO
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO APR_FIL
              ON APR.ACT_NUMERO_UVEM = APR_FIL.ACT_NUM_ACTIVO_UVEM
            INNER JOIN '||V_ESQUEMA||'.BIE_BIEN BIE
              ON BIE.BIE_ID = APR_FIL.BIE_ID
            INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = APR_FIL.DD_CRA_ID
            WHERE APR.COD_ENTRADA_ACTIVO IN (''03'',''04'',''05'',''06'',''07'',''08'', ''12'', ''13'', ''14'')
            AND CRA.DD_CRA_CODIGO = ''03''
            ) T2
          ON (T1.ACT_ID = T2.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
            T1.ADN_NUM_REFERENCIA = T2.NUM_PROTOCOLO,
            T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
          WHERE (T1.ADN_NUM_REFERENCIA <> T2.NUM_PROTOCOLO
             OR T1.ADN_NUM_REFERENCIA IS NULL OR T2.NUM_PROTOCOLO IS NULL)';
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
          
          V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL T1 USING (
	    SELECT DECODE(APR.FETIFI,''00000000'',NULL,TO_DATE(APR.FETIFI,''YYYYMMDD'')) AS FECHA, ADN.ADN_FECHA_FIRMA_TITULO, ACT.ACT_ID FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
	      JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
	      JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
	      LEFT JOIN '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL ADN ON ACT.ACT_ID = ADN.ACT_ID
	      WHERE APR.COD_ENTRADA_ACTIVO IN (''03'',''04'',''05'',''06'',''07'',''08'', ''12'', ''13'', ''14'')
	      AND APR.REM = 1
	      AND CRA.DD_CRA_CODIGO = ''03''
	      AND ACT.BORRADO = 0
	      AND (   TRUNC(ADN.ADN_FECHA_FIRMA_TITULO) <> DECODE(APR.FETIFI,''00000000'',NULL,TRUNC(TO_DATE(APR.FETIFI,''YYYYMMDD''))) 
	           OR ADN.ADN_FECHA_FIRMA_TITULO IS NULL 
	           OR DECODE(APR.FETIFI,''00000000'',NULL,TO_DATE(APR.FETIFI,''YYYYMMDD'')) IS NULL
	           )
	    ) T2 ON (T1.ACT_ID = T2.ACT_ID)
	      WHEN MATCHED THEN UPDATE SET
	      T1.ADN_FECHA_FIRMA_TITULO = T2.FECHA,
	      T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
	      T1.FECHAMODIFICAR = SYSDATE
	    '
	    ;         
          
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
          

         V_SQL := '
         MERGE INTO '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL ADN_OLD USING (
                 SELECT ADN.ADN_FECHA_TITULO AS FECHA_ADN_REM, APR.FEC_ADJUDICACION AS FECHA_ADN_UVEM
                      , ACT.ACT_ID
                      , ACT.ACT_NUM_ACTIVO_UVEM AS REM_NUM_UVEM, APR.ACT_NUMERO_UVEM AS NUM_UVEM
                 FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
                 JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON  ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
                 JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
                 JOIN '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL ADN ON ACT.ACT_ID = ADN.ACT_ID
                 WHERE (ADN.ADN_FECHA_TITULO <> APR.FEC_ADJUDICACION OR ADN.ADN_FECHA_TITULO IS NULL OR APR.FEC_ADJUDICACION IS NULL)
                   AND APR.REM = 1
                   AND CRA.DD_CRA_CODIGO = ''03''
                   AND ACT.BORRADO = 0
        ) ADN_NEW ON (ADN_OLD.ACT_ID = ADN_NEW.ACT_ID)
            WHEN MATCHED THEN UPDATE SET
            ADN_OLD.ADN_FECHA_TITULO = ADN_NEW.FECHA_ADN_UVEM,
            ADN_OLD.USUARIOMODIFICAR = '''||V_USUARIO||''',
            ADN_OLD.FECHAMODIFICAR = SYSDATE
            '          
            ;
            
                 EXECUTE IMMEDIATE V_SQL;
                 V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;             


          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


-----------------------------------
---- [7] ACT_SPS_SIT_POSESORIA ----
-----------------------------------
--[7.1]--SPS_FECHA_TITULO
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.FEC_INICIO_CONTRATO, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.SPS_FECHA_TITULO, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            WHERE
              TEMP.REM = 1
               AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.SPS_FECHA_TITULO IS NULL
              AND
              TEMP.FEC_INICIO_CONTRATO IS NOT NULL)
               and link.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.SPS_FECHA_TITULO = TMP.FEC_INICIO_CONTRATO,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

--[7.2]--SPS_OCUPADO
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              DECODE(APR.OCUPADO,''S'',1,''N'',0,NULL) AS OCUPADO, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.SPS_OCUPADO, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            WHERE
              TEMP.REM = 1
               AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.SPS_OCUPADO IS NULL
              AND
              TEMP.OCUPADO IS NOT NULL)
               and link.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.SPS_OCUPADO = TMP.OCUPADO,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

--[7.3]--DD_TPO_ID
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              CASE
                WHEN APR.OCUPADO = ''S'' AND APR.FEC_INICIO_CONTRATO IS NOT NULL THEN (SELECT TPO.DD_TPO_ID FROM '||V_ESQUEMA||'.DD_TPO_TIPO_TITULO_POSESORIO TPO WHERE TPO.DD_TPO_CODIGO = ''02'')
                END AS TPO, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.DD_TPO_ID, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            WHERE
              TEMP.REM = 1
               AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.DD_TPO_ID IS NULL
              AND
              TEMP.TPO IS NOT NULL)
               and link.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.DD_TPO_ID = TMP.TPO,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

--[7.4]--DD_SIJ_ID
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA ACT USING
          (
           	SELECT act1.act_id, apr.COSJUR 
           	FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
           	JOIN '||V_ESQUEMA||'.act_Activo act1 on apr.ACT_NUMERO_UVEM = ACT1.ACT_NUM_ACTIVO_UVEM
           	JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT1.DD_CRA_ID
           	WHERE CRA.DD_CRA_CODIGO = ''03''
          ) TMP
          ON (TMP.act_id = ACT.act_id)
          WHEN MATCHED THEN UPDATE SET
	          ACT.DD_SIJ_ID = (SELECT DD_SIJ_ID FROM '||V_ESQUEMA||'.DD_SIJ_SITUACION_JURIDICA WHERE DD_SIJ_CODIGO = TMP.COSJUR),
	          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
	          ACT.FECHAMODIFICAR = SYSDATE
	      WHERE (ACT.DD_SIJ_ID <> (SELECT DD_SIJ_ID FROM '||V_ESQUEMA||'.DD_SIJ_SITUACION_JURIDICA WHERE DD_SIJ_CODIGO = TMP.COSJUR) OR ACT.DD_SIJ_ID IS NULL OR TMP.COSJUR IS NULL)
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


----------------------------------------
---- [8] ACT_ADM_INF_ADMINISTRATIVA ----
----------------------------------------
--[8.1]--DD_TVP_ID
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ADM_INF_ADMINISTRATIVA ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              TVP.DD_TVP_ID AS REGIMEN_PROTECCION, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
              LEFT JOIN '||V_ESQUEMA||'.DD_EQV_BANKIA_REM EQV
                  ON EQV.DD_NOMBRE_BANKIA = ''DD_REGIMEN_PROTECCION''
                  AND EQV.DD_CODIGO_BANKIA = APR.REGIMEN_PROTECCION
                LEFT JOIN '||V_ESQUEMA||'.DD_TVP_TIPO_VPO TVP
                 ON TVP.DD_TVP_CODIGO = EQV.DD_CODIGO_REM
            )
            SELECT TEMP.*, ACT.DD_TVP_ID, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN '||V_ESQUEMA||'.ACT_ADM_INF_ADMINISTRATIVA ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            WHERE
              TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.DD_TVP_ID IS NULL
              AND
              TEMP.REGIMEN_PROTECCION IS NOT NULL)
               and link.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.DD_TVP_ID = TMP.REGIMEN_PROTECCION,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ADM_INF_ADMINISTRATIVA '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ADM_INF_ADMINISTRATIVA '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


----------------------------
---- [9] ACT_TIT_TITULO ----
----------------------------
--T_TIPO_TABLA10('FEC_PRESENTACION_HACIENDA','TIT_FECHA_PRESENT_HACIENDA'),
--T_TIPO_TABLA10('FEC_PRESENTACION_REGISTRO','TIT_FECHA_PRESENT1_REG'),
--T_TIPO_TABLA10('FEC_ENTREGA_TITULO_GESTOR','TIT_FECHA_ENTREGA_GESTORIA'),
--T_TIPO_TABLA10('FEC_ENVIO_AUTO_ADICCION','TIT_FECHA_ENVIO_AUTO'),
--T_TIPO_TABLA10('FEC_SEGUNDA_PRESEN_REG','TIT_FECHA_PRESENT2_REG'),
--T_TIPO_TABLA10('FEC_INSCRIPCION_TITULO','TIT_FECHA_INSC_REG')
FOR I IN V_TIPO_TABLA10.FIRST .. V_TIPO_TABLA10.LAST
    LOOP

      V_TMP_TIPO_TABLA10 := V_TIPO_TABLA10(I);

        V_SQL := '
        MERGE INTO '||V_ESQUEMA||'.ACT_TIT_TITULO TIT USING
        (
		    WITH DISTINTOS AS (
		      SELECT APR_ID, ACT_NUMERO_UVEM, ROW_NUMBER () OVER (PARTITION BY ACT_NUMERO_UVEM ORDER BY APR_ID DESC) ORDEN
		      FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
		    )
		    SELECT '||V_TMP_TIPO_TABLA10(1)||', ACT.ACT_ID
		    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
		    INNER JOIN DISTINTOS  ON DISTINTOS.APR_ID = APR.APR_ID
		    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT  ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		    INNER JOIN '||V_ESQUEMA||'.ACT_TIT_TITULO TIT1 ON ACT.ACT_ID = TIT1.ACT_ID     
		    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID 
		    WHERE CRA.DD_CRA_CODIGO = ''03''
		      AND (TIT1.'||V_TMP_TIPO_TABLA10(2)||' <> APR.'||V_TMP_TIPO_TABLA10(1)||' OR TIT1.'||V_TMP_TIPO_TABLA10(2)||' IS NULL OR APR.'||V_TMP_TIPO_TABLA10(1)||' IS NULL)
		      AND DISTINTOS.ORDEN = 1
		      and ACT.BORRADO = 0
        ) TMP
        ON (TIT.ACT_ID = TMP.ACT_ID)
        WHEN MATCHED THEN UPDATE SET
        TIT.'||V_TMP_TIPO_TABLA10(2)||' = TMP.'||V_TMP_TIPO_TABLA10(1)||',
        TIT.USUARIOMODIFICAR = '''||V_USUARIO||''',
        TIT.FECHAMODIFICAR = SYSDATE
        '
        ;

        EXECUTE IMMEDIATE V_SQL;

        EXECUTE IMMEDIATE V_SQL;
        V_NUM_TABLAS := SQL%ROWCOUNT;

      IF V_NUM_TABLAS != 0 THEN

        DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_TIT_TITULO.'||V_TMP_TIPO_TABLA10(2)||' '||V_NUM_TABLAS||' Registros.');
        PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_TIT_TITULO.'||V_TMP_TIPO_TABLA10(2)||' '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);

        COMMIT;

      END IF;


    END LOOP;

--[9.2]--DD_ETI_ID
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_TIT_TITULO ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              ETI.DD_ETI_ID AS SITUACION_TITULO, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
              LEFT JOIN '||V_ESQUEMA||'.DD_EQV_BANKIA_REM EQV
                  ON EQV.DD_NOMBRE_BANKIA = ''DD_SITUACION_TITULO''
                  AND EQV.DD_CODIGO_BANKIA = APR.SITUACION_TITULO
                LEFT JOIN '||V_ESQUEMA||'.DD_ETI_ESTADO_TITULO ETI
                  ON ETI.DD_ETI_CODIGO = EQV.DD_CODIGO_REM
            )
            SELECT TEMP.*, ACT.DD_ETI_ID, LINK.ACT_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
              JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            INNER JOIN '||V_ESQUEMA||'.ACT_TIT_TITULO ACT
              ON ACT.ACT_ID = LINK.ACT_ID
            WHERE TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
              AND (ACT.DD_ETI_ID <> TEMP.SITUACION_TITULO OR ACT.DD_ETI_ID IS NULL OR TEMP.SITUACION_TITULO IS NULL)
              and link.borrado = 0
          ) TMP
          ON (TMP.ACT_ID = ACT.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.DD_ETI_ID = TMP.SITUACION_TITULO,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_TIT_TITULO.DD_ETI_ID '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_TIT_TITULO.DD_ETI_ID '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


-------------------------------------
---- [10] ACT_OLE_OCUPANTE_LEGAL ----
-------------------------------------
--[10.1]--OLE_NOMBRE
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_OLE_OCUPANTE_LEGAL ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.NOMBRE_ARRENDATARIO, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.OLE_NOMBRE, LINK.ACT_ID, SPS.SPS_ID, SYSDATE AS FECHACREAR
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            INNER JOIN ACT_SPS_SIT_POSESORIA SPS
              ON SPS.ACT_ID = LINK.ACT_ID
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            LEFT JOIN '||V_ESQUEMA||'.ACT_OLE_OCUPANTE_LEGAL ACT
              ON ACT.SPS_ID = SPS.SPS_ID
            WHERE
              TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
               AND
             (ACT.OLE_NOMBRE IS NULL
              AND
              TEMP.NOMBRE_ARRENDATARIO IS NOT NULL)
              and link.borrado = 0
          ) TMP
          ON (TMP.SPS_ID = ACT.SPS_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.OLE_NOMBRE = TMP.NOMBRE_ARRENDATARIO,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          WHEN NOT MATCHED THEN INSERT
          (
          OLE_ID,
          SPS_ID,
          OLE_NOMBRE,
          USUARIOCREAR,
          FECHACREAR
          )
          VALUES
          (
          '||V_ESQUEMA||'.S_ACT_OLE_OCUPANTE_LEGAL.NEXTVAL,
          TMP.SPS_ID,
          TMP.NOMBRE_ARRENDATARIO,
          '''||V_USUARIO||''',
          TMP.FECHACREAR
          )
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_OLE_OCUPANTE_LEGAL '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_OLE_OCUPANTE_LEGAL '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


---------------------------------------
---- [11] ACT_ADO_ADMISION_DOCUMENTO ----
---------------------------------------
--[11.1]--ACT_ADO_ADMISION_DOCUMENTO
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_ADO_ADMISION_DOCUMENTO ACT USING
          (
            SELECT
            ADO.ADO_ID AS ADO_ID,
            ACT.ACT_ID AS ACT_ID,
            CFD.CFD_ID AS CFD_ID,
            1 AS ADO_APLICA,
            TCE.DD_TCE_ID,
            APR.FEC_EMISION_CERTIFI_ENERG AS ADO_FECHA_CALIFICACION,
            APR.FEC_CADUCIDAD_CERTIFI_ENERG AS ADO_FECHA_CADUCIDAD
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
              ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
            INNER JOIN '||V_ESQUEMA||'.BIE_BIEN BIE
              ON BIE.BIE_ID = ACT.BIE_ID
            INNER JOIN '||V_ESQUEMA||'.DD_TCE_TIPO_CALIF_ENERGETICA TCE
                ON TCE.DD_TCE_DESCRIPCION = APR.COD_CALIF_EFICI_ENERGETICA
            INNER JOIN '||V_ESQUEMA||'.ACT_CFD_CONFIG_DOCUMENTO CFD
              ON CFD.DD_TPA_ID = ACT.DD_TPA_ID
              AND CFD.DD_TPD_ID = (SELECT DD_TPD_ID FROM '||V_ESQUEMA||'.DD_TPD_TIPO_DOCUMENTO WHERE DD_TPD_CODIGO = ''11'')
            LEFT JOIN '||V_ESQUEMA||'.ACT_ADO_ADMISION_DOCUMENTO ADO
              ON ADO.ACT_ID = ACT.ACT_ID AND ADO.CFD_ID = CFD.CFD_ID
            WHERE APR.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
              and act.borrado = 0
          ) TMP
          ON (TMP.ADO_ID = ACT.ADO_ID)
          WHEN MATCHED THEN UPDATE SET
          ADO_FECHA_EMISION = TMP.ADO_FECHA_CALIFICACION,
          ADO_FECHA_CADUCIDAD = TMP.ADO_FECHA_CADUCIDAD,
          USUARIOMODIFICAR = '''||V_USUARIO||''',
          FECHAMODIFICAR = SYSDATE
          WHERE (ADO_FECHA_EMISION IS NULL OR ADO_FECHA_CADUCIDAD IS NULL)
          WHEN NOT MATCHED THEN INSERT
          (
          ADO_ID,
          ACT_ID,
          CFD_ID,
          ADO_APLICA,
          ADO_FECHA_EMISION,
          ADO_FECHA_CADUCIDAD,
          DD_TCE_ID,
          USUARIOCREAR,
          FECHACREAR
          )
          VALUES
          (
          '||V_ESQUEMA||'.S_ACT_ADO_ADMISION_DOCUMENTO.NEXTVAL,
          TMP.ACT_ID,
          TMP.CFD_ID,
          TMP.ADO_APLICA,
          TMP.ADO_FECHA_CALIFICACION,
          TMP.ADO_FECHA_CADUCIDAD,
          TMP.DD_TCE_ID,
          '''||V_USUARIO||''',
          SYSDATE
          )
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_CFD_CONFIG_DOCUMENTO '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_CFD_CONFIG_DOCUMENTO '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;


                      

---------------------------------------
---- [12] ACT_MLV_MOVIMIENTO_LLAVE ----
---------------------------------------
--[12.1]--MLV_FECHA_ENTREGA
          V_SQL := '
          MERGE INTO '||V_ESQUEMA||'.ACT_MLV_MOVIMIENTO_LLAVE ACT USING
          (
           WITH TEMP AS (
              SELECT DISTINCT
              APR.FEC_ENVIO_LLAVES_GESTOR, APR_ID, ACT_NUMERO_UVEM, REM
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            )
            SELECT TEMP.*, ACT.MLV_FECHA_ENTREGA, LINK.ACT_ID, ACT.MLV_ID, LLV.LLV_ID
            FROM TEMP
            INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO LINK
              ON LINK.ACT_NUM_ACTIVO_UVEM = TEMP.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = LINK.DD_CRA_ID
            INNER JOIN '||V_ESQUEMA||'.ACT_LLV_LLAVE LLV
              ON LLV.ACT_ID = LINK.ACT_ID
            LEFT JOIN '||V_ESQUEMA||'.ACT_MLV_MOVIMIENTO_LLAVE ACT
              ON ACT.LLV_ID = LLV.LLV_ID
            WHERE
              TEMP.REM = 1
              AND CRA.DD_CRA_CODIGO = ''03''
               AND
              (ACT.MLV_FECHA_ENTREGA IS NULL
              AND
              TEMP.FEC_ENVIO_LLAVES_GESTOR IS NOT NULL)
              and link.borrado = 0
          ) TMP
          ON (TMP.MLV_ID = ACT.MLV_ID)
          WHEN MATCHED THEN UPDATE SET
          ACT.MLV_FECHA_ENTREGA = TMP.FEC_ENVIO_LLAVES_GESTOR,
          ACT.USUARIOMODIFICAR = '''||V_USUARIO||''',
          ACT.FECHAMODIFICAR = SYSDATE
          WHEN NOT MATCHED THEN INSERT
          (MLV_ID,
          LLV_ID,
          MLV_FECHA_ENTREGA,
          USUARIOCREAR,
          FECHACREAR)
          VALUES
          ('||V_ESQUEMA||'.S_ACT_MLV_MOVIMIENTO_LLAVE.NEXTVAL,
          TMP.LLV_ID,
          TMP.FEC_ENVIO_LLAVES_GESTOR,
          '''||V_USUARIO||''',
          SYSDATE)
          '
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_MLV_MOVIMIENTO_LLAVE '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_MLV_MOVIMIENTO_LLAVE '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;

          
---------------------------------------          
--[13] TABLA ACT_PAC_PROPIETARIO_ACTIVO 
---------------------------------------
--[13.1]--GOGRAP (GRADO_PROPIEDAD) HREOS-3364
          V_SQL := '
           MERGE INTO '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO PAC_OLD
          USING
          (
              SELECT    ACT.ACT_ID,  TGP.DD_TGP_ID
              FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
              INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT                  ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM      
              JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
               LEFT JOIN '||V_ESQUEMA||'.DD_TGP_TIPO_GRADO_PROPIEDAD TGP ON TGP.DD_TGP_CODIGO       =  CASE WHEN APR.GRADO_PROPIEDAD = ''01'' THEN ''01'' 
                                                                                                            WHEN APR.GRADO_PROPIEDAD IS NULL THEN ''01''
                                                                                                            WHEN APR.GRADO_PROPIEDAD = ''02'' THEN ''03''
                                                                                                            WHEN APR.GRADO_PROPIEDAD = ''03'' THEN ''02''
                                                                                                            WHEN APR.GRADO_PROPIEDAD IN (''04'',''05'',''06'') THEN ''05''
                                                                                                            WHEN APR.GRADO_PROPIEDAD = ''07'' THEN ''04''
                                                                                                       END 
              where APR.REM=1
              AND CRA.DD_CRA_CODIGO = ''03''
              and ACT.borrado = 0
            ) PAC_NEW  ON (PAC_OLD.ACT_ID = PAC_NEW.ACT_ID)
          WHEN MATCHED THEN UPDATE SET
             PAC_OLD.DD_TGP_ID = PAC_NEW.DD_TGP_ID,
             PAC_OLD.USUARIOMODIFICAR = '''||V_USUARIO||''',
             PAC_OLD.FECHAMODIFICAR = SYSDATE
          WHERE PAC_OLD.DD_TGP_ID <> PAC_NEW.DD_TGP_ID OR PAC_OLD.DD_TGP_ID IS NULL
          '
       
          ;
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := SQL%ROWCOUNT;


--[13.2]--POPROP -> PORCENTAJE_PROPIEDAD
          V_SQL := '
		MERGE INTO '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO T1
		USING (
		    SELECT ACT.ACT_ID, ROUND(APR.PORCENTAJE_PROPIEDAD,2) AS REDONDEO, APR.PORCENTAJE_PROPIEDAD, PAC.PAC_PORC_PROPIEDAD FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
		    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		    INNER JOIN '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO PAC ON PAC.ACT_ID = ACT.ACT_ID
		    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
		    WHERE PAC.PAC_PORC_PROPIEDAD IS NULL
		    AND APR.REM = 1
		    AND CRA.DD_CRA_CODIGO = ''03''
		    AND ACT.BORRADO = 0           
    		   ) T2 ON (T1.ACT_ID = T2.ACT_ID)
     		WHEN MATCHED THEN UPDATE SET
        	T1.PAC_PORC_PROPIEDAD = ROUND(T2.PORCENTAJE_PROPIEDAD,2),
          	T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
          	T1.FECHAMODIFICAR = SYSDATE
          	'
          	;
          
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


--[13.3]--COSPAT -> Código de Sociedad Patrimonial
          V_SQL := '
		MERGE INTO '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO T1
		USING (
		    
			SELECT ACT.ACT_ID, PRO.PRO_CODIGO_UVEM AS PROPIETARIO_REM, APR.COD_SOC_PATRIMONIAL AS PROPIETARIO_UVEM, CRA.DD_CRA_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT
			INNER JOIN '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
			INNER JOIN '||V_ESQUEMA||'.DD_EQV_BANKIA_REM EQV ON EQV.DD_CODIGO_BANKIA = TO_CHAR(APR.COD_SOC_PATRIMONIAL)
			INNER JOIN '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO PAC ON PAC.ACT_ID = ACT.ACT_ID
			INNER JOIN '||V_ESQUEMA||'.ACT_PRO_PROPIETARIO PRO ON PRO.PRO_ID = PAC.PRO_ID
			INNER JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON ACT.DD_CRA_ID = CRA.DD_CRA_ID AND PRO.DD_CRA_ID = CRA.DD_CRA_ID
			WHERE CRA.DD_CRA_CODIGO = ''03'' AND EQV.DD_NOMBRE_BANKIA = ''DD_SCR_CODIGO'' 
			  AND (PRO.PRO_CODIGO_UVEM <> APR.COD_SOC_PATRIMONIAL OR PRO.PRO_CODIGO_UVEM IS NULL OR APR.COD_SOC_PATRIMONIAL IS NULL)
			  AND EXISTS (SELECT * FROM '||V_ESQUEMA||'.ACT_PRO_PROPIETARIO PRO2 WHERE PRO2.PRO_CODIGO_UVEM = APR.COD_SOC_PATRIMONIAL)
			  AND ACT.BORRADO = 0 AND EQV.BORRADO = 0 AND APR.REM = 1
    		   ) T2 ON (T1.ACT_ID = T2.ACT_ID)
     		WHEN MATCHED THEN UPDATE SET
        	T1.PRO_ID = (SELECT PRO_ID FROM '||V_ESQUEMA||'.ACT_PRO_PROPIETARIO WHERE PRO_CODIGO_UVEM = T2.PROPIETARIO_UVEM AND DD_CRA_ID = T2.DD_CRA_ID),
          	T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
          	T1.FECHAMODIFICAR = SYSDATE
          	'
          	;
          
          EXECUTE IMMEDIATE V_SQL;
          V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

          IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

          END IF;          
          
---------------------------------
---- [14] ACT_EDI_EDIFICIO ----
---------------------------------
--[14.1]--ASCENSORES
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_EDI_EDIFICIO EDI USING
  (
    SELECT DISTINCT
    ACT.ACT_ID,
    ICO.ICO_ID,
    DECODE(APR.ASCENSOR_ACTIVO,''S'',1,''N'',0,NULL) AS EDI_ASCENSOR,
    1 AS EDI_NUM_ASCENSORES,
    SYSDATE AS FECHACREAR
    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
    INNER JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
    ON ICO.ACT_ID = ACT.ACT_ID
    WHERE APR.ASCENSOR_ACTIVO IS NOT NULL
    AND CRA.DD_CRA_CODIGO = ''03''
    and act.borrado = 0
  ) TMP
  ON (TMP.ICO_ID = EDI.ICO_ID)
  WHEN NOT MATCHED THEN INSERT
  (
  EDI_ID,
  ICO_ID,
  EDI_ASCENSOR,
  EDI_NUM_ASCENSORES,
  USUARIOCREAR,
  FECHACREAR
  )
  VALUES
  (
  '||V_ESQUEMA||'.S_ACT_EDI_EDIFICIO.NEXTVAL,
  TMP.ICO_ID,
  TMP.EDI_ASCENSOR,
  TMP.EDI_NUM_ASCENSORES,
  '''||V_USUARIO||''',
  TMP.FECHACREAR
  )
  '
  ;
  EXECUTE IMMEDIATE V_SQL;
  V_NUM_TABLAS := SQL%ROWCOUNT;

  IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_EDI_EDIFICIO '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_EDI_EDIFICIO '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

    END IF;



---------------------------------
---- [15] ACT_VIV_VIVIENDA ----
---------------------------------
--[15.1]--ACT_VIV_VIVIENDA
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_VIV_VIVIENDA VIV USING
    (
    SELECT ACT.ACT_ID, ICO.ICO_ID, DIS.ICO_ID AS ICO_ID_DIS
    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
    INNER JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
    ON ICO.ACT_ID = ACT.ACT_ID
    LEFT JOIN '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION DIS
    ON DIS.ICO_ID = ICO.ICO_ID
    WHERE DIS.ICO_ID IS NULL
    and act.borrado = 0
    AND CRA.DD_CRA_CODIGO = ''03''
    AND (APR.DORMITORIOS_ACTIVO IS NOT NULL
    OR APR.BANIOS_ACTIVO IS NOT NULL
    OR APR.GARAJE IS NOT NULL
    OR APR.TRASTERO_ACTIVO IS NOT NULL
    OR APR.NUM_TERRAZAS_DESCUBIERTAS IS NOT NULL)
  ) TMP
  ON (TMP.ICO_ID = VIV.ICO_ID)
  WHEN NOT MATCHED THEN INSERT
  (
  ICO_ID
  )
  VALUES
  (
  TMP.ICO_ID
  )
  '
  ;
  EXECUTE IMMEDIATE V_SQL;
  V_NUM_TABLAS := SQL%ROWCOUNT;

  IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_VIV_VIVIENDA '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_VIV_VIVIENDA '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

    END IF;


---------------------------------
---- [16] ACT_DIS_DISTRIBUCION ----
---------------------------------
--[16.1]--DORMITORIOS
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION DIS USING
  (
    SELECT DISTINCT
    ACT.ACT_ID, ICO.ICO_ID,
    0 AS DIS_NUM_PLANTA,
    (SELECT DD_TPH_ID FROM '||V_ESQUEMA||'.DD_TPH_TIPO_HABITACULO WHERE DD_TPH_CODIGO = ''01'') AS DD_TPH_ID,
    APR.DORMITORIOS_ACTIVO AS DIS_CANTIDAD,
    0 AS DIS_SUPERFICIE,
    SYSDATE AS FECHACREAR
    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
    INNER JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
    ON ICO.ACT_ID = ACT.ACT_ID
    where APR.DORMITORIOS_ACTIVO IS NOT NULL
    AND CRA.DD_CRA_CODIGO = ''03''
    and act.borrado = 0
  ) TMP
  ON (TMP.ICO_ID = DIS.ICO_ID
  AND TMP.DD_TPH_ID = DIS.DD_TPH_ID)
  WHEN NOT MATCHED THEN INSERT
  (
  DIS_ID,
  ICO_ID,
  DIS_NUM_PLANTA,
  DD_TPH_ID,
  DIS_CANTIDAD,
  DIS_SUPERFICIE,
  USUARIOCREAR,
  FECHACREAR
  )
  VALUES
  (
  '||V_ESQUEMA||'.S_ACT_DIS_DISTRIBUCION.NEXTVAL,
  TMP.ICO_ID,
  TMP.DIS_NUM_PLANTA,
  TMP.DD_TPH_ID,
  TMP.DIS_CANTIDAD,
  TMP.DIS_SUPERFICIE,
  '''||V_USUARIO||''',
  TMP.FECHACREAR
  )
  '
  ;
  EXECUTE IMMEDIATE V_SQL;
  V_NUM_TABLAS := SQL%ROWCOUNT;



--[16.2]--BAÑOS
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION DIS USING
  (
    SELECT DISTINCT
    ACT.ACT_ID, ICO.ICO_ID,
    0 AS DIS_NUM_PLANTA,
    (SELECT DD_TPH_ID FROM '||V_ESQUEMA||'.DD_TPH_TIPO_HABITACULO WHERE DD_TPH_CODIGO = ''02'') AS DD_TPH_ID,
    APR.BANIOS_ACTIVO AS DIS_CANTIDAD,
    0 AS DIS_SUPERFICIE,
    SYSDATE AS FECHACREAR
    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
    INNER JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
    ON ICO.ACT_ID = ACT.ACT_ID
    where APR.BANIOS_ACTIVO IS NOT NULL
    AND CRA.DD_CRA_CODIGO = ''03''
    and act.borrado = 0
  ) TMP
  ON (TMP.ICO_ID = DIS.ICO_ID
  AND TMP.DD_TPH_ID = DIS.DD_TPH_ID)
  WHEN NOT MATCHED THEN INSERT
  (
  DIS_ID,
  ICO_ID,
  DIS_NUM_PLANTA,
  DD_TPH_ID,
  DIS_CANTIDAD,
  DIS_SUPERFICIE,
  USUARIOCREAR,
  FECHACREAR
  )
  VALUES
  (
  '||V_ESQUEMA||'.S_ACT_DIS_DISTRIBUCION.NEXTVAL,
  TMP.ICO_ID,
  TMP.DIS_NUM_PLANTA,
  TMP.DD_TPH_ID,
  TMP.DIS_CANTIDAD,
  TMP.DIS_SUPERFICIE,
  '''||V_USUARIO||''',
  TMP.FECHACREAR
  )
  '
  ;
  EXECUTE IMMEDIATE V_SQL;
  V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


--[16.3]--TERRAZAS_DESCUBIERTAS
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION DIS USING
  (
    SELECT DISTINCT
    ACT.ACT_ID, ICO.ICO_ID,
    0 AS DIS_NUM_PLANTA,
    (SELECT DD_TPH_ID FROM '||V_ESQUEMA||'.DD_TPH_TIPO_HABITACULO WHERE DD_TPH_CODIGO = ''16'') AS DD_TPH_ID,
    APR.NUM_TERRAZAS_DESCUBIERTAS AS DIS_CANTIDAD,
    0 AS DIS_SUPERFICIE,
    SYSDATE AS FECHACREAR
    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
    INNER JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
    ON ICO.ACT_ID = ACT.ACT_ID
    where APR.NUM_TERRAZAS_DESCUBIERTAS IS NOT NULL
    AND CRA.DD_CRA_CODIGO = ''03''
    and act.borrado = 0
  ) TMP
  ON (TMP.ICO_ID = DIS.ICO_ID
  AND TMP.DD_TPH_ID = DIS.DD_TPH_ID)
  WHEN NOT MATCHED THEN INSERT
  (
  DIS_ID,
  ICO_ID,
  DIS_NUM_PLANTA,
  DD_TPH_ID,
  DIS_CANTIDAD,
  DIS_SUPERFICIE,
  USUARIOCREAR,
  FECHACREAR
  )
  VALUES
  (
  '||V_ESQUEMA||'.S_ACT_DIS_DISTRIBUCION.NEXTVAL,
  TMP.ICO_ID,
  TMP.DIS_NUM_PLANTA,
  TMP.DD_TPH_ID,
  TMP.DIS_CANTIDAD,
  TMP.DIS_SUPERFICIE,
  '''||V_USUARIO||''',
  TMP.FECHACREAR
  )
  '
  ;
  EXECUTE IMMEDIATE V_SQL;
  V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


--[16.4]--TRASTEROS
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION DIS USING
  (
    SELECT DISTINCT
    ACT.ACT_ID, ICO.ICO_ID,
    0 AS DIS_NUM_PLANTA,
    (SELECT DD_TPH_ID FROM '||V_ESQUEMA||'.DD_TPH_TIPO_HABITACULO WHERE DD_TPH_CODIGO = ''11'') AS DD_TPH_ID,
    DECODE(APR.TRASTERO_ACTIVO,''S'',1,''N'',0,NULL) AS DIS_CANTIDAD,
    0 AS DIS_SUPERFICIE,
    SYSDATE AS FECHACREAR
    FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
    ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
    INNER JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
    ON ICO.ACT_ID = ACT.ACT_ID
    where APR.TRASTERO_ACTIVO = ''S''
    AND CRA.DD_CRA_CODIGO = ''03''
    and act.borrado = 0
  ) TMP
  ON (TMP.ICO_ID = DIS.ICO_ID
  AND TMP.DD_TPH_ID = DIS.DD_TPH_ID)
  WHEN NOT MATCHED THEN INSERT
  (
  DIS_ID,
  ICO_ID,
  DIS_NUM_PLANTA,
  DD_TPH_ID,
  DIS_CANTIDAD,
  DIS_SUPERFICIE,
  USUARIOCREAR,
  FECHACREAR
  )
  VALUES
  (
  '||V_ESQUEMA||'.S_ACT_DIS_DISTRIBUCION.NEXTVAL,
  TMP.ICO_ID,
  TMP.DIS_NUM_PLANTA,
  TMP.DD_TPH_ID,
  TMP.DIS_CANTIDAD,
  TMP.DIS_SUPERFICIE,
  '''||V_USUARIO||''',
  TMP.FECHACREAR
  )
  '
  ;
  EXECUTE IMMEDIATE V_SQL;
  V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;


--[16.5]--GARAJES
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION DIS USING
    (
      SELECT DISTINCT
      ACT.ACT_ID, ICO.ICO_ID, APR.GARAJE,1 AS DIS_CANTIDAD_1, APR.NUM_PLAZAS_GARAJE AS DIS_CANTIDAD_2,
      (SELECT DD_TPH_ID FROM '||V_ESQUEMA||'.DD_TPH_TIPO_HABITACULO WHERE DD_TPH_CODIGO = ''12'') AS DD_TPH_ID,
      0 AS DIS_NUM_PLANTA,
      0 AS DIS_SUPERFICIE,
      SYSDATE AS FECHACREAR
      FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
      INNER JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT
        ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
        JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
      INNER JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
        ON ICO.ACT_ID = ACT.ACT_ID
      WHERE APR.GARAJE = ''S''
      AND CRA.DD_CRA_CODIGO = ''03''
      and act.borrado = 0
    ) TMP
    ON (TMP.ICO_ID = DIS.ICO_ID
    AND TMP.DD_TPH_ID = DIS.DD_TPH_ID)
    WHEN NOT MATCHED THEN INSERT
    (
    DIS_ID,
    ICO_ID,
    DIS_NUM_PLANTA,
    DD_TPH_ID,
    DIS_CANTIDAD,
    DIS_SUPERFICIE,
    USUARIOCREAR,
    FECHACREAR
    )
    VALUES
    (
    '||V_ESQUEMA||'.S_ACT_DIS_DISTRIBUCION.NEXTVAL,
    TMP.ICO_ID,
    TMP.DIS_NUM_PLANTA,
    TMP.DD_TPH_ID,
    COALESCE(DIS_CANTIDAD_2,DIS_CANTIDAD_1),
    TMP.DIS_SUPERFICIE,
    '''||V_USUARIO||''',
    TMP.FECHACREAR
    )
    '
    ;
    EXECUTE IMMEDIATE V_SQL;
    V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

    IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

  END IF;
  
  
  
---------------------------------
---- [17] ACT_ABA_ACTIVO_BANCARIO ----
---------------------------------


--[17.1]-- COTIRG --> TIPO RIESGO, (ABA_TIPO_PRODUCTO)
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO T1 USING (
    SELECT TO_CHAR(APR.TIPO_RIESGO) AS TIPO_RIESGO, ACT.ACT_ID, ABA.ABA_ID FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
    JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
    JOIN '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO ABA ON ACT.ACT_ID = ABA.ACT_ID
    WHERE APR.REM = 1
    AND CRA.DD_CRA_CODIGO = ''03''
    AND ACT.BORRADO = 0
    AND (APR.TIPO_RIESGO <> ABA.ABA_TIPO_PRODUCTO 
    OR ABA.ABA_TIPO_PRODUCTO IS NULL OR APR.TIPO_RIESGO IS NULL)
  ) T2 ON (T2.ABA_ID = T1.ABA_ID)
  WHEN MATCHED THEN UPDATE SET
    T1.ABA_TIPO_PRODUCTO = TO_CHAR(T2.TIPO_RIESGO),
    T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
    T1.FECHAMODIFICAR = SYSDATE
    '
    ;
    
    EXECUTE IMMEDIATE V_SQL;
    V_NUM_TABLAS :=  SQL%ROWCOUNT;

--[17.2]-- NUIDOP --> NUM_EXP_RIESGO, (ABA_NEXPRIESGO)
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO T1 USING (
    SELECT APR.NUM_EXP_RIESGO, ACT.ACT_ID, ABA.ABA_ID FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
      JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
      JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
      JOIN '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO ABA ON ACT.ACT_ID = ABA.ACT_ID
      WHERE APR.REM = 1
      AND ACT.BORRADO = 0
      AND CRA.DD_CRA_CODIGO = ''03''
      AND (APR.NUM_EXP_RIESGO <> ABA.ABA_NEXPRIESGO 
      OR ABA.ABA_NEXPRIESGO IS NULL OR APR.NUM_EXP_RIESGO IS NULL)
    ) T2 ON (T2.ABA_ID = T1.ABA_ID)
	WHEN MATCHED THEN UPDATE SET
    	T1.ABA_NEXPRIESGO = T2.NUM_EXP_RIESGO,
    	T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
    	T1.FECHAMODIFICAR = SYSDATE
     	'
    	; 
    
    EXECUTE IMMEDIATE V_SQL;
    V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;

    IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

  END IF;
  
  
  
---------------------------------
---- [18] ACT_VAL_VALORACIONES ----
---------------------------------
  
  
  --[18.1]-- QMREFP --> PRECIO_REFERENCIA, (VAL_IMPORTE, DD_TPC_CODIGO = '14')
  V_SQL := '
  		MERGE INTO '||V_ESQUEMA||'.ACT_VAL_VALORACIONES T1
		USING (
		    WITH VAL_REF AS (
		        SELECT VAL.VAL_ID, VAL.ACT_ID, VAL.VAL_IMPORTE, ROW_NUMBER() OVER(PARTITION BY VAL.ACT_ID ORDER BY VAL.VAL_FECHA_INICIO DESC) RN
		        FROM '||V_ESQUEMA||'.ACT_VAL_VALORACIONES VAL
		        JOIN '||V_ESQUEMA||'.DD_TPC_TIPO_PRECIO TPC ON TPC.DD_TPC_ID = VAL.DD_TPC_ID AND TPC.DD_TPC_CODIGO = ''14''
		        WHERE VAL.BORRADO = 0 AND VAL.VAL_FECHA_FIN IS NULL
		        )
		    , PRC_REF AS (
		        SELECT ACT_NUMERO_UVEM, PRECIO_REFERENCIA
		        FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM
		        WHERE NVL(PRECIO_REFERENCIA,0) <> 0
		        )
		    SELECT VAL_REF.VAL_ID, ACT.ACT_ID, PRC_REF.PRECIO_REFERENCIA, VAL_REF.VAL_IMPORTE
		    FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT
		    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
		    LEFT JOIN VAL_REF ON VAL_REF.ACT_ID = ACT.ACT_ID AND VAL_REF.RN = 1
		    LEFT JOIN PRC_REF ON PRC_REF.ACT_NUMERO_UVEM = ACT.ACT_NUM_ACTIVO_UVEM
		    WHERE CRA.DD_CRA_CODIGO = ''03'' AND ACT.BORRADO = 0
		    ) T2
		ON (T1.VAL_ID = T2.VAL_ID)
		WHEN MATCHED THEN UPDATE SET
		    T1.VAL_IMPORTE = T2.PRECIO_REFERENCIA, T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
		WHERE T2.PRECIO_REFERENCIA IS NOT NULL AND NVL(T1.VAL_IMPORTE, 0) <> T2.PRECIO_REFERENCIA
		WHEN NOT MATCHED THEN INSERT (T1.VAL_ID, T1.ACT_ID
		    , T1.DD_TPC_ID
		    , T1.VAL_IMPORTE
		    , T1.VAL_FECHA_INICIO, T1.USUARIOCREAR, T1.FECHACREAR)
		VALUES ('||V_ESQUEMA||'.S_ACT_VAL_VALORACIONES.NEXTVAL, T2.ACT_ID
		    , (SELECT DD_TPC_ID FROM '||V_ESQUEMA||'.DD_TPC_TIPO_PRECIO WHERE DD_TPC_CODIGO = ''14'')
		    , T2.PRECIO_REFERENCIA, SYSDATE, '''||V_USUARIO||''', SYSDATE)
		WHERE T2.PRECIO_REFERENCIA IS NOT NULL
  		'
    	; 
    
    EXECUTE IMMEDIATE V_SQL;
    V_NUM_TABLAS :=  SQL%ROWCOUNT;


  --[18.2]-- IMVLIQ --> PRECIO_REFERENCIA, (VAL_IMPORTE, DD_TPC_CODIGO = '16')
  
   V_SQL := '
   	MERGE INTO '||V_ESQUEMA||'.ACT_VAL_VALORACIONES T1 USING (
    	  SELECT APR.IMVLIQ/100 AS PRECIO, VAL.DD_TPC_ID, ACT.ACT_ID, VAL.VAL_ID FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR 
          JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON APR.ACT_NUMERO_UVEM = ACT.ACT_NUM_ACTIVO_UVEM
          JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
          JOIN '||V_ESQUEMA||'.ACT_VAL_VALORACIONES VAL ON VAL.ACT_ID = ACT.ACT_ID
          WHERE DD_TPC_ID = (SELECT DD_TPC_ID FROM DD_TPC_TIPO_PRECIO WHERE DD_TPC_CODIGO = ''16'')
          AND APR.REM = 1
          AND CRA.DD_CRA_CODIGO = ''03''
          AND ACT.BORRADO = 0
          AND (APR.IMVLIQ/100 <> VAL.VAL_IMPORTE OR VAL.VAL_IMPORTE IS NULL OR APR.IMVLIQ IS NULL)
   	) T2 ON (T1.VAL_ID = T2.VAL_ID)
          WHEN MATCHED THEN UPDATE SET
          T1.VAL_IMPORTE = T2.PRECIO,
          T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
          T1.FECHAMODIFICAR = SYSDATE
  	'
    	; 
    
    EXECUTE IMMEDIATE V_SQL;
    V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
  



    IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_VAL_VALORACIONES '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_VAL_VALORACIONES '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

  END IF;
  


--------------------------------------------
  --[19]TABLA ACT_REG_INFO_COMERCIAL ---
--------------------------------------------

--[19.1] CASUTR --> SUP_TOTAL_REAL_UTIL (REG_SUPERFICIE_UTIL)


	V_SQL := '
		MERGE INTO '||V_ESQUEMA||'.ACT_REG_INFO_REGISTRAL T1 USING 
		(
		SELECT ACT.ACT_ID, REG.REG_SUPERFICIE_UTIL AS REG_UTIL, APR.SUP_TOTAL_REAL_UTIL AS APR_UTIL FROM APR_AUX_STOCK_UVEM_TO_REM APR
		    JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
		    JOIN '||V_ESQUEMA||'.ACT_REG_INFO_REGISTRAL REG ON REG.ACT_ID = ACT.ACT_ID
		    WHERE NVL(REG.REG_SUPERFICIE_UTIL,0) = 0
		    AND CRA.DD_CRA_CODIGO = ''03''
		    AND APR.SUP_TOTAL_REAL_UTIL IS NOT NULL
		) T2 ON (T1.ACT_ID = T2.ACT_ID)
		WHEN MATCHED THEN UPDATE SET
		T1.REG_SUPERFICIE_UTIL = T2.APR_UTIL,
		T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
		T1.FECHAMODIFICAR = SYSDATE
		'
	; 

	EXECUTE IMMEDIATE V_SQL;
	V_NUM_TABLAS := SQL%ROWCOUNT;
  
  
  
  IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_REG_INFO_COMERCIAL '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_REG_INFO_COMERCIAL '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

  END IF;




--------------------------------------------
  --[20]TABLA BIE_DATOS_REGISTRALES ---
--------------------------------------------


  --[20.1] CASUTG --> BIE_DREG_SUPERFICIE  (SUP_TOTAL_REGISTRAL_UTIL)

	V_SQL := '
		MERGE INTO '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES T1 USING
		(
		SELECT APR.SUP_TOTAL_REGISTRAL_UTIL, BIE.BIE_ID, ACT.ACT_ID FROM APR_AUX_STOCK_UVEM_TO_REM APR
		    JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
		    JOIN '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES BIE ON ACT.BIE_ID = BIE.BIE_ID
		    WHERE APR.SUP_TOTAL_REGISTRAL_UTIL IS NOT NULL
		    AND NVL(BIE.BIE_DREG_SUPERFICIE,0) = 0
		    AND CRA.DD_CRA_CODIGO = ''03''
		    AND APR.REM = 1
		    AND ACT.BORRADO = 0
		) T2 ON (T1.BIE_ID = T2.BIE_ID)
		    WHEN MATCHED THEN UPDATE SET
		    T1.BIE_DREG_SUPERFICIE = T2.SUP_TOTAL_REGISTRAL_UTIL,
		    T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
		    T1.FECHAMODIFICAR = SYSDATE
		'
	; 

	EXECUTE IMMEDIATE V_SQL;
	V_NUM_TABLAS := SQL%ROWCOUNT;


  --[20.2] CASUTC --> BIE_DREG_SUPERFICIE_CONSTRUIDA (SUP_TOTAL_REAL_CONSTRUIDA)


	V_SQL := '
		MERGE INTO '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES T1 USING
		(
		SELECT APR.SUP_TOTAL_REAL_CONSTRUIDA, BIE.BIE_ID, ACT.ACT_ID FROM APR_AUX_STOCK_UVEM_TO_REM APR
		    JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
		    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
		    JOIN '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES BIE ON ACT.BIE_ID = BIE.BIE_ID
		    WHERE APR.SUP_TOTAL_REAL_CONSTRUIDA IS NOT NULL
		    AND NVL(BIE.BIE_DREG_SUPERFICIE_CONSTRUIDA,0) = 0
		    AND CRA.DD_CRA_CODIGO = ''03''
		    AND APR.REM = 1
		    AND ACT.BORRADO = 0
		) T2 ON (T1.BIE_ID = T2.BIE_ID)
		    WHEN MATCHED THEN UPDATE SET
		    T1.BIE_DREG_SUPERFICIE_CONSTRUIDA = T2.SUP_TOTAL_REAL_CONSTRUIDA,
		    T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
		    T1.FECHAMODIFICAR = SYSDATE
	    	'
	; 

	EXECUTE IMMEDIATE V_SQL;
	V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
  
  
  
  IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_DATOS_REGISTRALES '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

  END IF;



--------------------------------------------
  --[21]TABLA ACT_ACTIVO_BNK ---
--------------------------------------------

  --[21.1] COTSIN --> ACB_COTSIN 

	V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO_BNK T1 USING (
	    SELECT ACT.ACT_ID, APR.COTSIN FROM APR_AUX_STOCK_UVEM_TO_REM APR
	    JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
	    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
	    WHERE CRA.DD_CRA_CODIGO = ''03''
	    AND APR.REM = 1
            AND ACT.BORRADO = 0
		) T2 ON (T1.ACT_ID = T2.ACT_ID)
		WHEN MATCHED THEN UPDATE SET 
		    T1.ACB_COTSIN = T2.COTSIN,
		    T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
		    T1.FECHAMODIFICAR = SYSDATE
		    WHERE (T1.ACB_COTSIN <> T2.COTSIN OR T2.COTSIN IS NULL OR T1.ACB_COTSIN IS NULL)
		WHEN NOT MATCHED THEN INSERT 
	            (T1.ACT_ID,
		     T1.ACB_COTSIN,
                     T1.USUARIOCREAR,
		     T1.FECHACREAR
		    ) VALUES (
		     T2.ACT_ID,
		     T2.COTSIN,
		     '''||V_USUARIO||''',
		     SYSDATE
		)
		'
		;
		
	EXECUTE IMMEDIATE V_SQL;
	V_NUM_TABLAS := SQL%ROWCOUNT;


--[21.2] COREAE --> ACB_COREAE 
  
  V_SQL := '
  MERGE INTO '||V_ESQUEMA||'.ACT_ACTIVO_BNK T1 USING 
	  (
	    SELECT ACT.ACT_ID, APR.COREAE FROM APR_AUX_STOCK_UVEM_TO_REM APR
	    JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
	    JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID
	    WHERE CRA.DD_CRA_CODIGO = ''03''
	    AND APR.REM = 1
            AND ACT.BORRADO = 0
	  ) T2 ON (T1.ACT_ID = T2.ACT_ID)
		WHEN MATCHED THEN UPDATE SET 
	    T1.ACB_COREAE = T2.COREAE,
	    T1.ACB_COREAE_TEXTO = DECODE(
		    T2.COREAE,
		    ''00001'',   ''COBIAN'',
		    ''00002'',   ''CASES'',
		    ''00003'',	''GTREZ.LABRADOR'',
		    ''00004'',   ''VALDARNO'',
		    ''00005'',	''GICSA'',
		    ''00006'',	''OTROS'',
		    ''00007'',	''PROCURADOR'',
		    ''00008'',	''MONTALVO'',
		    ''00009'',	''MUNDIGESTION'',
		    ''00010'',	''GARSA'',
		    ''00011'',	''UNIGES'',
		    ''00012'',	''PINOS XXI'',
		    ''00013'',	''HAYA GARSA'',
		    ''00014'',	''HAYA PINOS XXI'',
		    ''00015'',	''HAYA GUTIERREZ LABRADOR'',
		    ''00016'',	''HAYA MONTALVO'',
		    ''00017'',	''HAYA UNIGES'',
		    ''00018'',	''MARETRA'',
		    ''00019'',	''PEDRO SEQUERA'',
		    ''CODIGO NO REGISTRADO''
	    ),
	    T1.USUARIOMODIFICAR = '''||V_USUARIO||''',
	    T1.FECHAMODIFICAR = SYSDATE
	    WHERE T1.ACB_COREAE <> T2.COREAE OR T2.COREAE IS NULL OR T1.ACB_COREAE IS NULL
	WHEN NOT MATCHED THEN INSERT 
		(T1.ACT_ID,
		T1.ACB_COREAE,
		T1.ACB_COREAE_TEXTO,
		T1.USUARIOCREAR,
		T1.FECHACREAR
		) VALUES (
		T2.ACT_ID,
		T2.COREAE,
		DECODE(
		    T2.COREAE,
		    ''00001'',   ''COBIAN'',
		    ''00002'',   ''CASES'',
		    ''00003'',	''GTREZ.LABRADOR'',
		    ''00004'',   ''VALDARNO'',
		    ''00005'',	''GICSA'',
		    ''00006'',	''OTROS'',
		    ''00007'',	''PROCURADOR'',
		    ''00008'',	''MONTALVO'',
		    ''00009'',	''MUNDIGESTION'',
		    ''00010'',	''GARSA'',
		    ''00011'',	''UNIGES'',
		    ''00012'',	''PINOS XXI'',
		    ''00013'',	''HAYA GARSA'',
		    ''00014'',	''HAYA PINOS XXI'',
		    ''00015'',	''HAYA GUTIERREZ LABRADOR'',
		    ''00016'',	''HAYA MONTALVO'',
		    ''00017'',	''HAYA UNIGES'',
		    ''00018'',	''MARETRA'',
		    ''00019'',	''PEDRO SEQUERA'',
		    ''CODIGO NO REGISTRADO''
		),
		'''||V_USUARIO||''',
		SYSDATE
		)
		'
		;

	EXECUTE IMMEDIATE V_SQL;
	V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;  

  IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ACTIVO_BNK '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ACTIVO_BNK '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;

  END IF;

      --[22]TABLA BIE_LOCALIZACION
      --[22.1] NOVIAS --> BIE_LOC_DIRECCION
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                APR.NOMBRE_VIA AS BIE_LOC_DIRECCION
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID ) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_DIRECCION = T2.BIE_LOC_DIRECCION
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.BIE_LOC_DIRECCION IS NULL AND T2.BIE_LOC_DIRECCION IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := SQL%ROWCOUNT;
      --[22.2] NUPOAC --> BIE_LOC_NUMERO_DOMICILIO
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                APR.PORTAL_PUNTO_KM AS BIE_LOC_NUMERO_DOMICILIO
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_NUMERO_DOMICILIO = T2.BIE_LOC_NUMERO_DOMICILIO
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.BIE_LOC_NUMERO_DOMICILIO IS NULL AND T2.BIE_LOC_NUMERO_DOMICILIO IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      --[22.3] NUESAC --> BIE_LOC_ESCALERA
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                APR.ESCALERA AS BIE_LOC_ESCALERA
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID ) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_ESCALERA = T2.BIE_LOC_ESCALERA
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.BIE_LOC_ESCALERA IS NULL AND T2.BIE_LOC_ESCALERA IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      --[22.4] NUPIAC --> BIE_LOC_PISO
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                APR.PISO AS BIE_LOC_PISO
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_PISO = T2.BIE_LOC_PISO
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.BIE_LOC_PISO IS NULL AND T2.BIE_LOC_PISO IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      --[22.5] COTIVI --> DD_TVI_ID
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                DD_TVI.DD_TVI_ID AS DD_TVI_ID
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID       
            LEFT JOIN '||V_ESQUEMA||'.DD_EQV_BANKIA_REM EQV ON EQV.DD_CODIGO_BANKIA = LPAD(TO_CHAR(APR.TIPO_VIA),2,''0'') AND EQV.DD_NOMBRE_BANKIA = ''DD_TIPO_VIA''
            LEFT JOIN REMMASTER.DD_TVI_TIPO_VIA DD_TVI ON EQV.DD_CODIGO_REM = DD_TVI.DD_TVI_CODIGO) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.DD_TVI_ID = T2.DD_TVI_ID
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.DD_TVI_ID IS NULL AND T2.DD_TVI_ID IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      --[22.6] COPRAE --> BIE_LOC_PROVINCIA
      --[22.6] COPRAE --> DD_PRV_ID
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                PRV.DD_PRV_ID AS DD_PRV_ID,
                PRV.DD_PRV_CODIGO AS BIE_LOC_PROVINCIA,
                BIE.DD_PRV_ID AS DD_PRV_ID2,
                BIE.BIE_LOC_PROVINCIA AS BIE_LOC_PROVINCIA2
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID 
            LEFT JOIN '||V_ESQUEMA||'.APR_AUX_DD_PRV_PROVINCIA PRV ON PRV.DD_PRV_CODIGO = APR.COD_PROVINCIA) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_PROVINCIA = T2.BIE_LOC_PROVINCIA
          , T1.DD_PRV_ID = T2.DD_PRV_ID
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE (T1.DD_PRV_ID IS NULL OR T1.BIE_LOC_PROVINCIA IS NULL) AND (T2.DD_PRV_ID IS NOT NULL OR T2.BIE_LOC_PROVINCIA IS NOT NULL)';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      --[22.7] COMUIX --> BIE_LOC_MUNICIPIO
      --[22.7] COMUIX --> UPO_ID
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                UPO.DD_UPO_CODIGO AS BIE_LOC_MUNICIPIO,
                UPO.DD_UPO_ID AS DD_UPO_ID,
                UPO.DD_LOC_ID AS DD_LOC_ID
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID 
            LEFT JOIN REMMASTER.DD_UPO_UNID_POBLACIONAL UPO ON UPO.DD_UPO_CODIGO = APR.COD_MUNICIPIO       ) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_MUNICIPIO = T2.BIE_LOC_MUNICIPIO
          , T1.DD_UPO_ID = T2.DD_UPO_ID
          , T1.DD_LOC_ID = T2.DD_LOC_ID
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE (T1.BIE_LOC_MUNICIPIO IS NULL OR T1.DD_UPO_ID IS NULL OR T1.DD_LOC_ID IS NULL OR T1.DD_LOC_ID IS NULL) 
            AND (T2.BIE_LOC_MUNICIPIO IS NOT NULL OR T2.DD_UPO_ID IS NOT NULL OR T2.DD_LOC_ID IS NOT NULL)';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      --[22.8] NUPUAC --> BIE_LOC_PUERTA
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                APR.NUM_PUERTA AS BIE_LOC_PUERTA
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_PUERTA = T2.BIE_LOC_PUERTA
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.BIE_LOC_PUERTA IS NULL AND T2.BIE_LOC_PUERTA IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      --[22.9] COPOIN --> BIE_LOC_COD_POST
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.BIE_LOCALIZACION T1
        USING (SELECT
                BIE.BIE_LOC_ID AS BIE_LOC_ID,
                APR.COD_POSTAL AS BIE_LOC_COD_POST
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION BIE ON BIE.BIE_ID = ACT.BIE_ID ) T2
        ON (T1.BIE_LOC_ID = T2.BIE_LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.BIE_LOC_COD_POST = T2.BIE_LOC_COD_POST
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.BIE_LOC_COD_POST IS NULL AND T2.BIE_LOC_COD_POST IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_LOCALIZACION '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.BIE_LOCALIZACION '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;
      END IF;
      --[23]TABLA ACT_LOC_LOCALIZACION
      --[23.1] DESLO2 --> LOC_LONGITUD
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION T1
        USING (SELECT
                ACT_LOC.LOC_ID,
                CASE
                    WHEN APR.SIGNO_LONGITUD = ''-'' THEN cast(''-''||to_number(apr.LONGITUD)/1000000000000000 as number(21,15))
                    WHEN APR.SIGNO_LONGITUD = ''+'' THEN cast(to_number(apr.LONGITUD)/1000000000000000 as number(21,15))
                END AS LOC_LONGITUD
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION ACT_LOC ON ACT_LOC.ACT_ID = ACT.ACT_ID
            JOIN '||V_ESQUEMA||'.BIE_BIEN BIE ON BIE.BIE_ID = ACT.BIE_ID
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION LOC ON LOC.BIE_ID = BIE.BIE_ID) T2
        ON (T1.LOC_ID = T2.LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.LOC_LONGITUD = T2.LOC_LONGITUD
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.LOC_LONGITUD IS NULL AND T2.LOC_LONGITUD IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := SQL%ROWCOUNT;
      --[23.2] DESLA2 --> LOC_LATITUD
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION T1
        USING (SELECT
                ACT_LOC.LOC_ID,
                CASE
                    WHEN APR.SIGNO_LATITUD = ''-'' THEN cast(''-''||to_number(apr.latitud)/1000000000000000 as number(21,15))
                    WHEN APR.SIGNO_LATITUD = ''+'' THEN cast(to_number(apr.latitud)/1000000000000000 as number(21,15))
                END AS LOC_LATITUD
            FROM '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM APR
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_NUM_ACTIVO_UVEM = APR.ACT_NUMERO_UVEM
            JOIN '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION ACT_LOC ON ACT_LOC.ACT_ID = ACT.ACT_ID
            JOIN '||V_ESQUEMA||'.BIE_BIEN BIE ON BIE.BIE_ID = ACT.BIE_ID
            JOIN '||V_ESQUEMA||'.BIE_LOCALIZACION LOC ON LOC.BIE_ID = BIE.BIE_ID) T2
        ON (T1.LOC_ID = T2.LOC_ID)
        WHEN MATCHED THEN UPDATE SET
          T1.LOC_LATITUD = T2.LOC_LATITUD
          , T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE
        WHERE T1.LOC_LATITUD IS NULL AND T2.LOC_LATITUD IS NOT NULL';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;
      END IF;

      --[24]TABLA ACT_ICO
      --[24.1] FEACON --> ICO_ANO_CONSTRUCCION
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL T1
        USING (SELECT ICO.ICO_ID, TO_NUMBER(UR.FEC_ANIO_CONSTRUCCION) ICO_ANO_CONSTRUCCION
            FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = ICO.ACT_ID
            JOIN '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM UR ON UR.ACT_NUMERO_UVEM = ACT.ACT_NUM_ACTIVO_UVEM
            WHERE NVL(ICO.ICO_ANO_CONSTRUCCION,0) = 0 AND TO_NUMBER(UR.FEC_ANIO_CONSTRUCCION) > 0) T2
        ON (T1.ICO_ID = T2.ICO_ID)
        WHEN MATCHED THEN UPDATE SET
            T1.ICO_ANO_CONSTRUCCION = T2.ICO_ANO_CONSTRUCCION, T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := SQL%ROWCOUNT;
      --[24.2] FEREHA --> ICO_ANO_REHABILITACION
      V_SQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL T1
        USING (SELECT ICO.ICO_ID, TO_NUMBER(UR.FEC_ANIO_REHABILITACION) ICO_ANO_REHABILITACION
            FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL ICO
            JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = ICO.ACT_ID
            JOIN '||V_ESQUEMA||'.APR_AUX_STOCK_UVEM_TO_REM UR ON UR.ACT_NUMERO_UVEM = ACT.ACT_NUM_ACTIVO_UVEM
            WHERE NVL(ICO.ICO_ANO_REHABILITACION,0) = 0 AND TO_NUMBER(UR.FEC_ANIO_REHABILITACION) > 0 
                AND TO_NUMBER(UR.FEC_ANIO_REHABILITACION) > NVL(ICO.ICO_ANO_CONSTRUCCION,0)) T2
        ON (T1.ICO_ID = T2.ICO_ID)
        WHEN MATCHED THEN UPDATE SET
            T1.ICO_ANO_REHABILITACION = T2.ICO_ANO_REHABILITACION, T1.USUARIOMODIFICAR = '''||V_USUARIO||''', T1.FECHAMODIFICAR = SYSDATE';
      EXECUTE IMMEDIATE V_SQL;
      V_NUM_TABLAS := V_NUM_TABLAS + SQL%ROWCOUNT;
      IF V_NUM_TABLAS != 0 THEN

            DBMS_OUTPUT.PUT_LINE('[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL '||V_NUM_TABLAS||' Registros.');
            PL_OUTPUT := PL_OUTPUT||'[INFO] REGISTROS ACTUALIZADOS EN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL '||V_NUM_TABLAS||' Registros. '||CHR(10)||CHR(10);
            DBMS_OUTPUT.PUT_LINE('----------------------------------------------------------------');

            COMMIT;
      END IF;

    COMMIT;
	
    DBMS_OUTPUT.PUT_LINE('[OK] - PROCESO FINALIZADO.');

EXCEPTION

    WHEN OTHERS THEN

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion: '||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
        DBMS_OUTPUT.put_line(V_SQL);
        PL_OUTPUT := PL_OUTPUT||V_SQL;

    ROLLBACK;
    RAISE;

END SP_UPA_UPDATE_ACTIVES_UVEM;
/
EXIT;
