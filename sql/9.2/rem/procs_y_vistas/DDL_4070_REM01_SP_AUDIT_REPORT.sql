--/*
--#########################################
--## AUTOR=DAP
--## FECHA_CREACION=20180627
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=2.0.18
--## INCIDENCIA_LINK=REMVIP-1052
--## PRODUCTO=NO
--## 
--## Finalidad: 
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/
--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

CREATE OR REPLACE PROCEDURE #ESQUEMA#.SP_AUDIT_REPORT(SP_OUTPUT OUT VARCHAR2) AS

    V_ESQUEMA   VARCHAR2(30 CHAR) := '#ESQUEMA#';
    V_ESQUEMA_M VARCHAR2(30 CHAR) := '#ESQUEMA_MASTER#';
    V_COUNT     NUMBER(1);
    V_MSQL      VARCHAR2(32767 CHAR);
    V_TABLA_MOD VARCHAR2(30 CHAR) := 'USUARIOS_MODIFICADORES';
    V_TABLA_INF VARCHAR2(30 CHAR) := 'INFORME_USU_MOD_REMVIP_1052';
    V_TABLA_H_INF VARCHAR2(30 CHAR) := 'H_INFORME_USU_MODIFICADORES';
    V_TABLA_MAIL VARCHAR2(30 CHAR) := 'INFORME_ENVIO_MAIL';
    TYPE T_TABLA IS TABLE OF VARCHAR2(30 CHAR);
    V_TABLA T_TABLA := T_TABLA('INFORME_OFERTAS_REMVIP_1052','INFORME_GASTOS_REMVIP_1052','INFORME_ACTIVOS_REMVIP_1052'
        ,'INFORME_AGRUP_REMVIP_1052','INFORME_PUBLI_REMVIP_1052','INFORME_PRECIOS_REMVIP_1052','INFORME_TRABAJOS_REMVIP_1052');
    TYPE T_TABLA_HIST IS TABLE OF VARCHAR2(30 CHAR);
    V_TABLA_HIST T_TABLA_HIST := T_TABLA_HIST('H_INFORME_OFERTAS','H_INFORME_GASTOS','H_INFORME_ACTIVOS'
        ,'H_INFORME_AGRUP','H_INFORME_PUBLI','H_INFORME_PRECIOS','H_INFORME_TRABAJOS');
    V_FROM VARCHAR2(100 CHAR) := '"noreply.rem@pfsgroup.es"';
    V_TO VARCHAR2(100 CHAR) := '"daniel.albert@pfsgroup.es"';
    V_BODY VARCHAR2(500 CHAR) := '"Se adjunta el informe diario de modificaciones de campos de auditoría."';
    V_CC VARCHAR2(500 CHAR) := '"gustavo.mora@pfsgroup.es, vicente.martinez@pfsgroup.es"';
    V_ASUNTO VARCHAR2(250 CHAR) := '"Informe diario auditorías REM de ';
    V_ADJUNTO VARCHAR2(250 CHAR) := 'Hoja_Audit_Report.xlsx';
    
BEGIN

    SP_OUTPUT := '[INICIO]' || CHR(10);

    --CREACION TABLAS MAIL
    V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA_MAIL||''' AND OWNER = '''||V_ESQUEMA||'''';
    EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;
    IF V_COUNT = 1 THEN
        V_MSQL := 'DROP TABLE '||V_ESQUEMA||'.'||V_TABLA_MAIL||' PURGE';
        EXECUTE IMMEDIATE V_MSQL;
        SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_MAIL||' dropeada'||CHR(10);
    END IF;
    
    V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA_MAIL||' AS
       SELECT '''||V_FROM||''' DE, '''||V_TO||''' A, '''||V_CC||''' COPIA
       	, '''||V_BODY||''' CUERPO, '''||V_ASUNTO||''' || TO_CHAR(SYSDATE,''DD/MM/RR'') || ''"'' ASUNTO
       	, '''||V_ADJUNTO||''' ADJUNTO
       FROM DUAL';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_MAIL||' creada'||CHR(10);
    
    --CREACION TABLAS INFORME
    FOR I IN V_TABLA.FIRST .. V_TABLA.LAST
    LOOP
        V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA(I)||''' AND OWNER = '''||V_ESQUEMA||'''';
        EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;
        IF V_COUNT = 1 THEN
            V_MSQL := 'DROP TABLE '||V_ESQUEMA||'.'||V_TABLA(I)||' PURGE';
            EXECUTE IMMEDIATE V_MSQL;
            SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA(I)||' dropeada'||CHR(10);
        END IF;
        
        V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA(I)||'
            (
                "NUM_ACTIVO" NUMBER(16,0),
                "TABLA" CHAR(50 CHAR),
                "USUARIOCREAR" VARCHAR2(50 CHAR) NOT NULL ENABLE,
                "FECHACREAR" TIMESTAMP (6) NOT NULL ENABLE,
                "USUARIOMODIFICAR" VARCHAR2(50 CHAR),
                "FECHAMODIFICAR" TIMESTAMP (6),
                "REFERENCIA" NUMBER(16,0) NOT NULL ENABLE
            )';
        EXECUTE IMMEDIATE V_MSQL;
        SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA(I)||' creada'||CHR(10);
    END LOOP;
    
    --CREACION O NO DE TABLAS HISTORICAS
    FOR I IN V_TABLA_HIST.FIRST .. V_TABLA_HIST.LAST
    LOOP
        V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA_HIST(I)||''' AND OWNER = '''||V_ESQUEMA||'''';
        EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;
        IF V_COUNT = 0 THEN
            V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA_HIST(I)||'
                (
                    "NUM_ACTIVO" NUMBER(16,0),
                    "TABLA" CHAR(50 CHAR),
                    "USUARIOCREAR" VARCHAR2(50 CHAR) NOT NULL ENABLE,
                    "FECHACREAR" TIMESTAMP (6) NOT NULL ENABLE,
                    "USUARIOMODIFICAR" VARCHAR2(50 CHAR),
                    "FECHAMODIFICAR" TIMESTAMP (6),
                    "REFERENCIA" NUMBER(16,0) NOT NULL ENABLE,
                    "FECHA_INFORME" TIMESTAMP (6)
                )';
            EXECUTE IMMEDIATE V_MSQL;
            SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_HIST(I)||' creada'||CHR(10);
        ELSE
            SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_HIST(I)||' ya existente'||CHR(10);
        END IF;
    END LOOP;
    
    --CREACION TABLAS INFORME
    V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA_INF||''' AND OWNER = '''||V_ESQUEMA||'''';
    EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;
    IF V_COUNT = 1 THEN
        V_MSQL := 'DROP TABLE '||V_ESQUEMA||'.'||V_TABLA_INF||' PURGE';
        EXECUTE IMMEDIATE V_MSQL;
        SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_INF||' dropeada'||CHR(10);
    END IF;
    
    V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA_INF||'
       (	
        "MODULO" VARCHAR2(30 CHAR), 
        "TABLA" CHAR(50 CHAR), 
        "NUM_ACTIVO" NUMBER(16,0), 
        "CARTERA" VARCHAR2(100 CHAR), 
        "SUBCARTERA" VARCHAR2(100 CHAR), 
        "USUARIOCREAR" VARCHAR2(50 CHAR), 
        "FECHACREAR" TIMESTAMP (6), 
        "USUARIOMODIFICAR" VARCHAR2(50 CHAR), 
        "FECHAMODIFICAR" TIMESTAMP (6), 
        "REFERENCIA" NUMBER(16,0)
       )';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_INF||' creada'||CHR(10);
    
    V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA_H_INF||''' AND OWNER = '''||V_ESQUEMA||'''';
    EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;
    IF V_COUNT = 0 THEN
        V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA_H_INF||'
           (	
            "MODULO" VARCHAR2(30 CHAR), 
            "TABLA" CHAR(50 CHAR), 
            "NUM_ACTIVO" NUMBER(16,0), 
            "CARTERA" VARCHAR2(100 CHAR), 
            "SUBCARTERA" VARCHAR2(100 CHAR), 
            "USUARIOCREAR" VARCHAR2(50 CHAR), 
            "FECHACREAR" TIMESTAMP (6), 
            "USUARIOMODIFICAR" VARCHAR2(50 CHAR), 
            "FECHAMODIFICAR" TIMESTAMP (6), 
            "REFERENCIA" NUMBER(16,0), 
            "FECHA_INFORME" TIMESTAMP (6)
           )';
        EXECUTE IMMEDIATE V_MSQL;
        SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_H_INF||' creada'||CHR(10);
    ELSE
        SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_H_INF||' ya existente'||CHR(10);
    END IF;
    
    --CREACION DE TABLA DE USUARIOS MODIFICADORES
    V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA_MOD||''' AND OWNER = '''||V_ESQUEMA||'''';
    EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;
    IF V_COUNT = 1 THEN
        V_MSQL := 'DROP TABLE '||V_ESQUEMA||'.'||V_TABLA_MOD||' PURGE';
        EXECUTE IMMEDIATE V_MSQL;
        SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_MOD||' dropeada'||CHR(10);
    END IF;
    
    V_MSQL := 'CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA_MOD||' AS
        SELECT DISTINCT USU.USU_USERNAME
        FROM '||V_ESQUEMA_M||'.USU_USUARIOS USU
        JOIN '||V_ESQUEMA||'.UCA_USUARIO_CARTERA UCA ON UCA.USU_ID = USU.USU_ID
        WHERE USU.BORRADO = 0';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Tabla '||V_TABLA_MOD||' creada'||CHR(10);
        
    --MODULO GASTOS
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.INFORME_GASTOS_REMVIP_1052 (NUM_ACTIVO, TABLA, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
                , '''||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR'' AS TABLA
                , T2.USUARIOCREAR
                , T2.FECHACREAR
                , T2.USUARIOMODIFICAR
                , T2.FECHAMODIFICAR
                , T2.GPV_ID AS REFERENCIA      
                 FROM '||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR  T2
                 JOIN '||V_ESQUEMA||'.GPV_ACT GAC ON GAC.GPV_ID =  T2.GPV_ID
                 JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON GAC.ACT_ID = ACT.ACT_ID
                 JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR
        UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.GGE_GASTOS_GESTION'' AS TABLA
            , T2.USUARIOCREAR
            , T2.FECHACREAR
            , T2.USUARIOMODIFICAR
            , T2.FECHAMODIFICAR
            , T2.GPV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.GGE_GASTOS_GESTION  T2
             JOIN '||V_ESQUEMA||'.GPV_ACT GAC ON GAC.GPV_ID =  T2.GPV_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON GAC.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.GDE_GASTOS_DETALLE_ECONOMICO'' AS TABLA
            , T2.USUARIOCREAR
            , T2.FECHACREAR
            , T2.USUARIOMODIFICAR
            , T2.FECHAMODIFICAR
            , T2.GPV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.GDE_GASTOS_DETALLE_ECONOMICO  T2
             JOIN '||V_ESQUEMA||'.GPV_ACT GAC ON GAC.GPV_ID =  T2.GPV_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON GAC.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.GIC_GASTOS_INFO_CONTABILIDAD'' AS TABLA
            , T2.USUARIOCREAR
            , T2.FECHACREAR
            , T2.USUARIOMODIFICAR
            , T2.FECHAMODIFICAR
            , T2.GPV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.GIC_GASTOS_INFO_CONTABILIDAD  T2
             JOIN '||V_ESQUEMA||'.GPV_ACT GAC ON GAC.GPV_ID =  T2.GPV_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON GAC.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de gastos creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.H_INFORME_GASTOS
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.INFORME_GASTOS_REMVIP_1052 INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de gastos con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    --MODULO ACTIVOS
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.INFORME_ACTIVOS_REMVIP_1052 (NUM_ACTIVO, TABLA, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
                , '''||V_ESQUEMA||'.ACT_ACTIVO'' AS TABLA
                , T2.USUARIOCREAR
                , T2.FECHACREAR
                , T2.USUARIOMODIFICAR
                , T2.FECHAMODIFICAR
                , T2.ACT_ID AS REFERENCIA      
                 FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
                 JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR
        UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AAH_AGRUP_ACTIVO_HIST'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AAH_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_AAH_AGRUP_ACTIVO_HIST T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ABA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ADA_ADJUNTO_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ADA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ADA_ADJUNTO_ACTIVO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ADM_INF_ADMINISTRATIVA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ADM_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ADM_INF_ADMINISTRATIVA T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ADN_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ADN_ADJNOJUDICIAL T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ADO_ADMISION_DOCUMENTO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ADO_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ADO_ADMISION_DOCUMENTO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AGA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AGR_AGRUPACION'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AGR_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_AGR_AGRUPACION T1 ON T1.AGR_ACT_PRINCIPAL = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AJD_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_AJD_ADJJUDICIAL T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AOB_ACTIVO_OBS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AOB_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_AOB_ACTIVO_OBS T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AVI_ACTIVOS_VINCULADOS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AVI_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_AVI_ACTIVOS_VINCULADOS T1 ON T1.ACT_ID_ORIGEN = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AVI_ACTIVOS_VINCULADOS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AVI_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_AVI_ACTIVOS_VINCULADOS T1 ON T1.ACT_ID_VINCULADO = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_BEX_BLOQ_EXP_FORMALIZAR'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ACT_BEX_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_BEX_BLOQ_EXP_FORMALIZAR T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_CAC_COPROP_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.CAC_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_CAC_COPROP_ACTIVO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_CAT_CATASTRO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.CAT_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_CAT_CATASTRO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_COE_CONDICION_ESPECIFICA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.COE_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_COE_CONDICION_ESPECIFICA T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_CRG_CARGAS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.CRG_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_CRG_CARGAS T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ECO_INFORME_JURIDICO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ACT_ECO_IJ_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ECO_INFORME_JURIDICO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_FOT_FOTO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.FOT_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_FOT_FOTO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_HAL_HIST_ALQUILERES'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.HAL_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_HAL_HIST_ALQUILERES T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_HEP_HIST_EST_PUBLICACION'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.HEP_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_HEP_HIST_EST_PUBLICACION T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_HIC_EST_INF_COMER_HIST'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.HIC_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_HIC_EST_INF_COMER_HIST T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_HVA_HIST_VALORACIONES'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.HVA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_HVA_HIST_VALORACIONES T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ICM_INF_COMER_HIST_MEDI'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ICM_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ICM_INF_COMER_HIST_MEDI T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ICO_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_LLV_LLAVE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.LLV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_LLV_LLAVE T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_LOC_LOCALIZACION'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.LOC_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_LOC_LOCALIZACION T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_PAC_PERIMETRO_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PAC_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_PAC_PERIMETRO_ACTIVO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PAC_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_PAC_PROPIETARIO_ACTIVO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_PDV_PLAN_DIN_VENTAS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PDV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_PDV_PLAN_DIN_VENTAS T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_PTO_PRESUPUESTO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PTO_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_PTO_PRESUPUESTO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_REG_INFO_REGISTRAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.REG_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_REG_INFO_REGISTRAL T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.SPS_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TAS_TASACION'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TAS_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_TAS_TASACION T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TBJ_TRABAJO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TBJ_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_TBJ_TRABAJO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TIT_TITULO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TIT_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_TIT_TITULO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TRA_TRAMITE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TRA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_TRA_TRAMITE T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_VAL_VALORACIONES'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.VAL_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.ACT_VAL_VALORACIONES T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.AIA_ADMIN_IMPUESTOS_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AIA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.AIA_ADMIN_IMPUESTOS_ACTIVO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT T2.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.AIN_ACTIVO_INTEGRADO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AIN_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ACTIVO  T2
             JOIN '||V_ESQUEMA||'.AIN_ACTIVO_INTEGRADO T1 ON T1.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
        UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_BNY_BANYO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.BNY_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_BNY_BANYO T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_COC_COCINA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.COC_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_COC_COCINA T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_CRE_CARPINTERIA_EXT'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.CRE_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_CRE_CARPINTERIA_EXT T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_CRI_CARPINTERIA_INT'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.CRI_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_CRI_CARPINTERIA_INT T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.DIS_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_DIS_DISTRIBUCION T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_EDI_EDIFICIO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.EDI_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_EDI_EDIFICIO T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_INF_INFRAESTRUCTURA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.INF_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_INF_INFRAESTRUCTURA T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_INP_INC_PRESUPUESTO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.INP_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_PTO_PRESUPUESTO  T2
             JOIN '||V_ESQUEMA||'.ACT_INP_INC_PRESUPUESTO T1 ON T1.PTO_ID = T2.PTO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_INS_INSTALACION'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.INS_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_INS_INSTALACION T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_MLV_MOVIMIENTO_LLAVE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.MLV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_LLV_LLAVE  T2
             JOIN '||V_ESQUEMA||'.ACT_MLV_MOVIMIENTO_LLAVE T1 ON T1.LLV_ID = T2.LLV_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_OLE_OCUPANTE_LEGAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.OLE_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA  T2
             JOIN '||V_ESQUEMA||'.ACT_OLE_OCUPANTE_LEGAL T1 ON T1.SPS_ID = T2.SPS_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_PRV_PARAMENTO_VERTICAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PRV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_PRV_PARAMENTO_VERTICAL T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_SOL_SOLADO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.SOL_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_SOL_SOLADO T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ZCO_ZONA_COMUN'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ZCO_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_ZCO_ZONA_COMUN T1 ON T1.ICO_ID = T2.ICO_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.OFR_OFERTAS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.OFR_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.VIS_VISITAS  T2
             JOIN '||V_ESQUEMA||'.OFR_OFERTAS T1 ON T1.VIS_ID = T2.VIS_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de activos creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.H_INFORME_ACTIVOS
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.INFORME_ACTIVOS_REMVIP_1052 INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de activos con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    --MODULO AGRUPACIONES
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.INFORME_AGRUP_REMVIP_1052 (NUM_ACTIVO, TABLA, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
                , '''||V_ESQUEMA||'.ACT_AGR_AGRUPACION'' AS TABLA
                , T2.USUARIOCREAR
                , T2.FECHACREAR
                , T2.USUARIOMODIFICAR
                , T2.FECHAMODIFICAR
                , T2.AGR_ID AS REFERENCIA      
                 FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
                 JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
                 JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
                 JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR
        UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AAH_AGRUP_ACTIVO_HIST'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AAH_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
             JOIN '||V_ESQUEMA||'.ACT_AAH_AGRUP_ACTIVO_HIST T1 ON T1.AGR_ID = T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AGA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO T1 ON T1.AGR_ID = T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_AGO_AGRUPACION_OBS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.AGO_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
             JOIN '||V_ESQUEMA||'.ACT_AGO_AGRUPACION_OBS T1 ON T1.AGR_ID = T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_FOT_FOTO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.FOT_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
             JOIN '||V_ESQUEMA||'.ACT_FOT_FOTO T1 ON T1.AGR_ID = T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TBJ_TRABAJO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TBJ_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
             JOIN '||V_ESQUEMA||'.ACT_TBJ_TRABAJO T1 ON T1.AGR_ID = T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_VAS_VIGENCIA_ASISTIDAS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ACT_VAS_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
             JOIN '||V_ESQUEMA||'.ACT_VAS_VIGENCIA_ASISTIDAS T1 ON T1.ACT_VAS_AGR_ID = T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.OFR_OFERTAS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.OFR_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION  T2
             JOIN '||V_ESQUEMA||'.OFR_OFERTAS T1 ON T1.AGR_ID = T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO AGA ON AGA.AGR_ID =  T2.AGR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AGA.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de agrupaciones creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.H_INFORME_AGRUP
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.INFORME_AGRUP_REMVIP_1052 INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de agrupaciones con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    --MODULO PUBLICACIONES
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.INFORME_PUBLI_REMVIP_1052 (NUM_ACTIVO, TABLA, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_HEP_HIST_EST_PUBLICACION'' AS TABLA
            , T2.USUARIOCREAR
            , T2.FECHACREAR
            , T2.USUARIOMODIFICAR
            , T2.FECHAMODIFICAR
            , T2.HEP_ID AS REFERENCIA      
        FROM '||V_ESQUEMA||'.ACT_HEP_HIST_EST_PUBLICACION T2
        JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
        JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de publicaciones creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.H_INFORME_PUBLI
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.INFORME_PUBLI_REMVIP_1052 INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de publicaciones con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    --MODULO PRECIOS
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.INFORME_PRECIOS_REMVIP_1052 (NUM_ACTIVO, TABLA, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_VAL_VALORACIONES'' AS TABLA
            , T2.USUARIOCREAR
            , T2.FECHACREAR
            , T2.USUARIOMODIFICAR
            , T2.FECHAMODIFICAR
            , T2.VAL_ID AS REFERENCIA     
        FROM '||V_ESQUEMA||'.ACT_VAL_VALORACIONES T2
        JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = T2.ACT_ID
        JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de precios creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.H_INFORME_PRECIOS
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.INFORME_PRECIOS_REMVIP_1052 INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de precios con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    --MODULO TRABAJOS
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.INFORME_TRABAJOS_REMVIP_1052 (NUM_ACTIVO, TABLA, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
                , '''||V_ESQUEMA||'.ACT_TBJ_TRABAJO'' AS TABLA
                , T2.USUARIOCREAR
                , T2.FECHACREAR
                , T2.USUARIOMODIFICAR
                , T2.FECHAMODIFICAR
                , T2.TBJ_ID AS REFERENCIA      
                 FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
                 JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
                 JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
                 JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR
        UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ADT_ADJUNTO_TRABAJO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ADT_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_ADT_ADJUNTO_TRABAJO T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_INP_INC_PRESUPUESTO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.INP_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_INP_INC_PRESUPUESTO T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_PRT_PRESUPUESTO_TRABAJO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PRT_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_PRT_PRESUPUESTO_TRABAJO T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_PSU_PROVISION_SUPLIDO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PSU_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_PSU_PROVISION_SUPLIDO T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_RPV_RECARGOS_PROVEEDOR'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.RPV_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_RPV_RECARGOS_PROVEEDOR T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TBO_TRABAJO_OBS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TBO_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_TBO_TRABAJO_OBS T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TCT_TRABAJO_CFGTARIFA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TCT_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_TCT_TRABAJO_CFGTARIFA T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_TRA_TRAMITE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TRA_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ACT_TRA_TRAMITE T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ECO_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.PRP_PROPUESTAS_PRECIOS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.PRP_ID AS REFERENCIA      
             FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO  T2
             JOIN '||V_ESQUEMA||'.PRP_PROPUESTAS_PRECIOS T1 ON T1.TBJ_ID = T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
        UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TAR_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ACT_TRA_TRAMITE  T2
             JOIN '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS T1 ON T1.TRA_ID = T2.TRA_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID =  T2.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
        UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.TAR_TAREAS_NOTIFICACIONES'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TAR_ID AS REFERNCIA      
             FROM '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS T2
             JOIN '||V_ESQUEMA||'.TAR_TAREAS_NOTIFICACIONES T1 ON T1.TAR_ID = T2.TAR_ID
             JOIN '||V_ESQUEMA||'.ACT_TRA_TRAMITE TRA ON TRA.TRA_ID = T2.TRA_ID
             JOIN '||V_ESQUEMA||'.ACT_TBJ ATB ON ATB.TBJ_ID = TRA.TBJ_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ATB.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de trabajos creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.H_INFORME_TRABAJOS
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.INFORME_TRABAJOS_REMVIP_1052 INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de trabajos con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    --MODULO OFERTAS
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.INFORME_OFERTAS_REMVIP_1052 (NUM_ACTIVO, TABLA, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.OFR_OFERTAS'' AS TABLA
            , T2.USUARIOCREAR
            , T2.FECHACREAR
            , T2.USUARIOMODIFICAR
            , T2.FECHAMODIFICAR
            , T2.OFR_ID AS REFERENCIA
         FROM '||V_ESQUEMA||'.OFR_OFERTAS  T2
         JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
         JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
         JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T2.USUARIOMODIFICAR
        UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ECB_ESTADOS_COMERCIAL_BK'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ECB_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.OFR_OFERTAS  T2
             JOIN '||V_ESQUEMA||'.ECB_ESTADOS_COMERCIAL_BK T1 ON T1.OFR_ID = T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ECO_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.OFR_OFERTAS  T2
             JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL T1 ON T1.OFR_ID = T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.OFR_TIA_TITULARES_ADICIONALES'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TIA_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.OFR_OFERTAS  T2
             JOIN '||V_ESQUEMA||'.OFR_TIA_TITULARES_ADICIONALES T1 ON T1.OFR_ID = T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.TXO_TEXTOS_OFERTA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TXO_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.OFR_OFERTAS  T2
             JOIN '||V_ESQUEMA||'.TXO_TEXTOS_OFERTA T1 ON T1.OFR_ID = T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
            UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_BEX_BLOQ_EXP_FORMALIZAR'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ACT_BEX_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_BEX_BLOQ_EXP_FORMALIZAR T1 ON T1.ACT_BEX_ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ACT_ECO_INFORME_JURIDICO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ACT_ECO_IJ_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ACT_ECO_INFORME_JURIDICO T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ADE_ADJUNTO_EXPEDIENTE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ADE_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ADE_ADJUNTO_EXPEDIENTE T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.COE_CONDICIONANTES_EXPEDIENTE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.COE_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.COE_CONDICIONANTES_EXPEDIENTE T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.COV_COMPARECIENTES_VENDEDOR'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.COV_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.COV_COMPARECIENTES_VENDEDOR T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ECO_COND_CONDICIONES_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.COND_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ECO_COND_CONDICIONES_ACTIVO T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ECO_TAN_TANTEO_ACTIVO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.TAN_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.ECO_TAN_TANTEO_ACTIVO T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.FOR_FORMALIZACION'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.FOR_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.FOR_FORMALIZACION T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.GEX_GASTOS_EXPEDIENTE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.GEX_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.GEX_GASTOS_EXPEDIENTE T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.OEX_OBS_EXPEDIENTE'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.OEX_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.OEX_OBS_EXPEDIENTE T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.POS_POSICIONAMIENTO'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.POS_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.POS_POSICIONAMIENTO T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.RCB_RESOL_COMITE_BANKIA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.RCB_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.RCB_RESOL_COMITE_BANKIA T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.RES_RESERVAS'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.RES_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.RES_RESERVAS T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
             UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.SUB_SUBSANACIONES'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.SUB_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL  T2
             JOIN '||V_ESQUEMA||'.SUB_SUBSANACIONES T1 ON T1.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  T2.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR
            UNION ALL
        SELECT ACT.ACT_NUM_ACTIVO AS NUM_ACTIVO
            , '''||V_ESQUEMA||'.ERE_ENTREGAS_RESERVA'' AS TABLA
            , T1.USUARIOCREAR
            , T1.FECHACREAR
            , T1.USUARIOMODIFICAR
            , T1.FECHAMODIFICAR
            , T1.ERE_ID as REFERNCIA      
             FROM '||V_ESQUEMA||'.RES_RESERVAS  T2
             JOIN '||V_ESQUEMA||'.ERE_ENTREGAS_RESERVA T1 ON T1.RES_ID = T2.RES_ID
             JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL ECO ON ECO.ECO_ID = T2.ECO_ID
             JOIN '||V_ESQUEMA||'.ACT_OFR AOF ON AOF.OFR_ID =  ECO.OFR_ID
             JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON AOF.ACT_ID = ACT.ACT_ID
             JOIN '||V_ESQUEMA||'.'||V_TABLA_MOD||' UM ON UM.USU_USERNAME = T1.USUARIOMODIFICAR';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de ofertas creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.H_INFORME_OFERTAS
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.INFORME_OFERTAS_REMVIP_1052 INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de ofertas con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    --GENERAMOS INFORME FINAL
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.'||V_TABLA_INF||' (MODULO, TABLA, NUM_ACTIVO, CARTERA, SUBCARTERA
            , USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA)
        WITH INFORME AS (
            SELECT ''ACTIVOS'' AS MODULO, TABLA, NUM_ACTIVO, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA
            FROM '||V_ESQUEMA||'.INFORME_ACTIVOS_REMVIP_1052
            UNION ALL
            SELECT ''AGRUPACIONES'' AS MODULO, TABLA, NUM_ACTIVO, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA
            FROM '||V_ESQUEMA||'.INFORME_AGRUP_REMVIP_1052
            UNION ALL
            SELECT ''ADMINISTRACION'' AS MODULO, TABLA, NUM_ACTIVO, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA
            FROM '||V_ESQUEMA||'.INFORME_GASTOS_REMVIP_1052
            UNION ALL
            SELECT ''COMERCIAL'' AS MODULO, TABLA, NUM_ACTIVO, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA
            FROM '||V_ESQUEMA||'.INFORME_OFERTAS_REMVIP_1052
            UNION ALL
            SELECT ''PRECIOS'' AS MODULO, TABLA, NUM_ACTIVO, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA
            FROM '||V_ESQUEMA||'.INFORME_PRECIOS_REMVIP_1052
            UNION ALL
            SELECT ''PUBLICACIONES'' AS MODULO, TABLA, NUM_ACTIVO, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA
            FROM '||V_ESQUEMA||'.INFORME_PUBLI_REMVIP_1052
            UNION ALL
            SELECT ''TRABAJOS'' AS MODULO, TABLA, NUM_ACTIVO, USUARIOCREAR, FECHACREAR, USUARIOMODIFICAR, FECHAMODIFICAR, REFERENCIA
            FROM '||V_ESQUEMA||'.INFORME_TRABAJOS_REMVIP_1052
            )
        SELECT INF.MODULO, INF.TABLA, INF.NUM_ACTIVO, CRA.DD_CRA_DESCRIPCION AS CARTERA
            , SCR.DD_SCR_DESCRIPCION AS SUBCARTERA, INF.USUARIOCREAR, INF.FECHACREAR
            , INF.USUARIOMODIFICAR, INF.FECHAMODIFICAR, INF.REFERENCIA
        FROM INFORME INF
        JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON INF.NUM_ACTIVO = ACT.ACT_NUM_ACTIVO
        JOIN '||V_ESQUEMA||'.DD_CRA_CARTERA CRA ON CRA.DD_CRA_ID = ACT.DD_CRA_ID AND CRA.BORRADO = 0
        JOIN '||V_ESQUEMA||'.DD_SCR_SUBCARTERA SCR ON SCR.DD_SCR_ID = ACT.DD_SCR_ID';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Informe de usuarios modificadores creado con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.'||V_TABLA_H_INF||'
        SELECT INF.*, SYSDATE
        FROM '||V_ESQUEMA||'.'||V_TABLA_INF||' INF';
    EXECUTE IMMEDIATE V_MSQL;
    SP_OUTPUT := SP_OUTPUT || ' [INFO] Historificado el informe de usuarios modificadores con '||SQL%ROWCOUNT||' registros' ||CHR(10);
    
    SP_OUTPUT := SP_OUTPUT||'[FIN]'||CHR(10);

    V_MSQL := 'SELECT COUNT(1) FROM ALL_USERS WHERE USERNAME LIKE ''PFSREM''';
	EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;

	IF V_COUNT = 1 THEN
    	V_MSQL := 'GRANT SELECT, INSERT, DELETE, UPDATE ON '||V_ESQUEMA||'.'||V_TABLA_H_INF||' TO PFSREM';
    	EXECUTE IMMEDIATE V_MSQL;
	END IF;

    COMMIT;
    
EXCEPTION
    WHEN OTHERS THEN
      SP_OUTPUT := SP_OUTPUT||'[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(SQLCODE)||CHR(10);
      SP_OUTPUT := SP_OUTPUT||'-----------------------------------------------------------'||CHR(10);
      SP_OUTPUT := SP_OUTPUT||SQLERRM||CHR(10);
      SP_OUTPUT := SP_OUTPUT||V_MSQL||CHR(10);
      ROLLBACK;
      RAISE;
END SP_AUDIT_REPORT;
/
EXIT;
