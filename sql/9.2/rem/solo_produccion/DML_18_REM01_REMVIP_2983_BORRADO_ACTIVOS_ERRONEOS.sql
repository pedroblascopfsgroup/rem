--/*
--##########################################
--## AUTOR=VIOREL REMUS OVIDIU
--## FECHA_CREACION=20191208
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-2983
--## PRODUCTO=NO
--##
--## INSTRUCCIONES: 
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF; 
DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar    
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquemas
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    V_NUM_FILAS NUMBER(16); -- Vble. para validar la existencia de un registro.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USR VARCHAR2(30 CHAR) := 'REMVIP-2983'; -- USUARIOCREAR/USUARIOMODIFICAR.
    V_ECO_ID NUMBER(16); 
    
    ACT_NUM_ACTIVO NUMBER(16);
    V_COUNT_UPDATE NUMBER(16):= 0; -- Vble. para contar updates
    
    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
		T_JBV(158493),
		T_JBV(161160),
		T_JBV(7030509),
		T_JBV(7030510),
		T_JBV(7030511),
		T_JBV(7030512),
		T_JBV(7030513),
		T_JBV(7030514),
		T_JBV(7030515),
		T_JBV(89195),
		T_JBV(90000),
		T_JBV(93983),
		T_JBV(93984),
		T_JBV(99988),
		T_JBV(162151),
		T_JBV(7003852),
		T_JBV(7003853),
		T_JBV(7003854),
		T_JBV(7003856),
		T_JBV(7003857),
		T_JBV(7003858),
		T_JBV(7003859),
		T_JBV(7003860),
		T_JBV(7003861),
		T_JBV(7003862),
		T_JBV(7003863),
		T_JBV(7003864),
		T_JBV(7003865),
		T_JBV(7003866),
		T_JBV(7003867),
		T_JBV(7003868),
		T_JBV(7003869),
		T_JBV(149169),
		T_JBV(132964),
		T_JBV(144766),
		T_JBV(138491),
		T_JBV(138679),
		T_JBV(133112),
		T_JBV(133113),
		T_JBV(132965),
		T_JBV(145434),
		T_JBV(145134),
		T_JBV(133114),
		T_JBV(133117),
		T_JBV(132970),
		T_JBV(156083),
		T_JBV(138498),
		T_JBV(132755),
		T_JBV(156699),
		T_JBV(156084),
		T_JBV(159133),
		T_JBV(146945),
		T_JBV(149935),
		T_JBV(150218),
		T_JBV(149936),
		T_JBV(149937),
		T_JBV(146948),
		T_JBV(145427),
		T_JBV(138678),
		T_JBV(156322),
		T_JBV(156657),
		T_JBV(156323),
		T_JBV(144768),
		T_JBV(138683),
		T_JBV(156078),
		T_JBV(138496),
		T_JBV(132753),
		T_JBV(145438),
		T_JBV(156697),
		T_JBV(156698),
		T_JBV(138690),
		T_JBV(147418),
		T_JBV(134983),
		T_JBV(158766),
		T_JBV(159049),
		T_JBV(149939),
		T_JBV(155046),
		T_JBV(155248),
		T_JBV(156321),
		T_JBV(145431),
		T_JBV(138490),
		T_JBV(145131),
		T_JBV(156076),
		T_JBV(138681),
		T_JBV(138985),
		T_JBV(138492),
		T_JBV(156660),
		T_JBV(145135),
		T_JBV(133118),
		T_JBV(144770),
		T_JBV(138493),
		T_JBV(138495),
		T_JBV(145214),
		T_JBV(138236),
		T_JBV(145428),
		T_JBV(156040),
		T_JBV(132746),
		T_JBV(132747),
		T_JBV(145209),
		T_JBV(132749),
		T_JBV(138682),
		T_JBV(156077),
		T_JBV(156043),
		T_JBV(156327),
		T_JBV(145137),
		T_JBV(132971),
		T_JBV(132752),
		T_JBV(132972),
		T_JBV(145440),
		T_JBV(138685),
		T_JBV(145215),
		T_JBV(138499),
		T_JBV(156696),
		T_JBV(138993),
		T_JBV(138239),
		T_JBV(146878),
		T_JBV(146944),
		T_JBV(158600),
		T_JBV(135286),
		T_JBV(159048),
		T_JBV(150128),
		T_JBV(146973),
		T_JBV(150220),
		T_JBV(135288),
		T_JBV(146977),
		T_JBV(146949),
		T_JBV(96263),
		T_JBV(190565),
		T_JBV(190319),
		T_JBV(138994),
		T_JBV(138238),
		T_JBV(156700),
		T_JBV(140968),
		T_JBV(150216),
		T_JBV(150175),
		T_JBV(134981),
		T_JBV(150217),
		T_JBV(158599),
		T_JBV(150132),
		T_JBV(150178),
		T_JBV(160640),
		T_JBV(65886),
		T_JBV(160880),
		T_JBV(190153),
		T_JBV(192433),
		T_JBV(190258),
		T_JBV(197312),
		T_JBV(191065),
		T_JBV(190670),
		T_JBV(135462),
		T_JBV(65717),
		T_JBV(65887),
		T_JBV(65529),
		T_JBV(72074),
		T_JBV(192747),
		T_JBV(192577),
		T_JBV(190156),
		T_JBV(190157),
		T_JBV(197313),
		T_JBV(190187),
		T_JBV(190320),
		T_JBV(190568),
		T_JBV(188079),
		T_JBV(177850),
		T_JBV(138677),
		T_JBV(5875365),
		T_JBV(156039),
		T_JBV(145429),
		T_JBV(156075),
		T_JBV(145129),
		T_JBV(156324),
		T_JBV(138982),
		T_JBV(138983),
		T_JBV(138680),
		T_JBV(156658),
		T_JBV(144767),
		T_JBV(133115),
		T_JBV(145435),
		T_JBV(145213),
		T_JBV(156044),
		T_JBV(156326),
		T_JBV(138987),
		T_JBV(132969),
		T_JBV(156045),
		T_JBV(132751),
		T_JBV(144772),
		T_JBV(138686),
		T_JBV(138688),
		T_JBV(145216),
		T_JBV(145439),
		T_JBV(156330),
		T_JBV(156049),
		T_JBV(156050),
		T_JBV(138240),
		T_JBV(138241),
		T_JBV(146879),
		T_JBV(146946),
		T_JBV(146974),
		T_JBV(146975),
		T_JBV(150177),
		T_JBV(135102),
		T_JBV(146882),
		T_JBV(158767),
		T_JBV(179348),
		T_JBV(175729),
		T_JBV(66196),
		T_JBV(190154),
		T_JBV(190257),
		T_JBV(190564),
		T_JBV(190155),
		T_JBV(190429),
		T_JBV(190567),
		T_JBV(192435),
		T_JBV(192543),
		T_JBV(156038),
		T_JBV(145430),
		T_JBV(145207),
		T_JBV(145132),
		T_JBV(145433),
		T_JBV(145133),
		T_JBV(145210),
		T_JBV(133605),
		T_JBV(156325),
		T_JBV(133606),
		T_JBV(132967),
		T_JBV(138986),
		T_JBV(145212),
		T_JBV(145436),
		T_JBV(138988),
		T_JBV(138989),
		T_JBV(133121),
		T_JBV(156328),
		T_JBV(133122),
		T_JBV(156081),
		T_JBV(156665),
		T_JBV(149501),
		T_JBV(159134),
		T_JBV(150176),
		T_JBV(147419),
		T_JBV(134982),
		T_JBV(147481),
		T_JBV(179450),
		T_JBV(167891),
		T_JBV(192542),
		T_JBV(197314),
		T_JBV(190566),
		T_JBV(192436),
		T_JBV(190669),
		T_JBV(190569),
		T_JBV(192578),
		T_JBV(190188),
		T_JBV(192803),
		T_JBV(177406),
		T_JBV(178057),
		T_JBV(193032),
		T_JBV(193034),
		T_JBV(188028),
		T_JBV(177851),
		T_JBV(193496),
		T_JBV(156074),
		T_JBV(156041),
		T_JBV(132966),
		T_JBV(132750),
		T_JBV(156662),
		T_JBV(156046),
		T_JBV(156080),
		T_JBV(138992),
		T_JBV(138687),
		T_JBV(156329),
		T_JBV(132973),
		T_JBV(138689),
		T_JBV(162960),
		T_JBV(197316),
		T_JBV(197229),
		T_JBV(190727),
		T_JBV(197230),
		T_JBV(189391),
		T_JBV(188080),
		T_JBV(177404),
		T_JBV(177405),
		T_JBV(159137),
		T_JBV(150219),
		T_JBV(158601),
		T_JBV(197508),
		T_JBV(197226),
		T_JBV(190259),
		T_JBV(192437),
		T_JBV(191066),
		T_JBV(192544),
		T_JBV(191067),
		T_JBV(188077),
		T_JBV(188029),
		T_JBV(192802),
		T_JBV(178058),
		T_JBV(190726),
		T_JBV(197317),
		T_JBV(192438),
		T_JBV(189131),
		T_JBV(70739),
		T_JBV(160926),
		T_JBV(192434),
		T_JBV(190668),
		T_JBV(197228),
		T_JBV(190595),
		T_JBV(197318),
		T_JBV(193033),
		T_JBV(189218),
		T_JBV(192893),
		T_JBV(193495),
		T_JBV(177403),
		T_JBV(188027),
		T_JBV(145426),
		T_JBV(138232),
		T_JBV(145130),
		T_JBV(145432),
		T_JBV(132748),
		T_JBV(156659),
		T_JBV(145211),
		T_JBV(133116),
		T_JBV(133607),
		T_JBV(132968),
		T_JBV(133120),
		T_JBV(156079),
		T_JBV(138991),
		T_JBV(156082),
		T_JBV(156047),
		T_JBV(145217),
		T_JBV(145138),
		T_JBV(144773),
		T_JBV(145277),
		T_JBV(153594),
		T_JBV(135460),
		T_JBV(146883),
		T_JBV(160150),
		T_JBV(160927),
		T_JBV(161340),
		T_JBV(190594),
		T_JBV(197227),
		T_JBV(197315),
		T_JBV(190671),
		T_JBV(190728),
		T_JBV(188078)
	); 
	V_TMP_JBV T_JBV;
    
BEGIN	

	FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);
	
  	ACT_NUM_ACTIVO := TRIM(V_TMP_JBV(1));
	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ACTUALIZACION COLUMNA ACT_NUM_ACTIVO');
	
	V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO = '||ACT_NUM_ACTIVO;
	
	EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS;
	
	IF V_NUM_FILAS = 1 THEN
	
		V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_ACTIVO 
				   SET ACT_NUM_ACTIVO = -'||ACT_NUM_ACTIVO||',
				   USUARIOMODIFICAR = '''||V_USR||''',
				   FECHAMODIFICAR = SYSDATE 
				   WHERE ACT_NUM_ACTIVO = '||ACT_NUM_ACTIVO;
	
		EXECUTE IMMEDIATE V_MSQL;
    
		DBMS_OUTPUT.PUT_LINE('[FIN] REGISTRO CON ACT_NUM_ACTIVO: '||ACT_NUM_ACTIVO||' ACTUALIZADO');
		
		V_COUNT_UPDATE := V_COUNT_UPDATE + 1;
		
	ELSE
		
		DBMS_OUTPUT.PUT_LINE('[FIN] REGISTRO NO EXISTE');
		
	END IF;
	
	END LOOP;
		
	COMMIT;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Se han borrado en total '||V_COUNT_UPDATE||' registros');
 
EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
