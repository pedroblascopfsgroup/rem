--/*
--##########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20190123
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-3131
--## PRODUCTO=NO
--##
--## Finalidad:  
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE
    V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar         
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_TABLA VARCHAR2(25 CHAR):= 'BIE_DATOS_REGISTRALES';
    V_COUNT NUMBER(16); -- Vble. para contar.
    V_COUNT_INSERT NUMBER(16):= 0; -- Vble. para contar inserts
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USUARIO VARCHAR2(32 CHAR):= 'REMVIP-3131';
    
    ACT_NUM_ACTIVO NUMBER(16);
    ACT_RECOVERY_ID_MALO NUMBER(16);
    ACT_RECOVERY_ID_BUENO NUMBER(16);
    
    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
 	TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 

 	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
		T_JBV('6040318','10438','10098'),
		T_JBV('6040048','10439','10099'),
		T_JBV('6032546','10440','10100'),
		T_JBV('6032547','10441','10101'),
		T_JBV('6032548','10442','10102'),
		T_JBV('6028824','10443','10103'),
		T_JBV('6040049','10444','10104'),
		T_JBV('6040050','10445','10105'),
		T_JBV('6028825','10446','10075'),
		T_JBV('6032549','10447','10076'),
		T_JBV('6040051','10448','10077'),
		T_JBV('6032550','10449','10078'),
		T_JBV('6040319','10450','10079'),
		T_JBV('6040320','10451','10080'),
		T_JBV('6028826','10452','10081'),
		T_JBV('6028827','10453','10082'),
		T_JBV('6040321','10454','10083'),
		T_JBV('6040322','10455','10084'),
		T_JBV('6032551','10456','10085'),
		T_JBV('6028828','10457','10086'),
		T_JBV('6028829','10458','10087'),
		T_JBV('6032552','10459','10088'),
		T_JBV('6032553','10460','10089'),
		T_JBV('6028830','10461','10090'),
		T_JBV('6032554','10462','10091'),
		T_JBV('6028831','10463','10092'),
		T_JBV('6028832','10464','10093'),
		T_JBV('6040052','10465','10094'),
		T_JBV('6032555','10466','10095'),
		T_JBV('6040323','10467','10096'),
		T_JBV('6028833','10468','10097'),
		T_JBV('6040053','10469','10052'),
		T_JBV('6040324','10470','10053'),
		T_JBV('6040054','10471','10054'),
		T_JBV('6032556','10472','10055'),
		T_JBV('6028834','10473','10056'),
		T_JBV('6028835','10474','10057'),
		T_JBV('6040055','10475','10058'),
		T_JBV('6028836','10476','10059'),
		T_JBV('6028837','10477','10060'),
		T_JBV('6028838','10478','10061'),
		T_JBV('6032557','10479','10062'),
		T_JBV('6040056','10480','10063'),
		T_JBV('6028839','10481','10064'),
		T_JBV('6028840','10482','10065'),
		T_JBV('6028841','10483','10066'),
		T_JBV('6040057','10484','10067'),
		T_JBV('6028842','10485','10068'),
		T_JBV('6028843','10486','10069'),
		T_JBV('6032558','10487','10070'),
		T_JBV('6040325','10488','10071'),
		T_JBV('6040058','10489','10072'),
		T_JBV('6032559','10490','10073'),
		T_JBV('6028844','10491','10074'),
		T_JBV('6028845','10492','10029'),
		T_JBV('6040326','10493','10030'),
		T_JBV('6040059','10494','10031'),
		T_JBV('6040327','10495','10032'),
		T_JBV('6032560','10496','10033'),
		T_JBV('6028846','10497','10034'),
		T_JBV('6040328','10498','10035'),
		T_JBV('6032561','10499','10036'),
		T_JBV('6028847','10500','10037'),
		T_JBV('6032562','10501','10038'),
		T_JBV('6032563','10502','10039'),
		T_JBV('6040329','10503','10040'),
		T_JBV('6032564','10504','10041'),
		T_JBV('6040330','10505','10042'),
		T_JBV('6040331','10506','10043'),
		T_JBV('6040060','10507','10044'),
		T_JBV('6040061','10508','10045'),
		T_JBV('6040332','10509','10046'),
		T_JBV('6040062','10510','10047'),
		T_JBV('6040333','10511','10048'),
		T_JBV('6040334','10512','10049'),
		T_JBV('6040335','10513','10050'),
		T_JBV('6040063','10514','10051'),
		T_JBV('6032466','10515','9964'),
		T_JBV('6040247','10516','9965'),
		T_JBV('6028752','10517','9966'),
		T_JBV('6039989','10518','9967'),
		T_JBV('6032467','10519','9968'),
		T_JBV('6028753','10520','9969'),
		T_JBV('6040248','10521','9970'),
		T_JBV('6028848','10522','10013'),
		T_JBV('6040336','10523','10014'),
		T_JBV('6032565','10524','10015'),
		T_JBV('6032566','10525','10016'),
		T_JBV('6040064','10526','10017'),
		T_JBV('6032567','10527','10018'),
		T_JBV('6040065','10528','10019'),
		T_JBV('6028849','10529','10020'),
		T_JBV('6040337','10530','10021'),
		T_JBV('6032568','10531','10022'),
		T_JBV('6028850','10532','10023'),
		T_JBV('6040338','10533','10024'),
		T_JBV('6032569','10534','10025'),
		T_JBV('6040339','10535','10026'),
		T_JBV('6040340','10536','10027'),
		T_JBV('6040341','10537','10028'),
		T_JBV('6039990','10538','9941'),
		T_JBV('6039991','10539','9942'),
		T_JBV('6032468','10540','9943'),
		T_JBV('6032469','10541','9944'),
		T_JBV('6039992','10542','9945'),
		T_JBV('6032470','10543','9946'),
		T_JBV('6032471','10544','9947'),
		T_JBV('6032472','10545','9948'),
		T_JBV('6040249','10546','9949'),
		T_JBV('6040250','10547','9950'),
		T_JBV('6032473','10548','9951'),
		T_JBV('6040251','10549','9952'),
		T_JBV('6028754','10550','9953'),
		T_JBV('6028755','10551','9954'),
		T_JBV('6028756','10552','9955'),
		T_JBV('6032474','10553','9956'),
		T_JBV('6040252','10554','9957'),
		T_JBV('6028757','10555','9958'),
		T_JBV('6028758','10556','9959'),
		T_JBV('6028759','10557','9960'),
		T_JBV('6040253','10558','9961'),
		T_JBV('6040254','10559','9962'),
		T_JBV('6032475','10560','9963'),
		T_JBV('6039993','10561','9918'),
		T_JBV('6039994','10562','9919'),
		T_JBV('6032476','10563','9920'),
		T_JBV('6032477','10564','9921'),
		T_JBV('6028760','10565','9922'),
		T_JBV('6039995','10566','9923'),
		T_JBV('6028761','10567','9924'),
		T_JBV('6039996','10568','9925'),
		T_JBV('6028762','10569','9926'),
		T_JBV('6039997','10570','9927'),
		T_JBV('6040255','10571','9928'),
		T_JBV('6032478','10572','9929'),
		T_JBV('6032479','10573','9930'),
		T_JBV('6028763','10574','9931'),
		T_JBV('6032480','10575','9932'),
		T_JBV('6032481','10576','9933'),
		T_JBV('6032482','10577','9934'),
		T_JBV('6040256','10578','9935'),
		T_JBV('6028764','10579','9936'),
		T_JBV('6032483','10580','9937'),
		T_JBV('6028765','10581','9938'),
		T_JBV('6039998','10582','9939'),
		T_JBV('6028766','10583','9940'),
		T_JBV('6040257','10584','9872'),
		T_JBV('6032484','10585','9873'),
		T_JBV('6028767','10586','9874'),
		T_JBV('6032485','10587','9875'),
		T_JBV('6040258','10588','9876'),
		T_JBV('6028768','10589','9877'),
		T_JBV('6039999','10590','9878'),
		T_JBV('6028769','10591','9879'),
		T_JBV('6028770','10592','9880'),
		T_JBV('6040259','10593','9881'),
		T_JBV('6032486','10594','9882'),
		T_JBV('6028771','10595','9883'),
		T_JBV('6028772','10596','9884'),
		T_JBV('6040260','10597','9885'),
		T_JBV('6028773','10598','9886'),
		T_JBV('6040261','10599','9887'),
		T_JBV('6040000','10600','9888'),
		T_JBV('6040001','10601','9889'),
		T_JBV('6040002','10602','9890'),
		T_JBV('6040003','10603','9891'),
		T_JBV('6040004','10604','9892'),
		T_JBV('6028774','10605','9893'),
		T_JBV('6040005','10606','9894'),
		T_JBV('6032487','10607','9895'),
		T_JBV('6028775','10608','9896'),
		T_JBV('6032488','10609','9897'),
		T_JBV('6032489','10610','9898'),
		T_JBV('6028776','10611','9899'),
		T_JBV('6040262','10612','9900'),
		T_JBV('6028777','10613','9901'),
		T_JBV('6032490','10614','9902'),
		T_JBV('6028778','10615','9903'),
		T_JBV('6032491','10616','9904'),
		T_JBV('6028779','10617','9905'),
		T_JBV('6028780','10618','9906'),
		T_JBV('6032492','10619','9907'),
		T_JBV('6040006','10620','9908'),
		T_JBV('6028781','10621','9909'),
		T_JBV('6040263','10622','9910'),
		T_JBV('6040264','10623','9911'),
		T_JBV('6028782','10624','9912'),
		T_JBV('6028783','10625','9913'),
		T_JBV('6032493','10626','9914'),
		T_JBV('6032494','10627','9915'),
		T_JBV('6032495','10628','9916'),
		T_JBV('6028784','10629','9917')
	 	);   
    V_TMP_JBV T_JBV;
    
    
 BEGIN
 
 FOR I IN V_JBV.FIRST .. V_JBV.LAST
 LOOP
    V_TMP_JBV := V_JBV(I);
    
  
    		V_SQL := 'UPDATE '||V_ESQUEMA||'.'||V_TABLA||' SET 
							BIE_DREG_NUM_FINCA = '||V_TMP_JBV(3)||',
							USUARIOMODIFICAR = '''||V_USUARIO||''',
							FECHAMODIFICAR = SYSDATE 
						WHERE BIE_ID = (SELECT BIE_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO ='||V_TMP_JBV(1)||') 
						AND BIE_DREG_NUM_FINCA = '||V_TMP_JBV(2)||'';	  
	
  EXECUTE IMMEDIATE V_SQL;
  
  DBMS_OUTPUT.PUT_LINE('[INFO] Se ha actualizado el NUM_FINCA '||V_TMP_JBV(2)||' A '||V_TMP_JBV(3)||'');
  
  V_COUNT_INSERT := V_COUNT_INSERT + 1;
  
  END LOOP;
  DBMS_OUTPUT.PUT_LINE('[INFO] Se han actualizado en total '||V_COUNT_INSERT||' registros en la tabla '||V_TABLA);
  
 COMMIT;
 
EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.PUT_LINE('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.PUT_LINE('-----------------------------------------------------------'); 
          DBMS_OUTPUT.PUT_LINE(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;

