--/*
--#########################################
--## AUTOR=VIOREL REMUS OVIDIU
--## FECHA_CREACION=20190604
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-4447
--## PRODUCTO=NO
--## 
--## Finalidad: ACTUALIZAR PROVISIONES Y GASTOS
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
V_SQL VARCHAR2(10000 CHAR);
TABLE_COUNT NUMBER(1,0) := 0;
V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master

BEGIN			
			
	DBMS_OUTPUT.PUT_LINE('[INICIO]');

	V_SQL := 'UPDATE '||V_ESQUEMA||'.PRG_PROVISION_GASTOS SET BORRADO = 0, 
		USUARIOBORRAR = ''REMVIP-4447'',
		FECHABORRAR = SYSDATE 
		WHERE PRG_NUM_PROVISION IN (20600014858,
		20700014859,
		20600014860,
		20700014861,
		20700014862,
		20600014863,
		20600014864,
		20700014865,
		20700014866,
		20600014867,
		20600014868,
		20600014869,
		20700014870,
		20700014871,
		20700014872,
		20600014873,
		20600014874,
		20600014875,
		20600014876,
		20600014877,
		20600014878,
		20600014879,
		20600014880,
		20600014881,
		20600014882,
		20600014883,
		20600014884,
		20600014885,
		20600014886,
		20600014887,
		20700014888,
		20600014889,
		20600014890)'
			;

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] '||SQL%ROWCOUNT||' PROVISIONES ACTUALIZADAS.');  

	V_SQL := 'UPDATE '||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR SET PRG_ID = NULL, 
		USUARIOMODIFICAR = ''REMVIP-4447'',
		FECHAMODIFICAR = SYSDATE 
		WHERE GPV_NUM_GASTO_HAYA IN (
		10503117,
		10532409,
		10526771,
		10526773,
		10526774,
		10526775,
		10526776,
		10528482,
		10583940,
		10583949,
		10583950,
		10583951,
		10583960,
		10583961,
		10583963,
		10583964,
		10583948,
		10583962,
		10583566,
		10583581,
		10583582,
		10583583,
		10583595,
		10583596,
		10583597,
		10584261,
		10584279,
		10583712,
		10583726,
		10583727,
		10583728,
		10583762,
		10583763,
		10575762,
		10575649,
		10575760,
		10575606,
		10575610,
		10575611,
		10575625,
		10575783,
		10575693,
		10575720,
		10575729,
		10575730,
		10575731,
		10575732,
		10575763,
		10575767,
		10575770,
		10575772,
		10575781,
		10575801,
		10575803,
		10575815,
		10575820,
		10575860,
		10575863,
		10565511,
		10565513,
		10565514,
		10565515,
		10565517,
		10565518,
		10565519,
		10565512,
		10565516)'
			;

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] '||SQL%ROWCOUNT||' GASTOS ACTUALIZADAS.');

	COMMIT;

	DBMS_OUTPUT.PUT_LINE('[FIN]');

EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
		DBMS_OUTPUT.PUT_LINE(V_SQL);
        ROLLBACK;
        RAISE;
END;

/

EXIT

