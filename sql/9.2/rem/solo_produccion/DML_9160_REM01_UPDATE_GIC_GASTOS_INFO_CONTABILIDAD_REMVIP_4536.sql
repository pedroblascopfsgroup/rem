--/*
--#########################################
--## AUTOR=Oscar Diestre
--## FECHA_CREACION=20190617
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-4539
--## PRODUCTO=NO
--## 
--## Finalidad: 
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
	
    err_num NUMBER; -- Numero de error.
    err_msg VARCHAR2(2048); -- Mensaje de error.
    V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; -- Configuracion Esquemas.
    V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; -- Configuracion Esquemas.
    V_USUARIOMODIFICAR VARCHAR(100 CHAR):= 'REMVIP-4539';
    V_SQL VARCHAR2(4000 CHAR);

BEGIN			
			
	DBMS_OUTPUT.PUT_LINE('[INICIO] Actualiza datos registrales ');			


	 V_SQL := 'MERGE INTO '||V_ESQUEMA||'.GIC_GASTOS_INFO_CONTABILIDAD T1
        USING (

		SELECT 
		GPV_ID
		FROM 	'||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR 
		WHERE 1 = 1
		AND BORRADO = 0
		AND GPV_NUM_GASTO_HAYA IN ( 
						10578804, 10578585, 10579025, 10578565, 10579005, 10578729, 10579174, 10565640, 10578927, 10578586, 10579026, 10578566, 10579006, 10578730, 10579175, 10565641, 10578933, 10578587, 10579107, 10578567, 10579007, 10578731, 10579176, 10565664, 10578939, 10578588, 10579113, 10578568, 10579008, 10578732, 10579177, 10565665, 10578945, 10578589, 10579119, 10578569, 10579009, 10578733, 10579178, 10565698, 10578951, 10578590, 10579125, 10578570, 10579010, 10578749, 10579179, 10565699, 10578957, 10578661, 10579131, 10578571, 10579011, 10578750, 10579180, 10565706, 10578963, 10578667, 10579132, 10578572, 10579012, 10578751, 10579181, 10565707, 10578964, 10578673, 10579138, 10578573, 10579013, 10578752, 10579182, 10565714, 10578970, 10578679, 10579139, 10578574, 10579014, 10578773, 10579183, 10565715, 10578976, 10578685, 10579145, 10578575, 10579015, 10578779, 10579184, 10565740, 10578977, 10578691, 10579151, 10578576, 10579016, 10578780, 10579225, 10565741, 10578978, 10578697, 10579157, 10578577, 10579017, 10578786, 10579226, 10565748, 10578979, 10578703, 10579163, 10578578, 10579018, 10578792, 10579232, 10565749, 10578980, 10578709, 10579169, 10578579, 10579019, 10578798, 10579238, 
10578551, 10578981, 10578715, 10579170, 10578580, 10579020, 10578799, 10579244, 10578557, 10578997, 10578716, 10579171, 10578581, 10579021, 10578800, 10579245, 10578563, 10579003, 10578722, 10579172, 10578582, 10579022, 10578801, 10579251, 10578564, 10579004, 10578728, 10579173, 10578583, 10579023, 10578802, 10579257, 10578584, 10579024, 10578803, 10579263
					) 

        ) T2 
        ON (T1.GPV_ID = T2.GPV_ID )
	WHEN MATCHED THEN UPDATE
	SET T1.GIC_CUENTA_CONTABLE = ''6310000000'' ,
	    T1.USUARIOMODIFICAR = ''' || V_USUARIOMODIFICAR || ''',
	    T1.FECHAMODIFICAR   = SYSDATE

	';

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Actualizados '||SQL%ROWCOUNT||' registros en GIC_GASTOS_INFO_CONTABILIDAD');  


-----------------------------------------------------------------------------------------------------------------


	COMMIT;

	DBMS_OUTPUT.PUT_LINE('[FIN] Proceso realizado');
	

EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
        ROLLBACK;
        RAISE;
END;
/
EXIT
