--/*
--#########################################
--## AUTOR=VIOREL REMUS OVIDIU
--## FECHA_CREACION=20190705
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-4730
--## PRODUCTO=NO
--## 
--## Finalidad: ACTUALIZAR PROVISIONES Y GASTOS
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
V_SQL VARCHAR2(10000 CHAR);
TABLE_COUNT NUMBER(1,0) := 0;
V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master

BEGIN			
			
	DBMS_OUTPUT.PUT_LINE('[INICIO]');

	V_SQL := 'UPDATE '||V_ESQUEMA||'.PRG_PROVISION_GASTOS SET BORRADO = 1, 
		USUARIOBORRAR = ''REMVIP-4730'',
		FECHABORRAR = SYSDATE 
		WHERE PRG_NUM_PROVISION IN (
		20600017238,
		20600017275,
		20600017269,
		20600017257,
		20600017243,
		20600017259,
		20600017245,
		20600017251,
		20600017273,
		20600017267,
		20600017276,
		20600017277,
		20600017246,
		20700017265,
		20600017250,
		20600017252,
		20600017260,
		20700017262,
		20700017263,
		20700017242,
		20600017249,
		20600017244,
		20600017274,
		20600017268,
		20600017254,
		20600017255,
		20600017256,
		20600017271,
		20600017270,
		20600017247,
		20600017248,
		20600017266,
		20600017239,
		21300017261,
		20700017264,
		20700017253,
		20600017272,
		20600017258,
		20600017240,
		20600017241)'
			;

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] '||SQL%ROWCOUNT||' PROVISIONES ACTUALIZADAS.');  

	V_SQL := 'UPDATE '||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR SET PRG_ID = NULL, 
		USUARIOMODIFICAR = ''REMVIP-4730'',
		FECHAMODIFICAR = SYSDATE 
		WHERE GPV_NUM_GASTO_HAYA IN (
10669821,
10669823,
10669838,
10669839,
10669840,
10669841,
10669842,
10669846,
10671307,
10671311,
10671312,
10671313,
10669849,
10669850,
10669859,
10669860,
10669861,
10669862,
10669863,
10669864,
10669865,
10669867,
10669868,
10669869,
10669873,
10671314,
10671315,
10671316,
10671317,
10671320,
10671321,
10671324,
10671325,
10672035,
10669901,
10669905,
10669906,
10669907,
10669910,
10669911,
10669912,
10669914,
10669921,
10669922,
10669927,
10669928,
10669930,
10669935,
10670640,
10670655,
10670657,
10670658,
10670662,
10670663,
10670671,
10670672,
10671383,
10671384,
10671385,
10671386,
10671387,
10671388,
10672067,
10669938,
10669952,
10669953,
10669954,
10669955,
10670677,
10670698,
10671402,
10671404,
10671407,
10671412,
10671417,
10672106,
10672112,
10672113,
10672114,
10672128,
10672129,
10672142,
10671448,
10671449,
10671450,
10671451,
10671452,
10671453,
10671454,
10671455,
10671456,
10671457,
10671458,
10671459,
10671460,
10671461,
10671462,
10671463,
10671464,
10671465,
10671466,
10671467,
10671514,
10671515,
10671516,
10671517,
10671518,
10671519,
10671520,
10671521,
10671522,
10671523,
10671524,
10671525,
10671526,
10671527,
10671528,
10671529,
10670830,
10671530,
10671531,
10671532,
10671533,
10671556,
10671563,
10670878,
10671595,
10671606,
10671676,
10671707,
10671708,
10671709,
10671710,
10671711,
10671712,
10671010,
10671713,
10671714,
10671715,
10671716,
10671717,
10671718,
10671719,
10671720,
10671721,
10671722,
10671723,
10671724,
10671725,
10671726,
10671735,
10671739,
10670330,
10670331,
10670332,
10670333,
10670334,
10670335,
10670336,
10670337,
10670338,
10670339,
10670340,
10670341,
10670342,
10670344,
10670345,
10670350,
10670351,
10671083,
10671084,
10671085,
10671783,
10671784,
10671785,
10671786,
10671787,
10671788,
10671789,
10671790,
10671791,
10671792,
10671794,
10671795,
10671796,
10671797,
10671798,
10671799,
10673188,
10668891,
10668893,
10668896,
10668897,
10668907,
10668909,
10668912,
10668913,
10668914,
10668915,
10668917,
10668919,
10668920,
10668921,
10668922,
10668923,
10668924,
10668925,
10669664,
10671110,
10671800,
10671801,
10671802,
10671803,
10671804,
10671805,
10671806,
10671807,
10671808,
10671809,
10671810,
10671811,
10671812,
10671813,
10671816,
10671817,
10671818,
10671819,
10671820,
10671821,
10671822,
10671823,
10671824,
10671825,
10671826,
10671827,
10671828,
10671829,
10671830,
10671831,
10671832,
10671833,
10671834,
10671835,
10668955,
10668956,
10668960,
10668961,
10671146,
10671147,
10671148,
10671149,
10671153,
10671161,
10671164,
10671167,
10671844,
10671849,
10671851,
10671853,
10671854,
10671862,
10672604,
10672605,
10672606,
10672607,
10672608,
10672609,
10672610,
10672611,
10672612,
10672613,
10672614,
10672615,
10672616,
10668977,
10669742,
10669743,
10671211,
10671216,
10671221,
10671222,
10671224,
10672618,
10669763,
10669764,
10669765,
10669766,
10669767,
10669768,
10669769,
10669782,
10669783,
10669784,
10669787,
10670493,
10670495,
10670497,
10670499,
10670501,
10670521,
10671234,
10671268,
10655560,
10655561,
10655525,
10649182,
10649183,
10649181,
10648906,
10648905,
10641718,
10641719,
10641721,
10641722,
10641723,
10641724,
10641725,
10641726,
10641740,
10641741,
10641117,
10641118,
10641845,
10641846,
10641847,
10641848,
10641228,
10641229,
10641248,
10641250,
10641268,
10641269,
10641288,
10641289,
10641331,
10641350,
10641370,
10641371,
10641391,
10641411,
10641430,
10641450,
10641452,
10641470,
10641491,
10641510,
10641511,
10641530,
10641531,
10641017,
10641018,
10641037,
10641038,
10641057,
10641058,
10641671,
10641673,
10641689,
10641077,
10641078,
10641097,
10641098,
10630381,
10630252,
10630383,
10630384,
10630472,
10630473,
10630474,
10630475,
10630496,
10630497,
10630498,
10630499,
10630500,
10630501,
10630502,
10630503,
10630504,
10630505,
10630506,
10630507,
10630581,
10630382,
10630251,
10630250,
10630246,
10630245,
10630244,
10630584,
10630583,
10630582,
10606145,
10575817,
10565480,
10564194,
10564195,
10564196,
10564197,
10564198,
10564199,
10564200,
10564201,
10564202,
10564203,
10564206,
10564193,
10564192,
10564156,
10564168,
10564118,
10564148,
10564150,
10486088,
10486089,
10486087,
10466213,
10333352,
10333351,
10260267)'
			;

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] '||SQL%ROWCOUNT||' GASTOS ACTUALIZADAS.');

	COMMIT;

	DBMS_OUTPUT.PUT_LINE('[FIN]');

EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
		DBMS_OUTPUT.PUT_LINE(V_SQL);
        ROLLBACK;
        RAISE;
END;

/

EXIT

