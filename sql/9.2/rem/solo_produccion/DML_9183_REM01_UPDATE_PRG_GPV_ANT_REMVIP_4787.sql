--/*
--##########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20190711
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-4787
--## PRODUCTO=NO
--##
--## Finalidad:
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
    V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_TABLA VARCHAR2(25 CHAR):= 'GPV_GASTOS_PROVEEDOR';
    V_COUNT NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USUARIO VARCHAR2(65 CHAR) := 'REMVIP-4787';   
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    V_NUM_FILAS NUMBER(16); -- Vble. para validar la existencia de un registro.
    GPV NUMBER(16);
    PRG NUMBER(16);
    V_COUNT_UPDATE NUMBER(16):= 0; -- Vble. para contar updates

    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	--GPV_ID, PRG_ID

	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
		T_JBV('6646961','851591'),
		T_JBV('6646391','851573'),
		T_JBV('6646389','851573'),
		T_JBV('6646388','851573'),
		T_JBV('6646387','851573'),
		T_JBV('6646386','851573'),
		T_JBV('6646385','851573'),
		T_JBV('6646384','851573'),
		T_JBV('6646383','851573'),
		T_JBV('6646382','851573'),
		T_JBV('6646381','851573'),
		T_JBV('6646380','851573'),
		T_JBV('6646379','851573'),
		T_JBV('6646378','851573'),
		T_JBV('6646377','851573'),
		T_JBV('6645915','851587'),
		T_JBV('6645902','851587'),
		T_JBV('6645901','851587'),
		T_JBV('6645887','851587'),
		T_JBV('6645886','851578'),
		T_JBV('6645885','851578'),
		T_JBV('6645879','851578'),
		T_JBV('6645840','851587'),
		T_JBV('6645808','851587'),
		T_JBV('6645635','851601'),
		T_JBV('6645627','851601'),
		T_JBV('6645626','851601'),
		T_JBV('6645624','851601'),
		T_JBV('6645622','851601'),
		T_JBV('6645617','851601'),
		T_JBV('6645608','851592'),
		T_JBV('6645607','851592'),
		T_JBV('6645606','851592'),
		T_JBV('6645605','851592'),
		T_JBV('6645604','851592'),
		T_JBV('6645603','851592'),
		T_JBV('6645602','851592'),
		T_JBV('6645601','851592'),
		T_JBV('6645600','851592'),
		T_JBV('6645599','851592'),
		T_JBV('6645598','851592'),
		T_JBV('6645597','851592'),
		T_JBV('6645596','851592'),
		T_JBV('6645595','851592'),
		T_JBV('6645594','851592'),
		T_JBV('6645593','851592'),
		T_JBV('6645592','851592'),
		T_JBV('6645591','851592'),
		T_JBV('6645590','851592'),
		T_JBV('6645589','851592'),
		T_JBV('6645586','851592'),
		T_JBV('6645585','851592'),
		T_JBV('6645584','851592'),
		T_JBV('6645583','851592'),
		T_JBV('6645582','851592'),
		T_JBV('6645581','851592'),
		T_JBV('6645580','851592'),
		T_JBV('6645579','851592'),
		T_JBV('6645578','851592'),
		T_JBV('6645577','851592'),
		T_JBV('6645576','851592'),
		T_JBV('6645575','851592'),
		T_JBV('6645574','851592'),
		T_JBV('6645573','851592'),
		T_JBV('6645572','851592'),
		T_JBV('6645571','851592'),
		T_JBV('6645570','851592'),
		T_JBV('6645569','851592'),
		T_JBV('6645568','851592'),
		T_JBV('6645567','851592'),
		T_JBV('6645565','851592'),
		T_JBV('6645564','851592'),
		T_JBV('6645563','851592'),
		T_JBV('6645562','851592'),
		T_JBV('6645561','851592'),
		T_JBV('6645560','851592'),
		T_JBV('6645559','851592'),
		T_JBV('6645558','851592'),
		T_JBV('6645557','851592'),
		T_JBV('6645556','851592'),
		T_JBV('6645512','851601'),
		T_JBV('6645508','851601'),
		T_JBV('6645499','851592'),
		T_JBV('6645498','851592'),
		T_JBV('6645497','851592'),
		T_JBV('6645496','851592'),
		T_JBV('6645495','851592'),
		T_JBV('6645494','851592'),
		T_JBV('6645493','851592'),
		T_JBV('6645492','851592'),
		T_JBV('6645491','851592'),
		T_JBV('6645490','851592'),
		T_JBV('6645489','851592'),
		T_JBV('6645488','851592'),
		T_JBV('6645487','851592'),
		T_JBV('6645486','851592'),
		T_JBV('6645485','851592'),
		T_JBV('6645484','851592'),
		T_JBV('6645483','851592'),
		T_JBV('6645482','851592'),
		T_JBV('6645481','851592'),
		T_JBV('6645480','851592'),
		T_JBV('6645449','851568'),
		T_JBV('6645379','851573'),
		T_JBV('6645368','851573'),
		T_JBV('6645336','851600'),
		T_JBV('6645329','851600'),
		T_JBV('6645306','851592'),
		T_JBV('6645305','851592'),
		T_JBV('6645304','851592'),
		T_JBV('6645303','851592'),
		T_JBV('6645302','851592'),
		T_JBV('6645301','851592'),
		T_JBV('6645300','851592'),
		T_JBV('6645299','851592'),
		T_JBV('6645298','851592'),
		T_JBV('6645297','851592'),
		T_JBV('6645296','851592'),
		T_JBV('6645295','851592'),
		T_JBV('6645294','851592'),
		T_JBV('6645293','851592'),
		T_JBV('6645292','851592'),
		T_JBV('6645291','851592'),
		T_JBV('6645290','851592'),
		T_JBV('6645289','851592'),
		T_JBV('6645288','851592'),
		T_JBV('6645287','851592'),
		T_JBV('6645240','851592'),
		T_JBV('6645239','851592'),
		T_JBV('6645238','851592'),
		T_JBV('6645237','851592'),
		T_JBV('6645236','851592'),
		T_JBV('6645235','851592'),
		T_JBV('6645234','851592'),
		T_JBV('6645233','851592'),
		T_JBV('6645232','851592'),
		T_JBV('6645231','851592'),
		T_JBV('6645230','851592'),
		T_JBV('6645229','851592'),
		T_JBV('6645228','851592'),
		T_JBV('6645227','851592'),
		T_JBV('6645226','851592'),
		T_JBV('6645225','851592'),
		T_JBV('6645224','851592'),
		T_JBV('6645223','851592'),
		T_JBV('6645222','851592'),
		T_JBV('6645221','851592'),
		T_JBV('6645190','851573'),
		T_JBV('6645185','851573'),
		T_JBV('6645180','851578'),
		T_JBV('6645177','851600'),
		T_JBV('6645175','851578'),
		T_JBV('6645161','851600'),
		T_JBV('6645160','851600'),
		T_JBV('6645159','851600'),
		T_JBV('6645158','851600'),
		T_JBV('6645157','851600'),
		T_JBV('6645156','851600'),
		T_JBV('6645098','851600'),
		T_JBV('6645097','851600'),
		T_JBV('6645094','851600'),
		T_JBV('6645093','851600'),
		T_JBV('6645090','851600'),
		T_JBV('6645089','851573'),
		T_JBV('6645088','851573'),
		T_JBV('6645087','851573'),
		T_JBV('6645086','851573'),
		T_JBV('6645085','851573'),
		T_JBV('6645084','851573'),
		T_JBV('6645080','851590'),
		T_JBV('6645041','851574'),
		T_JBV('6645007','851590'),
		T_JBV('6644997','851573'),
		T_JBV('6644995','851590'),
		T_JBV('6644994','851590'),
		T_JBV('6644989','851590'),
		T_JBV('6644984','851590'),
		T_JBV('6644940','851600'),
		T_JBV('6644937','851600'),
		T_JBV('6644934','851578'),
		T_JBV('6644926','851600'),
		T_JBV('6644922','851600'),
		T_JBV('6644921','851600'),
		T_JBV('6644920','851600'),
		T_JBV('6644919','851600'),
		T_JBV('6644883','851600'),
		T_JBV('6644858','851588'),
		T_JBV('6644857','851588'),
		T_JBV('6644856','851588'),
		T_JBV('6644783','851600'),
		T_JBV('6644651','851600'),
		T_JBV('6644603','851600'),
		T_JBV('6644471','851588'),
		T_JBV('6644450','851600'),
		T_JBV('6644445','851600'),
		T_JBV('6644444','851600'),
		T_JBV('6644436','851600'),
		T_JBV('6644435','851591'),
		T_JBV('6644431','851600'),
		T_JBV('6644430','851600'),
		T_JBV('6644428','851600'),
		T_JBV('6644413','851600'),
		T_JBV('6644294','851600'),
		T_JBV('6644274','851600'),
		T_JBV('6644272','851600'),
		T_JBV('6644270','851600'),
		T_JBV('6644268','851600'),
		T_JBV('6644266','851600'),
		T_JBV('6644124','851573'),
		T_JBV('6644123','851573'),
		T_JBV('6644118','851588'),
		T_JBV('6644117','851600'),
		T_JBV('6644115','851564'),
		T_JBV('6644114','851564'),
		T_JBV('6644113','851564'),
		T_JBV('6644112','851564'),
		T_JBV('6644111','851564'),
		T_JBV('6644110','851564'),
		T_JBV('6644109','851564'),
		T_JBV('6644108','851564'),
		T_JBV('6644107','851564'),
		T_JBV('6644106','851564'),
		T_JBV('6644105','851564'),
		T_JBV('6644104','851564'),
		T_JBV('6644103','851564'),
		T_JBV('6643728','851600'),
		T_JBV('6643727','851600'),
		T_JBV('6643726','851600'),
		T_JBV('6643725','851600'),
		T_JBV('6643711','851600'),
		T_JBV('6643708','851578'),
		T_JBV('6643703','851600'),
		T_JBV('6643701','851600'),
		T_JBV('6643700','851600'),
		T_JBV('6643695','851578'),
		T_JBV('6643694','851578'),
		T_JBV('6643687','851573'),
		T_JBV('6643685','851589'),
		T_JBV('6643684','851589'),
		T_JBV('6643683','851573'),
		T_JBV('6643680','851573'),
		T_JBV('6643679','851573'),
		T_JBV('6643678','851578'),
		T_JBV('6643674','851573'),
		T_JBV('6643646','851589'),
		T_JBV('6643642','851589'),
		T_JBV('6643641','851589'),
		T_JBV('6643640','851573'),
		T_JBV('6643638','851586'),
		T_JBV('6643637','851586'),
		T_JBV('6643636','851586'),
		T_JBV('6643635','851586'),
		T_JBV('6643634','851586'),
		T_JBV('6643633','851586'),
		T_JBV('6643632','851586'),
		T_JBV('6643623','851589'),
		T_JBV('6643622','851589'),
		T_JBV('6643619','851573'),
		T_JBV('6643615','851589'),
		T_JBV('6643614','851589'),
		T_JBV('6643613','851589'),
		T_JBV('6643612','851589'),
		T_JBV('6643611','851589'),
		T_JBV('6643596','851573'),
		T_JBV('6643594','851573'),
		T_JBV('6643560','851578'),
		T_JBV('6643557','851578'),
		T_JBV('6643556','851578'),
		T_JBV('6643555','851578'),
		T_JBV('6643542','851586'),
		T_JBV('6643541','851586'),
		T_JBV('6643540','851586'),
		T_JBV('6643539','851586'),
		T_JBV('6643538','851586'),
		T_JBV('6643537','851586'),
		T_JBV('6643536','851586'),
		T_JBV('6643516','851589'),
		T_JBV('6643515','851589'),
		T_JBV('6643437','851573'),
		T_JBV('6642750','851588'),
		T_JBV('6642734','851578'),
		T_JBV('6642733','851578'),
		T_JBV('6642729','851578'),
		T_JBV('6642728','851588'),
		T_JBV('6642698','851600'),
		T_JBV('6642697','851600'),
		T_JBV('6642696','851600'),
		T_JBV('6642695','851573'),
		T_JBV('6642694','851600'),
		T_JBV('6642693','851600'),
		T_JBV('6642692','851600'),
		T_JBV('6642690','851590'),
		T_JBV('6642688','851573'),
		T_JBV('6642687','851590'),
		T_JBV('6642686','851590'),
		T_JBV('6642685','851590'),
		T_JBV('6642682','851573'),
		T_JBV('6642680','851590'),
		T_JBV('6642670','851573'),
		T_JBV('6642669','851590'),
		T_JBV('6642666','851590'),
		T_JBV('6642664','851590'),
		T_JBV('6629334','851580'),
		T_JBV('6629333','851580'),
		T_JBV('6629298','851583'),
		T_JBV('6622956','851581'),
		T_JBV('6622955','851575'),
		T_JBV('6622954','851575'),
		T_JBV('6622679','851562'),
		T_JBV('6622678','851562'),
		T_JBV('6615621','851570'),
		T_JBV('6615620','851570'),
		T_JBV('6615619','851570'),
		T_JBV('6615618','851570'),
		T_JBV('6615514','851572'),
		T_JBV('6615513','851572'),
		T_JBV('6615499','851570'),
		T_JBV('6615498','851570'),
		T_JBV('6615497','851570'),
		T_JBV('6615496','851570'),
		T_JBV('6615495','851570'),
		T_JBV('6615494','851570'),
		T_JBV('6615492','851570'),
		T_JBV('6615491','851570'),
		T_JBV('6615462','851582'),
		T_JBV('6615446','851569'),
		T_JBV('6615444','851569'),
		T_JBV('6615304','851588'),
		T_JBV('6615303','851588'),
		T_JBV('6615284','851588'),
		T_JBV('6615283','851588'),
		T_JBV('6615264','851588'),
		T_JBV('6615243','851588'),
		T_JBV('6615225','851588'),
		T_JBV('6615223','851588'),
		T_JBV('6615203','851588'),
		T_JBV('6615184','851588'),
		T_JBV('6615164','851588'),
		T_JBV('6615144','851588'),
		T_JBV('6615143','851588'),
		T_JBV('6615123','851588'),
		T_JBV('6615104','851588'),
		T_JBV('6615062','851588'),
		T_JBV('6615061','851588'),
		T_JBV('6615042','851588'),
		T_JBV('6615041','851588'),
		T_JBV('6615023','851588'),
		T_JBV('6615021','851588'),
		T_JBV('6615002','851588'),
		T_JBV('6615001','851588'),
		T_JBV('6614891','851588'),
		T_JBV('6614890','851588'),
		T_JBV('6614871','851588'),
		T_JBV('6614870','851588'),
		T_JBV('6614851','851588'),
		T_JBV('6614850','851588'),
		T_JBV('6614831','851588'),
		T_JBV('6614830','851588'),
		T_JBV('6614811','851588'),
		T_JBV('6614810','851588'),
		T_JBV('6614791','851588'),
		T_JBV('6614790','851588'),
		T_JBV('6604357','851577'),
		T_JBV('6604356','851577'),
		T_JBV('6604355','851577'),
		T_JBV('6604354','851577'),
		T_JBV('6604280','851567'),
		T_JBV('6604279','851567'),
		T_JBV('6604278','851567'),
		T_JBV('6604277','851567'),
		T_JBV('6604276','851567'),
		T_JBV('6604275','851567'),
		T_JBV('6604274','851567'),
		T_JBV('6604273','851567'),
		T_JBV('6604272','851567'),
		T_JBV('6604271','851567'),
		T_JBV('6604270','851567'),
		T_JBV('6604269','851567'),
		T_JBV('6604248','851585'),
		T_JBV('6604247','851585'),
		T_JBV('6604246','851585'),
		T_JBV('6604245','851585'),
		T_JBV('6604157','851571'),
		T_JBV('6604156','851571'),
		T_JBV('6604155','851571'),
		T_JBV('6604154','851571'),
		T_JBV('6604025','851563'),
		T_JBV('6604024','851563'),
		T_JBV('6604023','851563'),
		T_JBV('6604019','851563'),
		T_JBV('6604018','851563'),
		T_JBV('6604017','851563'),
		T_JBV('6579918','851595'),
		T_JBV('6549603','851585'),
		T_JBV('6539239','851594'),
		T_JBV('6537979','851576'),
		T_JBV('6537976','851598'),
		T_JBV('6537975','851593'),
		T_JBV('6537974','851593'),
		T_JBV('6537973','851593'),
		T_JBV('6537972','851593'),
		T_JBV('6537971','851593'),
		T_JBV('6537970','851593'),
		T_JBV('6537969','851593'),
		T_JBV('6537968','851593'),
		T_JBV('6537967','851593'),
		T_JBV('6537966','851593'),
		T_JBV('6537965','851593'),
		T_JBV('6537941','851566'),
		T_JBV('6537929','851593'),
		T_JBV('6537923','851584'),
		T_JBV('6537921','851565'),
		T_JBV('6537891','851599'),
		T_JBV('6459841','851579'),
		T_JBV('6459840','851579'),
		T_JBV('6459839','851579'),
		T_JBV('6439966','851596'),
		T_JBV('6307333','851575'),
		T_JBV('6307332','851575'),
		T_JBV('6234349','851597')
		); 
	V_TMP_JBV T_JBV; 
    
BEGIN	

	FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);

	GPV := TRIM(V_TMP_JBV(1));

	PRG := TRIM(V_TMP_JBV(2));

	V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR WHERE GPV_ID = '||GPV;
	
	EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS;
	
	IF V_NUM_FILAS = 1 THEN
	
		V_SQL := 'UPDATE '||V_ESQUEMA||'.'||V_TABLA||' SET 
	 				    FECHAMODIFICAR = SYSDATE  
					  , USUARIOMODIFICAR = '''||V_USUARIO||''' 
		 			  , PRG_ID = '||PRG||'  
					    WHERE GPV_ID = '||GPV
		 			  ;
	    	EXECUTE IMMEDIATE V_SQL;

	    	DBMS_OUTPUT.put_line('[INFO] Se ha actualizado '||SQL%ROWCOUNT||' registroS en la tabla '||V_TABLA);

	ELSE
	
		DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO NO EXISTE');
	
	END IF;

	END LOOP;

	DBMS_OUTPUT.PUT_LINE('[FIN] ');
	   
    COMMIT;

EXCEPTION
     WHEN OTHERS THEN
          err_num := SQLCODE;
          err_msg := SQLERRM;

          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(err_msg);

          ROLLBACK;
          RAISE;          

END;

/

EXIT
