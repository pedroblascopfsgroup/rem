--/*
--##########################################
--## AUTOR=VIOREL REMUS OVIDIU
--## FECHA_CREACION=20190813
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-5027
--## PRODUCTO=NO
--##
--## Finalidad: ACTUALIZAR ACTIVOS OCUPADO SI, CON TITULO NO
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
    V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_TABLA VARCHAR2(25 CHAR):= 'ACT_SPS_SIT_POSESORIA'; 
    V_COUNT NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USUARIO VARCHAR2(65 CHAR) := 'REMVIP-5027';    
    
BEGIN	
	
	V_SQL := 'UPDATE '||V_ESQUEMA||'.'||V_TABLA||' SET 
 				    FECHAMODIFICAR = SYSDATE 
				  , USUARIOMODIFICAR = '''||V_USUARIO||'''
	 			  , SPS_OCUPADO = 1  
				  , SPS_CON_TITULO = 0
				    WHERE ACT_ID IN (SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO IN (7032446,
7032500,
7032502,
7032503,
7032583,
7032584,
7032806,
7033418,
7034390,
7034393,
7034418,
7034425,
7034430,
7034437,
7034439,
7034459,
7034463,
7034466,
7034481,
7034507,
7034520,
7034533,
7034539,
7034540,
7034547,
7034556,
7034557,
7034559,
7034594,
7034608,
7034626,
7034641,
7034681,
7034700,
7034749,
7034764,
7034860,
7034869,
7034874,
7034882,
7034892,
7034938,
7034951,
7034960,
7034997,
7035000,
7035001,
7035022,
7035036,
7035048,
7035055,
7035068,
7035072,
7035077,
7035119,
7035149,
7035161,
7035185,
7035190,
7035191,
7035198,
7035223,
7035230,
7035242,
7035246,
7035281,
7035293,
7035357,
7035369,
7035381,
7035382,
7035390,
7035408,
7035415,
7035417,
7035421,
7035423,
7035428,
7035456,
7035460,
7035468,
7035491,
7035501,
7035512,
7035599,
7035621,
7035624,
7035628,
7035636,
7035665,
7035676,
7035720,
7035727,
7035777,
7035788,
7035797,
7035811,
7035897,
7035901,
7035903,
7035966,
7036002,
7036066,
7036105,
7036126,
7036192,
7036193,
7036253,
7036258,
7036321,
7036338,
7036347,
7036366,
7036415,
7036487,
7036488,
7036523,
7036527,
7036668,
7037519,
7037555,
7037568,
7037587,
7037605,
7037610,
7037619,
7037636,
7037652,
7037722,
7037748,
7037760,
7037771,
7037813,
7037816,
7037835,
7037878,
7037886,
7037957,
7037970,
7037986,
7038022,
7038024,
7038028,
7038055,
7038083,
7038085,
7038095,
7038156,
7038159,
7038178,
7038246,
7038314,
7038318,
7038346,
7038353,
7038354,
7038387,
7038455,
7038473,
7038505,
7038555,
7038561,
7038655,
7038731,
7038772,
7038778,
7038795,
7038850,
7038853,
7038873,
7038874,
7038911,
7038928,
7038971,
7038976,
7039243,
7039270,
7039271,
7039272,
7039299,
7039380,
7039504,
7039554,
7039596,
7039613,
7039744,
7039954,
7039956,
7040056,
7040061,
7040072,
7040085,
7040101,
7040295,
7040855,
7040857,
7040873,
7040915,
7041103,
7041150,
7041203,
7041241,
7041309,
7041338,
7041419,
7041434,
7041439,
7041449,
7041472,
7041633,
7041765,
7041849,
7041937,
7041965,
7042000,
7042002,
7042055,
7042143,
7042436,
7042480,
7042538,
7042614,
7042737,
7042847,
7042863,
7042897,
7042911,
7042917,
7042933,
7042947,
7042949,
7042951,
7043037,
7043041,
7043048,
7043071,
7043091,
7043098,
7043120,
7043121,
7043126,
7043129,
7043136,
7043166,
7043173,
7043178,
7043216,
7043228,
7043240,
7043242,
7043269,
7043349,
7043356,
7043357,
7043386,
7043395,
7043424,
7043426,
7043430,
7043432,
7043438,
7043458,
7043467,
7043469,
7043494,
7043506,
7043517,
7043528,
7043539,
7043542,
7043557,
7043560,
7043591,
7043624,
7043644,
7043652,
7043675,
7043677,
7043709,
7043716,
7043719,
7043721,
7043761,
7043767,
7043771,
7043774,
7043839,
7043849,
7043868,
7043888,
7043918,
7043928,
7043932,
7043941,
7043951,
7043956,
7043963,
7043964,
7043979,
7043989,
7043990,
7044025,
7044060,
7044088,
7044095,
7044101,
7044120,
7044138,
7044154,
7044160,
7044168,
7044176,
7044203,
7044205,
7044262,
7044269,
7044279,
7044292,
7044335,
7044350,
7044351,
7044358,
7044390,
7044398,
7044399,
7044428,
7044433,
7044439,
7044440,
7044447,
7044478,
7044496,
7044502,
7044522,
7044530,
7044531,
7044538,
7044552,
7044555,
7044577,
7044588,
7044594,
7044643,
7044650,
7044664,
7044679,
7044728,
7044756,
7044769,
7044770,
7044775,
7044776,
7044801,
7044810,
7044846,
7044847,
7044849,
7044874,
7044881,
7044899,
7044914,
7044924,
7044960,
7044982,
7045010,
7045036,
7045040,
7045050,
7045056,
7045062,
7045065,
7045075,
7045100,
7045120,
7045137,
7045156,
7045171,
7045190,
7045195,
7045291,
7045313,
7045327,
7045333,
7045348,
7045358,
7045362,
7045367,
7045371,
7045411,
7045414,
7045428,
7045438,
7045449,
7045450,
7045468,
7045487,
7045489,
7045514,
7045527,
7045536,
7045538,
7045545,
7045578,
7045611,
7045654,
7045670,
7045701,
7045709,
7045728,
7045729,
7045762,
7045810,
7045815,
7045834,
7045862,
7045863,
7045867,
7045911,
7045948,
7045956,
7045981,
7045985,
7045992,
7046029,
7046047,
7046050,
7046064,
7046065,
7046073,
7046102,
7046104,
7046106,
7046121,
7046129,
7046139,
7046206,
7046235,
7046239,
7046270,
7046273,
7046318,
7046325,
7046375,
7046376,
7046377,
7046392,
7046420,
7046451,
7046466,
7046475,
7046497,
7046500,
7046533,
7046571,
7046586,
7046602,
7046681,
7046744,
7046754,
7046758,
7046820,
7046841,
7046843,
7046871,
7046897,
7046941,
7046954,
7046955,
7046958,
7046961,
7047004,
7047086,
7047096,
7047188,
7047257,
7047279,
7047317,
7047337,
7047360,
7047422,
7047482,
7047499,
7047547,
7047596,
7047598,
7047599,
7047603,
7047605,
7047703,
7047705,
7047748,
7047753,
7047754,
7047762,
7047791,
7047812,
7047894,
7047895,
7047925,
7048087,
7048097,
7048178,
7048194,
7048233,
7048404,
7048467,
7048490,
7048496,
7048517,
7048520,
7048538,
7048542,
7048557,
7048571,
7048593,
7048598,
7048599,
7048612,
7048627,
7048643,
7048667,
7048680,
7048685,
7048690,
7048693,
7048758,
7048765,
7048777,
7048786,
7048811,
7048821,
7048829,
7048834,
7048836,
7048840,
7048842,
7048850,
7048867,
7048888,
7048894,
7048901,
7048909,
7048917,
7048955,
7048964,
7048966,
7048973,
7048976,
7048979,
7048994,
7048999,
7049011,
7049012,
7049016,
7049029,
7049061,
7049072,
7049095,
7049100,
7049106,
7049154,
7049186,
7049190,
7049201,
7049208,
7049213,
7049221,
7049239,
7049240,
7049243,
7049245,
7049270,
7049296,
7049302,
7049309,
7049320,
7049324,
7049326,
7049330,
7049348,
7049349,
7049363,
7049409,
7049417,
7049418,
7049429,
7049446,
7049468,
7049484,
7049490,
7049499,
7049521,
7049524,
7049525,
7049530,
7049531,
7049532,
7049533,
7049554,
7049560,
7049564,
7049565,
7049571,
7049585,
7049589,
7049607,
7049671,
7049675,
7049684,
7049705,
7049730,
7049731,
7049743,
7049744,
7049759,
7049761,
7049802,
7049812,
7049816,
7049817,
7049835,
7049843,
7049847,
7049866,
7049881,
7049908,
7049928,
7049947,
7049951,
7049969,
7050006,
7050016,
7050017,
7050019,
7050053,
7050101,
7050110,
7050125,
7050134,
7050228,
7050229,
7050235,
7050245,
7050247,
7050252,
7050270,
7050273,
7050282,
7050290,
7050299,
7050337,
7050338,
7050339,
7050352,
7050357,
7050379,
7050381,
7050384,
7050397,
7050408,
7050415,
7050421,
7050422,
7050444,
7050445,
7050449,
7050468,
7050471,
7050483,
7050486,
7050487,
7050496,
7050499,
7050502,
7050509,
7050522,
7050523,
7050524,
7050535,
7050544,
7050553,
7050554,
7050558,
7050591,
7050598,
7050611,
7050612,
7050618,
7050646,
7050647,
7050662,
7050663,
7050664,
7050668,
7050670,
7050685,
7050712,
7050714,
7050741,
7050752,
7050764,
7050780,
7050781,
7050812,
7050814,
7050823,
7050836,
7050848,
7050869,
7050884,
7050891,
7050894,
7050897,
7050900,
7050930,
7050937,
7050953,
7050957,
7050962,
7050967,
7050971,
7050992,
7051025,
7051028,
7051043,
7051063,
7051067,
7051102,
7051130,
7051136,
7051147,
7051171,
7051173,
7051183,
7051198,
7051205,
7051267,
7051273,
7051294,
7051315,
7051324,
7051337,
7051354,
7051361,
7051458,
7051474,
7051496,
7051505,
7051530,
7051539,
7051548,
7051575,
7051583,
7051649,
7051652,
7051678,
7051717,
7051719,
7051729,
7051759,
7051760,
7051806,
7051858,
7051864,
7051879,
7051903,
7051914,
7051940,
7051948,
7051950,
7051956,
7051959,
7051970,
7051978,
7051983,
7051986,
7051991,
7052002,
7052031,
7052059,
7052062,
7052160,
7052164,
7052179,
7053228,
7053283,
7053289,
7053290,
7053291,
7053444,
7053518,
7053716,
7053717,
7053718,
7053805,
7053806,
7053807,
7054616,
7054617,
7054651,
7055435,
7055730,
7057821,
7059589,
7061244))';

        EXECUTE IMMEDIATE V_SQL;

	DBMS_OUTPUT.put_line('[INFO] Se ha actualizado '||SQL%ROWCOUNT||' registro en la tabla '||V_TABLA);

   	COMMIT;
    	DBMS_OUTPUT.PUT_LINE('[FIN] ');


EXCEPTION
     WHEN OTHERS THEN
          err_num := SQLCODE;
          err_msg := SQLERRM;

          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(err_msg);

          ROLLBACK;
          RAISE;          

END;
/
EXIT;


