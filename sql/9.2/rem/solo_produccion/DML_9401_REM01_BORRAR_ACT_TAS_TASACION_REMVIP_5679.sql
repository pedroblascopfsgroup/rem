--/*
--##########################################
--## AUTOR=Oscar Diestre Pérez
--## FECHA_CREACION=20191106
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-5679
--## PRODUCTO=NO
--##
--## Finalidad: Actualizar estados de provisión según estado de los gastos
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USUARIOMODIFICAR VARCHAR2(25 CHAR):= 'REMVIP-5679'; -- Configuracion Esquema

BEGIN	        

    DBMS_OUTPUT.PUT_LINE('[INICIO] ');


    DBMS_OUTPUT.PUT_LINE('[INFO]: Borrar tasaciones incorrectas' );

                V_MSQL := ' 	

UPDATE '||V_ESQUEMA||'.ACT_TAS_TASACION
SET BORRADO = 1,
USUARIOBORRAR = '''||V_USUARIOMODIFICAR|| ''',
FECHABORRAR = SYSDATE
WHERE 1 = 1
AND TAS_ID_EXTERNO IN
(
687765300,
687767844,
687768270,
687761517,
687769182,
687756901,
687767961,
687755251,
687757075,
687757210,
687759754,
687757813,
687769065,
687765885,
687767727,
687595950,
687762294,
687763575,
687755134,
687755503,
687595833,
687757930,
687763107,
687762546,
687764856,
687595716,
687756883,
687760470,
687595698,
687768153,
687758725,
687756766,
687758608,
687758122,
687750673,
687757192,
687755368,
687765534,
687761868,
687764622,
687758959,
687762060,
687760002,
687763692,
687760722,
687757444,
687763827,
687762915,
687759988,
687762780,
687758842,
687760236,
687761400,
687757678,
687759403,
687759385,
687755971,
687755620,
687760353,
687758473,
687763224,
687768036,
687770150,
687764973,
687760119,
687759871,
687759034,
687760839,
687757327,
687762429,
687759520,
687763710,
687758239,
687759268,
687757561,
687762663,
687758005,
687758356,
687769668,
687769803,
687765048,
687759637,
687760956,
687763089,
687764739,
687766212,
687760605,
687759151,
687766194,
687769785,
687769200,
687761148,
687764487,
687756649,
687765165,
687766815,
687761985,
687750790,
687764505,
687765282,
687764136,
687750808,
687755854,
687751234,
687751351,
687758590,
687751585,
687769920,
687751720,
687761634,
687752515,
687756046,
687752749,
687753292,
687753544,
687754222,
687754573,
687754690,
687756415,
687754942,
687764019,
687766563,
687769434,
687762897,
687765417,
687766797,
687767124,
687764370,
687767592,
687763341,
687763944,
687768873,
687755485,
687751000,
687755737,
687751468,
687757795,
687765651,
687766077,
687751117,
687769551,
687766446,
687751837,
687752380,
687752146,
687752263,
687752029,
687751954,
687768756,
687750925,
687763458,
687762177,
687768405,
687768387,
687767475,
687751603,
687768639,
687761031,
687766329,
687752497,
687752632,
687756163,
687752866,
687752983,
687753058,
687753175,
687753310,
687756280,
687753427,
687753661,
687753778,
687753895,
687753913,
687756397,
687754087,
687754105,
687754339,
687754456,
687754708,
687756532,
687754825,
687761751,
687764253,
687767241,
687767358,
687767007,
687755017,
687766932,
687770033,
687767610,
687762312,
687768522,
687765768,
687761265,
687769317,
687765903,
687766680,
687760587,
687768990,
687761382,
687765048
)
			
		';

	EXECUTE IMMEDIATE V_MSQL;

        DBMS_OUTPUT.PUT_LINE('[INFO]: Borrados ' || SQL%ROWCOUNT || ' registros de ACT_TAS_TASACION ' );

--*******************************************************************************************************************************

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('[FIN]: PEF_PERFILES ACTUALIZADO CORRECTAMENTE ');


EXCEPTION
     WHEN OTHERS THEN
          err_num := SQLCODE;
          err_msg := SQLERRM;

          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(err_msg);

          ROLLBACK;
          RAISE;          

END;

/

EXIT
