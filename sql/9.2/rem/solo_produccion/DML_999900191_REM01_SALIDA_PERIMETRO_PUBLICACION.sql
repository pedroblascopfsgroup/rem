--/*
--##########################################
--## AUTOR=Pablo Meseguer
--## FECHA_CREACION=20171220
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=HREOS-3460
--## PRODUCTO=NO
--##
--## Finalidad: Sacar del perimetro de publicación los activos pasados mediante array
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    
    V_EJE_ANYO NUMBER(16);
	
    V_TEXT1 VARCHAR2(2400 CHAR); -- Vble. auxiliar
    V_ENTIDAD_ID NUMBER(16);
    V_ID NUMBER(16);
    
    TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
			--    ACT_NUM_ACTIVO
		T_TIPO_DATA('6077207'),
		T_TIPO_DATA('6078263'),
		T_TIPO_DATA('6039426'),
		T_TIPO_DATA('6346435'),
		T_TIPO_DATA('6346314'),
		T_TIPO_DATA('6081945'),
		T_TIPO_DATA('6077266'),
		T_TIPO_DATA('6136515'),
		T_TIPO_DATA('6788342'),
		T_TIPO_DATA('6781385'),
		T_TIPO_DATA('6037861'),
		T_TIPO_DATA('6081171'),
		T_TIPO_DATA('6710986'),
		T_TIPO_DATA('6823549'),
		T_TIPO_DATA('6133925'),
		T_TIPO_DATA('6075931'),
		T_TIPO_DATA('6077481'),
		T_TIPO_DATA('6843701'),
		T_TIPO_DATA('6136053'),
		T_TIPO_DATA('6083363'),
		T_TIPO_DATA('6084065'),
		T_TIPO_DATA('6135213'),
		T_TIPO_DATA('6135336'),
		T_TIPO_DATA('6037257'),
		T_TIPO_DATA('6033803'),
		T_TIPO_DATA('6780735'),
		T_TIPO_DATA('6036305'),
		T_TIPO_DATA('6520195'),
		T_TIPO_DATA('6135626'),
		T_TIPO_DATA('6030734'),
		T_TIPO_DATA('6082822'),
		T_TIPO_DATA('6077249'),
		T_TIPO_DATA('6520275'),
		T_TIPO_DATA('6346437'),
		T_TIPO_DATA('6041907'),
		T_TIPO_DATA('6040632'),
		T_TIPO_DATA('6077265'),
		T_TIPO_DATA('6029375'),
		T_TIPO_DATA('6811329'),
		T_TIPO_DATA('6811287'),
		T_TIPO_DATA('6521026'),
		T_TIPO_DATA('6711112'),
		T_TIPO_DATA('6527564'),
		T_TIPO_DATA('6036282'),
		T_TIPO_DATA('6042240'),
		T_TIPO_DATA('6038425'),
		T_TIPO_DATA('6135507'),
		T_TIPO_DATA('6037002'),
		T_TIPO_DATA('6029723'),
		T_TIPO_DATA('6033170'),
		T_TIPO_DATA('6036644'),
		T_TIPO_DATA('6781074'),
		T_TIPO_DATA('6780727'),
		T_TIPO_DATA('6136986'),
		T_TIPO_DATA('6710979'),
		T_TIPO_DATA('6032953'),
		T_TIPO_DATA('6076461'),
		T_TIPO_DATA('6036353'),
		T_TIPO_DATA('6711020'),
		T_TIPO_DATA('6082922'),
		T_TIPO_DATA('6082923'),
		T_TIPO_DATA('6032197'),
		T_TIPO_DATA('6043527'),
		T_TIPO_DATA('6029460'),
		T_TIPO_DATA('6076551'),
		T_TIPO_DATA('6037794'),
		T_TIPO_DATA('6520267'),
		T_TIPO_DATA('6823371'),
		T_TIPO_DATA('6032273'),
		T_TIPO_DATA('6082898'),
		T_TIPO_DATA('6781478'),
		T_TIPO_DATA('6082820'),
		T_TIPO_DATA('6036305'),
		T_TIPO_DATA('6135326'),
		T_TIPO_DATA('6077603'),
		T_TIPO_DATA('6520136'),
		T_TIPO_DATA('6031025'),
		T_TIPO_DATA('6135463'),
		T_TIPO_DATA('6028633'),
		T_TIPO_DATA('6823246'),
		T_TIPO_DATA('6745221'),
		T_TIPO_DATA('6527560'),
		T_TIPO_DATA('6782783'),
		T_TIPO_DATA('6080207'),
		T_TIPO_DATA('6780882'),
		T_TIPO_DATA('6711162'),
		T_TIPO_DATA('6811843'),
		T_TIPO_DATA('6823398'),
		T_TIPO_DATA('6823299'),
		T_TIPO_DATA('6032854'),
		T_TIPO_DATA('6030736'),
		T_TIPO_DATA('6043882'),
		T_TIPO_DATA('6823433'),
		T_TIPO_DATA('6823342'),
		T_TIPO_DATA('6800157'),
		T_TIPO_DATA('6527550'),
		T_TIPO_DATA('6520326'),
		T_TIPO_DATA('6520128'),
		T_TIPO_DATA('6823490'),
		T_TIPO_DATA('6030094'),
		T_TIPO_DATA('6042725'),
		T_TIPO_DATA('6035902'),
		T_TIPO_DATA('6076054'),
		T_TIPO_DATA('6034694'),
		T_TIPO_DATA('6028938'),
		T_TIPO_DATA('6133616'),
		T_TIPO_DATA('6078274'),
		T_TIPO_DATA('6083397'),
		T_TIPO_DATA('6083398'),
		T_TIPO_DATA('6785331'),
		T_TIPO_DATA('6042997'),
		T_TIPO_DATA('6136647'),
		T_TIPO_DATA('6711054'),
		T_TIPO_DATA('6694821'),
		T_TIPO_DATA('6780892'),
		T_TIPO_DATA('6076387'),
		T_TIPO_DATA('6076625'),
		T_TIPO_DATA('6079988'),
		T_TIPO_DATA('6082945'),
		T_TIPO_DATA('6043837'),
		T_TIPO_DATA('6136008'),
		T_TIPO_DATA('6827920'),
		T_TIPO_DATA('6033583'),
		T_TIPO_DATA('6042610'),
		T_TIPO_DATA('6038791'),
		T_TIPO_DATA('6043382'),
		T_TIPO_DATA('6081348'),
		T_TIPO_DATA('6780603'),
		T_TIPO_DATA('6780727'),
		T_TIPO_DATA('6028973'),
		T_TIPO_DATA('6134844'),
		T_TIPO_DATA('6080827'),
		T_TIPO_DATA('6078451'),
		T_TIPO_DATA('6780892'),
		T_TIPO_DATA('6780745'),
		T_TIPO_DATA('6043877'),
		T_TIPO_DATA('6077113'),
		T_TIPO_DATA('6136537'),
		T_TIPO_DATA('6078652'),
		T_TIPO_DATA('6078653'),
		T_TIPO_DATA('6343684'),
		T_TIPO_DATA('6811297'),
		T_TIPO_DATA('6811319'),
		T_TIPO_DATA('6823293'),
		T_TIPO_DATA('6823282'),
		T_TIPO_DATA('6078949'),
		T_TIPO_DATA('6029008'),
		T_TIPO_DATA('6042779'),
		T_TIPO_DATA('6036292'),
		T_TIPO_DATA('6798267'),
		T_TIPO_DATA('6078888'),
		T_TIPO_DATA('6079374'),
		T_TIPO_DATA('6043307'),
		T_TIPO_DATA('6033182'),
		T_TIPO_DATA('6042208'),
		T_TIPO_DATA('6043792'),
		T_TIPO_DATA('6801579'),
		T_TIPO_DATA('6029693'),
		T_TIPO_DATA('6043278'),
		T_TIPO_DATA('6043278'),
		T_TIPO_DATA('6043278'),
		T_TIPO_DATA('6082720'),
		T_TIPO_DATA('6036170'),
		T_TIPO_DATA('6078977'),
		T_TIPO_DATA('6035612'),
		T_TIPO_DATA('6035946'),
		T_TIPO_DATA('6030837'),
		T_TIPO_DATA('6128937'),
		T_TIPO_DATA('6128892'),
		T_TIPO_DATA('6785801'),
		T_TIPO_DATA('6785803'),
		T_TIPO_DATA('6811816'),
		T_TIPO_DATA('6811686'),
		T_TIPO_DATA('6781133'),
		T_TIPO_DATA('6077031'),
		T_TIPO_DATA('6781114'),
		T_TIPO_DATA('6036173'),
		T_TIPO_DATA('6135118'),
		T_TIPO_DATA('6819657'),
		T_TIPO_DATA('6747371'),
		T_TIPO_DATA('6747358'),
		T_TIPO_DATA('6747330'),
		T_TIPO_DATA('6747348'),
		T_TIPO_DATA('6747399'),
		T_TIPO_DATA('6747315'),
		T_TIPO_DATA('6747433'),
		T_TIPO_DATA('6747349'),
		T_TIPO_DATA('6747393'),
		T_TIPO_DATA('6747332'),
		T_TIPO_DATA('6077772'),
		T_TIPO_DATA('6042236'),
		T_TIPO_DATA('6134209'),
		T_TIPO_DATA('6076337'),
		T_TIPO_DATA('6040639'),
		T_TIPO_DATA('6080917'),
		T_TIPO_DATA('6080918'),
		T_TIPO_DATA('6036420'),
		T_TIPO_DATA('6078645'),
		T_TIPO_DATA('6041117'),
		T_TIPO_DATA('6076336'),
		T_TIPO_DATA('6134453'),
		T_TIPO_DATA('6076974'),
		T_TIPO_DATA('6077599'),
		T_TIPO_DATA('6077609'),
		T_TIPO_DATA('6077570'),
		T_TIPO_DATA('6077543'),
		T_TIPO_DATA('6077547'),
		T_TIPO_DATA('6077550'),
		T_TIPO_DATA('6036970'),
		T_TIPO_DATA('6077555'),
		T_TIPO_DATA('6077561'),
		T_TIPO_DATA('6077562'),
		T_TIPO_DATA('6134574'),
		T_TIPO_DATA('6077567'),
		T_TIPO_DATA('6711214'),
		T_TIPO_DATA('6711373'),
		T_TIPO_DATA('6711318'),
		T_TIPO_DATA('6711454'),
		T_TIPO_DATA('6710881'),
		T_TIPO_DATA('6711077'),
		T_TIPO_DATA('6711165'),
		T_TIPO_DATA('6711101'),
		T_TIPO_DATA('6711447'),
		T_TIPO_DATA('6711045'),
		T_TIPO_DATA('6711011'),
		T_TIPO_DATA('6711334'),
		T_TIPO_DATA('6711150'),
		T_TIPO_DATA('6711007'),
		T_TIPO_DATA('6711470'),
		T_TIPO_DATA('6711180'),
		T_TIPO_DATA('6711156'),
		T_TIPO_DATA('6711133'),
		T_TIPO_DATA('6710969'),
		T_TIPO_DATA('6710989'),
		T_TIPO_DATA('6710928'),
		T_TIPO_DATA('6711240'),
		T_TIPO_DATA('6711030'),
		T_TIPO_DATA('6711207'),
		T_TIPO_DATA('6711316'),
		T_TIPO_DATA('6818975'),
		T_TIPO_DATA('6037850'),
		T_TIPO_DATA('6078259'),
		T_TIPO_DATA('6078893'),
		T_TIPO_DATA('6076607'),
		T_TIPO_DATA('6800161'),
		T_TIPO_DATA('6800156'),
		T_TIPO_DATA('6800160'),
		T_TIPO_DATA('6036998'),
		T_TIPO_DATA('6033130'),
		T_TIPO_DATA('6136315'),
		T_TIPO_DATA('6811323'),
		T_TIPO_DATA('6811274'),
		T_TIPO_DATA('6711049'),
		T_TIPO_DATA('6711096'),
		T_TIPO_DATA('6711181'),
		T_TIPO_DATA('6083030'),
		T_TIPO_DATA('6083031'),
		T_TIPO_DATA('6083087'),
		T_TIPO_DATA('6083090'),
		T_TIPO_DATA('6083105'),
		T_TIPO_DATA('6083106'),
		T_TIPO_DATA('6083107'),
		T_TIPO_DATA('6083108'),
		T_TIPO_DATA('6083110'),
		T_TIPO_DATA('6083111'),
		T_TIPO_DATA('6083113'),
		T_TIPO_DATA('6083126'),
		T_TIPO_DATA('6083128'),
		T_TIPO_DATA('6083133'),
		T_TIPO_DATA('6083134'),
		T_TIPO_DATA('6839468'),
		T_TIPO_DATA('6079984'),
		T_TIPO_DATA('6035936'),
		T_TIPO_DATA('6035936'),
		T_TIPO_DATA('6136294'),
		T_TIPO_DATA('6520348'),
		T_TIPO_DATA('6083864'),
		T_TIPO_DATA('6076381'),
		T_TIPO_DATA('6082895'),
		T_TIPO_DATA('6082743'),
		T_TIPO_DATA('6029843'),
		T_TIPO_DATA('6837005'),
		T_TIPO_DATA('6836961'),
		T_TIPO_DATA('6082901'),
		T_TIPO_DATA('6082869'),
		T_TIPO_DATA('6082870'),
		T_TIPO_DATA('6811588'),
		T_TIPO_DATA('6811587'),
		T_TIPO_DATA('6038276'),
		T_TIPO_DATA('6041973'),
		T_TIPO_DATA('6030425'),
		T_TIPO_DATA('6831183'),
		T_TIPO_DATA('6082846'),
		T_TIPO_DATA('6521042'),
		T_TIPO_DATA('6080158'),
		T_TIPO_DATA('6080176'),
		T_TIPO_DATA('6811345'),
		T_TIPO_DATA('6811332'),
		T_TIPO_DATA('6811284'),
		T_TIPO_DATA('6811282'),
		T_TIPO_DATA('6811333'),
		T_TIPO_DATA('6811286'),
		T_TIPO_DATA('6036723'),
		T_TIPO_DATA('6346356'),
		T_TIPO_DATA('6033662'),
		T_TIPO_DATA('6043089'),
		T_TIPO_DATA('6136583'),
		T_TIPO_DATA('6036589'),
		T_TIPO_DATA('6043275'),
		T_TIPO_DATA('6082789'),
		T_TIPO_DATA('6080452'),
		T_TIPO_DATA('6038405'),
		T_TIPO_DATA('6754655'),
		T_TIPO_DATA('6038721'),
		T_TIPO_DATA('6711165'),
		T_TIPO_DATA('6078013'),
		
		T_TIPO_DATA('6756568'),
		T_TIPO_DATA('6029225'),
		T_TIPO_DATA('6133673'),
		T_TIPO_DATA('6040389'),
		T_TIPO_DATA('6038154'),
		T_TIPO_DATA('6032787'),
		T_TIPO_DATA('6078243'),
		T_TIPO_DATA('6036980'),
		T_TIPO_DATA('6042180'),
		T_TIPO_DATA('6029758'),
		T_TIPO_DATA('6134561'),
		T_TIPO_DATA('6811312'),
		T_TIPO_DATA('6811295'),
		T_TIPO_DATA('6082654'),
		T_TIPO_DATA('6035707'),
		T_TIPO_DATA('6037378'),
		T_TIPO_DATA('6040471'),
		T_TIPO_DATA('6082711'),
		T_TIPO_DATA('6084499'),
		T_TIPO_DATA('6082721'),
		T_TIPO_DATA('6083678'),
		T_TIPO_DATA('6083675'),
		T_TIPO_DATA('6083676'),
		T_TIPO_DATA('6083842'),
		T_TIPO_DATA('6083843'),
		T_TIPO_DATA('6785802'),
		T_TIPO_DATA('6785810'),
		T_TIPO_DATA('6135089'),
		T_TIPO_DATA('6043916'),
		T_TIPO_DATA('6759063'),
		T_TIPO_DATA('6759082'),
		T_TIPO_DATA('6759071'),
		T_TIPO_DATA('6759068'),
		T_TIPO_DATA('6759067'),
		T_TIPO_DATA('6759074'),
		T_TIPO_DATA('6759064'),
		T_TIPO_DATA('6759066'),
		T_TIPO_DATA('6759081'),
		T_TIPO_DATA('6759069'),
		T_TIPO_DATA('6759073'),
		T_TIPO_DATA('6759078'),
		T_TIPO_DATA('6041607'),
		T_TIPO_DATA('6038422'),
		T_TIPO_DATA('6079444'),
		T_TIPO_DATA('6780888'),
		T_TIPO_DATA('6082471'),
		T_TIPO_DATA('6786825'),
		T_TIPO_DATA('6082960'),
		T_TIPO_DATA('6346238'),
		T_TIPO_DATA('6041623'),
		T_TIPO_DATA('6038374'),
		T_TIPO_DATA('6029748'),
		T_TIPO_DATA('6037832'),
		T_TIPO_DATA('6711314'),
		T_TIPO_DATA('6711099'),
		T_TIPO_DATA('6831658'),
		T_TIPO_DATA('6036198'),
		T_TIPO_DATA('6761287'),
		T_TIPO_DATA('6041721'),
		T_TIPO_DATA('6037087'),
		T_TIPO_DATA('6041720'),
		T_TIPO_DATA('6080019'),
		T_TIPO_DATA('6076059'),
		T_TIPO_DATA('6806606'),
		T_TIPO_DATA('6078501'),
		T_TIPO_DATA('6037324'),
		T_TIPO_DATA('6079879'),
		T_TIPO_DATA('6079370'),
		T_TIPO_DATA('6042785'),
		T_TIPO_DATA('6080747'),
		T_TIPO_DATA('6043803'),
		T_TIPO_DATA('6711216'),
		T_TIPO_DATA('6082768'),
		T_TIPO_DATA('6346385'),
		T_TIPO_DATA('6029374'),
		T_TIPO_DATA('6032732'),
		T_TIPO_DATA('6041799'),
		T_TIPO_DATA('6029373'),
		T_TIPO_DATA('6041811'),
		T_TIPO_DATA('6346159'),
		T_TIPO_DATA('6078086'),
		T_TIPO_DATA('6711505'),
		T_TIPO_DATA('6082619'),
		T_TIPO_DATA('6133935'),
		T_TIPO_DATA('6076921'),
		T_TIPO_DATA('6134459'),
		T_TIPO_DATA('6043970'),
		T_TIPO_DATA('6037495'),
		T_TIPO_DATA('6077047'),
		T_TIPO_DATA('6135692'),
		T_TIPO_DATA('6823515'),
		T_TIPO_DATA('6823383'),
		T_TIPO_DATA('6082897'),
		T_TIPO_DATA('6038166'),
		T_TIPO_DATA('6080205'),
		T_TIPO_DATA('6134284'),
		T_TIPO_DATA('6076143'),
		T_TIPO_DATA('6529775'),
		T_TIPO_DATA('6040966'),
		T_TIPO_DATA('6134484'),
		T_TIPO_DATA('6032202'),
		T_TIPO_DATA('6128936'),
		T_TIPO_DATA('6128884'),
		T_TIPO_DATA('6128926'),
		T_TIPO_DATA('6042724'),
		T_TIPO_DATA('6029115'),
		T_TIPO_DATA('6037548'),
		T_TIPO_DATA('6788648'),
		T_TIPO_DATA('6037459'),
		T_TIPO_DATA('6079367'),
		T_TIPO_DATA('6030189'),
		T_TIPO_DATA('6040661'),
		T_TIPO_DATA('6035931'),
		T_TIPO_DATA('6136756'),
		T_TIPO_DATA('6136815'),
		T_TIPO_DATA('6075868'),
		T_TIPO_DATA('6833278'),
		T_TIPO_DATA('6036983'),
		T_TIPO_DATA('6029732'),
		T_TIPO_DATA('6038415'),
		T_TIPO_DATA('6745254'),
		T_TIPO_DATA('6745242'),
		T_TIPO_DATA('6033576'),
		T_TIPO_DATA('6030140'),
		T_TIPO_DATA('6033569'),
		T_TIPO_DATA('6135623'),
		T_TIPO_DATA('6040394'),
		T_TIPO_DATA('6032189'),
		T_TIPO_DATA('6028579'),
		T_TIPO_DATA('6038057'),
		T_TIPO_DATA('6082908'),
		T_TIPO_DATA('6823620'),
		T_TIPO_DATA('6033718'),
		T_TIPO_DATA('6811322'),
		T_TIPO_DATA('6041310'),
		T_TIPO_DATA('6082467'),
		T_TIPO_DATA('6082532'),
		T_TIPO_DATA('6811306'),
		T_TIPO_DATA('6811294'),
		T_TIPO_DATA('6811301'),
		T_TIPO_DATA('6811278'),
		T_TIPO_DATA('6811276'),
		T_TIPO_DATA('6811330'),
		T_TIPO_DATA('6837017'),
		T_TIPO_DATA('6078267'),
		T_TIPO_DATA('6081855'),
		T_TIPO_DATA('6037046'),
		T_TIPO_DATA('6346369'),
		T_TIPO_DATA('6346480'),
		T_TIPO_DATA('6039426'),
		T_TIPO_DATA('6030664'),
		T_TIPO_DATA('6133807'),
		T_TIPO_DATA('6032840'),
		T_TIPO_DATA('6082618'),
		T_TIPO_DATA('6725296'),
		T_TIPO_DATA('6029174'),
		T_TIPO_DATA('6029770'),
		T_TIPO_DATA('6346362'),
		T_TIPO_DATA('6346301'),
		T_TIPO_DATA('6076392'),
		T_TIPO_DATA('6078048'),
		T_TIPO_DATA('6745083'),
		T_TIPO_DATA('6043966'),
		T_TIPO_DATA('6082589'),
		T_TIPO_DATA('6078888'),
		T_TIPO_DATA('6520166'),
		T_TIPO_DATA('6083576'),
		T_TIPO_DATA('6084072'),
		T_TIPO_DATA('6079617'),
		T_TIPO_DATA('6076749'),
		T_TIPO_DATA('6080882'),
		T_TIPO_DATA('6082503'),
		T_TIPO_DATA('6346241'),
		T_TIPO_DATA('6346176'),
		T_TIPO_DATA('6030274'),
		T_TIPO_DATA('6028632'),
		T_TIPO_DATA('6083884'),
		T_TIPO_DATA('6083885'),
		T_TIPO_DATA('6844251'),
		T_TIPO_DATA('6076137'),
		T_TIPO_DATA('6136629'),
		T_TIPO_DATA('6081259'),
		T_TIPO_DATA('6711124'),
		T_TIPO_DATA('6033545'),
		T_TIPO_DATA('6082818'),
		T_TIPO_DATA('6780644'),
		T_TIPO_DATA('6811304'),
		T_TIPO_DATA('6811348'),
		T_TIPO_DATA('6033328'),
		T_TIPO_DATA('6082816'),
		T_TIPO_DATA('6786920'),
		T_TIPO_DATA('6030971'),
		T_TIPO_DATA('6135373'),
		T_TIPO_DATA('6036266'),
		T_TIPO_DATA('6036447'),
		T_TIPO_DATA('6035891'),
		T_TIPO_DATA('6081678'),
		T_TIPO_DATA('6081679'),
		T_TIPO_DATA('6043392'),
		T_TIPO_DATA('6031620'),
		T_TIPO_DATA('6035311'),
		T_TIPO_DATA('6041654'),
		T_TIPO_DATA('6081977'),
		T_TIPO_DATA('6032311'),
		T_TIPO_DATA('6082729'),
		T_TIPO_DATA('6780852'),
		T_TIPO_DATA('6781100'),
		T_TIPO_DATA('6030018'),
		T_TIPO_DATA('6135651'),
		T_TIPO_DATA('6076383'),
		T_TIPO_DATA('6136554'),
		T_TIPO_DATA('6082821'),
		T_TIPO_DATA('6781143'),
		T_TIPO_DATA('6038814'),
		T_TIPO_DATA('6029509'),
		T_TIPO_DATA('6082790'),
		T_TIPO_DATA('6078005'),
		T_TIPO_DATA('6033443'),
		T_TIPO_DATA('6136657'),
		T_TIPO_DATA('6082815'),
		T_TIPO_DATA('6039653'),
		T_TIPO_DATA('6035089'),
		T_TIPO_DATA('6037147'),
		T_TIPO_DATA('6788137'),
		T_TIPO_DATA('6031639'),
		T_TIPO_DATA('6042572'),
		T_TIPO_DATA('6041823'),
		T_TIPO_DATA('6038756'),
		T_TIPO_DATA('6835433'),
		T_TIPO_DATA('6520293'),
		T_TIPO_DATA('6042364'),
		T_TIPO_DATA('6815727'),
		T_TIPO_DATA('6134592'),
		T_TIPO_DATA('6819656'),
		T_TIPO_DATA('6043196'),
		T_TIPO_DATA('6079440'),
		T_TIPO_DATA('6029779'),
		T_TIPO_DATA('6806572'),
		T_TIPO_DATA('6806598'),
		T_TIPO_DATA('6806554'),
		T_TIPO_DATA('6037737'),
		T_TIPO_DATA('6136912'),
		T_TIPO_DATA('6346273'),
		T_TIPO_DATA('6077848'),
		T_TIPO_DATA('6077840'),
		T_TIPO_DATA('6787681'),
		T_TIPO_DATA('6354904'),
		T_TIPO_DATA('6039723'),
		T_TIPO_DATA('6835275'),
		T_TIPO_DATA('6037740'),
		T_TIPO_DATA('6083677'),
		T_TIPO_DATA('6083840'),
		T_TIPO_DATA('6823316'),
		T_TIPO_DATA('6785788'),
		T_TIPO_DATA('6785768'),
		T_TIPO_DATA('6083330'),
		T_TIPO_DATA('6133865'),
		T_TIPO_DATA('6520175'),
		T_TIPO_DATA('6823296'),
		T_TIPO_DATA('6823354'),
		T_TIPO_DATA('6077387'),
		T_TIPO_DATA('6785757'),
		T_TIPO_DATA('6785821'),
		T_TIPO_DATA('6785770'),
		T_TIPO_DATA('6811646'),
		T_TIPO_DATA('6811752'),
		T_TIPO_DATA('6082814'),
		T_TIPO_DATA('6081517'),
		T_TIPO_DATA('6043454'),
		T_TIPO_DATA('6084737'),
		T_TIPO_DATA('6083323'),
		T_TIPO_DATA('6037521'),
		T_TIPO_DATA('6043549'),
		T_TIPO_DATA('6043552'),
		T_TIPO_DATA('6041886'),
		T_TIPO_DATA('6082412'),
		T_TIPO_DATA('6030377'),
		T_TIPO_DATA('6030797'),
		T_TIPO_DATA('6786874'),
		T_TIPO_DATA('6082538'),
		T_TIPO_DATA('6527561'),
		T_TIPO_DATA('6029866'),
		T_TIPO_DATA('6136370'),
		T_TIPO_DATA('6134141'),
		T_TIPO_DATA('6135457'),
		T_TIPO_DATA('6135412'),
		T_TIPO_DATA('6135201'),
		T_TIPO_DATA('6136645'),
		T_TIPO_DATA('6135755'),
		T_TIPO_DATA('6135832'),
		T_TIPO_DATA('6042856'),
		T_TIPO_DATA('6076933'),
		T_TIPO_DATA('6040794'),
		T_TIPO_DATA('6039162'),
		T_TIPO_DATA('6744953'),
		T_TIPO_DATA('6031816'),
		T_TIPO_DATA('6076531'),
		T_TIPO_DATA('6076530'),
		T_TIPO_DATA('6521036'),
		T_TIPO_DATA('6711352'),
		T_TIPO_DATA('6521021'),
		T_TIPO_DATA('6036982'),
		T_TIPO_DATA('6038480'),
		T_TIPO_DATA('6081080'),
		T_TIPO_DATA('6747408'),
		T_TIPO_DATA('6029251'),
		T_TIPO_DATA('6041987'),
		T_TIPO_DATA('6043648'),
		T_TIPO_DATA('6035817'),
		T_TIPO_DATA('6082769'),
		T_TIPO_DATA('6075973'),
		T_TIPO_DATA('6082670'),
		T_TIPO_DATA('6032659'),
		T_TIPO_DATA('6038073'),
		T_TIPO_DATA('6135455'),
		T_TIPO_DATA('6038943'),
		T_TIPO_DATA('6082917'),
		T_TIPO_DATA('6814868'),
		T_TIPO_DATA('6036264'),
		T_TIPO_DATA('6030998'),
		T_TIPO_DATA('6032676'),
		T_TIPO_DATA('6041714'),
		T_TIPO_DATA('6811280'),
		T_TIPO_DATA('6811283'),
		T_TIPO_DATA('6815754'),
		T_TIPO_DATA('6079774'),
		T_TIPO_DATA('6079775'),
		T_TIPO_DATA('6079776'),
		T_TIPO_DATA('6079777'),
		T_TIPO_DATA('6079781'),
		T_TIPO_DATA('6079782'),
		T_TIPO_DATA('6079783'),
		T_TIPO_DATA('6079784'),
		T_TIPO_DATA('6521018'),
		T_TIPO_DATA('6043760'),
		T_TIPO_DATA('6135870')
		); 
    V_TMP_TIPO_DATA T_TIPO_DATA;
    
BEGIN	
	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ');
	 
		
		DBMS_OUTPUT.PUT_LINE('[INFO]: COMIENZA EL PROCESO DE DESPUBLICACIÓN DE LOS ACTIVOS VENDIDOS DE CAJAMAR');
		FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
		LOOP
      
			V_TMP_TIPO_DATA := V_TIPO_DATA(I);
				
				DBMS_OUTPUT.PUT_LINE('[INFO]: SE INICIA LA DESPUBLICACIÓN DEL ACTIVO '''|| TRIM(V_TMP_TIPO_DATA(1)) ||'''...');
				
				--Comprobamos si el activo a despublicar existe
				V_SQL := 'SELECT COUNT(1)  
						FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT
						WHERE ACT.ACT_NUM_ACTIVO = '''|| TRIM(V_TMP_TIPO_DATA(1)) ||'''
						';
				EXECUTE IMMEDIATE V_SQL INTO V_NUM_TABLAS;
			
				--Si existe iniciamos la despublicación
				IF V_NUM_TABLAS = 1 THEN				
				
				--Sacamos del perímetro de comercialización.
				V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_PAC_PERIMETRO_ACTIVO PAC SET
							PAC.PAC_CHECK_COMERCIALIZAR = 0, 
							PAC.PAC_FECHA_COMERCIALIZAR = SYSDATE, 
							PAC.PAC_MOT_EXCL_COMERCIALIZAR = ''Salida de perímetro por petición'',
							PAC.FECHAMODIFICAR = SYSDATE, 
							PAC.USUARIOMODIFICAR = ''HREOS-3460''
							WHERE PAC.ACT_ID = (SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT WHERE ACT.ACT_NUM_ACTIVO = '''|| TRIM(V_TMP_TIPO_DATA(1)) ||''')';
				EXECUTE IMMEDIATE V_MSQL;
				DBMS_OUTPUT.PUT_LINE('[INFO]: '||sql%rowcount||' ACTIVO SE HA SACADO DEL PERIMETRO DE COMERCIALIZACIÓN.');
			  
				--Cambiamos estado de publicación a No publicado
				V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_ACTIVO ACT SET
							ACT.DD_EPU_ID = (SELECT EPU.DD_EPU_ID FROM '||V_ESQUEMA||'.DD_EPU_ESTADO_PUBLICACION EPU WHERE EPU.DD_EPU_CODIGO = ''06''), 
							ACT.ACT_FECHA_IND_PUBLICABLE = SYSDATE, 
							ACT.USUARIOMODIFICAR = ''HREOS-3460'', 
							ACT.FECHAMODIFICAR = SYSDATE
							WHERE ACT.DD_EPU_ID <> (SELECT EPU.DD_EPU_ID FROM '||V_ESQUEMA||'.DD_EPU_ESTADO_PUBLICACION EPU WHERE EPU.DD_EPU_CODIGO = ''06'')
							AND ACT.ACT_NUM_ACTIVO = '''|| TRIM(V_TMP_TIPO_DATA(1)) ||'''';
				EXECUTE IMMEDIATE V_MSQL;
				DBMS_OUTPUT.PUT_LINE('[INFO]: '||sql%rowcount||' ACTIVO SE HA CAMBIADO SU ESTADO DE PUBLICACIÓN.');
				
				--Rellenar fila actual del histórico de publicaciones.
				V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_HEP_HIST_EST_PUBLICACION HEP SET
							HEP.HEP_FECHA_HASTA = SYSDATE, 
							HEP.USUARIOMODIFICAR = ''HREOS-3460'', 
							HEP.FECHAMODIFICAR = SYSDATE
							WHERE HEP.HEP_FECHA_HASTA IS NULL
							AND HEP.DD_EPU_ID <> (SELECT EPU.DD_EPU_ID FROM '||V_ESQUEMA||'.DD_EPU_ESTADO_PUBLICACION EPU WHERE EPU.DD_EPU_CODIGO = ''06'')
							AND HEP.ACT_ID = (SELECT ACT.ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT WHERE ACT.ACT_NUM_ACTIVO = '''|| TRIM(V_TMP_TIPO_DATA(1)) ||''')';
				EXECUTE IMMEDIATE V_MSQL;
				DBMS_OUTPUT.PUT_LINE('[INFO]: SE HA ACTUALIZADO EL ESTADO DE '||sql%rowcount||' ACTIVO EN EL HISTORICO DE PUBLICACIONES (CADUCADO).');
				
				--Rellenar fila nueva del histórico de publicaciones.
				V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.ACT_HEP_HIST_EST_PUBLICACION
							(HEP_ID, ACT_ID, HEP_FECHA_DESDE, DD_POR_ID, DD_TPU_ID
							, DD_EPU_ID, HEP_MOTIVO, VERSION, USUARIOCREAR, FECHACREAR, BORRADO)
							SELECT '||V_ESQUEMA||'.S_ACT_HEP_HIST_EST_PUBLICACION.NEXTVAL, 
							ACT.ACT_ID, 
							SYSDATE, 
							NULL, 
							NULL, 
							EPU.DD_EPU_ID, 
							''Salida de perímetro por petición'', 
							0, 
							''HREOS-3460'', 
							SYSDATE, 
							0
							FROM '||V_ESQUEMA||'.ACT_ACTIVO ACT
							JOIN '||V_ESQUEMA||'.DD_EPU_ESTADO_PUBLICACION EPU ON EPU.DD_EPU_ID = ''06''
							WHERE ACT.ACT_NUM_ACTIVO = '''|| TRIM(V_TMP_TIPO_DATA(1)) ||''' 
							AND NOT EXISTS (SELECT 1 FROM '||V_ESQUEMA||'.ACT_HEP_HIST_EST_PUBLICACION AUX WHERE AUX.ACT_ID = ACT.ACT_ID AND AUX.HEP_FECHA_HASTA IS NULL AND AUX.DD_EPU_ID = EPU.DD_EPU_ID)';
				EXECUTE IMMEDIATE V_MSQL;
				DBMS_OUTPUT.PUT_LINE('[INFO]: SE HA INSERTADO EL ESTADO DE '||sql%rowcount||' ACTIVO EN EL HISTORICO DE PUBLICACIONES (NUEVO DESPUBLICADO).');
				
				--Actualizar situación comercial ACT_ACTIVO.DD_SCM_ID a 1.
				V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_ACTIVO ACT SET
							ACT.DD_SCM_ID = (SELECT DD_SCM_ID FROM '||V_ESQUEMA||'.DD_SCM_SITUACION_COMERCIAL WHERE DD_SCM_CODIGO = ''05''), 
							ACT.ACT_FECHA_IND_PUBLICABLE = SYSDATE, 
							ACT.USUARIOMODIFICAR = ''HREOS-3460'', 
							ACT.FECHAMODIFICAR = SYSDATE
							WHERE ACT.ACT_NUM_ACTIVO = '''|| TRIM(V_TMP_TIPO_DATA(1)) ||'''';
				EXECUTE IMMEDIATE V_MSQL;
				DBMS_OUTPUT.PUT_LINE('[INFO]: '||sql%rowcount||' ACTIVO SE HA ACTUALIZADO SU SITUACIÓN COMERCIAL.');
				
				--Si existe, no hacemos nada   
				ELSE
					DBMS_OUTPUT.PUT_LINE('[INFO]: EL ACTIVO '''|| TRIM(V_TMP_TIPO_DATA(1)) ||''' NO EXISTE');        
				END IF;			
      END LOOP;
    
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('[FIN]: PARTIDAS PRESUPUESTARIAS ACTUALIZADAS CORRECTAMENTE.');   

EXCEPTION
     WHEN OTHERS THEN
          err_num := SQLCODE;
          err_msg := SQLERRM;

          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(err_msg);

          ROLLBACK;
          RAISE;          

END;

/

EXIT
