--/*
--#########################################
--## AUTOR=JINLI HU
--## FECHA_CREACION=20181011
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-1991
--## PRODUCTO=NO
--## 
--## Finalidad: 
--##            
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/
--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
    V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar         
    V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; --'#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; --'#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_TABLA VARCHAR2(25 CHAR):= 'ACT_SPS_SIT_POSESORIA';
    V_COUNT NUMBER(16); -- Vble. para contar.
    V_KOUNT NUMBER(16); -- Vble. para kontar.
    V_COUNT_UPDATE NUMBER(16):= 0; -- Vble. para contar updates
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USUARIO VARCHAR2(32 CHAR):= 'REMVIP-1991';

	ACT_NUM_ACTIVO NUMBER(16);
	ACT_ID VARCHAR2(55 CHAR);

    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
		T_JBV(7002349),
		T_JBV(7001961),
		T_JBV(7001825),
		T_JBV(6980935),
		T_JBV(7001746),
		T_JBV(7001667),
		T_JBV(7001419),
		T_JBV(7001401),
		T_JBV(7001244),
		T_JBV(7001115),
		T_JBV(6981944),
		T_JBV(6981985),
		T_JBV(6982233),
		T_JBV(7000993),
		T_JBV(6999005),
		T_JBV(6983301),
		T_JBV(6998995),
		T_JBV(6998904),
		T_JBV(6998881),
		T_JBV(6998290),
		T_JBV(6997491),
		T_JBV(6997353),
		T_JBV(6997156),
		T_JBV(6983824),
		T_JBV(6983825),
		T_JBV(6996421),
		T_JBV(6996044),
		T_JBV(6996008),
		T_JBV(6995936),
		T_JBV(6995924),
		T_JBV(6984790),
		T_JBV(6995718),
		T_JBV(6995512),
		T_JBV(6995507),
		T_JBV(6984968),
		T_JBV(6995338),
		T_JBV(6985154),
		T_JBV(6994831),
		T_JBV(6985420),
		T_JBV(6994708),
		T_JBV(6993931),
		T_JBV(6993872),
		T_JBV(6993688),
		T_JBV(6993211),
		T_JBV(6993115),
		T_JBV(6992795),
		T_JBV(6992491),
		T_JBV(6992109),
		T_JBV(6992001),
		T_JBV(6991704),
		T_JBV(6991235),
		T_JBV(6991082),
		T_JBV(6990951),
		T_JBV(6987630),
		T_JBV(6990943),
		T_JBV(6990904),
		T_JBV(6990468),
		T_JBV(6990405),
		T_JBV(6990208),
		T_JBV(6990201),
		T_JBV(6990178),
		T_JBV(6990133),
		T_JBV(6990095),
		T_JBV(6990066),
		T_JBV(6990012),
		T_JBV(6989281),
		T_JBV(6988297),
		T_JBV(6988298),
		T_JBV(6989217),
		T_JBV(6988383),
		T_JBV(6989181),
		T_JBV(6989066),
		T_JBV(6988516),
		T_JBV(6988974),
		T_JBV(6988867),
		T_JBV(6988712),
		T_JBV(6988865),
		T_JBV(6988836),
		T_JBV(6988835),
		T_JBV(6988833),
		T_JBV(5925037),
		T_JBV(5925086),
		T_JBV(5925210),
		T_JBV(5925253),
		T_JBV(5925347),
		T_JBV(5925390),
		T_JBV(5925592),
		T_JBV(5926567),
		T_JBV(5926824),
		T_JBV(5927329),
		T_JBV(5927413),
		T_JBV(5928032),
		T_JBV(5928090),
		T_JBV(5928775),
		T_JBV(5929868),
		T_JBV(5929973),
		T_JBV(5929990),
		T_JBV(5930930),
		T_JBV(5931522),
		T_JBV(5931679),
		T_JBV(5931741),
		T_JBV(5932340),
		T_JBV(5932419),
		T_JBV(5932450),
		T_JBV(5933105),
		T_JBV(5933248),
		T_JBV(5934203),
		T_JBV(5934453),
		T_JBV(5934511),
		T_JBV(5934706),
		T_JBV(5935079),
		T_JBV(5935306),
		T_JBV(5935433),
		T_JBV(5935537),
		T_JBV(5935810),
		T_JBV(5935877),
		T_JBV(5935901),
		T_JBV(5936029),
		T_JBV(5936355),
		T_JBV(5936655),
		T_JBV(5936686),
		T_JBV(5936971),
		T_JBV(5936982),
		T_JBV(5937111),
		T_JBV(5937176),
		T_JBV(5937464),
		T_JBV(5937725),
		T_JBV(5938166),
		T_JBV(5938205),
		T_JBV(5938338),
		T_JBV(5938679),
		T_JBV(5938975),
		T_JBV(5939270),
		T_JBV(5939472),
		T_JBV(5939717),
		T_JBV(5939807),
		T_JBV(5939867),
		T_JBV(5940037),
		T_JBV(5940058),
		T_JBV(5940101),
		T_JBV(5940287),
		T_JBV(5941263),
		T_JBV(5941401),
		T_JBV(5941545),
		T_JBV(5941565),
		T_JBV(5941869),
		T_JBV(5942300),
		T_JBV(5942381),
		T_JBV(5942466),
		T_JBV(5942532),
		T_JBV(5942794),
		T_JBV(5942989),
		T_JBV(5943098),
		T_JBV(5943462),
		T_JBV(5943756),
		T_JBV(5943848),
		T_JBV(5943960),
		T_JBV(5944177),
		T_JBV(5944416),
		T_JBV(5944421),
		T_JBV(5944540),
		T_JBV(5944634),
		T_JBV(5945236),
		T_JBV(5946462),
		T_JBV(5946497),
		T_JBV(5946517),
		T_JBV(5946556),
		T_JBV(5947102),
		T_JBV(5947805),
		T_JBV(5947909),
		T_JBV(5948370),
		T_JBV(5948573),
		T_JBV(5948599),
		T_JBV(5948767),
		T_JBV(5949065),
		T_JBV(5949440),
		T_JBV(5949993),
		T_JBV(5950031),
		T_JBV(5950104),
		T_JBV(5950221),
		T_JBV(5950494),
		T_JBV(5950929),
		T_JBV(5950944),
		T_JBV(5951684),
		T_JBV(5952084),
		T_JBV(5952150),
		T_JBV(5952480),
		T_JBV(5953069),
		T_JBV(5953481),
		T_JBV(5953897),
		T_JBV(5954042),
		T_JBV(5954510),
		T_JBV(5954563),
		T_JBV(5955929),
		T_JBV(5956307),
		T_JBV(5957292),
		T_JBV(5957929),
		T_JBV(5958547),
		T_JBV(5958844),
		T_JBV(5958918),
		T_JBV(5959190),
		T_JBV(5959242),
		T_JBV(5959385),
		T_JBV(5959671),
		T_JBV(5959781),
		T_JBV(5959990),
		T_JBV(5960879),
		T_JBV(5961004),
		T_JBV(5961319),
		T_JBV(5961818),
		T_JBV(5961907),
		T_JBV(5961951),
		T_JBV(5961975),
		T_JBV(5962200),
		T_JBV(5962222),
		T_JBV(5962357),
		T_JBV(5962812),
		T_JBV(5962857),
		T_JBV(5962998),
		T_JBV(5963952),
		T_JBV(5964015),
		T_JBV(5964426),
		T_JBV(5964521),
		T_JBV(5964572),
		T_JBV(5964835),
		T_JBV(5964941),
		T_JBV(5965064),
		T_JBV(5965287),
		T_JBV(5965298),
		T_JBV(5965558),
		T_JBV(5965577),
		T_JBV(5966067),
		T_JBV(5966481),
		T_JBV(5966862),
		T_JBV(5966963),
		T_JBV(5967328),
		T_JBV(5967334),
		T_JBV(5968085),
		T_JBV(5968138),
		T_JBV(5968702),
		T_JBV(5968960),
		T_JBV(5969217),
		T_JBV(5969245),
		T_JBV(5969284),
		T_JBV(5969519),
		T_JBV(5969985),
		T_JBV(5970238),
		T_JBV(5971627),
		T_JBV(5971650),
		T_JBV(6047128),
		T_JBV(6058334),
		T_JBV(6058442),
		T_JBV(6058480),
		T_JBV(6058734),
		T_JBV(6058756),
		T_JBV(6059469),
		T_JBV(6059626),
		T_JBV(6060763),
		T_JBV(6061333),
		T_JBV(6061372),
		T_JBV(6062542),
		T_JBV(6062946),
		T_JBV(6344607),
		T_JBV(6523308),
		T_JBV(6528290),
		T_JBV(6764179),
		T_JBV(6772868),
		T_JBV(6779888),
		T_JBV(6796830),
		T_JBV(6798896),
		T_JBV(6812089),
		T_JBV(6830913),
		T_JBV(6941138),
		T_JBV(6943751),
		T_JBV(6950321),
		T_JBV(6956393),
		T_JBV(6957783),
		T_JBV(6963983),
		T_JBV(6965740),
		T_JBV(6965879),
		T_JBV(6966939),
		T_JBV(6967314),
		T_JBV(6973112),
		T_JBV(6986109),
		T_JBV(6989078),
		T_JBV(6989704),
		T_JBV(6989758),
		T_JBV(6991799),
		T_JBV(6994346),
		T_JBV(6994859),
		T_JBV(6994957),
		T_JBV(6999633),
		T_JBV(7000793),
		T_JBV(7000955),
		T_JBV(7001123),
		T_JBV(7001951),
		T_JBV(7015949),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269),
		T_JBV(6999295),
		T_JBV(6993919),
		T_JBV(6993691),
		T_JBV(6994669),
		T_JBV(6979716),
		T_JBV(6997621),
		T_JBV(6997795),
		T_JBV(6999269)); 
	V_TMP_JBV T_JBV;
	
BEGIN

	FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);
	
  	ACT_NUM_ACTIVO := TRIM(V_TMP_JBV(1));
  			  
  	EXECUTE IMMEDIATE 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO = '||ACT_NUM_ACTIVO INTO V_KOUNT;
  			  
	IF V_KOUNT > 0 THEN 
  			  
		EXECUTE IMMEDIATE 'SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO = '||ACT_NUM_ACTIVO INTO ACT_ID;


		EXECUTE IMMEDIATE 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.'||V_TABLA||' WHERE ACT_ID = '||ACT_ID INTO V_COUNT;

		IF V_COUNT > 0 THEN
			V_SQL := 'UPDATE '||V_ESQUEMA||'.'||V_TABLA||' SET
						 SPS_OCUPADO = 1
					   , SPS_CON_TITULO = 0
					   , USUARIOMODIFICAR = '''||V_USUARIO||'''
					   , FECHAMODIFICAR = SYSDATE
					   WHERE ACT_ID = '||ACT_ID||'
						';
			EXECUTE IMMEDIATE V_SQL;
			DBMS_OUTPUT.PUT_LINE('ACTUALIZADO EL ACTIVO '||ACT_NUM_ACTIVO);
		END IF;
		
		V_COUNT_UPDATE := V_COUNT_UPDATE + 1;
		
	END IF;
	
	END LOOP;			    
    
	COMMIT;

    DBMS_OUTPUT.PUT_LINE('[INFO] Se han updateado en total '||V_COUNT_UPDATE||' registros');

EXCEPTION
    WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(SQLCODE));
      DBMS_OUTPUT.PUT_LINE('-----------------------------------------------------------');
      DBMS_OUTPUT.PUT_LINE(SQLERRM);
      ROLLBACK;
      RAISE;
END;
/
EXIT;
