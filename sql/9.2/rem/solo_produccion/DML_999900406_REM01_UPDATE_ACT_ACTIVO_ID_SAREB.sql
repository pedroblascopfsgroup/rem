--/*
--##########################################
--## AUTOR=PIER	GOTTA 
--## FECHA_CREACION=20181114
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-2521
--## PRODUCTO=NO
--##
--## Finalidad: Actualizar el ACT_NUM_ACTIVO_SAREB erróneos
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE
    V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar         
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_TABLA VARCHAR2(25 CHAR):= 'ACT_ACTIVO';
    V_COUNT NUMBER(16); -- Vble. para contar.
    V_COUNT_INSERT NUMBER(16):= 0; -- Vble. para contar inserts
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
	V_USUARIO VARCHAR2(32 CHAR):= 'REMVIP-2521';
    
    ACT_NUM_ACTIVO NUMBER(16);
    ACT_NUM_ACTIVO_SAREB_MALO NUMBER(16);
    ACT_NUM_ACTIVO_SAREB_BUENO NUMBER(16);
    
    TYPE T_JBV IS TABLE OF VARCHAR2(4000);
 	TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 

 	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
		T_JBV(65923,688205,569853),
		T_JBV(66897,571517,670951),
		T_JBV(78733,573330,646507),
		T_JBV(100466,561254,674813),
		T_JBV(101062,540271,689266),
		T_JBV(109063,2788829,676324),
		T_JBV(116875,550217,672941),
		T_JBV(119613,545658,714211),
		T_JBV(135989,672734,525661),
		T_JBV(142092,661470,533099),
		T_JBV(142265,521747,717310),
		T_JBV(143098,530472,707397),
		T_JBV(151315,549780,542454),
		T_JBV(151668,729889,542521),
		T_JBV(155038,649308,560080),
		T_JBV(155543,649774,525662),
		T_JBV(155548,545422,562899),
		T_JBV(156336,568636,563996),
		T_JBV(167782,707397,530472),
		T_JBV(170117,551369,572532),
		T_JBV(171259,572532,551369),
		T_JBV(177339,516993,733202),
		T_JBV(177340,531139,673089),
		T_JBV(177341,565408,646513),
		T_JBV(177342,524100,673090),
		T_JBV(177343,520114,718274),
		T_JBV(177344,551162,646517),
		T_JBV(177345,558811,673094),
		T_JBV(177346,565409,643380),
		T_JBV(177396,569803,664610),
		T_JBV(177397,561807,712313),
		T_JBV(177508,558810,654628),
		T_JBV(177509,524096,709297),
		T_JBV(177510,561800,733204),
		T_JBV(177511,544953,727324),
		T_JBV(177515,520115,680628),
		T_JBV(177517,516997,727328),
		T_JBV(177518,569804,664613),
		T_JBV(177654,572354,680624),
		T_JBV(177655,565406,698010),
		T_JBV(177656,527620,689233),
		T_JBV(177657,549801,703679),
		T_JBV(177658,531140,695467),
		T_JBV(177659,531141,654630),
		T_JBV(177660,572357,689235),
		T_JBV(177661,544954,703751),
		T_JBV(177662,536052,660179),
		T_JBV(177664,561803,712308),
		T_JBV(177665,524108,660187),
		T_JBV(177841,539871,660182),
		T_JBV(177842,536054,660183),
		T_JBV(177892,558812,689241),
		T_JBV(177893,524110,709304),
		T_JBV(178044,539872,727330),
		T_JBV(178045,551164,712312),
		T_JBV(178046,520118,643384),
		T_JBV(183393,684054,657544),
		T_JBV(185806,719424,735329),
		T_JBV(187386,558808,733200),
		T_JBV(187387,544950,680625),
		T_JBV(187389,524097,680627),
		T_JBV(187390,549802,673088),
		T_JBV(187412,520097,733203),
		T_JBV(187413,572356,712304),
		T_JBV(187414,565407,660177),
		T_JBV(187636,531143,660180),
		T_JBV(187727,524099,646514),
		T_JBV(187728,572446,712306),
		T_JBV(187730,561802,727327),
		T_JBV(187732,549804,712310),
		T_JBV(187878,527619,733201),
		T_JBV(187879,558809,673087),
		T_JBV(187880,569802,695465),
		T_JBV(187883,539869,646515),
		T_JBV(187886,572447,733207),
		T_JBV(187935,544951,727323),
		T_JBV(187937,561804,643382),
		T_JBV(187938,524103,703755),
		T_JBV(187963,524095,664605),
		T_JBV(187964,516994,654629),
		T_JBV(188017,544955,712307),
		T_JBV(188018,539870,646519),
		T_JBV(188019,527622,664609),
		T_JBV(188020,536053,646520),
		T_JBV(188070,524104,680630),
		T_JBV(188073,561806,680632),
		T_JBV(188095,554555,718273),
		T_JBV(188120,572355,689232),
		T_JBV(188121,569801,646512),
		T_JBV(188122,554553,680626),
		T_JBV(188123,572445,654631),
		T_JBV(188185,551161,689237),
		T_JBV(188186,551163,673093),
		T_JBV(188187,554556,664611),
		T_JBV(188188,527623,654635),
		T_JBV(188189,524102,689242),
		T_JBV(188192,520117,689244),
		T_JBV(188193,549805,712311),
		T_JBV(188741,536057,709303),
		T_JBV(188987,524101,698012),
		T_JBV(188988,536055,646521),
		T_JBV(189110,572448,689240),
		T_JBV(189111,558813,695471),
		T_JBV(189112,527624,703754),
		T_JBV(189114,516999,643383),
		T_JBV(189115,554557,654638),
		T_JBV(189116,524106,723263),
		T_JBV(189117,531177,680633),
		T_JBV(189151,531145,727429),
		T_JBV(189153,524107,660186),
		T_JBV(189451,527625,712309),
		T_JBV(189462,1066246,691741),
		T_JBV(189563,531175,646523),
		T_JBV(189564,531176,727430),
		T_JBV(189565,569805,698013),
		T_JBV(189566,531178,664615),
		T_JBV(190769,655066,9009689),
		T_JBV(192028,692039,655066),
		T_JBV(192789,544952,689234),
		T_JBV(192790,516995,727326),
		T_JBV(192792,516996,695470),
		T_JBV(192793,516998,709301),
		T_JBV(192794,565410,733209),
		T_JBV(192796,524109,646525),
		T_JBV(192884,531138,718272),
		T_JBV(192885,709363,654633),
		T_JBV(192886,520116,660181),
		T_JBV(192888,524105,680631),
		T_JBV(192889,549806,727431),
		T_JBV(193025,554554,695466),
		T_JBV(193026,524098,709298),
		T_JBV(193027,539868,703680),
		T_JBV(193030,558814,660184),
		T_JBV(193092,561805,695473),
		T_JBV(193093,551165,703757),
		T_JBV(193094,544957,733211),
		T_JBV(193095,536056,698014),
		T_JBV(193388,539867,712305),
		T_JBV(193389,561801,660178),
		T_JBV(193390,551159,654632),
		T_JBV(193391,531142,664607),
		T_JBV(193392,551160,703752),
		T_JBV(193395,544956,654636),
		T_JBV(193396,569806,703758),
		T_JBV(195064,547529,566719),
		T_JBV(198373,554065,552368),
		T_JBV(200364,697819,815882),
		T_JBV(200390,892922,545722),
		T_JBV(200899,673368,546285),
		T_JBV(202795,537708,547298),
		T_JBV(204552,1051025,713001),
		T_JBV(944919,1474724,546823),
		T_JBV(951543,3179835,726711),
		T_JBV(5877488,687328,535333),
		T_JBV(5877489,557153,580099),
		T_JBV(6119038,2799092,563021),
		T_JBV(6128178,814741,701733),
		T_JBV(6128179,814742,657991),
		T_JBV(6129746,2803463,9003659),
		T_JBV(6129748,2803465,9004235),
		T_JBV(6129750,2803467,9005084),
		T_JBV(6345722,563958,11001108),
		T_JBV(6345818,691945,11001111),
		T_JBV(6346009,657544,11001090),
		T_JBV(6523057,799768,11002409),
		T_JBV(6524664,649468,11002630),
		T_JBV(6524756,547196,11002633),
		T_JBV(6524757,799859,11002641),
		T_JBV(6524758,801610,11002635),
		T_JBV(6524759,799064,11002642),
		T_JBV(6524760,800194,11002634),
		T_JBV(6524761,800195,11002636),
		T_JBV(6524762,801609,11002643),
		T_JBV(6524763,803173,11002637),
		T_JBV(6524764,800519,11002638),
		T_JBV(6524765,800980,11002639),
		T_JBV(6524766,802917,11002640),
		T_JBV(6524767,797899,11002644),
		T_JBV(6694899,666322,11003302),
		T_JBV(6702623,692454,11003354),
		T_JBV(6702624,655496,11003355),
		T_JBV(6702625,655497,11003356),
		T_JBV(6702626,714908,11003357),
		T_JBV(6702627,692455,11003358),
		T_JBV(6702628,694705,11003360),
		T_JBV(6702629,703040,11003359),
		T_JBV(6702630,643082,11003361),
		T_JBV(6702631,696925,11003362),
		T_JBV(6702632,711635,11003363),
		T_JBV(6702633,647492,11003364),
		T_JBV(6702634,719332,11003365),
		T_JBV(6706794,728753,11004584),
		T_JBV(6746136,1065969,11006460),
		T_JBV(6746139,671125,11006458),
		T_JBV(6746140,1070088,11006463),
		T_JBV(6746144,1070092,11006464),
		T_JBV(6746145,662647,11006469),
		T_JBV(6746146,671124,11006468),
		T_JBV(6746147,729524,11006466),
		T_JBV(6746148,716339,11006467),
		T_JBV(6746149,671122,11006470),
		T_JBV(6746151,1065974,11006473),
		T_JBV(6746152,1065977,11006471),
		T_JBV(6746153,716338,11006475),
		T_JBV(6746154,725153,11006472),
		T_JBV(6746155,666338,11006478),
		T_JBV(6746156,1065970,11006477),
		T_JBV(6746157,1070089,11006476),
		T_JBV(6746159,1065973,11006479),
		T_JBV(6746160,1065976,11006484),
		T_JBV(6746165,893325,11006488),
		T_JBV(6746166,675381,11006485),
		T_JBV(6746167,675378,11006489),
		T_JBV(6746169,683286,11006492),
		T_JBV(6746170,666335,11006494),
		T_JBV(6746171,729523,11006491),
		T_JBV(6746172,1065971,11006490),
		T_JBV(6746174,671123,11006495),
		T_JBV(6746175,1065972,11006497),
		T_JBV(6746176,700610,11006496),
		T_JBV(6746177,1070090,11006500),
		T_JBV(6746178,725152,11006499),
		T_JBV(6746179,648782,11006498),
		T_JBV(6746180,1070091,11006503),
		T_JBV(6746181,705469,11006502),
		T_JBV(6746182,675379,11006501),
		T_JBV(6746183,666337,11006506),
		T_JBV(6746184,735339,11006505),
		T_JBV(6746185,656954,11006504),
		T_JBV(6746186,720505,11006509),
		T_JBV(6746187,666340,11006508),
		T_JBV(6746188,685769,11006507),
		T_JBV(6746189,656953,11006514),
		T_JBV(6746190,666339,11006513),
		T_JBV(6746191,683287,11006512),
		T_JBV(6746192,666336,11006510),
		T_JBV(6746193,562632,11006511),
		T_JBV(6746195,1070103,11006515),
		T_JBV(6746196,1070102,11006517),
		T_JBV(6746198,1070100,11006519),
		T_JBV(6750142,531873,11008232),
		T_JBV(6762913,702134,11014247),
		T_JBV(6762978,660899,11014295),
		T_JBV(6762979,659544,11014293),
		T_JBV(6762980,736766,11014291),
		T_JBV(6762981,659545,11014292),
		T_JBV(6762982,684771,11014294),
		T_JBV(6762983,686149,11014297),
		T_JBV(6762984,686148,11014299),
		T_JBV(6762985,718252,11014296),
		T_JBV(6762986,689180,11014298),
		T_JBV(6762987,718253,11014300),
		T_JBV(6762988,712280,11014302),
		T_JBV(6762989,695402,11014304),
		T_JBV(6762990,658719,11014301),
		T_JBV(6762991,727415,11014303),
		T_JBV(6762992,658717,11014306),
		T_JBV(6762993,664485,11014305),
		T_JBV(6762994,689181,11014307),
		T_JBV(6762995,689182,11014309),
		T_JBV(6762996,712279,11014311),
		T_JBV(6762998,815882,11014308),
		T_JBV(6762999,658718,11014310),
		T_JBV(6763000,697818,11014313),
		T_JBV(6763001,654728,11014312),
		T_JBV(6763002,680578,11014315),
		T_JBV(6767815,711573,11015944),
		T_JBV(6767816,690317,11015945),
		T_JBV(6767817,665352,11015943),
		T_JBV(6767818,728269,11015946),
		T_JBV(6767819,702403,11015948),
		T_JBV(6767820,646637,11015950),
		T_JBV(6767821,673898,11015949),
		T_JBV(6770756,667817,11016713),
		T_JBV(6788989,689247,11037196),
		T_JBV(6802981,11048153,9002973),
		T_JBV(6839415,533964,9004704),
		T_JBV(6939958,893332,9009478),
		T_JBV(6939959,11001956,692039),
		T_JBV(6939960,692042,9009687),
		T_JBV(6939961,2803988,9009688),
		T_JBV(186140,NULL,720986)
	 	);   
    V_TMP_JBV T_JBV;
    
    
 BEGIN
 
 FOR I IN V_JBV.FIRST .. V_JBV.LAST
 LOOP
    V_TMP_JBV := V_JBV(I);
    
    ACT_NUM_ACTIVO 	      := V_TMP_JBV(1);
    ACT_NUM_ACTIVO_SAREB_MALO := V_TMP_JBV(2);
    ACT_NUM_ACTIVO_SAREB_BUENO := V_TMP_JBV(3);
    
    IF ACT_NUM_ACTIVO_SAREB_MALO IS NOT NULL THEN
		V_SQL := 'UPDATE '||V_ESQUEMA||'.'||V_TABLA||' SET
		 			  ACT_NUM_ACTIVO_SAREB   = '||ACT_NUM_ACTIVO_SAREB_BUENO||'
		 			, USUARIOMODIFICAR 	     = '''||V_USUARIO||'''
		 			, FECHAMODIFICAR         = SYSDATE
					WHERE ACT_NUM_ACTIVO 	 = '||ACT_NUM_ACTIVO||' 
					AND ACT_NUM_ACTIVO_SAREB = '||ACT_NUM_ACTIVO_SAREB_MALO||'
				  ';
	ELSE
		V_SQL := 'UPDATE '||V_ESQUEMA||'.'||V_TABLA||' SET
		 			  ACT_NUM_ACTIVO_SAREB   = '||ACT_NUM_ACTIVO_SAREB_BUENO||'
		 			, USUARIOMODIFICAR 	     = '''||V_USUARIO||'''
		 			, FECHAMODIFICAR         = SYSDATE
					WHERE ACT_NUM_ACTIVO 	 = '||ACT_NUM_ACTIVO||' 
				  ';
	END IF;	  
	
  EXECUTE IMMEDIATE V_SQL;
  
  DBMS_OUTPUT.PUT_LINE('[INFO] Se ha cambiado el activo '||ACT_NUM_ACTIVO||' su ACT_NUM_ACTIVO_SAREB por '||ACT_NUM_ACTIVO_SAREB_BUENO);
  
  V_COUNT_INSERT := V_COUNT_INSERT + 1;
  
  END LOOP;
  DBMS_OUTPUT.PUT_LINE('[INFO] Se han cambiado en total '||V_COUNT_INSERT||' registros en la tabla '||V_TABLA);
  
 COMMIT;
 
EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.PUT_LINE('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.PUT_LINE('-----------------------------------------------------------'); 
          DBMS_OUTPUT.PUT_LINE(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
