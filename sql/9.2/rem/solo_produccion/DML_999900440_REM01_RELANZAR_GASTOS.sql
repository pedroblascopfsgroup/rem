--/*
--#########################################
--## AUTOR=Ivan Castell贸 Cabrelles
--## FECHA_CREACION=20190326
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-3484
--## PRODUCTO=NO
--## 
--## Finalidad: Proceso de migraci贸n 
--##
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versi贸n inicial
--#########################################
--*/

--Para permitir la visualizaci贸n de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE



	V_ESQUEMA VARCHAR2(10 CHAR) := 'REM01';
	V_ESQUEMA_MASTER VARCHAR2(15 CHAR) := 'REMMASTER';
	V_SQL VARCHAR2(2500 CHAR) := '';
	V_NUM NUMBER(25);
	V_SENTENCIA VARCHAR2(4000 CHAR);
	TABLE_COUNT NUMBER(10,0) := 0;
	


BEGIN

      DBMS_OUTPUT.PUT_LINE('[INFO] COMIENZA EL PROCESO ');
      
 
      V_SENTENCIA := '

      MERGE INTO REM01.GGE_GASTOS_GESTION T1 USING
(
    SELECT GPV.GPV_ID
    FROM rem01.GPV_GASTOS_PROVEEDOR GPV
    JOIN REM01.GGE_GASTOS_GESTION GGE ON GGE.GPV_ID = GPV.GPV_ID
    WHERE GPV.GPV_NUM_GASTO_HAYA IN(
    10370496,
10370495,
10370494,
10370493,
10370492,
10370491,
10370490,
10370489,
10370488,
10370487,
10370486,
10370485,
10370484,
10370483,
10286154,
10286155,
10286156,
10286157,
10286158,
10286159,
10286160,
10286161,
10286162,
10286163,
10290392,
10290393,
10290394,
10290395,
10290396,
10290397,
10290398,
10290399,
10290400,
10290401,
10290402,
10290403,
10290404,
10290405,
10290406,
10290407,
10290408,
10290409,
10290410,
10290411,
10290992,
10290993,
10290994,
10290995,
10290996,
10290997,
10290998,
10290999,
10291000,
10291001,
10291002,
10291003,
10291004,
10291005,
10291006,
10291007,
10291008,
10291009,
10291010,
10291011,
10291012,
10291013,
10291014,
10291015,
10291016,
10291017,
10291018,
10291019,
10291020,
10291021,
10291022,
10291023,
10291024,
10291025,
10291026,
10291027,
10291028,
10291029,
10291030,
10291031,
10291032,
10291033,
10291034,
10291035,
10291036,
10291037,
10291038,
10291039,
10291040,
10291041,
10291042,
10291043,
10291044,
10291045,
10291046,
10291047,
10291048,
10291049,
10291050,
10291051,
10370467,
10370468,
10370469,
10370470,
10370471,
10370472,
10370473,
10370474,
10370475,
10370476,
10370477,
10370478,
10370479,
10370480,
10370481,
10370482
    ) 
)T2 ON (T1.GPV_ID = T2.GPV_ID)
WHEN MATCHED THEN
UPDATE
SET T1.DD_EAH_ID = (SELECT DD_EAH_ID FROM  REM01.DD_EAH_ESTADOS_AUTORIZ_HAYA WHERE DD_EAH_CODIGO = ''03''),
    T1.GGE_FECHA_EAH = SYSDATE,
    T1.DD_EAP_ID = (SELECT DD_EAP_ID FROM  REM01.DD_EAP_ESTADOS_AUTORIZ_PROP WHERE DD_EAP_CODIGO = ''01''),
    T1.GGE_FECHA_EAP = NULL,
    T1.GGE_MOTIVO_RECHAZO_PROP = NULL,
    T1.GGE_FECHA_ENVIO_PRPTRIO = NULL,
    T1.USUARIOMODIFICAR = ''REMVIP-3747'',
    T1.FECHAMODIFICAR = SYSDATE
    


        ';


      EXECUTE IMMEDIATE V_SENTENCIA;
      
      DBMS_OUTPUT.PUT_LINE('[INFO] CAMBIADAS  '||SQL%ROWCOUNT||' Filas.');
   


       DBMS_OUTPUT.PUT_LINE('[INFO] COMIENZA EL PROCESO ');
      
 
      V_SENTENCIA := '

MERGE INTO REM01.GPV_GASTOS_PROVEEDOR T1 USING
(
    SELECT GPV.GPV_ID
    FROM rem01.GPV_GASTOS_PROVEEDOR GPV
    JOIN REM01.GGE_GASTOS_GESTION GGE ON GGE.GPV_ID = GPV.GPV_ID
    WHERE GPV.GPV_NUM_GASTO_HAYA IN(
    10370496,
10370495,
10370494,
10370493,
10370492,
10370491,
10370490,
10370489,
10370488,
10370487,
10370486,
10370485,
10370484,
10370483,
10286154,
10286155,
10286156,
10286157,
10286158,
10286159,
10286160,
10286161,
10286162,
10286163,
10290392,
10290393,
10290394,
10290395,
10290396,
10290397,
10290398,
10290399,
10290400,
10290401,
10290402,
10290403,
10290404,
10290405,
10290406,
10290407,
10290408,
10290409,
10290410,
10290411,
10290992,
10290993,
10290994,
10290995,
10290996,
10290997,
10290998,
10290999,
10291000,
10291001,
10291002,
10291003,
10291004,
10291005,
10291006,
10291007,
10291008,
10291009,
10291010,
10291011,
10291012,
10291013,
10291014,
10291015,
10291016,
10291017,
10291018,
10291019,
10291020,
10291021,
10291022,
10291023,
10291024,
10291025,
10291026,
10291027,
10291028,
10291029,
10291030,
10291031,
10291032,
10291033,
10291034,
10291035,
10291036,
10291037,
10291038,
10291039,
10291040,
10291041,
10291042,
10291043,
10291044,
10291045,
10291046,
10291047,
10291048,
10291049,
10291050,
10291051,
10370467,
10370468,
10370469,
10370470,
10370471,
10370472,
10370473,
10370474,
10370475,
10370476,
10370477,
10370478,
10370479,
10370480,
10370481,
10370482
    ) 
    
)T2 ON (T1.GPV_ID = T2.GPV_ID) 
WHEN MATCHED THEN
        UPDATE
        SET T1.DD_EGA_ID = (SELECT DD_EGA_ID FROM  REM01.DD_EGA_ESTADOS_GASTO WHERE DD_EGA_CODIGO = ''03''),
            T1.PRG_ID = NULL,
            T1.USUARIOMODIFICAR = ''REMVIP-3747'',
            T1.FECHAMODIFICAR = SYSDATE
    


        ';


      EXECUTE IMMEDIATE V_SENTENCIA;
      
      DBMS_OUTPUT.PUT_LINE('[INFO] CAMBIADAS  '||SQL%ROWCOUNT||' Filas.');     
  





       DBMS_OUTPUT.PUT_LINE('[INFO] COMIENZA EL PROCESO ');
      
 
      V_SENTENCIA := '

        MERGE INTO REM01.GPV_GASTOS_PROVEEDOR T1 USING
        (
            SELECT GPV.GPV_ID
            FROM rem01.GPV_GASTOS_PROVEEDOR GPV
            JOIN REM01.GGE_GASTOS_GESTION GGE ON GGE.GPV_ID = GPV.GPV_ID
            WHERE GPV.GPV_NUM_GASTO_HAYA IN(
9678033,
9678034,
9678035,
9678036,
9678037,
9678038,
9678039,
9678040,
9678041,
9678042,
9678043,
9678044,
9678045,
9678046,
9678047,
9678048,
9678049,
9678050,
9678051,
9678052,
9678053,
9678054,
9678055,
9678056,
9678057,
9678058,
9678059,
9678060,
9678061,
9678062,
9678063,
9678064,
9678065,
9678066,
9678067,
9678068,
9678069,
9678070,
9678071,
10153918,
10154088,
10154068,
10153987,
10153930,
10154018,
10153964,
10154090,
10154086,
10154122,
10154033,
10153943,
10153968,
10154045,
10153902,
10153919,
10153942,
10154019,
10154011,
10153949,
10153938,
10153988,
10154006,
10154046,
10153926,
10153903,
10154064,
10154118,
10153918,
10154076,
10153970,
10154008,
10153907,
10154012,
10153931,
10153982,
10153976,
10154039,
10154041,
10154082,
10153922,
10153951,
10154024,
10154116,
10154091,
10154015,
10153937,
10154109,
10154073,
10154005,
10154060,
10154028,
10154049,
10153980,
10154001,
10153954,
10153960,
10154115,
10154121,
10153995,
10154026,
10153956,
10153928,
10154021,
10154048,
10153900,
10153997,
10153965,
10153932,
10154007,
10154002,
10154029,
10153916,
10153914,
10153990,
10154013,
10153967,
10154110,
10153996,
10154072,
10153946,
10153910,
10154034,
10154119,
10154014,
10153998,
10154077,
10153977,
10153955,
10154003,
10153992,
10154052,
10153974,
10153939,
10154058,
10153934,
10153984,
10154117,
10154081,
10154062,
10154075,
10154037,
10154025,
10154056,
10153940,
10153948,
10153957,
10154031,
10154054,
10153929,
10154094,
10154043,
10153969,
10154055,
10153901,
10154083,
10153925,
10153975,
10154040,
10153983,
10153941,
10153933,
10154069,
10153947,
10154001,
10154053,
10154066,
10154066,
10154066,
10153958,
10153911,
10154042,
10154050,
10153945,
10153952,
10154085,
10153909,
10154120,
10153950,
10153923,
10154020,
10153905,
10153924,
10154080,
10154078,
10170936,
10153994,
10153973,
10153921,
10153961,
10154051,
10153985,
10153989,
10154016,
10154089,
10153920,
10153962,
10154047,
10154111,
10154022,
10153953,
10153993,
10154027,
10154065,
10154067,
10154061,
10154123,
10154038,
10153913,
10153963,
10154071,
10154035,
10154113,
10153971,
10154074,
10153979,
10154125,
10154124,
10154079,
10153944,
10153999,
10154070,
10154059,
10154010,
10153912,
10153915,
10153935,
10154126,
10154000,
10154087,
10154030,
10153917,
10154023,
10153959,
10153981,
10153978,
10153966,
10154093,
10154112,
10153936,
10154017,
10153908,
10153991,
10153986,
10153906,
10154009,
10154004,
10154092,
10153927,
10154044,
10154101,
10153972,
10154099,
10154098,
10154096,
10154097,
10154100,
10154104,
10154108,
10154114,
10154107,
10154105,
10154095,
10154103,
10154102,
10154106

            )            
        )T2 ON (T1.GPV_ID = T2.GPV_ID) 
        WHEN MATCHED THEN
                UPDATE
                SET T1.DD_EGA_ID = (SELECT DD_EGA_ID FROM  REM01.DD_EGA_ESTADOS_GASTO WHERE DD_EGA_CODIGO = ''01''),
                    T1.PRG_ID = NULL,
                    T1.USUARIOMODIFICAR = ''REMVIP-3484'',
                    T1.FECHAMODIFICAR = SYSDATE
            


        ';


      EXECUTE IMMEDIATE V_SENTENCIA;
      
      DBMS_OUTPUT.PUT_LINE('[INFO] CAMBIADAS  '||SQL%ROWCOUNT||' Filas.');    




   
   COMMIT;
      
   
      
EXCEPTION
      WHEN OTHERS THEN
            DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
            DBMS_OUTPUT.put_line('-----------------------------------------------------------');
            DBMS_OUTPUT.put_line(SQLERRM);
            ROLLBACK;
            RAISE;
END;

/

EXIT;
