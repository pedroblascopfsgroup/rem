--/*
--#########################################
--## AUTOR=SIMEON SHOPOV
--## FECHA_CREACION=20180416
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=2.0.17
--## INCIDENCIA_LINK=REMVIP-505
--## PRODUCTO=NO
--## 
--## Finalidad: 
--##            
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/
--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
    V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar         
    V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; --'#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; --'#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_TABLA VARCHAR2(25 CHAR):= 'OFR_OFERTAS';
    --V_COUNT NUMBER(16); -- Vble. para contar.
    V_COUNT_UPDATE NUMBER(16):= 0; -- Vble. para contar updates
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USUARIO VARCHAR2(32 CHAR):= 'REMVIP-744';

	OFR_NUM_OFERTA NUMBER(16);
	OFR_WEBCOM_ID VARCHAR2(55 CHAR);

    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
		   T_JBV(52143528,90058278)
		 , T_JBV(52144557,90058275)
		 , T_JBV(52146516,90058277)
		 , T_JBV(52150823,90058284)
		 , T_JBV(52151852,90058282)
		 , T_JBV(52161990,90058294)
		 , T_JBV(52163608,90058292)
		 , T_JBV(52167742,90058295)
		 , T_JBV(52170048,90058290)
		 , T_JBV(52174065,90058291)
		 , T_JBV(52226945,90058303)
		 , T_JBV(52283225,90058308)
		 , T_JBV(52296351,90058306)
		 , T_JBV(52297642,90058305)
		 , T_JBV(52315539,90058317)
		 , T_JBV(52318275,90058312)
		 , T_JBV(52321202,90058314)
		 , T_JBV(52322834,90058313)
		 , T_JBV(52357388,90058330)
		 , T_JBV(52358183,90058336)
		 , T_JBV(52359113,90058328)
		 , T_JBV(52360549,90058327)
		 , T_JBV(52361695,90058329)
		 , T_JBV(52377099,90058352)
		 , T_JBV(52377837,90058343)
		 , T_JBV(52378515,90058344)
		 , T_JBV(52380970,90058345)
		 , T_JBV(52384529,90058341)
		 , T_JBV(52385072,90058347)
		 , T_JBV(52387985,90058340)
		 , T_JBV(52408636,90058356)
		 , T_JBV(52413972,90058357)
		 , T_JBV(54229854,90058363)
		 , T_JBV(54231968,90058361)
		 , T_JBV(54240960,90058362)
		 , T_JBV(54245421,90058360)
		 , T_JBV(57024440,90058371)
		 , T_JBV(58748394,90058373)
		 , T_JBV(61940268,90058375)
		 , T_JBV(62189425,90058377)
		 , T_JBV(62497116,90058379)
		 , T_JBV(62695931,90058382)
		 , T_JBV(62867349,90058386)
		 , T_JBV(63091652,90058389)
		 , T_JBV(63096698,90058388)
		 , T_JBV(63396065,90058394)
		 , T_JBV(63737710,90058396)
		 , T_JBV(63752016,90058398)
		 , T_JBV(63816634,90058400)
		 , T_JBV(64372608,90058419)
		 , T_JBV(64376625,90058402)
		 , T_JBV(64383299,90058403)
		 , T_JBV(64403992,90058434)
		 , T_JBV(64475502,90058470)
		 , T_JBV(64476414,90058479)
		 , T_JBV(64478111,90058481)
		 , T_JBV(64480955,90058471)
		 , T_JBV(64482914,90058473)
		 , T_JBV(64484018,90058484)
		 , T_JBV(64485640,90058472)
		 , T_JBV(64487123,90058475)
		 , T_JBV(64489802,90058497)
		 , T_JBV(64518273,90058500)
		 , T_JBV(64731412,90058505)
		 , T_JBV(64896586,90058508)
		 , T_JBV(65622388,90058512)
		 , T_JBV(65660238,90058513)
		 , T_JBV(65711117,90058515)
		 , T_JBV(65830308,90058517)
		 , T_JBV(65954662,90058519)
		 , T_JBV(66025842,90058522)
		 , T_JBV(66710224,90058524)
		 , T_JBV(66732479,90058527)
		 , T_JBV(66734204,90058529)
		 , T_JBV(66796619,90058535)
		 , T_JBV(66806426,90058534)
		 , T_JBV(66951945,90058538)
		 , T_JBV(67306546,90058540)
		 , T_JBV(67688156,90058542)
		 , T_JBV(67689185,90058543)
		 , T_JBV(68274134,90058547)
		 , T_JBV(68372936,90058556)
		 , T_JBV(68700221,90058558)
		 , T_JBV(68701970,90058559)
		 , T_JBV(69148873,90058564)
		 , T_JBV(69245430,90058566)
		 , T_JBV(70180202,90058585)
		 , T_JBV(70311024,90058604)
		 , T_JBV(70516368,90058607)
		 , T_JBV(70611345,90058626)
		 , T_JBV(70809997,90058631)
		 , T_JBV(71444165,90058636)
		 , T_JBV(71653582,90058638)
	); 
	V_TMP_JBV T_JBV;
BEGIN


 
 FOR I IN V_JBV.FIRST .. V_JBV.LAST
 LOOP
 
 V_TMP_JBV := V_JBV(I);
  			  OFR_NUM_OFERTA := TRIM(V_TMP_JBV(1));
 			  OFR_WEBCOM_ID := TRIM(V_TMP_JBV(2));
			
	

		V_SQL := 'UPDATE '||V_ESQUEMA||'.'||V_TABLA||' SET
					 OFR_WEBCOM_ID = '''||OFR_WEBCOM_ID||'''
				   , USUARIOMODIFICAR = '''||V_USUARIO||'''
				   , FECHAMODIFICAR = SYSDATE
				   WHERE OFR_NUM_OFERTA = '||OFR_NUM_OFERTA||'
					';


				EXECUTE IMMEDIATE V_SQL;
			    DBMS_OUTPUT.PUT_LINE('Puesto el OFR_WEBCOM_ID A '||OFR_WEBCOM_ID||' en la oferta ofr_num_oferta '||OFR_NUM_OFERTA);
				V_COUNT_UPDATE := V_COUNT_UPDATE + 1;

 END LOOP;			    
    
	COMMIT;

    DBMS_OUTPUT.PUT_LINE('[INFO] Se han updateado en total '||V_COUNT_UPDATE||' registros');

EXCEPTION
    WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(SQLCODE));
      DBMS_OUTPUT.PUT_LINE('-----------------------------------------------------------');
      DBMS_OUTPUT.PUT_LINE(SQLERRM);
      ROLLBACK;
      RAISE;
END;
/
EXIT;
