--/*
--##########################################
--## AUTOR=VIORE REMUS OVIDIU
--## FECHA_CREACION=20180725
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-1374
--## PRODUCTO=NO
--##
--## Finalidad: Insercion de clases activos en la tabla ACT_ABA_ACTIVO_BANCARIO
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_REGISTRO NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
	
    V_TEXT1 VARCHAR2(2400 CHAR); -- Vble. auxiliar
    V_ENTIDAD_ID NUMBER(16);
    V_ID NUMBER(16);
    V_SEQ_GEH NUMBER(16);
    V_TIPO_ID NUMBER(16); --Vle para el id ACT_ID
    V_USUARIO VARCHAR2(32 CHAR) := 'REMVIP-1374';
    
    
    TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(	
	  	  T_TIPO_DATA(155755)
		, T_TIPO_DATA(146811)
		, T_TIPO_DATA(87989)
		, T_TIPO_DATA(85409)
		, T_TIPO_DATA(79482)
		, T_TIPO_DATA(183697)
		, T_TIPO_DATA(82276)
		, T_TIPO_DATA(91613)
		, T_TIPO_DATA(82080)
		, T_TIPO_DATA(91168)
		, T_TIPO_DATA(82081)
		, T_TIPO_DATA(84967)
		, T_TIPO_DATA(82117)
		, T_TIPO_DATA(63335)
		, T_TIPO_DATA(63479)
		, T_TIPO_DATA(131463)
		, T_TIPO_DATA(137729)
		, T_TIPO_DATA(131584)
		, T_TIPO_DATA(154901)
		, T_TIPO_DATA(154573)
		, T_TIPO_DATA(143905)
		, T_TIPO_DATA(131585)
		, T_TIPO_DATA(154876)
		, T_TIPO_DATA(143906)
		, T_TIPO_DATA(154900)
		, T_TIPO_DATA(137675)
		, T_TIPO_DATA(144471)
		, T_TIPO_DATA(156111)
		, T_TIPO_DATA(143449)
		, T_TIPO_DATA(144473)
		, T_TIPO_DATA(154575)
		, T_TIPO_DATA(137884)
		, T_TIPO_DATA(138026)
		, T_TIPO_DATA(144472)
		, T_TIPO_DATA(154879)
		, T_TIPO_DATA(138030)
		, T_TIPO_DATA(144093)
		, T_TIPO_DATA(131911)
		, T_TIPO_DATA(143947)
		, T_TIPO_DATA(143088)
		, T_TIPO_DATA(131579)
		, T_TIPO_DATA(137886)
		, T_TIPO_DATA(137728)
		, T_TIPO_DATA(137670)
		, T_TIPO_DATA(137674)
		, T_TIPO_DATA(137885)
		, T_TIPO_DATA(138029)
		, T_TIPO_DATA(154572)
		, T_TIPO_DATA(143253)
		, T_TIPO_DATA(131779)
		, T_TIPO_DATA(148493)
		, T_TIPO_DATA(143447)
		, T_TIPO_DATA(154293)
		, T_TIPO_DATA(197399)
		, T_TIPO_DATA(145288)
		, T_TIPO_DATA(131777)
		, T_TIPO_DATA(154903)
		, T_TIPO_DATA(144094)
		, T_TIPO_DATA(153828)
		, T_TIPO_DATA(154878)
		, T_TIPO_DATA(138028)
		, T_TIPO_DATA(131780)
		, T_TIPO_DATA(154875)
		, T_TIPO_DATA(131462)
		, T_TIPO_DATA(143946)
		, T_TIPO_DATA(138935)
		, T_TIPO_DATA(154611)
		, T_TIPO_DATA(153826)
		, T_TIPO_DATA(143086)
		, T_TIPO_DATA(153314)
		, T_TIPO_DATA(156347)
		, T_TIPO_DATA(156108)
		, T_TIPO_DATA(137006)
		, T_TIPO_DATA(143084)
		, T_TIPO_DATA(148537)
		, T_TIPO_DATA(137118)
		, T_TIPO_DATA(137003)
		, T_TIPO_DATA(113351)
		, T_TIPO_DATA(143446)
		, T_TIPO_DATA(154078)
		, T_TIPO_DATA(154076)
		, T_TIPO_DATA(136953)
		, T_TIPO_DATA(156348)
		, T_TIPO_DATA(137119)
		, T_TIPO_DATA(136955)
		, T_TIPO_DATA(156779)
		, T_TIPO_DATA(159827)
		, T_TIPO_DATA(155860)
		, T_TIPO_DATA(153483)
		, T_TIPO_DATA(153484)
		, T_TIPO_DATA(142881)
		, T_TIPO_DATA(143184)
		, T_TIPO_DATA(136436)
		, T_TIPO_DATA(136682)
		, T_TIPO_DATA(146847)
		, T_TIPO_DATA(146842)
		, T_TIPO_DATA(143342)
		, T_TIPO_DATA(134177)
		, T_TIPO_DATA(142712)
		, T_TIPO_DATA(155859)
		, T_TIPO_DATA(152968)
		, T_TIPO_DATA(152966)
		, T_TIPO_DATA(155908)
		, T_TIPO_DATA(154994)
		, T_TIPO_DATA(142982)
		, T_TIPO_DATA(154949)
		, T_TIPO_DATA(142713)
		, T_TIPO_DATA(142981)
		, T_TIPO_DATA(153479)
		, T_TIPO_DATA(136122)
		, T_TIPO_DATA(139667)
		, T_TIPO_DATA(136434)
		, T_TIPO_DATA(142023)
		, T_TIPO_DATA(154993)
		, T_TIPO_DATA(136121)
		, T_TIPO_DATA(152967)
		, T_TIPO_DATA(136856)
		, T_TIPO_DATA(157816)
		, T_TIPO_DATA(153189)
		, T_TIPO_DATA(136432)
		, T_TIPO_DATA(152964)
		, T_TIPO_DATA(143341)
		, T_TIPO_DATA(155757)
		, T_TIPO_DATA(155862)
		, T_TIPO_DATA(142711)
		, T_TIPO_DATA(153478)
		, T_TIPO_DATA(153480)
		, T_TIPO_DATA(143340)
		, T_TIPO_DATA(155195)
		, T_TIPO_DATA(152477)
		, T_TIPO_DATA(147461)
		, T_TIPO_DATA(155465)
		, T_TIPO_DATA(141548)
		, T_TIPO_DATA(155861)
		, T_TIPO_DATA(152396)
		, T_TIPO_DATA(136266)
		, T_TIPO_DATA(142882)
		, T_TIPO_DATA(136613)
		, T_TIPO_DATA(153481)
		, T_TIPO_DATA(134479)
		, T_TIPO_DATA(136857)
		, T_TIPO_DATA(6842824)
		, T_TIPO_DATA(6842846)
		, T_TIPO_DATA(6842848)
		, T_TIPO_DATA(131580)
		, T_TIPO_DATA(6842853)
		, T_TIPO_DATA(6842860)
		, T_TIPO_DATA(6842823)
		, T_TIPO_DATA(6842838)
		, T_TIPO_DATA(6842851)
		, T_TIPO_DATA(6842859)
		, T_TIPO_DATA(6842847)
		, T_TIPO_DATA(6842868)
		, T_TIPO_DATA(6842856)
		, T_TIPO_DATA(6842862)
		, T_TIPO_DATA(6842830)
		, T_TIPO_DATA(6842841)
		, T_TIPO_DATA(6842850)
		, T_TIPO_DATA(6842854)
		, T_TIPO_DATA(6842857)
		, T_TIPO_DATA(138027)
		, T_TIPO_DATA(142338)
		, T_TIPO_DATA(6842827)
		, T_TIPO_DATA(6842822)
		, T_TIPO_DATA(6842843)
		, T_TIPO_DATA(6842837)
		, T_TIPO_DATA(6842855)
		, T_TIPO_DATA(6842858)
		, T_TIPO_DATA(142337)
		, T_TIPO_DATA(6842849)
		, T_TIPO_DATA(6842867)
		, T_TIPO_DATA(6842866)
		, T_TIPO_DATA(6842825)
		, T_TIPO_DATA(6842833)
		, T_TIPO_DATA(6842831)
		, T_TIPO_DATA(6842865)
		, T_TIPO_DATA(6842834)
		, T_TIPO_DATA(6842835)
		, T_TIPO_DATA(141784)
		, T_TIPO_DATA(6842842)
		, T_TIPO_DATA(6842840)
		, T_TIPO_DATA(154877)
		, T_TIPO_DATA(6842836)
		, T_TIPO_DATA(6842852)
		, T_TIPO_DATA(139542)
		, T_TIPO_DATA(6842864)
		, T_TIPO_DATA(160061)
		, T_TIPO_DATA(131581)
		, T_TIPO_DATA(6842845)
		, T_TIPO_DATA(200834)
		, T_TIPO_DATA(6842839)
		, T_TIPO_DATA(6842821)
		, T_TIPO_DATA(6842844)
		, T_TIPO_DATA(6842863)
		, T_TIPO_DATA(158310)
		, T_TIPO_DATA(6842861)
		, T_TIPO_DATA(6842826)
		, T_TIPO_DATA(154574)
		, T_TIPO_DATA(6842832)
		, T_TIPO_DATA(6842829)
		, T_TIPO_DATA(173298)
		, T_TIPO_DATA(148925)
		, T_TIPO_DATA(163027)
		, T_TIPO_DATA(145978)
		, T_TIPO_DATA(174050)
		, T_TIPO_DATA(156980)
		, T_TIPO_DATA(146096)
		, T_TIPO_DATA(145739)
		, T_TIPO_DATA(148245)
		, T_TIPO_DATA(175836)
		, T_TIPO_DATA(166388)
		, T_TIPO_DATA(157455)
		, T_TIPO_DATA(145976)
		, T_TIPO_DATA(154326)
		, T_TIPO_DATA(146423)
		, T_TIPO_DATA(159082)
		, T_TIPO_DATA(143892)
		, T_TIPO_DATA(133066)
		, T_TIPO_DATA(163028)
		, T_TIPO_DATA(148020)
		, T_TIPO_DATA(135788)
		, T_TIPO_DATA(157317)
		, T_TIPO_DATA(148926)
		, T_TIPO_DATA(163299)
		, T_TIPO_DATA(172677)
		, T_TIPO_DATA(172678)
		, T_TIPO_DATA(174049)
		, T_TIPO_DATA(97176)
		, T_TIPO_DATA(173851)
		, T_TIPO_DATA(145840)
		, T_TIPO_DATA(133242)
		, T_TIPO_DATA(133566)
		, T_TIPO_DATA(157702)
		, T_TIPO_DATA(162567)
		, T_TIPO_DATA(173867)
		, T_TIPO_DATA(157033)
		, T_TIPO_DATA(149127)
		, T_TIPO_DATA(145740)
		, T_TIPO_DATA(133844)
		, T_TIPO_DATA(162810)
		, T_TIPO_DATA(135787)
		, T_TIPO_DATA(163298)
		, T_TIPO_DATA(162811)
		, T_TIPO_DATA(172998)
		, T_TIPO_DATA(98758)
		, T_TIPO_DATA(145977)
		, T_TIPO_DATA(166487)
		, T_TIPO_DATA(146099)
		, T_TIPO_DATA(141589)
		, T_TIPO_DATA(173772)
		, T_TIPO_DATA(166281)
		, T_TIPO_DATA(166599)
		, T_TIPO_DATA(90929)
		, T_TIPO_DATA(172574)
		, T_TIPO_DATA(6343951)
		, T_TIPO_DATA(204042)

	); 
    V_TMP_TIPO_DATA T_TIPO_DATA;

BEGIN	
	
    DBMS_OUTPUT.PUT_LINE('[INICIO] ');

	 
    -- LOOP para insertar los valores en ACT_ABA_ACTIVO_BANCARIO -----------------------------------------------------------------
    DBMS_OUTPUT.PUT_LINE('[INICIO] '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO... Empezando a insertar datos en la tabla ACT_ABA_ACTIVO_BANCARIO');
    FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
      LOOP
      
        V_TMP_TIPO_DATA := V_TIPO_DATA(I);

		--COMPRUEBO QUE NO EXISTE EL ACT_ID

		V_MSQL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO WHERE ACT_ID = (SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO = '||V_TMP_TIPO_DATA(1)||')';
		EXECUTE IMMEDIATE V_MSQL INTO V_NUM_REGISTRO;
		
		IF V_NUM_REGISTRO > 0 THEN 
			DBMS_OUTPUT.PUT_LINE('[INFO] El activo '||V_TMP_TIPO_DATA(1)||' ya existe en la tabla');
		ELSE
    
   		V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO(ABA_ID, ACT_ID, DD_CLA_ID, USUARIOCREAR, FECHACREAR)
			  VALUES(S_ACT_ABA_ACTIVO_BANCARIO.NEXTVAL, (SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO = '||V_TMP_TIPO_DATA(1)||'), 2, '''||V_USUARIO||''', SYSDATE)';
		EXECUTE IMMEDIATE V_MSQL;
		DBMS_OUTPUT.PUT_LINE('[INFO] INSERTANDO ACTIVO '''||V_TMP_TIPO_DATA(1)||'''');
	
		END IF;	
    	  END LOOP;
    	
	COMMIT;

    	DBMS_OUTPUT.PUT_LINE('[FIN] '||V_ESQUEMA||'.ACT_ABA_ACTIVO_BANCARIO... Datos de la tabla insertados');

EXCEPTION
     WHEN OTHERS THEN
          err_num := SQLCODE;
          err_msg := SQLERRM;

          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(err_msg);

          ROLLBACK;
          RAISE;          

END;

/

EXIT

