

--/*
--##########################################
--## AUTOR=GUSTAVO MORA
--## FECHA_CREACION=20180822
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=REMVIP-1601
--## PRODUCTO=NO
--##
--## Finalidad: 
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versi√≥n inicial
--##########################################
--*/

set serveroutput on;

DECLARE

   V_SQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar
   V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; -- Configuracion Esquema
   V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; -- Configuracion Esquema Master
   ERR_NUM NUMBER(25); -- Vble. auxiliar para registrar errores en el script.
   ERR_MSG VARCHAR2(10024 CHAR); -- Vble. auxiliar para registrar errores en el script.
   V_NUM_TABLAS NUMBER(16); -- Variable auxiliar
   USUARIO_CONSULTA_REM VARCHAR2(50 CHAR):= 'REM_QUERY';
   V_USUARIO_MODIFICAR VARCHAR2(50 CHAR):='REMVIP-1601';

BEGIN   
        
        DBMS_OUTPUT.PUT_LINE('[INICIO] ');              
                                
                V_SQL := 'MERGE INTO REM01.GGE_GASTOS_GESTION T1 USING
                                                        (SELECT GPV_ID FROM REM01.GPV_GASTOS_PROVEEDOR GPV WHERE GPV_NUM_GASTO_HAYA IN (  10012788
                                                              , 10012795
                                                              , 10012820
                                                              , 10012828
                                                              , 10012635
                                                              , 10012637
                                                              , 10012644
                                                              , 10012659
                                                              , 10012665
                                                              , 10012709
                                                              , 10012712
                                                              , 10012835
                                                              , 10012838
                                                              , 10012840
                                                              , 10012845
                                                              , 10012857
                                                              , 10012739
                                                              , 10012754
                                                              , 10012756
                                                              , 10012764
                                                              , 10012766
                                                              , 10012872
                                                              , 10012873
                                                              , 10012880
                                                              , 10012884
                                                              , 10012894
                                                              , 10012905
                                                              , 10012933
                                                              , 10012947
                                                              , 10012960
                                                              , 10012967
                                                              , 10012975
                                                              , 10012997
                                                              , 10012773
                                                              , 10012804
                                                              , 10012816
                                                              , 10012642
                                                              , 10012646
                                                              , 10012648
                                                              , 10012674
                                                              , 10012680
                                                              , 10012681
                                                              , 10012686
                                                              , 10012690
                                                              , 10012692
                                                              , 10012697
                                                              , 10012700
                                                              , 10012702
                                                              , 10012708
                                                              , 10012719
                                                              , 10012849
                                                              , 10012855
                                                              , 10012720
                                                              , 10012723
                                                              , 10012730
                                                              , 10012741
                                                              , 10012742
                                                              , 10012744
                                                              , 10012751
                                                              , 10012760
                                                              , 10012865
                                                              , 10012866
                                                              , 10012870
                                                              , 10012871
                                                              , 10012874
                                                              , 10012875
                                                              , 10012882
                                                              , 10012883
                                                              , 10012897
                                                              , 10012898
                                                              , 10012913
                                                              , 10012914
                                                              , 10012923
                                                              , 10012928
                                                              , 10012929
                                                              , 10012953
                                                              , 10012964
                                                              , 10012965
                                                              , 10012968
                                                              , 10012973
                                                              , 10012978
                                                              , 10012979
                                                              , 10012990
                                                              , 10012993
                                                              , 10012789
                                                              , 10012790
                                                              , 10012633
                                                              , 10012634
                                                              , 10012638
                                                              , 10012639
                                                              , 10012640
                                                              , 10012645
                                                              , 10012662
                                                              , 10012663
                                                              , 10012668
                                                              , 10012688
                                                              , 10012693
                                                              , 10012701
                                                              , 10012706
                                                              , 10012707
                                                              , 10012714
                                                              , 10012842
                                                              , 10012861
                                                              , 10012729
                                                              , 10012736
                                                              , 10012743
                                                              , 10012746
                                                              , 10012750
                                                              , 10012769
                                                              , 10012877
                                                              , 10012759
                                                              , 10012761
                                                              , 10012869
                                                              , 10012893
                                                              , 10012901
                                                              , 10012906
                                                              , 10012909
                                                              , 10012910
                                                              , 10012918
                                                              , 10012919
                                                              , 10012922
                                                              , 10012931
                                                              , 10012951
                                                              , 10012970
                                                              , 10012974
                                                              , 10012986
                                                              , 10012987
                                                              , 10012995
                                                              , 10012785
                                                              , 10012800
                                                              , 10012802
                                                              , 10012636
                                                              , 10012650
                                                              , 10012655
                                                              , 10012657
                                                              , 10012661
                                                              , 10012670
                                                              , 10012673
                                                              , 10012677
                                                              , 10012704
                                                              , 10012832
                                                              , 10012839
                                                              , 10012724
                                                              , 10012726
                                                              , 10012727
                                                              , 10012732
                                                              , 10012735
                                                              , 10012737
                                                              , 10012748
                                                              , 10012749
                                                              , 10012752
                                                              , 10012763
                                                              , 10012867
                                                              , 10012902
                                                              , 10012904
                                                              , 10012907
                                                              , 10012937
                                                              , 10012942
                                                              , 10012946
                                                              , 10012961
                                                              , 10012982
                                                              , 10012992
                                                              , 10012776
                                                              , 10012796
                                                              , 10012811
                                                              , 10012812
                                                              , 10012824
                                                              , 10012664
                                                              , 10012667
                                                              , 10012672
                                                              , 10012675
                                                              , 10012682
                                                              , 10012684
                                                              , 10012691
                                                              , 10012710
                                                              , 10012830
                                                              , 10012841
                                                              , 10012850
                                                              , 10012738
                                                              , 10012740
                                                              , 10012745
                                                              , 10012747
                                                              , 10012755
                                                              , 10012762
                                                              , 10012768
                                                              , 10012770
                                                              , 10012771
                                                              , 10012881
                                                              , 10012879
                                                              , 10012886
                                                              , 10012921
                                                              , 10012926
                                                              , 10012936
                                                              , 10012938
                                                              , 10012949
                                                              , 10012952
                                                              , 10012955
                                                              , 10012958
                                                              , 10012959
                                                              , 10012985
                                                              , 10012999
                                                              , 10012786
                                                              , 10012793
                                                              , 10012805
                                                              , 10012806
                                                              , 10012813
                                                              , 10012821
                                                              , 10012825
                                                              , 10012647
                                                              , 10012653
                                                              , 10012658
                                                              , 10012669
                                                              , 10012671
                                                              , 10012678
                                                              , 10012683
                                                              , 10012689
                                                              , 10012694
                                                              , 10012703
                                                              , 10012705
                                                              , 10012711
                                                              , 10012715
                                                              , 10012829
                                                              , 10012853
                                                              , 10012722
                                                              , 10012757
                                                              , 10012885
                                                              , 10012899
                                                              , 10012911
                                                              , 10012916
                                                              , 10012917
                                                              , 10012932
                                                              , 10012935
                                                              , 10012939
                                                              , 10012944
                                                              , 10012948
                                                              , 10012950
                                                              , 10012976
                                                              , 10012980
                                                              , 10012981
                                                              , 10012983
                                                              , 10012989
                                                              , 10012994
                                                              , 10012772
                                                              , 10012775
                                                              , 10012779
                                                              , 10012780
                                                              , 10012782
                                                              , 10012783
                                                              , 10012784
                                                              , 10012803
                                                              , 10012807
                                                              , 10012809
                                                              , 10012818
                                                              , 10012819
                                                              , 10012649
                                                              , 10012651
                                                              , 10012654
                                                              , 10012660
                                                              , 10012676
                                                              , 10012695
                                                              , 10012696
                                                              , 10012698
                                                              , 10012717
                                                              , 10012848
                                                              , 10012859
                                                              , 10012731
                                                              , 10012733
                                                              , 10012753
                                                              , 10012758
                                                              , 10012718
                                                              , 10012831
                                                              , 10012843
                                                              , 10012844
                                                              , 10012856
                                                              , 10012858
                                                              , 10012862
                                                              , 10012725
                                                              , 10012728
                                                              , 10012734
                                                              , 10012863
                                                              , 10012876
                                                              , 10012920
                                                              , 10012927
                                                              , 10012962
                                                              , 10012963
                                                              , 10012977
                                                              , 10012998
                                                              , 10012774
                                                              , 10012777
                                                              , 10012791
                                                              , 10012794
                                                              , 10012797
                                                              , 10012808
                                                              , 10012814
                                                              , 10012641
                                                              , 10012643
                                                              , 10012652
                                                              , 10012656
                                                              , 10012666
                                                              , 10012679
                                                              , 10012685
                                                              , 10012687
                                                              , 10012699
                                                              , 10012713
                                                              , 10012716
                                                              , 10012889
                                                              , 10012891
                                                              , 10012900
                                                              , 10012903
                                                              , 10012912
                                                              , 10012925
                                                              , 10012930
                                                              , 10012934
                                                              , 10012941
                                                              , 10012943
                                                              , 10012956
                                                              , 10012971
                                                              , 10012988
                                                              , 9620721
                                                              , 10002408
                                                              , 9736803
                                                              , 10013013
                                                              , 10013004
                                                              , 9591180
                                                              , 9750977
                                                              , 10002403
                                                              , 10013012
                                                              , 10013028
                                                              , 10013027
                                                              , 10009056
                                                              , 10012557
                                                              , 10009039
                                                              , 9591179
                                                              , 10005642
                                                              , 9736078
                                                              , 10012556
                                                              , 9736816
                                                              , 10012552
                                                              , 10013060
                                                              , 10012518
                                                              , 10013066
                                                              , 4150889
                                                              , 10001611
                                                              , 10013005
                                                              , 10012515
                                                              , 10013049
                                                              , 9624755
                                                              , 10012519
                                                              , 9218930
                                                              , 9197002
                                                              , 9193110
                                                              , 9742754
                                                              , 9750974
                                                              , 10013041
                                                              , 9722401
                                                              , 9745132
                                                              , 9745136
                                                              , 9750980
                                                              , 10012559
                                                              , 9742794
                                                              , 9745863
                                                              , 10005593
                                                              , 10012520
                                                              , 10012548
                                                              , 10013016
                                                              , 10012555
                                                              )
                                                        )T2 ON (
                                                        T1.GPV_ID = T2.GPV_ID
                                                ) WHEN MATCHED THEN
                                                        UPDATE
                                                        SET T1.DD_EAH_ID = 3,
                                                                T1.GGE_FECHA_EAH = SYSDATE,
                                                                T1.DD_EAP_ID = 1,
                                                                T1.GGE_FECHA_EAP = NULL,
                                                                T1.GGE_MOTIVO_RECHAZO_PROP = NULL,
                                                                T1.GGE_FECHA_ENVIO_PRPTRIO = NULL,
                                                                T1.USUARIOMODIFICAR = '''||V_USUARIO_MODIFICAR||''',
                                                                T1.FECHAMODIFICAR = SYSDATE';
                        
                        EXECUTE IMMEDIATE V_SQL;
                        
                        V_SQL := 'MERGE INTO REM01.GPV_GASTOS_PROVEEDOR T1 USING
                                                        (SELECT GPV_ID FROM REM01.GPV_GASTOS_PROVEEDOR GPV WHERE GPV_NUM_GASTO_HAYA IN ( 10012788
                                                        , 10012795
                                                        , 10012820
                                                        , 10012828
                                                        , 10012635
                                                        , 10012637
                                                        , 10012644
                                                        , 10012659
                                                        , 10012665
                                                        , 10012709
                                                        , 10012712
                                                        , 10012835
                                                        , 10012838
                                                        , 10012840
                                                        , 10012845
                                                        , 10012857
                                                        , 10012739
                                                        , 10012754
                                                        , 10012756
                                                        , 10012764
                                                        , 10012766
                                                        , 10012872
                                                        , 10012873
                                                        , 10012880
                                                        , 10012884
                                                        , 10012894
                                                        , 10012905
                                                        , 10012933
                                                        , 10012947
                                                        , 10012960
                                                        , 10012967
                                                        , 10012975
                                                        , 10012997
                                                        , 10012773
                                                        , 10012804
                                                        , 10012816
                                                        , 10012642
                                                        , 10012646
                                                        , 10012648
                                                        , 10012674
                                                        , 10012680
                                                        , 10012681
                                                        , 10012686
                                                        , 10012690
                                                        , 10012692
                                                        , 10012697
                                                        , 10012700
                                                        , 10012702
                                                        , 10012708
                                                        , 10012719
                                                        , 10012849
                                                        , 10012855
                                                        , 10012720
                                                        , 10012723
                                                        , 10012730
                                                        , 10012741
                                                        , 10012742
                                                        , 10012744
                                                        , 10012751
                                                        , 10012760
                                                        , 10012865
                                                        , 10012866
                                                        , 10012870
                                                        , 10012871
                                                        , 10012874
                                                        , 10012875
                                                        , 10012882
                                                        , 10012883
                                                        , 10012897
                                                        , 10012898
                                                        , 10012913
                                                        , 10012914
                                                        , 10012923
                                                        , 10012928
                                                        , 10012929
                                                        , 10012953
                                                        , 10012964
                                                        , 10012965
                                                        , 10012968
                                                        , 10012973
                                                        , 10012978
                                                        , 10012979
                                                        , 10012990
                                                        , 10012993
                                                        , 10012789
                                                        , 10012790
                                                        , 10012633
                                                        , 10012634
                                                        , 10012638
                                                        , 10012639
                                                        , 10012640
                                                        , 10012645
                                                        , 10012662
                                                        , 10012663
                                                        , 10012668
                                                        , 10012688
                                                        , 10012693
                                                        , 10012701
                                                        , 10012706
                                                        , 10012707
                                                        , 10012714
                                                        , 10012842
                                                        , 10012861
                                                        , 10012729
                                                        , 10012736
                                                        , 10012743
                                                        , 10012746
                                                        , 10012750
                                                        , 10012769
                                                        , 10012877
                                                        , 10012759
                                                        , 10012761
                                                        , 10012869
                                                        , 10012893
                                                        , 10012901
                                                        , 10012906
                                                        , 10012909
                                                        , 10012910
                                                        , 10012918
                                                        , 10012919
                                                        , 10012922
                                                        , 10012931
                                                        , 10012951
                                                        , 10012970
                                                        , 10012974
                                                        , 10012986
                                                        , 10012987
                                                        , 10012995
                                                        , 10012785
                                                        , 10012800
                                                        , 10012802
                                                        , 10012636
                                                        , 10012650
                                                        , 10012655
                                                        , 10012657
                                                        , 10012661
                                                        , 10012670
                                                        , 10012673
                                                        , 10012677
                                                        , 10012704
                                                        , 10012832
                                                        , 10012839
                                                        , 10012724
                                                        , 10012726
                                                        , 10012727
                                                        , 10012732
                                                        , 10012735
                                                        , 10012737
                                                        , 10012748
                                                        , 10012749
                                                        , 10012752
                                                        , 10012763
                                                        , 10012867
                                                        , 10012902
                                                        , 10012904
                                                        , 10012907
                                                        , 10012937
                                                        , 10012942
                                                        , 10012946
                                                        , 10012961
                                                        , 10012982
                                                        , 10012992
                                                        , 10012776
                                                        , 10012796
                                                        , 10012811
                                                        , 10012812
                                                        , 10012824
                                                        , 10012664
                                                        , 10012667
                                                        , 10012672
                                                        , 10012675
                                                        , 10012682
                                                        , 10012684
                                                        , 10012691
                                                        , 10012710
                                                        , 10012830
                                                        , 10012841
                                                        , 10012850
                                                        , 10012738
                                                        , 10012740
                                                        , 10012745
                                                        , 10012747
                                                        , 10012755
                                                        , 10012762
                                                        , 10012768
                                                        , 10012770
                                                        , 10012771
                                                        , 10012881
                                                        , 10012879
                                                        , 10012886
                                                        , 10012921
                                                        , 10012926
                                                        , 10012936
                                                        , 10012938
                                                        , 10012949
                                                        , 10012952
                                                        , 10012955
                                                        , 10012958
                                                        , 10012959
                                                        , 10012985
                                                        , 10012999
                                                        , 10012786
                                                        , 10012793
                                                        , 10012805
                                                        , 10012806
                                                        , 10012813
                                                        , 10012821
                                                        , 10012825
                                                        , 10012647
                                                        , 10012653
                                                        , 10012658
                                                        , 10012669
                                                        , 10012671
                                                        , 10012678
                                                        , 10012683
                                                        , 10012689
                                                        , 10012694
                                                        , 10012703
                                                        , 10012705
                                                        , 10012711
                                                        , 10012715
                                                        , 10012829
                                                        , 10012853
                                                        , 10012722
                                                        , 10012757
                                                        , 10012885
                                                        , 10012899
                                                        , 10012911
                                                        , 10012916
                                                        , 10012917
                                                        , 10012932
                                                        , 10012935
                                                        , 10012939
                                                        , 10012944
                                                        , 10012948
                                                        , 10012950
                                                        , 10012976
                                                        , 10012980
                                                        , 10012981
                                                        , 10012983
                                                        , 10012989
                                                        , 10012994
                                                        , 10012772
                                                        , 10012775
                                                        , 10012779
                                                        , 10012780
                                                        , 10012782
                                                        , 10012783
                                                        , 10012784
                                                        , 10012803
                                                        , 10012807
                                                        , 10012809
                                                        , 10012818
                                                        , 10012819
                                                        , 10012649
                                                        , 10012651
                                                        , 10012654
                                                        , 10012660
                                                        , 10012676
                                                        , 10012695
                                                        , 10012696
                                                        , 10012698
                                                        , 10012717
                                                        , 10012848
                                                        , 10012859
                                                        , 10012731
                                                        , 10012733
                                                        , 10012753
                                                        , 10012758
                                                        , 10012718
                                                        , 10012831
                                                        , 10012843
                                                        , 10012844
                                                        , 10012856
                                                        , 10012858
                                                        , 10012862
                                                        , 10012725
                                                        , 10012728
                                                        , 10012734
                                                        , 10012863
                                                        , 10012876
                                                        , 10012920
                                                        , 10012927
                                                        , 10012962
                                                        , 10012963
                                                        , 10012977
                                                        , 10012998
                                                        , 10012774
                                                        , 10012777
                                                        , 10012791
                                                        , 10012794
                                                        , 10012797
                                                        , 10012808
                                                        , 10012814
                                                        , 10012641
                                                        , 10012643
                                                        , 10012652
                                                        , 10012656
                                                        , 10012666
                                                        , 10012679
                                                        , 10012685
                                                        , 10012687
                                                        , 10012699
                                                        , 10012713
                                                        , 10012716
                                                        , 10012889
                                                        , 10012891
                                                        , 10012900
                                                        , 10012903
                                                        , 10012912
                                                        , 10012925
                                                        , 10012930
                                                        , 10012934
                                                        , 10012941
                                                        , 10012943
                                                        , 10012956
                                                        , 10012971
                                                        , 10012988
                                                        , 9620721
                                                        , 10002408
                                                        , 9736803
                                                        , 10013013
                                                        , 10013004
                                                        , 9591180
                                                        , 9750977
                                                        , 10002403
                                                        , 10013012
                                                        , 10013028
                                                        , 10013027
                                                        , 10009056
                                                        , 10012557
                                                        , 10009039
                                                        , 9591179
                                                        , 10005642
                                                        , 9736078
                                                        , 10012556
                                                        , 9736816
                                                        , 10012552
                                                        , 10013060
                                                        , 10012518
                                                        , 10013066
                                                        , 4150889
                                                        , 10001611
                                                        , 10013005
                                                        , 10012515
                                                        , 10013049
                                                        , 9624755
                                                        , 10012519
                                                        , 9218930
                                                        , 9197002
                                                        , 9193110
                                                        , 9742754
                                                        , 9750974
                                                        , 10013041
                                                        , 9722401
                                                        , 9745132
                                                        , 9745136
                                                        , 9750980
                                                        , 10012559
                                                        , 9742794
                                                        , 9745863
                                                        , 10005593
                                                        , 10012520
                                                        , 10012548
                                                        , 10013016
                                                        , 10012555
                                                        )
                                                        )T2 ON (
                                                        T1.GPV_ID = T2.GPV_ID
                                                ) WHEN MATCHED THEN
                                                        UPDATE
                                                        SET T1.DD_EGA_ID = 3,
                                                                T1.PRG_ID = NULL,
                                                                T1.USUARIOMODIFICAR = '''||V_USUARIO_MODIFICAR||''',
                                                                T1.FECHAMODIFICAR = SYSDATE';
                                                                
                        EXECUTE IMMEDIATE V_SQL;
                        
    COMMIT;
    
    DBMS_OUTPUT.PUT_LINE('[FIN]: GASTOS REENVIADOS CORRECTAMENTE ');

EXCEPTION
   WHEN OTHERS THEN
      ERR_NUM := SQLCODE;
      ERR_MSG := SQLERRM;
      DBMS_OUTPUT.PUT_LINE('[ERROR] Se ha producido un error en la ejecuci√≥n: '||ERR_MSG);
      ROLLBACK;
      RAISE;
END;


