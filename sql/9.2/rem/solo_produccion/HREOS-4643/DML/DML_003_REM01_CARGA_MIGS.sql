--/*
--##########################################
--## AUTOR=Vicente Martinez
--## FECHA_CREACION=20180112
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.2
--## INCIDENCIA_LINK=HREOS-3625
--## PRODUCTO=NO
--##
--## Finalidad: Migracion Tango
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    
    TABLA_AUXILIAR VARCHAR2(50 CHAR) := 'AUX_ACTIVOS_TRASPASADOS';
    V_CARTERA VARCHAR2(50 CHAR);
    V_SUFIJO VARCHAR2(30 CHAR) := '_CJ'; /*Si el origen es de migracion sareb:   _SR
                                           Si el origen es de migracion cajamar: _CJ
                                           Si el origen es de migracion bankia:  _BK
    */
    
BEGIN

DBMS_OUTPUT.PUT_LINE('[INICIO]: Inicio del proceso');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ACA_CABECERA (ACT_NUMERO_ACTIVO, ACT_NUMERO_UVEM, ACT_NUMERO_PRINEX, ACT_NUMERO_SAREB
    , ENTIDAD_PROPIETARIA, ENTIDAD_ORIGEN, ENTIDAD_ORIGEN_ANTERIOR, ACT_DESCRIPCION, ACT_RATING
    , ACT_DIVISION_HORIZONTAL, ACT_FECHA_REV_CARGAS, ACT_CON_CARGAS, TIPO_ACTIVO, SUBTIPO_ACTIVO, ESTADO_ACTIVO
    , USO_ACTIVO, TIPO_TITULO, SUBTIPO_TITULO, ACT_VPO, ESTADO_ADMISION, ESTADO_GESTION, GESTION_HRE
    , SELLO_CALIDAD, SITUACION_COMERCIAL, VALIDACION)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.ACT_NUMERO_UVEM, NULL, MIG.ACT_NUMERO_SAREB
    , AUX.CODIGO_CARTERA, MIG.ENTIDAD_ORIGEN, MIG.ENTIDAD_ORIGEN_ANTERIOR, MIG.ACT_DESCRIPCION, MIG.ACT_RATING
    , MIG.ACT_DIVISION_HORIZONTAL, MIG.ACT_FECHA_REV_CARGAS, MIG.ACT_CON_CARGAS, MIG.TIPO_ACTIVO, MIG.SUBTIPO_ACTIVO, MIG.ESTADO_ACTIVO
    , MIG.USO_ACTIVO, MIG.TIPO_TITULO, MIG.SUBTIPO_TITULO, MIG.ACT_VPO, MIG.ESTADO_ADMISION, MIG.ESTADO_GESTION, MIG.GESTION_HRE
    , MIG.SELLO_CALIDAD, MIG.SITUACION_COMERCIAL, MIG.VALIDACION
FROM '||V_ESQUEMA||'.MIG_ACA_CABECERA'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ACA_CABECERA');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ADA_DATOS_ADI (ACT_NUMERO_ACTIVO, TIPO_VPO, ADM_SUELO_VPO, ADM_PROMOCION_VPO, ADM_NUM_EXPEDIENTE, ADM_FECHA_CALIFICACION, ADM_OBLIGATORIO_SOL_DEV_AYUDA, ADM_OBLIG_AUT_ADM_VENTA
    , ADM_DESCALIFICADO, ADM_MAX_PRECIO_VENTA, ADM_OBSERVACIONES, SPS_FECHA_REVISION_ESTADO, SPS_FECHA_TOMA_POSESION, SPS_OCUPADO, SPS_CON_TITULO, SPS_ACC_TAPIADO
    , SPS_FECHA_ACC_TAPIADO, SPS_ACC_ANTIOCUPA, SPS_FECHA_ACC_ANTIOCUPA, SPS_RIESGO_OCUPACION, TIPO_TITULO_POSESORIO, SPS_FECHA_TITULO, SPS_FECHA_VENC_TITULO, SPS_RENTA_MENSUAL
    , SPS_FECHA_SOL_DESAHUCIO, SPS_FECHA_LANZAMIENTO, SPS_FECHA_LANZAMIENTO_EFECTIVO, MUNICIPIO_REGISTRO, REG_NUM_REGISTRO, REG_TOMO, REG_LIBRO, REG_FOLIO, REG_NUM_FINCA
    , REG_NUM_DEPARTAMENTO, REG_IDUFIR, REG_HAN_CAMBIADO, MUNICIPIO_REG_ANTERIOR, REG_NUM_ANTERIOR, REG_NUM_FINCA_ANTERIOR, REG_SUPERFICIE, REG_SUPERFICIE_CONSTRUIDA
    , REG_SUPERFICIE_UTIL, REG_SUPERFICIE_ELEM_COMUN, REG_SUPERFICIE_PARCELA, REG_SUPERFICIE_BAJO_RASANTE, REG_SUPERFICIE_SOBRE_RASANTE, REG_DIV_HOR_INSCRITO, ESTADO_DIVISION_HORIZONTAL
    , ESTADO_OBRA_NUEVA, REG_FECHA_CFO, TIPO_UBICACION, TIPO_VIA, LOC_NOMBRE_VIA, LOC_NUMERO_DOMICILIO, LOC_ESCALERA, LOC_PISO, LOC_PUERTA, LOC_COD_POST
    , UNIDAD_INFERIOR_MUNICIPIO, MUNICIPIO, PROVINCIA, PAIS, LOC_LONGITUD, LOC_LATITUD, LOC_DIST_PLAYA, CPR_COD_COM_PROP_UVEM, ACT_LLV_NECESARIAS, ACT_LLV_LLAVES_HRE
    , ACT_LLV_NUM_JUEGOS, ACT_LLV_FECHA_RECEPCION, ACT_IND_CONDICIONADO_OTROS, REG_ID, BIE_DREG_ID, LOC_ID, BIE_LOC_ID, VALIDACION)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.TIPO_VPO, MIG.ADM_SUELO_VPO, MIG.ADM_PROMOCION_VPO, MIG.ADM_NUM_EXPEDIENTE, MIG.ADM_FECHA_CALIFICACION, MIG.ADM_OBLIGATORIO_SOL_DEV_AYUDA, MIG.ADM_OBLIG_AUT_ADM_VENTA
    , MIG.ADM_DESCALIFICADO, MIG.ADM_MAX_PRECIO_VENTA, MIG.ADM_OBSERVACIONES, MIG.SPS_FECHA_REVISION_ESTADO, MIG.SPS_FECHA_TOMA_POSESION, MIG.SPS_OCUPADO, MIG.SPS_CON_TITULO, MIG.SPS_ACC_TAPIADO
    , MIG.SPS_FECHA_ACC_TAPIADO, MIG.SPS_ACC_ANTIOCUPA, MIG.SPS_FECHA_ACC_ANTIOCUPA, MIG.SPS_RIESGO_OCUPACION, MIG.TIPO_TITULO_POSESORIO, MIG.SPS_FECHA_TITULO, MIG.SPS_FECHA_VENC_TITULO, MIG.SPS_RENTA_MENSUAL
    , MIG.SPS_FECHA_SOL_DESAHUCIO, MIG.SPS_FECHA_LANZAMIENTO, MIG.SPS_FECHA_LANZAMIENTO_EFECTIVO, MIG.MUNICIPIO_REGISTRO, MIG.REG_NUM_REGISTRO, MIG.REG_TOMO, MIG.REG_LIBRO, MIG.REG_FOLIO, MIG.REG_NUM_FINCA
    , MIG.REG_NUM_DEPARTAMENTO, MIG.REG_IDUFIR, MIG.REG_HAN_CAMBIADO, MIG.MUNICIPIO_REG_ANTERIOR, MIG.REG_NUM_ANTERIOR, MIG.REG_NUM_FINCA_ANTERIOR, MIG.REG_SUPERFICIE, MIG.REG_SUPERFICIE_CONSTRUIDA
    , MIG.REG_SUPERFICIE_UTIL, MIG.REG_SUPERFICIE_ELEM_COMUN, MIG.REG_SUPERFICIE_PARCELA, MIG.REG_SUPERFICIE_BAJO_RASANTE, MIG.REG_SUPERFICIE_SOBRE_RASANTE, MIG.REG_DIV_HOR_INSCRITO, MIG.ESTADO_DIVISION_HORIZONTAL
    , MIG.ESTADO_OBRA_NUEVA, MIG.REG_FECHA_CFO, MIG.TIPO_UBICACION, MIG.TIPO_VIA, MIG.LOC_NOMBRE_VIA, MIG.LOC_NUMERO_DOMICILIO, MIG.LOC_ESCALERA, MIG.LOC_PISO, MIG.LOC_PUERTA, MIG.LOC_COD_POST
    , MIG.UNIDAD_INFERIOR_MUNICIPIO, MIG.MUNICIPIO, MIG.PROVINCIA, MIG.PAIS, MIG.LOC_LONGITUD, MIG.LOC_LATITUD, MIG.LOC_DIST_PLAYA, MIG.CPR_COD_COM_PROP_UVEM, MIG.ACT_LLV_NECESARIAS, MIG.ACT_LLV_LLAVES_HRE
    , MIG.ACT_LLV_NUM_JUEGOS, MIG.ACT_LLV_FECHA_RECEPCION, MIG.ACT_IND_CONDICIONADO_OTROS, NULL, NULL, NULL, NULL, MIG.VALIDACION
FROM '||V_ESQUEMA||'.MIG_ADA_DATOS_ADI'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ADA_DATOS_ADI');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ATI_TITULO (ACT_NUMERO_ACTIVO, TIT_FECHA_PRESENT_HACIENDA, TIT_FECHA_ENVIO_AUTO, TIT_FECHA_RETIRADA_REG, TIT_FECHA_ENTREGA_GESTORIA, ESTADO_TITULO, TIT_FECHA_PRESENT1_REG
    , VALIDACION, TIT_FECHA_PRESENT2_REG, TIT_FECHA_NOTA_SIMPLE, TIT_FECHA_INSC_REG)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.TIT_FECHA_PRESENT_HACIENDA, MIG.TIT_FECHA_ENVIO_AUTO, MIG.TIT_FECHA_RETIRADA_REG, MIG.TIT_FECHA_ENTREGA_GESTORIA, MIG.ESTADO_TITULO, MIG.TIT_FECHA_PRESENT1_REG
    , MIG.VALIDACION, MIG.TIT_FECHA_PRESENT2_REG, MIG.TIT_FECHA_NOTA_SIMPLE, MIG.TIT_FECHA_INSC_REG
FROM '||V_ESQUEMA||'.MIG_ATI_TITULO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ATI_TITULO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_APL_PLANDINVENTAS (ACT_NUMERO_ACTIVO, VALIDACION, PDV_ACREEDOR_NIF, PDV_ACREEDOR_CODIGO, PDV_TIPO_PRODUCTO_ACTIVO, PDV_IMPORTE_DEUDA, PDV_ACREEDOR_NOMBRE, PDV_ACREEDOR_DIR
    , PDV_ACREEDOR_NUM_EXP)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.VALIDACION, MIG.PDV_ACREEDOR_NIF, MIG.PDV_ACREEDOR_CODIGO, MIG.PDV_TIPO_PRODUCTO_ACTIVO, MIG.PDV_IMPORTE_DEUDA, MIG.PDV_ACREEDOR_NOMBRE, MIG.PDV_ACREEDOR_DIR
    , MIG.PDV_ACREEDOR_NUM_EXP
FROM '||V_ESQUEMA||'.MIG_APL_PLANDINVENTAS'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_APL_PLANDINVENTAS');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ADJ_JUDICIAL(ACT_NUMERO_ACTIVO, ADJ_IMPORTE, JUZGADO, ADJ_PROCURADOR, PLAZA_JUZGADO, VALIDACION, ADJ_FECHA_ADJUDICACION, ESTADO_ADJUDICACION, ADJ_FECHA_SEN_POSESION
    , ADJ_FECHA_DECRETO_FIRME, ADJ_NUM_AUTO, ADJ_LETRADO, ENTIDAD_EJECUTANTE, ADJ_ID_ASUNTO)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.ADJ_IMPORTE, MIG.JUZGADO, MIG.ADJ_PROCURADOR, MIG.PLAZA_JUZGADO, MIG.VALIDACION, MIG.ADJ_FECHA_ADJUDICACION, MIG.ESTADO_ADJUDICACION, MIG.ADJ_FECHA_SEN_POSESION
    , MIG.ADJ_FECHA_DECRETO_FIRME, MIG.ADJ_NUM_AUTO, MIG.ADJ_LETRADO, MIG.ENTIDAD_EJECUTANTE, MIG.ADJ_ID_ASUNTO
FROM '||V_ESQUEMA||'.MIG_ADJ_JUDICIAL'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ADJ_JUDICIAL');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ADJ_NO_JUDICIAL (ACT_NUMERO_ACTIVO, ADN_TRAMITADOR_TITULO, ADN_VALOR_ADQUISICION, ADN_NUM_REFERENCIA, VALIDACION, ADN_FECHA_TITULO, ENTIDAD_EJECUTANTE, ADN_FECHA_FIRMA_TITULO)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.ADN_TRAMITADOR_TITULO, MIG.ADN_VALOR_ADQUISICION, MIG.ADN_NUM_REFERENCIA, MIG.VALIDACION, MIG.ADN_FECHA_TITULO, MIG.ENTIDAD_EJECUTANTE, MIG.ADN_FECHA_FIRMA_TITULO
FROM '||V_ESQUEMA||'.MIG_ADJ_NO_JUDICIAL'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ADJ_NO_JUDICIAL');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_APA_PROP_ACTIVO (ACT_NUMERO_ACTIVO, VALIDACION, PORCENTAJE, PRO_CODIGO_UVEM, GRADO_PROPIEDAD)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.VALIDACION, MIG.PORCENTAJE, MIG.PRO_CODIGO_UVEM, MIG.GRADO_PROPIEDAD
FROM '||V_ESQUEMA||'.MIG_APA_PROP_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_APA_PROP_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ACA_CARGAS_ACTIVO (ACT_NUMERO_ACTIVO, CRG_FECHA_CANCELACION, CRG_ID, CRG_FECHA_CANCEL_REGISTRAL, CRG_FECHA_PRESENTACION, TIPO_CARGA, CRG_DESCRIPCION, SITUACION_CARGA
    , SUBTIPO_CARGA, CRG_TITULAR, BIE_CAR_ID, CRG_IMPORTE_REGISTRAL, CRG_FECHA_INSCRIPCION, CRG_IMPORTE_ECONOMICO, CRG_ORDEN, VALIDACION)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.CRG_FECHA_CANCELACION, MIG.CRG_ID, MIG.CRG_FECHA_CANCEL_REGISTRAL, MIG.CRG_FECHA_PRESENTACION, MIG.TIPO_CARGA, MIG.CRG_DESCRIPCION, MIG.SITUACION_CARGA
    , MIG.SUBTIPO_CARGA, MIG.CRG_TITULAR, MIG.BIE_CAR_ID, MIG.CRG_IMPORTE_REGISTRAL, MIG.CRG_FECHA_INSCRIPCION, MIG.CRG_IMPORTE_ECONOMICO, MIG.CRG_ORDEN, MIG.VALIDACION
FROM '||V_ESQUEMA||'.MIG_ACA_CARGAS_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ACA_CARGAS_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ALA_LLAVES_ACTIVO (ACT_NUMERO_ACTIVO, LLV_MOTIVO_INCOMPLETO, LLV_CODIGO_UVEM, LLV_ARCHIVO1, LLV_COD_CENTRO, LLV_ARCHIVO2, LLV_ID, LLV_ARCHIVO3, LLV_NOMBRE_CENTRO
    , VALIDACION, LLV_COMPLETO)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.LLV_MOTIVO_INCOMPLETO, MIG.LLV_CODIGO_UVEM, MIG.LLV_ARCHIVO1, MIG.LLV_COD_CENTRO, MIG.LLV_ARCHIVO2, NULL, MIG.LLV_ARCHIVO3, MIG.LLV_NOMBRE_CENTRO
    , MIG.VALIDACION, MIG.LLV_COMPLETO
FROM '||V_ESQUEMA||'.MIG_ALA_LLAVES_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ALA_LLAVES_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ATA_TASACIONES_ACTIVO (ACT_NUMERO_ACTIVO, TAS_PORCENTAJE_OBRA, TAS_IMPORTE_VAL_SOLAR, TAS_COSTE_REPO_NETO_ACTUAL, TAS_CODIGO_FIRMA, TAS_IMPORTE_VALOR_TER, TAS_COSTE_REPO_NETO_FINALIZADO
    , TAS_IMPORTE_TAS_FIN, VALIDACION, TAS_IMPORTE_VAL_LEGAL_FINCA, TAS_FECHA_INI_TASACION, TAS_VALOR_REPER_SUELO_CONST, TAS_TIPO_TASACION, TAS_COEF_MERCADO_ESTADO, TAS_ID_TEXTO_ASOCIADO
    , TAS_FECHA_FIN_TASACION, TAS_ID, TAS_IMPORTE_VALOR_TASACION, TAS_INDICE_DEPRE_FUNCIONAL, BIE_VAL_ID, TAS_COSTE_CONST_DEPRE, TAS_NOMBRE_TASADOR, TAS_COEF_MERCADO_ESTADO_HOMO, TAS_COEF_POND_VALOR_ANYADIDO
    , TAS_OBSERVACIONES, TAS_VALOR_VENTA_RAPIDA, TAS_INDICE_TOTAL_DEPRE, TAS_INDICE_DEPRE_FISICA, TAS_F_SOL_TASACION, TAS_COSTE_CONST_CONST, TAS_COSTE_UNI_REPO_NETO, TAS_FECHA_RECEPCION_TASACION
    , TAS_COSTE_REPOSICION, TAS_CODIGO_TASA_UVEM)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.TAS_PORCENTAJE_OBRA, MIG.TAS_IMPORTE_VAL_SOLAR, MIG.TAS_COSTE_REPO_NETO_ACTUAL, MIG.TAS_CODIGO_FIRMA, MIG.TAS_IMPORTE_VALOR_TER, MIG.TAS_COSTE_REPO_NETO_FINALIZADO
    , MIG.TAS_IMPORTE_TAS_FIN, MIG.VALIDACION, MIG.TAS_IMPORTE_VAL_LEGAL_FINCA, MIG.TAS_FECHA_INI_TASACION, MIG.TAS_VALOR_REPER_SUELO_CONST, MIG.TAS_TIPO_TASACION, MIG.TAS_COEF_MERCADO_ESTADO, MIG.TAS_ID_TEXTO_ASOCIADO
    , MIG.TAS_FECHA_FIN_TASACION, MIG.TAS_ID, MIG.TAS_IMPORTE_VALOR_TASACION, MIG.TAS_INDICE_DEPRE_FUNCIONAL, MIG.BIE_VAL_ID, MIG.TAS_COSTE_CONST_DEPRE, MIG.TAS_NOMBRE_TASADOR, MIG.TAS_COEF_MERCADO_ESTADO_HOMO, MIG.TAS_COEF_POND_VALOR_ANYADIDO
    , MIG.TAS_OBSERVACIONES, MIG.TAS_VALOR_VENTA_RAPIDA, MIG.TAS_INDICE_TOTAL_DEPRE, MIG.TAS_INDICE_DEPRE_FISICA, MIG.TAS_F_SOL_TASACION, MIG.TAS_COSTE_CONST_CONST, MIG.TAS_COSTE_UNI_REPO_NETO, MIG.TAS_FECHA_RECEPCION_TASACION
    , MIG.TAS_COSTE_REPOSICION, MIG.TAS_CODIGO_TASA_UVEM
FROM '||V_ESQUEMA||'.MIG_ATA_TASACIONES_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ATA_TASACIONES_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_AIA_INFCOMERCIAL_ACT (ACT_NUMERO_ACTIVO, LCO_USO_ANTERIOR, ICO_JUSTIFICANTE_IMP_VENTA, TIPO_VIVIENDA, LCO_USO_IDONEO, ICO_FECHA_EMISION_INFORME, VIV_NUM_PLANTAS_INTERIOR
    , VIV_REFORMA_SUELO, LCO_MTS_ALTURA_LIBRE, ESTADO_CONSERVACION_EDIFICIO, LCO_DIAFANO, TIPO_RENTA, PVE_CODIGO, ICO_ANYO_REHABILITA_EDIFICIO, EDI_ANO_REHABILITACION, VIV_REFORMA_COCINA
    , APR_FORMA_IRREGULAR, APR_ANCHURA, APR_DESTINO_MOTO, ICO_APTO_PUBLICIDAD, TIPO_INFO_COMERCIAL, EDI_REFORMA_ESCALERA, LCO_MTS_LINEALES_PROF, VIV_REFORMA_OTRO_DESC, ICO_ANO_CONSTRUCCION
    , ESTADO_CONSTRUCCION, VIV_REFORMA_PINTURA, TIPO_ORIENTACION, VIV_REFORMA_CARP_INT, VIV_ULTIMA_PLANTA, TIPO_FACHADA_EDIFICIO, ICO_FECHA_RECEPCION_LLAVES, ICO_FECHA_ACEPTACION, EDI_NUM_ASCENSORES
    , ICO_JUSTIFICANTE_IMP_ALQUILER, LCO_OBSERVACIONES, VIV_REFORMA_PRESUPUESTO, ESTADO_CONSERVACION, ICO_DISTRITO, TIPO_UBICACION_APARCA, LCO_MTS_LUZ_LIBRE, APR_DESTINO_DOBLE, APR_PROFUNDIDAD
    , EDI_ENTORNO_INFRAESTRUCTURA, EDI_DESCRIPCION, VIV_REFORMA_OTRO, UBICACION_ACTIVO, ICO_CONDICIONES_LEGALES, LCO_MTS_FACHADA_PPAL, VIV_DISTRIBUCION_TXT, APR_DESTINO_COCHE, EDI_REFORMA_OTRA_ZONA
    , EDI_REFORMA_ASCENSOR, ICO_FECHA_ULTIMA_VISITA, VIV_REFORMA_CARP_EXT, EDI_ENTORNO_COMUNICACION, VALIDACION, ICO_ANO_REHABILITACION, LCO_MTS_FACHADA_LAT, EDI_REFORMA_OTRO_ZONA_COM_DES, EDI_REFORMA_OTRO
    , EDI_ASCENSOR, EDI_REFORMA_PORTAL, ICO_FECHA_RECHAZO, VIV_REFORMA_INTEGRAL, VIV_REFORMA_BANYO, ICO_DESCRIPCION, EDI_REFORMA_FACHADA, EDI_NUM_PLANTAS, ICO_ACTIVOS_VINC, EDI_REFORMA_CUBIERTA
    , EDI_REFORMA_OTRO_DESC, TIPO_CALIDAD)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.LCO_USO_ANTERIOR, MIG.ICO_JUSTIFICANTE_IMP_VENTA, MIG.TIPO_VIVIENDA, MIG.LCO_USO_IDONEO, MIG.ICO_FECHA_EMISION_INFORME, MIG.VIV_NUM_PLANTAS_INTERIOR
    , MIG.VIV_REFORMA_SUELO, MIG.LCO_MTS_ALTURA_LIBRE, MIG.ESTADO_CONSERVACION_EDIFICIO, MIG.LCO_DIAFANO, MIG.TIPO_RENTA, MIG.PVE_CODIGO, MIG.ICO_ANYO_REHABILITA_EDIFICIO, MIG.EDI_ANO_REHABILITACION, MIG.VIV_REFORMA_COCINA
    , MIG.APR_FORMA_IRREGULAR, MIG.APR_ANCHURA, MIG.APR_DESTINO_MOTO, MIG.ICO_APTO_PUBLICIDAD, MIG.TIPO_INFO_COMERCIAL, MIG.EDI_REFORMA_ESCALERA, MIG.LCO_MTS_LINEALES_PROF, MIG.VIV_REFORMA_OTRO_DESC, MIG.ICO_ANO_CONSTRUCCION
    , MIG.ESTADO_CONSTRUCCION, MIG.VIV_REFORMA_PINTURA, MIG.TIPO_ORIENTACION, MIG.VIV_REFORMA_CARP_INT, MIG.VIV_ULTIMA_PLANTA, MIG.TIPO_FACHADA_EDIFICIO, MIG.ICO_FECHA_RECEPCION_LLAVES, MIG.ICO_FECHA_ACEPTACION, MIG.EDI_NUM_ASCENSORES
    , MIG.ICO_JUSTIFICANTE_IMP_ALQUILER, MIG.LCO_OBSERVACIONES, MIG.VIV_REFORMA_PRESUPUESTO, MIG.ESTADO_CONSERVACION, MIG.ICO_DISTRITO, MIG.TIPO_UBICACION_APARCA, MIG.LCO_MTS_LUZ_LIBRE, MIG.APR_DESTINO_DOBLE, MIG.APR_PROFUNDIDAD
    , MIG.EDI_ENTORNO_INFRAESTRUCTURA, MIG.EDI_DESCRIPCION, MIG.VIV_REFORMA_OTRO, MIG.UBICACION_ACTIVO, MIG.ICO_CONDICIONES_LEGALES, MIG.LCO_MTS_FACHADA_PPAL, MIG.VIV_DISTRIBUCION_TXT, MIG.APR_DESTINO_COCHE, MIG.EDI_REFORMA_OTRA_ZONA
    , MIG.EDI_REFORMA_ASCENSOR, MIG.ICO_FECHA_ULTIMA_VISITA, MIG.VIV_REFORMA_CARP_EXT, MIG.EDI_ENTORNO_COMUNICACION, MIG.VALIDACION, MIG.ICO_ANO_REHABILITACION, MIG.LCO_MTS_FACHADA_LAT, MIG.EDI_REFORMA_OTRO_ZONA_COM_DES, MIG.EDI_REFORMA_OTRO
    , MIG.EDI_ASCENSOR, MIG.EDI_REFORMA_PORTAL, MIG.ICO_FECHA_RECHAZO, MIG.VIV_REFORMA_INTEGRAL, MIG.VIV_REFORMA_BANYO, MIG.ICO_DESCRIPCION, MIG.EDI_REFORMA_FACHADA, MIG.EDI_NUM_PLANTAS, MIG.ICO_ACTIVOS_VINC, MIG.EDI_REFORMA_CUBIERTA
    , MIG.EDI_REFORMA_OTRO_DESC, MIG.TIPO_CALIDAD
FROM '||V_ESQUEMA||'.MIG_AIA_INFCOMERCIAL_ACT'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_AIA_INFCOMERCIAL_ACT');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ACA_CALIDADES_ACTIVO (ACT_NUMERO_ACTIVO, COC_GRIFOS_MONOMANDO, CRE_VTNAS_MADERA, INS_ELECTR_CON_CONTADOR, PRV_PINTURA_LISA_TECHO_EST, CRI_PTA_PASO_MACIZAS, BNY_ALICATADO_AZULEJO
, BNY_COLUMNA_HIDROMASAJE, INS_GAS_CON_CONTADOR, PRV_MOLDURA_ESCAYOLA, INS_AGUA_CALIENTE_GAS_NATURAL, ZCO_CONSERJE_VIGILANCIA, INS_CALEF_CENTRAL, INF_LINEAS_BUS, INF_CENTROS_EDU
, COC_GRIFOS_MONOMANDO_EST, ZCO_PADEL, INF_SALAS_CINE_DESC, INS_ELECTR_BUEN_ESTADO, SOL_PARQUE, CRE_VTNAS_PVC, INF_FACIL_ACCESO_DESC, INS_INST_OTROS, INS_CALEF, INF_UNIVERSIDADES, CRE_DOBLE_CRISTAL
, BNY_GRANITO, INF_COLEGIOS, INF_METRO, INF_CENTROS_SANIT_OTROS, CRE_VTNAS_CORREDERAS, CRI_PTA_ENT_NORMAL, BNY_MARMOL, INF_INSTITUTOS, PRV_PLASTICA_LISA, ZCO_INST_DEP, INF_CLINICAS_DESC
, PRV_MOLDURA_ESCAYOLA_EST, INF_CENTROS_EDU_OTROS, ZCO_JARDINES, CRI_PTA_ENT_ACORAZADA, BNY_BANYERA, PRV_GRIETA_TECHO, CRE_VTNAS_OSCILOBAT, COC_LAVADORA, COC_SUELOS, CRE_VTNAS_ALU_LACADO
, BNY_BANYERA_HIDROMASAJE, INF_TEATROS, CRE_VTNAS_HIERRO, NIVEL_ACABADO_INTERIOR, ZCO_OTROS, SOL_PLAQUETA, PRV_GRIETA_PARED, INF_CENTROS_SANIT, INS_CALEF_RADIADORES_ALU, COC_FRIGORIFICO
, BNY_SUELOS, CRE_VTNAS_ALU_ANODIZADO, INS_AGUA_CALIENTE_CENTRAL, INS_AIRE_FRIO_CALOR, CRE_EST_DOBLE_CRISTAL, INF_CENTROS_COMERC, CRI_PTA_ENT_BLINDADA, COC_AMUEBLADA_EST, CRE_PERS_ALU, SOL_MARMOL
, INF_HOTELES_DESC, INF_UNIVERSIDADES_DESC, PRV_PAPEL_PINTADO, BNY_DUCHA, INS_AGUA_BUEN_ESTADO, CRI_CRP_INT_OTROS, SOL_TARIMA_FLOTANTE, INF_EST_TREN, COC_AMUEBLADA, INF_PARKING_SUP_SUF
, PRV_PARAMENTOS_OTROS, ZCO_ZONA_COMUN_OTROS, CRE_PERS_PLASTICO, INS_AGUA_CON_CONTADOR, COC_ENCI_OTRO_MATERIAL, ZCO_GIMNASIO, ZCO_ZONA_INFANTIL, INF_CENTROS_SALUD, INF_COMUNICACIONES_OTRO
, INF_HOTELES, INF_METRO_DESC, BNY_ENCIMERA, COC_AZULEJOS_EST, INS_GAS, SOL_SOLADO_OTROS, COC_LAVAVAJILLAS, ZCO_PISTA_POLIDEP, BNY_OTRO_MATERIAL, CRE_VTNAS_ABATIBLES, INF_CLINICAS, INF_OCIO_OTROS
, INS_AGUA, INS_ELECTR, BNY_GRIFO_MONOMANDO_EST, BNY_ALICATADO_GRANITO, INS_AIRE_INSTALACION, COC_AZULEJOS, COC_ENCI_GRANITO, INS_CALEF_GAS_NATURAL, INF_TEATROS_DESC, INF_ESCUELAS_INF_DESC
, PRV_PINTURA_LISA_TECHO, INF_SALAS_CINE, VALIDACION, INF_COMUNICACIONES, INS_GAS_INST_BUEN_ESTADO, INF_INST_DEPORT_DESC, PRV_HUMEDAD_TECHO, CRI_PTA_PASO_HUECAS, BNY_DUCHA_BANYERA, INF_HOSPITALES_DESC
, PRV_GOTELE, BNY_BANYO_OTROS, COC_COCINA_OTROS, COC_ENCI_MARMOL, ZCO_TENIS, INS_ELECTR_DEFECTUOSA_ANTIGUA, PRV_HUMEDAD_PARED, COC_VITRO, INF_INST_DEPORT, INF_OCIO, INF_EST_TREN_DESC, BNY_SANITARIOS_EST
, INS_CALEF_PREINSTALACION, COC_MICROONDAS, INF_FACIL_ACCESO, CRI_ARMARIOS_EMPOTRADOS, INS_AIRE_PREINSTALACION, INF_HOSPITALES, ZCO_PISCINA, INF_CENTROS_SALUD_DESC, COC_HORNO, ZCO_ZONAS_COMUNES
, BNY_GRIFO_MONOMANDO, CRE_CRP_EXT_OTROS, INS_AIRE, BNY_SANITARIOS, BNY_ALICATADO_MARMOL, INF_COLEGIOS_DESC, COC_ENCIMERA, INS_AGUA_DEFECTUOSA_ANTIGUA, INF_LINEAS_BUS_DESC, INF_ESCUELAS_INF
, INS_GAS_DEFECTUOSA_ANTIGUA, INF_CENTROS_COMERC_DESC, INF_INSTITUTOS_DESC, CRI_PTA_PASO_LACADAS)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.COC_GRIFOS_MONOMANDO, MIG.CRE_VTNAS_MADERA, MIG.INS_ELECTR_CON_CONTADOR, MIG.PRV_PINTURA_LISA_TECHO_EST, MIG.CRI_PTA_PASO_MACIZAS, MIG.BNY_ALICATADO_AZULEJO
, MIG.BNY_COLUMNA_HIDROMASAJE, MIG.INS_GAS_CON_CONTADOR, MIG.PRV_MOLDURA_ESCAYOLA, MIG.INS_AGUA_CALIENTE_GAS_NATURAL, MIG.ZCO_CONSERJE_VIGILANCIA, MIG.INS_CALEF_CENTRAL, MIG.INF_LINEAS_BUS, MIG.INF_CENTROS_EDU
, MIG.COC_GRIFOS_MONOMANDO_EST, MIG.ZCO_PADEL, MIG.INF_SALAS_CINE_DESC, MIG.INS_ELECTR_BUEN_ESTADO, MIG.SOL_PARQUE, MIG.CRE_VTNAS_PVC, MIG.INF_FACIL_ACCESO_DESC, MIG.INS_INST_OTROS, MIG.INS_CALEF, MIG.INF_UNIVERSIDADES, MIG.CRE_DOBLE_CRISTAL
, MIG.BNY_GRANITO, MIG.INF_COLEGIOS, MIG.INF_METRO, MIG.INF_CENTROS_SANIT_OTROS, MIG.CRE_VTNAS_CORREDERAS, MIG.CRI_PTA_ENT_NORMAL, MIG.BNY_MARMOL, MIG.INF_INSTITUTOS, MIG.PRV_PLASTICA_LISA, MIG.ZCO_INST_DEP, MIG.INF_CLINICAS_DESC
, MIG.PRV_MOLDURA_ESCAYOLA_EST, MIG.INF_CENTROS_EDU_OTROS, MIG.ZCO_JARDINES, MIG.CRI_PTA_ENT_ACORAZADA, MIG.BNY_BANYERA, MIG.PRV_GRIETA_TECHO, MIG.CRE_VTNAS_OSCILOBAT, MIG.COC_LAVADORA, MIG.COC_SUELOS, MIG.CRE_VTNAS_ALU_LACADO
, MIG.BNY_BANYERA_HIDROMASAJE, MIG.INF_TEATROS, MIG.CRE_VTNAS_HIERRO, MIG.NIVEL_ACABADO_INTERIOR, MIG.ZCO_OTROS, MIG.SOL_PLAQUETA, MIG.PRV_GRIETA_PARED, MIG.INF_CENTROS_SANIT, MIG.INS_CALEF_RADIADORES_ALU, MIG.COC_FRIGORIFICO
, MIG.BNY_SUELOS, MIG.CRE_VTNAS_ALU_ANODIZADO, MIG.INS_AGUA_CALIENTE_CENTRAL, MIG.INS_AIRE_FRIO_CALOR, MIG.CRE_EST_DOBLE_CRISTAL, MIG.INF_CENTROS_COMERC, MIG.CRI_PTA_ENT_BLINDADA, MIG.COC_AMUEBLADA_EST, MIG.CRE_PERS_ALU, MIG.SOL_MARMOL
, MIG.INF_HOTELES_DESC, MIG.INF_UNIVERSIDADES_DESC, MIG.PRV_PAPEL_PINTADO, MIG.BNY_DUCHA, MIG.INS_AGUA_BUEN_ESTADO, MIG.CRI_CRP_INT_OTROS, MIG.SOL_TARIMA_FLOTANTE, MIG.INF_EST_TREN, MIG.COC_AMUEBLADA, MIG.INF_PARKING_SUP_SUF
, MIG.PRV_PARAMENTOS_OTROS, MIG.ZCO_ZONA_COMUN_OTROS, MIG.CRE_PERS_PLASTICO, MIG.INS_AGUA_CON_CONTADOR, MIG.COC_ENCI_OTRO_MATERIAL, MIG.ZCO_GIMNASIO, MIG.ZCO_ZONA_INFANTIL, MIG.INF_CENTROS_SALUD, MIG.INF_COMUNICACIONES_OTRO
, MIG.INF_HOTELES, MIG.INF_METRO_DESC, MIG.BNY_ENCIMERA, MIG.COC_AZULEJOS_EST, MIG.INS_GAS, MIG.SOL_SOLADO_OTROS, MIG.COC_LAVAVAJILLAS, MIG.ZCO_PISTA_POLIDEP, MIG.BNY_OTRO_MATERIAL, MIG.CRE_VTNAS_ABATIBLES, MIG.INF_CLINICAS, MIG.INF_OCIO_OTROS
, MIG.INS_AGUA, MIG.INS_ELECTR, MIG.BNY_GRIFO_MONOMANDO_EST, MIG.BNY_ALICATADO_GRANITO, MIG.INS_AIRE_INSTALACION, MIG.COC_AZULEJOS, MIG.COC_ENCI_GRANITO, MIG.INS_CALEF_GAS_NATURAL, MIG.INF_TEATROS_DESC, MIG.INF_ESCUELAS_INF_DESC
, MIG.PRV_PINTURA_LISA_TECHO, MIG.INF_SALAS_CINE, MIG.VALIDACION, MIG.INF_COMUNICACIONES, MIG.INS_GAS_INST_BUEN_ESTADO, MIG.INF_INST_DEPORT_DESC, MIG.PRV_HUMEDAD_TECHO, MIG.CRI_PTA_PASO_HUECAS, MIG.BNY_DUCHA_BANYERA, MIG.INF_HOSPITALES_DESC
, MIG.PRV_GOTELE, MIG.BNY_BANYO_OTROS, MIG.COC_COCINA_OTROS, MIG.COC_ENCI_MARMOL, MIG.ZCO_TENIS, MIG.INS_ELECTR_DEFECTUOSA_ANTIGUA, MIG.PRV_HUMEDAD_PARED, MIG.COC_VITRO, MIG.INF_INST_DEPORT, MIG.INF_OCIO, MIG.INF_EST_TREN_DESC, MIG.BNY_SANITARIOS_EST
, MIG.INS_CALEF_PREINSTALACION, MIG.COC_MICROONDAS, MIG.INF_FACIL_ACCESO, MIG.CRI_ARMARIOS_EMPOTRADOS, MIG.INS_AIRE_PREINSTALACION, MIG.INF_HOSPITALES, MIG.ZCO_PISCINA, MIG.INF_CENTROS_SALUD_DESC, MIG.COC_HORNO, MIG.ZCO_ZONAS_COMUNES
, MIG.BNY_GRIFO_MONOMANDO, MIG.CRE_CRP_EXT_OTROS, MIG.INS_AIRE, MIG.BNY_SANITARIOS, MIG.BNY_ALICATADO_MARMOL, MIG.INF_COLEGIOS_DESC, MIG.COC_ENCIMERA, MIG.INS_AGUA_DEFECTUOSA_ANTIGUA, MIG.INF_LINEAS_BUS_DESC, MIG.INF_ESCUELAS_INF
, MIG.INS_GAS_DEFECTUOSA_ANTIGUA, MIG.INF_CENTROS_COMERC_DESC, MIG.INF_INSTITUTOS_DESC, MIG.CRI_PTA_PASO_LACADAS
FROM '||V_ESQUEMA||'.MIG_ACA_CALIDADES_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ACA_CALIDADES_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_APC_PRECIO (ACT_NUMERO_ACTIVO, VAL_FECHA_FIN, VALIDACION, TIPO_PRECIO, VAL_IMPORTE, VAL_FECHA_INICIO)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.VAL_FECHA_FIN, MIG.VALIDACION, MIG.TIPO_PRECIO, MIG.VAL_IMPORTE, MIG.VAL_FECHA_INICIO
FROM '||V_ESQUEMA||'.MIG_APC_PRECIO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_APC_PRECIO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ACA_CATASTRO_ACTIVO (ACT_NUMERO_ACTIVO, CAT_FECHA_REV_VALOR_CATASTRAL, CAT_REF_CATASTRAL, CAT_POLIGONO, CAT_PARCELA, CAT_SUPERFICIE_PARCELA, CAT_TITULAR_CATASTRAL
    , CAT_SUPERFICIE_UTIL, CAT_SUPERFICIE_REPER_COMUN, CAT_IND_INTERFAZ_BANKIA, CAT_VALOR_CATASTRAL_CONST, CAT_VALOR_CATASTRAL_SUELO, CAT_SUPERFICIE_CONSTRUIDA, CAT_SUPERFICIE_SUELO, VALIDACION)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.CAT_FECHA_REV_VALOR_CATASTRAL, MIG.CAT_REF_CATASTRAL, MIG.CAT_POLIGONO, MIG.CAT_PARCELA, MIG.CAT_SUPERFICIE_PARCELA, MIG.CAT_TITULAR_CATASTRAL
    , MIG.CAT_SUPERFICIE_UTIL, MIG.CAT_SUPERFICIE_REPER_COMUN, MIG.CAT_IND_INTERFAZ_BANKIA, MIG.CAT_VALOR_CATASTRAL_CONST, MIG.CAT_VALOR_CATASTRAL_SUELO, MIG.CAT_SUPERFICIE_CONSTRUIDA, MIG.CAT_SUPERFICIE_SUELO, MIG.VALIDACION
FROM '||V_ESQUEMA||'.MIG_ACA_CATASTRO_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ACA_CATASTRO_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_AID_INFCOMERCIAL_DISTR (ACT_NUMERO_ACTIVO, DIS_CANTIDAD, TIPO_HABITACULO, VALIDACION, DIS_SUPERFICIE, DIS_NUM_PLANTA)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.DIS_CANTIDAD, MIG.TIPO_HABITACULO, MIG.VALIDACION, MIG.DIS_SUPERFICIE, MIG.DIS_NUM_PLANTA
FROM '||V_ESQUEMA||'.MIG_AID_INFCOMERCIAL_DISTR'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_AID_INFCOMERCIAL_DISTR');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_AML_MOVIMIENTOS_LLAVE (MLV_CODIGO_MOVI_UVEM, MLV_FECHA_DEVOLUCION, MLV_COD_TENEDOR, LLV_CODIGO_UVEM, VALIDACION, MLV_FECHA_ENTREGA, MLV_NOM_TENEDOR, MLV_TIPO_TENEDOR)
SELECT MIG.MLV_CODIGO_MOVI_UVEM, MIG.MLV_FECHA_DEVOLUCION, MIG.MLV_COD_TENEDOR, MIG.LLV_CODIGO_UVEM, MIG.VALIDACION, MIG.MLV_FECHA_ENTREGA, MIG.MLV_NOM_TENEDOR, MIG.MLV_TIPO_TENEDOR
FROM '||V_ESQUEMA||'.MIG_AML_MOVIMIENTOS_LLAVE'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.MIG_ALA_LLAVES_ACTIVO ALA ON ALA.LLV_CODIGO_UVEM = MIG.LLV_CODIGO_UVEM'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_AML_MOVIMIENTOS_LLAVE');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_APC_PROP_CABECERA (PRO_CODIGO_UVEM, LOCALIDAD_PROPIETARIO, PRO_PAGA_EJECUTANTE, PRO_CONTACTO_EMAIL, PRO_CONTACTO_NOM, PROVINCIA_CONTACTO, LOCALIDAD_CONTACTO
    , PRO_CONTACTO_TELF2, PRO_TELF, PROVINCIA_PROPIETARIO, PRO_CONTACTO_CP, PRO_APELLIDO1, PRO_APELLIDO2, PRO_DIR, PRO_OBSERVACIONES, VALIDACION, PRO_CP, PRO_NOMBRE, TIPO_DOCUMENTO
    , PRO_CONTACTO_TELF1, PRO_CONTACTO_DIR, PRO_NIF, PRO_EMAIL, TIPO_PERSONA, PRO_COD_CARTERA)
SELECT MIG.PRO_CODIGO_UVEM, MIG.LOCALIDAD_PROPIETARIO, MIG.PRO_PAGA_EJECUTANTE, MIG.PRO_CONTACTO_EMAIL, MIG.PRO_CONTACTO_NOM, MIG.PROVINCIA_CONTACTO, MIG.LOCALIDAD_CONTACTO
    , MIG.PRO_CONTACTO_TELF2, MIG.PRO_TELF, MIG.PROVINCIA_PROPIETARIO, MIG.PRO_CONTACTO_CP, MIG.PRO_APELLIDO1, MIG.PRO_APELLIDO2, MIG.PRO_DIR, MIG.PRO_OBSERVACIONES, MIG.VALIDACION, MIG.PRO_CP, MIG.PRO_NOMBRE, MIG.TIPO_DOCUMENTO
    , MIG.PRO_CONTACTO_TELF1, MIG.PRO_CONTACTO_DIR, MIG.PRO_NIF, MIG.PRO_EMAIL, MIG.TIPO_PERSONA, MIG.PRO_COD_CARTERA
FROM '||V_ESQUEMA||'.MIG_APC_PROP_CABECERA'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.MIG_APA_PROP_ACTIVO APA ON MIG.PRO_CODIGO_UVEM = APA.PRO_CODIGO_UVEM'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_APC_PROP_CABECERA');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_ADD_ADMISION_DOC (ACT_NUMERO_ACTIVO, ADO_FECHA_VERIFICACION, ADO_FECHA_CADUCIDAD, TIPO_DOCUMENTO, ADO_CALIFICACION, VALIDACION, ADO_NUM_DOCUMENTO, ADO_FECHA_ETIQUETA, ADO_APLICA
    , ADO_FECHA_OBTENCION, ADO_FECHA_CALIFICACION, ESTADO_DOCUMENTO, ADO_FECHA_EMISION, ADO_FECHA_SOLICITUD)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.ADO_FECHA_VERIFICACION, MIG.ADO_FECHA_CADUCIDAD, MIG.TIPO_DOCUMENTO, MIG.ADO_CALIFICACION, MIG.VALIDACION, MIG.ADO_NUM_DOCUMENTO, MIG.ADO_FECHA_ETIQUETA, MIG.ADO_APLICA
    , MIG.ADO_FECHA_OBTENCION, MIG.ADO_FECHA_CALIFICACION, MIG.ESTADO_DOCUMENTO, MIG.ADO_FECHA_EMISION, MIG.ADO_FECHA_SOLICITUD
FROM '||V_ESQUEMA||'.MIG_ADD_ADMISION_DOC'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_ADD_ADMISION_DOC');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_ACT_ACTIVO (ACT_NUMERO_ACTIVO, ACT_FECHA_VENTA, ACT_COD_TIPO_ALQUILER, ACT_COD_PROPIETARIO_UVEM_ANT, ACT_FECHA_IND_PRECIAR, ACT_COD_TIPO_PUBLICACION
    , ACT_COD_SUBCARTERA_ANTERIOR, ACT_COD_ESTADO_PUBLICACION, ACT_FECHA_IND_DESCUENTO, ACT_NUMERO_INMOVILIZADO, FECHA_CALIDAD, GESTOR_CALIDAD, VALIDACION, ACT_CODIGO_ENTRADA
    , ACT_COD_SUBCARTERA, ACT_COD_CARTERA, ACT_FECHA_IND_REPRECIAR, ACT_COD_TIPO_COMERCIALIZACION, ACT_IMPORTE_VENTA, ACT_BLOQUEO_PRECIO_FECHA_INI, ACT_BLOQUEO_PRECIO_USU_ID, SELLO_CALIDAD)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.ACT_FECHA_VENTA, MIG.ACT_COD_TIPO_ALQUILER, MIG.ACT_COD_PROPIETARIO_UVEM_ANT, MIG.ACT_FECHA_IND_PRECIAR, MIG.ACT_COD_TIPO_PUBLICACION
    , MIG.ACT_COD_SUBCARTERA_ANTERIOR, MIG.ACT_COD_ESTADO_PUBLICACION, MIG.ACT_FECHA_IND_DESCUENTO, MIG.ACT_NUMERO_INMOVILIZADO, MIG.FECHA_CALIDAD, MIG.GESTOR_CALIDAD, MIG.VALIDACION, MIG.ACT_CODIGO_ENTRADA
    , AUX.CODIGO_SUBCARTERA, AUX.CODIGO_CARTERA, MIG.ACT_FECHA_IND_REPRECIAR, MIG.ACT_COD_TIPO_COMERCIALIZACION, MIG.ACT_IMPORTE_VENTA, MIG.ACT_BLOQUEO_PRECIO_FECHA_INI, MIG.ACT_BLOQUEO_PRECIO_USU_ID, MIG.SELLO_CALIDAD
FROM '||V_ESQUEMA||'.MIG2_ACT_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_ACT_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_ACT_PRP (ACT_PRP_ACT_NUMERO_ACTIVO, ACT_PRP_MOTIVO_DESCARTE, VALIDACION, ACT_PRP_NUM_PROPUESTA, ACT_PRP_PRECIO_PROPUESTO, ACT_PRP_VALOR_LIQUIDATIVO, ACT_PRP_PRECIO_SANCIONADO)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.ACT_PRP_MOTIVO_DESCARTE, MIG.VALIDACION, MIG.ACT_PRP_NUM_PROPUESTA, MIG.ACT_PRP_PRECIO_PROPUESTO, MIG.ACT_PRP_VALOR_LIQUIDATIVO, MIG.ACT_PRP_PRECIO_SANCIONADO
FROM '||V_ESQUEMA||'.MIG2_ACT_PRP'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_PRP_ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_ACT_PRP'); 

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_ACT_HEP_HIST_EST_PUBLI (HEP_ACT_NUMERO_ACTIVO, HEP_MOTIVO, HEP_COD_TIPO_PUBLICACION, HEP_COD_ESTADO_PUBLI, HEP_FECHA_HASTA, HEP_COD_PORTAL, VALIDACION, HEP_FECHA_DESDE)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, HEP_MOTIVO, HEP_COD_TIPO_PUBLICACION, HEP_COD_ESTADO_PUBLI, HEP_FECHA_HASTA, HEP_COD_PORTAL, VALIDACION, HEP_FECHA_DESDE
FROM '||V_ESQUEMA||'.MIG2_ACT_HEP_HIST_EST_PUBLI'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.HEP_ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_ACT_HEP_HIST_EST_PUBLI'); 

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_PAC_PERIMETRO_ACTIVO (PAC_NUMERO_ACTIVO, PAC_FECHA_TRA_ADMISION, PAC_COD_MOTIVO_NOCOMERCIAL, PAC_MOTIVO_GESTIONAR, PAC_FECHA_ASIGNAR_MEDIADOR, PAC_IND_CHECK_GESTIONAR, PAC_IND_INCLUIDO
    , PAC_MOTIVO_FORMALIZAR, PAC_IND_CHECK_FORMALIZAR, PAC_IND_CHECK_TRA_ADMISION, PAC_MOTIVO_TRA_ADMISION, VALIDACION, PAC_FECHA_COMERCIALIZAR, PAC_IND_CHECK_ASIG_MEDIA, PAC_FECHA_FORMALIZAR
    , PAC_COD_MOTIVO_COMERCIAL, PAC_FECHA_GESTIONAR, PAC_IND_CHECK_COMERCIALIZAR, PAC_MOTIVO_ASIGNAR_MEDIADOR)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.PAC_FECHA_TRA_ADMISION, MIG.PAC_COD_MOTIVO_NOCOMERCIAL, MIG.PAC_MOTIVO_GESTIONAR, MIG.PAC_FECHA_ASIGNAR_MEDIADOR, MIG.PAC_IND_CHECK_GESTIONAR, MIG.PAC_IND_INCLUIDO
    , MIG.PAC_MOTIVO_FORMALIZAR, MIG.PAC_IND_CHECK_FORMALIZAR, MIG.PAC_IND_CHECK_TRA_ADMISION, MIG.PAC_MOTIVO_TRA_ADMISION, MIG.VALIDACION, MIG.PAC_FECHA_COMERCIALIZAR, MIG.PAC_IND_CHECK_ASIG_MEDIA, MIG.PAC_FECHA_FORMALIZAR
    , MIG.PAC_COD_MOTIVO_COMERCIAL, MIG.PAC_FECHA_GESTIONAR, MIG.PAC_IND_CHECK_COMERCIALIZAR, MIG.PAC_MOTIVO_ASIGNAR_MEDIADOR
FROM '||V_ESQUEMA||'.MIG2_PAC_PERIMETRO_ACTIVO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.PAC_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_PAC_PERIMETRO_ACTIVO');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_PRP_PROPUESTAS_PRECIOS (PRP_NUM_PROPUESTA, PRP_OBSERVACIONES, PRP_FECHA_ENVIO, PRP_COD_USUARIO, PRP_FECHA_SANCION, PRP_COD_TIPO_PRP, VALIDACION, PRP_FECHA_EMISION
    , PRP_IND_PROP_MANUAL, PRP_COD_ESTADO_PRP, PRP_NOMBRE_PROPUESTA, PRP_FECHA_CARGA, PRP_COD_CARTERA)
SELECT MIG.PRP_NUM_PROPUESTA, MIG.PRP_OBSERVACIONES, MIG.PRP_FECHA_ENVIO, MIG.PRP_COD_USUARIO, MIG.PRP_FECHA_SANCION, MIG.PRP_COD_TIPO_PRP, MIG.VALIDACION, MIG.PRP_FECHA_EMISION
    , MIG.PRP_IND_PROP_MANUAL, MIG.PRP_COD_ESTADO_PRP, MIG.PRP_NOMBRE_PROPUESTA, MIG.PRP_FECHA_CARGA, MIG.PRP_COD_CARTERA
FROM '||V_ESQUEMA||'.MIG2_PRP_PROPUESTAS_PRECIOS'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.MIG2_ACT_PRP PRP ON PRP.ACT_PRP_NUM_PROPUESTA = MIG.PRP_NUM_PROPUESTA'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_PRP_PROPUESTAS_PRECIOS');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_ACT_HVA_HIST_VALORACIONES (HVA_ACT_NUMERO_ACTIVO, HVA_COD_USUARIO, HVA_FECHA_FIN, HVA_IMPORTE, HVA_FECHA_CARGA, HVA_FECHA_APROBACION, HVA_COD_TIPO_PRECIO
    , HVA_OBSERVACIONES, HVA_FECHA_INICIO, VALIDACION)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.HVA_COD_USUARIO, MIG.HVA_FECHA_FIN, MIG.HVA_IMPORTE, MIG.HVA_FECHA_CARGA, MIG.HVA_FECHA_APROBACION, MIG.HVA_COD_TIPO_PRECIO
    , MIG.HVA_OBSERVACIONES, MIG.HVA_FECHA_INICIO, MIG.VALIDACION
FROM '||V_ESQUEMA||'.MIG2_ACT_HVA_HIST_VALORACIO'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.HVA_ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_ACT_HVA_HIST_VALORACIONES');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_PRH_PROP_HIST (PRH_NUMERO_ACTIVO, PRH_FECHA_INICIO_PROMOTOR, PRH_PROPITARIO_CODIGO_UVEM, PRH_FECHA_FIN_PROMOTOR, VALIDACION)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.PRH_FECHA_INICIO_PROMOTOR, MIG.PRH_PROPITARIO_CODIGO_UVEM, MIG.PRH_FECHA_FIN_PROMOTOR, MIG.VALIDACION
FROM '||V_ESQUEMA||'.MIG2_PRH_PROP_HIST'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.PRH_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_PRH_PROP_HIST');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG2_GEA_GESTORES_ACTIVOS (GEA_NUMERO_ACTIVO, VALIDACION, GEA_TIPO_GESTOR, GEE_ID, GEA_GESTOR_ACTIVO, GEH_ID)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.VALIDACION, MIG.GEA_TIPO_GESTOR, MIG.GEE_ID, MIG.GEA_GESTOR_ACTIVO, MIG.GEH_ID
FROM '||V_ESQUEMA||'.MIG2_GEA_GESTORES_ACTIVOS'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.GEA_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG2_GEA_GESTORES_ACTIVOS');

EXECUTE IMMEDIATE 'INSERT INTO '||V_ESQUEMA||'.MIG_AOA_OBSERVACIONES_ACTIVOS (ACT_NUMERO_ACTIVO, USERNAME, AOB_OBSERVACION, AOB_FECHA, AOB_TIPO_OBSERVACION, VALIDACION)
SELECT AUX.ACT_NUM_ACTIVO_NUEVO, MIG.USERNAME, MIG.AOB_OBSERVACION, MIG.AOB_FECHA, MIG.AOB_TIPO_OBSERVACION, MIG.VALIDACION
FROM '||V_ESQUEMA||'.MIG_AOA_OBSERVACIONES_ACTIV'||V_SUFIJO||' MIG
JOIN '||V_ESQUEMA||'.'||TABLA_AUXILIAR||' AUX ON AUX.ACT_NUM_ACTIVO_VIEJO = MIG.ACT_NUMERO_ACTIVO'; 

  DBMS_OUTPUT.PUT_LINE('[MIG]: '||SQL%ROWCOUNT||' registros insertados en la tabla MIG_AOA_OBSERVACIONES_ACTIVOS');

DBMS_OUTPUT.PUT_LINE('[FIN]');

COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        err_num := SQLCODE;
        err_msg := SQLERRM;
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);
        DBMS_OUTPUT.put_line(V_MSQL);
        ROLLBACK;
        RAISE;          
END;
/
EXIT;
