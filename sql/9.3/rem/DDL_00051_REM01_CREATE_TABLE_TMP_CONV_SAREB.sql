--/*
--#########################################
--## AUTOR=Daniel Algaba
--## FECHA_CREACION=20200630
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=HREOS-10462
--## PRODUCTO=NO
--## 
--## Finalidad: Creación de tabla temporal para el proceso de convivencia de Sareb
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
----*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE

	V_MSQL VARCHAR2(32000 CHAR); 
	V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; 
	V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#';
	V_SQL VARCHAR2(4000 CHAR);
	V_NUM NUMBER(16);
	ERR_NUM NUMBER(25);  
	ERR_MSG VARCHAR2(1024 CHAR); 
	V_TABLA VARCHAR2(50 CHAR):= 'TMP_CONV_SAREB';


BEGIN	

	DBMS_OUTPUT.PUT_LINE('[INFO] INICIO DEL PROCESO.');
	
	V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA||''' AND OWNER = '''||V_ESQUEMA||'''';
	EXECUTE IMMEDIATE V_MSQL INTO V_NUM;
	
	IF V_NUM = 1 THEN
	
		DBMS_OUTPUT.PUT_LINE('[INFO] LA TABLA '''||V_TABLA||''' YA EXISTE.');
		V_MSQL := 'DROP TABLE '||V_ESQUEMA||'.'||V_TABLA||'';
		EXECUTE IMMEDIATE V_MSQL;
		
	END IF;	

	EXECUTE IMMEDIATE '
	CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA||' (
		ACT_NUM_ACTIVO 			VARCHAR2(250 CHAR)
		, ACT_NUM_ACTIVO_SAREB	VARCHAR2(250 CHAR)
		, TIPO_ACTIVO	VARCHAR2(250 CHAR)
		, SUBTIPO_ACTIVO	VARCHAR2(250 CHAR)
		, USO_DOMINANTE	VARCHAR2(250 CHAR)
		, ALQUILADO	VARCHAR2(250 CHAR)
		, OKUPADO	VARCHAR2(250 CHAR)
		, ESTADO_FISICO	VARCHAR2(250 CHAR)
		, RIESGO_OCUPACION	VARCHAR2(250 CHAR)
		, PUERTA_ANTIOKUPA	VARCHAR2(250 CHAR)
		, VIGILANCIA	VARCHAR2(250 CHAR)
		, ASCENSOR	VARCHAR2(250 CHAR)
		, ESTADO_INSCRIPCION	VARCHAR2(250 CHAR)
		, FECHA_INSCRIPCION	VARCHAR2(250 CHAR)
		, TIPO_TITULO	VARCHAR2(250 CHAR)
		, SUBTIPO_TITULO	VARCHAR2(250 CHAR)
		, FECHA_TOMA_POS	VARCHAR2(250 CHAR)
		, PORCENTAJE_PROPIEDAD	VARCHAR2(250 CHAR)
		, GRADO_PROPIEDAD	VARCHAR2(250 CHAR)
		, VPO	VARCHAR2(250 CHAR)
		, FECHA_SENY_LANZAMIENTO	VARCHAR2(250 CHAR)
		, PROPIETARIO	VARCHAR2(250 CHAR)
		, CON_CARGAS	VARCHAR2(250 CHAR)
		, ID_CARGA	VARCHAR2(250 CHAR)
		, TIPO_CARGA	VARCHAR2(250 CHAR)
		, SUBTIPO_CARGA	VARCHAR2(250 CHAR)
		, TITULAR_CARGA	VARCHAR2(250 CHAR)
		, IMPORTE_REGISTRAL	VARCHAR2(250 CHAR)
		, ESTADO_REGISTRAL	VARCHAR2(250 CHAR)
		, ESTADO_ECONOMICO	VARCHAR2(250 CHAR)
		, FECHA_CAN_CRG_ECO	VARCHAR2(250 CHAR)
		, FECHA_PRES_CAN	VARCHAR2(250 CHAR)
		, FECHA_CAN_REG	VARCHAR2(250 CHAR)
		, TIPO_VIA	VARCHAR2(250 CHAR)
		, NOMBRE_VIA	VARCHAR2(250 CHAR)
		, NUMERO	VARCHAR2(250 CHAR)
		, ESCALERA	VARCHAR2(250 CHAR)
		, PLANTA	VARCHAR2(250 CHAR)
		, PUERTA	VARCHAR2(250 CHAR)
		, PROVINCIA	VARCHAR2(250 CHAR)
		, MUNICIPIO	VARCHAR2(250 CHAR)
		, COM_AUTONOMA	VARCHAR2(250 CHAR)
		, PAIS	VARCHAR2(250 CHAR)
		, CODIGO_POSTAL	VARCHAR2(250 CHAR)
		, LATITUD	VARCHAR2(250 CHAR)
		, LONGITUD	VARCHAR2(250 CHAR)
		, DIV_HOR_NO_INSCRITA	VARCHAR2(250 CHAR)
		, PRV_REGISTRO	VARCHAR2(250 CHAR)
		, POB_REGISTRO	VARCHAR2(250 CHAR)
		, NUM_REGISTRO	VARCHAR2(250 CHAR)
		, TOMO	VARCHAR2(250 CHAR)
		, LIBRO	VARCHAR2(250 CHAR)
		, FOLIO	VARCHAR2(250 CHAR)
		, FINCA	VARCHAR2(250 CHAR)
		, IDUFIR	VARCHAR2(250 CHAR)
		, REFERENCIA_CATASTRAL	VARCHAR2(250 CHAR)
		, SUPERFICIE_CONSTRUIDA	VARCHAR2(250 CHAR)
		, SUPERFICIE_UTIL	VARCHAR2(250 CHAR)
		, SUPERFICIE_PARCELA	VARCHAR2(250 CHAR)
		, BOLETIN_AGUA	VARCHAR2(250 CHAR)
		, BOLETIN_ELECTRICIDAD	VARCHAR2(250 CHAR)
		, BOLETIN_GAS	VARCHAR2(250 CHAR)
		, CEDULA_HABITABILIDAD	VARCHAR2(250 CHAR)
		, FECHA_OBT_CED_HABITABILIDAD	VARCHAR2(250 CHAR)
		, CERTIFICADO_ENERGETICO	VARCHAR2(250 CHAR)
		, INFORME0	VARCHAR2(250 CHAR)
		, DEST_COMERCIAL_OBJ	VARCHAR2(250 CHAR)
		, ESTADO_COMERCIAL	VARCHAR2(250 CHAR)
		, CFO	VARCHAR2(250 CHAR)
		, FECHA_CFO	VARCHAR2(250 CHAR)
		, LPO	VARCHAR2(250 CHAR)
		, FECHA_LPO	VARCHAR2(250 CHAR)
		, TAPIADO	VARCHAR2(250 CHAR)
		, ESTADO_ADECUACION	VARCHAR2(250 CHAR)
		, PRECIO_VENTA_WEB	VARCHAR2(250 CHAR)
		, PRECIO_RENTA_WEB	VARCHAR2(250 CHAR)	
		, PRECIO_MIN_AUT_VENTA	VARCHAR2(250 CHAR)	
		, TASACION	VARCHAR2(250 CHAR)
		, FECHA_TASACION	VARCHAR2(250 CHAR)
		, FECHA_SOL_TASACION	VARCHAR2(250 CHAR)
		, FECHA_RECEP_TASACION	VARCHAR2(250 CHAR)
		, TECNICO_TASADORA_ASOC	VARCHAR2(250 CHAR)
		, IMPORTE_TASACION_FIN	VARCHAR2(250 CHAR)
		, TIPO_TASACION	VARCHAR2(250 CHAR)
		, PRECIO_VISIBLE_VENTA	VARCHAR2(250 CHAR)
		, FECHA_INI_VIG_PRECIO_VENTA	VARCHAR2(250 CHAR)
		, FECHA_FIN_VIG_PRECIO_VENTA	VARCHAR2(250 CHAR)
		, PRECIO_VISIBLE_RENTA	VARCHAR2(250 CHAR)
		, FECHA_INI_VIG_PRECIO_RENTA	VARCHAR2(250 CHAR)
		, FECHA_FIN_VIG_PRECIO_RENTA	VARCHAR2(250 CHAR)
		, UNIDAD_ALQUILABLE	VARCHAR2(250 CHAR)
		, ID_ACTIVO_PADRE	VARCHAR2(250 CHAR)
		, ADECUACION_ALQ	VARCHAR2(250 CHAR)
		, FECHA_PREV_FIN_ADECUACION_ALQ	VARCHAR2(250 CHAR)
		, NUM_RESERVA	VARCHAR2(250 CHAR)
		, FECHA_CONT_RESERVA	VARCHAR2(250 CHAR)
		, CARTERA	VARCHAR2(250 CHAR)
		, SUBCARTERA	VARCHAR2(250 CHAR)
		, RUINA	VARCHAR2(250 CHAR)
		, VANDALIZADO	VARCHAR2(250 CHAR)
		, CEE_EN_TRAMITE	VARCHAR2(250 CHAR)
	)';

	DBMS_OUTPUT.PUT_LINE('[INFO] LA TABLA '''||V_TABLA||''' HA SIDO CREADA CON ÉXITO.');
  COMMIT;
 
  
  DBMS_OUTPUT.PUT_LINE('[INFO] PROCESO FINALIZADO.');

         
EXCEPTION

   WHEN OTHERS THEN
   
        err_num := SQLCODE;
        err_msg := SQLERRM;

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);

        ROLLBACK;
        RAISE;          

END;
/
EXIT
