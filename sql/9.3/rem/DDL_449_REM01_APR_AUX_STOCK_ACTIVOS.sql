--/*
--#########################################
--## AUTOR=Santi Monz贸
--## FECHA_CREACION=20210808
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=HREOS-14827
--## PRODUCTO=NO
--## 
--## Finalidad: Creaci贸n de tabla auxiliar
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versi贸n inicial
--#########################################
----*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE

	V_MSQL VARCHAR2(32000 CHAR); 
	V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; 
	V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#';
	V_SQL VARCHAR2(4000 CHAR);
	V_NUM NUMBER(16);
	ERR_NUM NUMBER(25);  
	ERR_MSG VARCHAR2(1024 CHAR); 
	V_TABLA VARCHAR2(50 CHAR):= 'APR_AUX_STOCK_ACTIVOS';


BEGIN	

	DBMS_OUTPUT.PUT_LINE('[INFO] INICIO DEL PROCESO.');
	
	V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA||''' AND OWNER = '''||V_ESQUEMA||'''';
	EXECUTE IMMEDIATE V_MSQL INTO V_NUM;
	
	IF V_NUM != 0 THEN
	
		DBMS_OUTPUT.PUT_LINE('[INFO] LA TABLA '''||V_TABLA||''' YA EXISTE.');
		V_MSQL := 'DROP TABLE '||V_ESQUEMA||'.'||V_TABLA||'';
		EXECUTE IMMEDIATE V_MSQL;
		
	END IF;	

	EXECUTE IMMEDIATE '
	CREATE TABLE '||V_ESQUEMA||'.'||V_TABLA||' (
		ID_ACTIVO_HAYA 		VARCHAR2(50 CHAR)
		, CARTERA 	        VARCHAR2(50 CHAR)
		, SUBCARTERA	    VARCHAR2(50 CHAR)
		, PERIMETRO_MACC	VARCHAR2(50 CHAR)
    ,DIRECCION_COMERCIAL VARCHAR2(50 CHAR)
    ,SOCIEDAD_PROPIETARIO VARCHAR2(50 CHAR)
    ,TIPOLOGIA_ACTIVO VARCHAR2(50 CHAR)
        , TIPO_ALQUILER	VARCHAR2(50 CHAR)
         , ESTADO_COMERCIAL	VARCHAR2(50 CHAR)      
        , DESTINO_COMERCIAL	VARCHAR2(50 CHAR)
        ,GESTOR_COMERCIAL_ALQ VARCHAR2(50 CHAR)
        , REFERENCIA_CATASTRAL	VARCHAR2(50 CHAR)
        , PUERTA_ANTI_OKUPA	VARCHAR2(50 CHAR)
        , SEGURIDAD	VARCHAR2(50 CHAR)
        , VIGILANCIA	VARCHAR2(50 CHAR)
        , PAIS	VARCHAR2(50 CHAR)
        , CCAA	VARCHAR2(50 CHAR)
        , PROVINCIA	VARCHAR2(50 CHAR)
        ,SIGLA VARCHAR2(50 CHAR)
        , VIAPUBLICA	VARCHAR2(50 CHAR)
        , NUMERO	VARCHAR2(50 CHAR)
        , BLOQUE	VARCHAR2(50 CHAR)
        , PORTAL	VARCHAR2(50 CHAR)
        , ESCALERA	VARCHAR2(50 CHAR)
        , PISO	VARCHAR2(50 CHAR)
        , PUERTA	VARCHAR2(50 CHAR)
        , CODPOSTAL	VARCHAR2(50 CHAR)
        , POBLACION	VARCHAR2(50 CHAR)
        , M2_CONST	VARCHAR2(50 CHAR)
        , M2_UTILES	VARCHAR2(50 CHAR)
        , NUM_DORMITORIOS	VARCHAR2(50 CHAR)
        , NUM_BANOS	VARCHAR2(50 CHAR)
        ,LUGARREG VARCHAR2(50 CHAR)
        ,NUMREGPROP VARCHAR2(50 CHAR)
        , FOLIO	VARCHAR2(50 CHAR)
        , LIBRO	VARCHAR2(50 CHAR)
        , TOMO	VARCHAR2(50 CHAR)
        ,FINCA VARCHAR2(50 CHAR)
        , IDUFIR	VARCHAR2(50 CHAR)
        ,LATITUD VARCHAR2(50 CHAR)
        ,LONGITUD VARCHAR2(50 CHAR)
        ,PRECIO_RENTA VARCHAR2(50 CHAR)
        ,MESES_CARENCIA VARCHAR2(50 CHAR)
        ,BONIFICACIONES GASTOS_1 VARCHAR2(50 CHAR)  
        ,BONIFICACIONES GASTOS_2 VARCHAR2(50 CHAR)  
        ,ID_ACTIVO_ORIGEN VARCHAR2(50 CHAR)
        , COD_API	VARCHAR2(50 CHAR)
        ,TERRAZA VARCHAR2(50 CHAR)
        ,ANTIGUEDAD VARCHAR2(50 CHAR)
        ,ORIENTACION VARCHAR2(50 CHAR)
        ,ESTADO VARCHAR2(50 CHAR)
        ,AMUEBLADO VARCHAR2(500 CHAR)   
        ,ARMARIOS_EMPOTRADOS VARCHAR2(50 CHAR)
        ,VIDIROS_DOBLES VARCHAR2(50 CHAR)
        ,TIPO_SUELO VARCHAR2(500 CHAR)
        ,CARPINTERIA_EXTERIOR VARCHAR2(500 CHAR)
        ,CALEFACCION VARCHAR2(500 CHAR)
        ,ASCENSOR VARCHAR2(50 CHAR)
        ,COCINA_EQUIPADA  VARCHAR2(500 CHAR)    
        ,PTA_ENT_BLINDADA VARCHAR2(50 CHAR)
        ,PISCINA VARCHAR2(50 CHAR)
        ,GARAJE VARCHAR2(50 CHAR)
        ,TRASTERO VARCHAR2(50 CHAR)
        , API_PRIMARIO	VARCHAR2(50 CHAR)
        , API_ESPEJO	VARCHAR2(50 CHAR)       
        ,ORIGEN_ACTIVO VARCHAR2(50 CHAR)

	)';

	DBMS_OUTPUT.PUT_LINE('[INFO] LA TABLA '''||V_TABLA||''' HA SIDO CREADA CON EXITO.');
  COMMIT;
 
  
  DBMS_OUTPUT.PUT_LINE('[INFO] PROCESO FINALIZADO.');

         
EXCEPTION

   WHEN OTHERS THEN
   
        err_num := SQLCODE;
        err_msg := SQLERRM;

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecuci贸n:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);

        ROLLBACK;
        RAISE;          

END;
/
EXIT
