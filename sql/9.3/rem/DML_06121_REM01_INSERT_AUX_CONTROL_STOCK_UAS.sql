--/*
--##########################################
--## AUTOR=Pier Gotta
--## FECHA_CREACION=20220907
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=HREOS-18618
--## PRODUCTO=NO
--## Finalidad: Diccionario con los subestados de cargas 
--##           
--## INSTRUCCIONES: Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
	
    V_TEXT1 VARCHAR2(2400 CHAR); -- Vble. auxiliar
    V_ENTIDAD_ID NUMBER(16);
    V_ID NUMBER(16);

    
    
    TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
    --NULOS UNIDAD_INMOBILIARIA, --NULOS SUPERFICIE_INMOBILIARIA
	T_TIPO_DATA('NUM_UNIDAD','CUOTA'),
	T_TIPO_DATA('CLASE_USO','GRADO_PROPIEDAD'),
	T_TIPO_DATA('NUM_INMUEBLE','STATUS_USUARIO'),
	T_TIPO_DATA('FEC_VALIDO_DE','SITUACION_ALQUILER'),
	T_TIPO_DATA('FEC_VALIDO_A','PRODUCTO'),
	T_TIPO_DATA('SOCIEDAD_PATRIMONIAL','PROCEDENCIA_PRODUCTO'),
	T_TIPO_DATA('SUBTIPO_VIVIENDA','SOCIEDAD_ORIGEN'),
	T_TIPO_DATA('SUBTIPO_SUELO','BANCO_ORIGEN'),
	T_TIPO_DATA('NUM_INMUEBLE_ANTERIOR','FINCA'),
	T_TIPO_DATA('COMPLEMENTO','LIBRO'),
	T_TIPO_DATA('CALLE','TOMO'),
	T_TIPO_DATA('NUMERO','FOLIO'),
	T_TIPO_DATA('APARTADO','INSCRIPCION'),
	T_TIPO_DATA('POBLACION','NUM_CARTILLA'),
	T_TIPO_DATA('REGION','ORIGEN_REGULATORIO'),
	T_TIPO_DATA('PAIS','CLASE_USO_REGISTRAL'),
	T_TIPO_DATA('CALLE2','IDUFIR'),
	T_TIPO_DATA('DISTRITO','VIVIENDA_HABITUAL'),
	T_TIPO_DATA('ALA_EDIFICIO','FEC_PRESENTACION_REGISTRO'),
	T_TIPO_DATA('PLANTA','FEC_INSC_TITULO'),
	T_TIPO_DATA('NUM_UBICACION','FEC_ADJUDICACION'),
	T_TIPO_DATA('X_GOOGLE','FEC_TITULO_FIRME'),
	T_TIPO_DATA('Y_GOOGLE','IMPORTE_CESION'),
	T_TIPO_DATA('SIGLA_EDIFICIO','FEC_CESION_REMATE'),
	T_TIPO_DATA('ESTADO_POSESORIO','FEC_PRESENTADO'),
	T_TIPO_DATA('FEC_ESTADO_POSESORIO','INDICADOR_LLAVES'),
	T_TIPO_DATA('ESTADO_COMERCIAL_ALQUILER','FEC_RECEP_LLAVES'),
	T_TIPO_DATA('FEC_ESTADO_COMERCIAL_ALQUILER','NUM_AUTOS_JUZGADO'),
	T_TIPO_DATA('ESTADO_TECNICO','TIPO_IMPUESTO_COMPRA'),
	T_TIPO_DATA('FEC_ESTADO_TECNICO','SUBTIPO_IMPUESTO_COMPRA'),
	T_TIPO_DATA('EST_COMERCIAL_SERVICER','PORC_IMPUESTO_COMPRA'),
	T_TIPO_DATA('FEC_COMERCIAL_SERVICER','COD_TP_IVA_COMPRA'),
	T_TIPO_DATA('EST_ENTR_PROD_MANT_VENTA','NUM_CARGAS'),
	T_TIPO_DATA('ACTIVO_CARTERA_CONCENTRADA','COD_GESTORIA'),
	T_TIPO_DATA('FEC_ENTR_PROD_MANT_VENTA','NOMBRE_REGISTRO_PROPIEDAD'),
	T_TIPO_DATA('PROMO_CONJUNTA_ALQUILER','NUMERO_REGISTRO_PROPIEDAD'),
	T_TIPO_DATA('ACTIVO_AAMM','COD_GESTORIA_ADMINIS'),
	T_TIPO_DATA('ACTIVO_PROMO_ESTRATEG','TIPO_ALQUILER'),
	T_TIPO_DATA('DESTINO_COMERCIAL','ESTADO_TITULARIDAD'),
	T_TIPO_DATA('MOTIVO_NO_COMERCIAL','FEC_ESTADO_TITULARIDAD'),
	T_TIPO_DATA('FEC_INICIO_CONCURENCIA','PROMO_CONJUNTA_OB_REM'),
	T_TIPO_DATA('FEC_FIN_CONCURENCIA','RENUNCIA_EXENSION'),
	T_TIPO_DATA('FEC_VISITA_INMB_SERVICER','ANYO_CONCESION'),
	T_TIPO_DATA('FEC_PUBLICACION_SERVICER','FEC_FIN_CONCESION'),
	T_TIPO_DATA('PUBLICABLE_PORT_PUBLI_ALQUI','SITUACION_VPO'),
	T_TIPO_DATA('PUBLICABLE_PORT_INVER_ALQUI','SEGMENTACION_CARTERA'),
	T_TIPO_DATA('PUBLICABLE_PORT_API_ALQUI',''),
	T_TIPO_DATA('CAT_COMERCIALIZACION',''),
	T_TIPO_DATA('CANAL_DISTRIBUCION_ALQ',''),
	T_TIPO_DATA('PROMO_COMERCIAL',''),
	T_TIPO_DATA('TXT_COMERCIAL_CAS_1',''),
	T_TIPO_DATA('TXT_COMERCIAL_CAS_2',''),
	T_TIPO_DATA('TXT_COMERCIAL_ENG_1',''),
	T_TIPO_DATA('TXT_COMERCIAL_ENG_2',''),
	T_TIPO_DATA('FEC_PUBLI_SERVICER_APIS',''),
	T_TIPO_DATA('FEC_PUBLI_PORT_INVERSOR',''),
	T_TIPO_DATA('FEC_INICIO_INFORME',''),
	T_TIPO_DATA('FEC_FIN_INFORME',''),
	T_TIPO_DATA('CALIFICACION_ENERGETICA',''),
	T_TIPO_DATA('CERTIFICADO_REGISTRADO',''),
	T_TIPO_DATA('FEC_SOLICITUD',''),
	T_TIPO_DATA('FEC_FIN_VIGENCIA',''),
	T_TIPO_DATA('LISTA_EMISIONES',''),
	T_TIPO_DATA('VALORES_EMISIONES',''),
	T_TIPO_DATA('LISTA_ENERGIA',''),
	T_TIPO_DATA('VALOR_ENERGIA',''),
	T_TIPO_DATA('CEDULA_HABITABILIDAD',''),
	T_TIPO_DATA('PRECIO_MAX_MOD_ALQUILER',''),
	T_TIPO_DATA('SITUACION_CEE',''),
	T_TIPO_DATA('MOTIVO_EXONERACION_CEE',''),
	T_TIPO_DATA('INCIDENCIA_CEE',''),
	T_TIPO_DATA('NUMERO_CEE',''),
	T_TIPO_DATA('CODIGO_SST',''),
	T_TIPO_DATA('SUP_TASACION_SOLAR',''),
	T_TIPO_DATA('PORC_OBRA_EJECUTADA',''),
	T_TIPO_DATA('SUP_TASACION_UTIL',''),
	T_TIPO_DATA('SUP_REGISTRAL_UTIL',''),
	T_TIPO_DATA('SUP_TASACION_CONSTRUIDA',''),
	T_TIPO_DATA('NUM_HABITACIONES',''),
	T_TIPO_DATA('NUM_BANYOS',''),
	T_TIPO_DATA('NUM_TERRAZAS',''),
	T_TIPO_DATA('ANYO_CONSTRUCCION',''),
	T_TIPO_DATA('ANYO_ULTIMA_REFORMA',''),
	T_TIPO_DATA('SUP_SOBRE_RASANTE',''),
	T_TIPO_DATA('SUP_BAJO_RASANTE',''),
	T_TIPO_DATA('NUM_APARACAMIENTOS',''),
	T_TIPO_DATA('IDEN_PL_PARKING',''),
	T_TIPO_DATA('IDEN_TRASTERO',''),
	T_TIPO_DATA('SUP_REG_CONSTRUIDA',''),
	T_TIPO_DATA('SUP_REG_SOLAR',''),
	T_TIPO_DATA('TIENE_ASCENSOR',''),
	T_TIPO_DATA('TIENE_TRASTERO',''),
	T_TIPO_DATA('INMUEBLE_VACACIONAL',''),
	T_TIPO_DATA('EQUIPAMIENTO_015001',''),
	T_TIPO_DATA('BALCON',''),
	T_TIPO_DATA('CALEFACCION',''),
	T_TIPO_DATA('COCINA_EQUIPADA',''),
	T_TIPO_DATA('EST_CONSERVACION',''),
	T_TIPO_DATA('JARDIN',''),
	T_TIPO_DATA('USO_JARDIN',''),
	T_TIPO_DATA('PISCINA',''),
	T_TIPO_DATA('SALIDA_HUMOS',''),
	T_TIPO_DATA('TERRAZA',''),
	T_TIPO_DATA('TIPO_VIVIENDA_INF',''),
	T_TIPO_DATA('TIPOLOGIA_EDIFICIO',''),
	T_TIPO_DATA('SEG_INVERSION_PROM',''),
	T_TIPO_DATA('DESC_COLEC_PRECIO_ALQUI',''),
	T_TIPO_DATA('IMP_PRECIO_ALQUI',''),
	T_TIPO_DATA('PRECIO_ALQUI_NEGOCIABLE',''),
	T_TIPO_DATA('DESC_COL_PRECIO_CAMP_ALQUI',''),
	T_TIPO_DATA('IMP_PRECIO_CAMP_ALQUI',''),
	T_TIPO_DATA('PRECIO_CAMP_ALQUI_NEGOCIABLE',''),
	T_TIPO_DATA('IMP_PRECIO_REF_ALQUI',''),
	T_TIPO_DATA('FEC_INICIO_PRECIO_ALQUI',''),
	T_TIPO_DATA('FEC_FIN_PRECIO_ALQUI',''),
	T_TIPO_DATA('FEC_INICIO_PRECIO_CAMP_ALQUI',''),
	T_TIPO_DATA('FEC_FIN_PRECIO_CAMP_ALQUI',''),
	T_TIPO_DATA('FEC_POSESION',''),
	T_TIPO_DATA('FEC_SENYAL_LANZAMIENTO',''),
	T_TIPO_DATA('FEC_LANZAMIENTO',''),
	T_TIPO_DATA('AVISO_OCUP_SERVICER',''),
	T_TIPO_DATA('IND_FUERZA_PUBLICA',''),
	T_TIPO_DATA('IND_OCUPANTES_VIVIENDA',''),
	T_TIPO_DATA('FEC_RESOLUCION_MORA',''),
	T_TIPO_DATA('SUP_ALQUILABLE','')

    ); 
    V_TMP_TIPO_DATA T_TIPO_DATA;
    
BEGIN	
	
    DBMS_OUTPUT.PUT_LINE('[INICIO] ');
    DBMS_OUTPUT.PUT_LINE('[INFO]: TRUNCAMOS LA TABLA AUX_CONTROL_STOCK_UAS');
    	V_MSQL := 'TRUNCATE TABLE '|| V_ESQUEMA ||'.AUX_CONTROL_STOCK_UAS';
       EXECUTE IMMEDIATE V_MSQL;
    DBMS_OUTPUT.PUT_LINE('[INFO]: TRUNCADO CORRECTAMENTE');
	
    DBMS_OUTPUT.PUT_LINE('[INFO]: INSERCION EN AUX_CONTROL_STOCK_UAS] ');
    FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
      LOOP
      
        V_TMP_TIPO_DATA := V_TIPO_DATA(I);   
       
          DBMS_OUTPUT.PUT_LINE('[INFO]: INSERTAMOS EL REGISTRO '''|| TRIM(V_TMP_TIPO_DATA(1)) ||'''');   
          V_MSQL := 'INSERT INTO '|| V_ESQUEMA ||'.AUX_CONTROL_STOCK_UAS (UNIDAD_INMOBILIARIA, SUPERFICIE_INMOBILIARIA)VALUES ('''||V_TMP_TIPO_DATA(1)||''','''||TRIM(V_TMP_TIPO_DATA(2))||''')';
          EXECUTE IMMEDIATE V_MSQL;
          DBMS_OUTPUT.PUT_LINE('[INFO]: REGISTRO INSERTADO CORRECTAMENTE');
        
      END LOOP;
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('[FIN]: DICCIONARIO DD_SCG_SUBESTADO_CARGA ACTUALIZADO CORRECTAMENTE ');
   

EXCEPTION
     WHEN OTHERS THEN
          err_num := SQLCODE;
          err_msg := SQLERRM;

          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(err_msg);

          ROLLBACK;
          RAISE;          

END;

/

EXIT;
