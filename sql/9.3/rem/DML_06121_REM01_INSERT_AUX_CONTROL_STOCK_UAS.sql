--/*
--##########################################
--## AUTOR=Pier Gotta
--## FECHA_CREACION=20221116
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=HREOS-18618
--## PRODUCTO=NO
--## Finalidad: Diccionario con los subestados de cargas 
--##           
--## INSTRUCCIONES: Configurar las variables necesarias en el principio del DECLARE
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
	
    V_TEXT1 VARCHAR2(2400 CHAR); -- Vble. auxiliar
    V_ENTIDAD_ID NUMBER(16);
    V_ID NUMBER(16);

    
    
    TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
    --NULOS UNIDAD_INMOBILIARIA, --NULOS SUPERFICIE_INMOBILIARIA
	T_TIPO_DATA('','CUOTA'),
	T_TIPO_DATA('','GRADO_PROPIEDAD'),
	T_TIPO_DATA('','STATUS_USUARIO'),
	T_TIPO_DATA('','SITUACION_ALQUILER'),
	T_TIPO_DATA('','PRODUCTO'),
	T_TIPO_DATA('','PROCEDENCIA_PRODUCTO'),
	T_TIPO_DATA('','SOCIEDAD_ORIGEN'),
	T_TIPO_DATA('','BANCO_ORIGEN'),
	T_TIPO_DATA('','FINCA'),
	T_TIPO_DATA('','LIBRO'),
	T_TIPO_DATA('','TOMO'),
	T_TIPO_DATA('','FOLIO'),
	T_TIPO_DATA('','INSCRIPCION'),
	T_TIPO_DATA('','NUM_CARTILLA'),
	T_TIPO_DATA('','ORIGEN_REGULATORIO'),
	T_TIPO_DATA('','CLASE_USO_REGISTRAL'),
	T_TIPO_DATA('','IDUFIR'),
	T_TIPO_DATA('','VIVIENDA_HABITUAL'),
	T_TIPO_DATA('','FEC_PRESENTACION_REGISTRO'),
	T_TIPO_DATA('','FEC_INSC_TITULO'),
	T_TIPO_DATA('','FEC_ADJUDICACION'),
	T_TIPO_DATA('','FEC_TITULO_FIRME'),
	T_TIPO_DATA('','IMPORTE_CESION'),
	T_TIPO_DATA('','FEC_CESION_REMATE'),
	T_TIPO_DATA('','FEC_PRESENTADO'),
	T_TIPO_DATA('','INDICADOR_LLAVES'),
	T_TIPO_DATA('','FEC_RECEP_LLAVES'),
	T_TIPO_DATA('','NUM_AUTOS_JUZGADO'),
	T_TIPO_DATA('','TIPO_IMPUESTO_COMPRA'),
	T_TIPO_DATA('','NUM_CARGAS'),
	T_TIPO_DATA('','COD_GESTORIA'),
	T_TIPO_DATA('','NOMBRE_REGISTRO_PROPIEDAD'),
	T_TIPO_DATA('','NUMERO_REGISTRO_PROPIEDAD'),
	T_TIPO_DATA('','COD_GESTORIA_ADMINIS'),
	T_TIPO_DATA('','TIPO_ALQUILER'),
	T_TIPO_DATA('','ESTADO_TITULARIDAD'),
	T_TIPO_DATA('','FEC_ESTADO_TITULARIDAD'),
	T_TIPO_DATA('','ESTADO_COMERCIAL_VENTA'),
	T_TIPO_DATA('','FEC_ESTADO_COMERCIAL_VENTA'),
	T_TIPO_DATA('','EST_DESA_PROMO_DETALLADO'),
	T_TIPO_DATA('','FEC_DESA_PROMO_DETALLADO'),
	T_TIPO_DATA('','EST_DESA_PROMO_GENERAL'),
	T_TIPO_DATA('','FEC_DESA_PROMO_GENERAL'),
	T_TIPO_DATA('','EST_ENTR_PROD_MANT_VENTA'),
	T_TIPO_DATA('','FEC_ENTR_PROD_MANT_VENTA'),
	T_TIPO_DATA('','PROMO_CONJUNTA_OB_REM'),
	T_TIPO_DATA('','PROMO_CONJUNTA_VENTA'),
	T_TIPO_DATA('','CANAL_DISTRIBUCION_VENTA'),
	T_TIPO_DATA('','PUBLICABLE_PORT_PUBLI_VENTA'),
	T_TIPO_DATA('','PUBLICABLE_PORT_INVER_VENTA'),
	T_TIPO_DATA('','PUBLICABLE_PORT_API_VENTA'),
	T_TIPO_DATA('','NECESIDAD_ARRAS'),
	T_TIPO_DATA('','MOT_NECESIDAD_ARRAS'),
	T_TIPO_DATA('','RENUNCIA_EXENSION'),
	T_TIPO_DATA('','CARTERA_VENTA_ACTIVOS'),
	T_TIPO_DATA('','CARTERA_VENTA_CREDITOS'),
	T_TIPO_DATA('','TRIBUT_PROPUESTA_VENTA'),
	T_TIPO_DATA('','TRIBUT_PROPUESTA_CLI_EXT_IVA'),
	T_TIPO_DATA('','ANYO_CONCESION'),
	T_TIPO_DATA('','FEC_FIN_CONCESION'),
	T_TIPO_DATA('','PRECIO_MAX_MOD_VENTA'),
	T_TIPO_DATA('','SITUACION_VPO'),
	T_TIPO_DATA('','NECESARIA_AUTORI_TRANS'),
	T_TIPO_DATA('','TANTEO_RETRACTO_TRANS'),
	T_TIPO_DATA('','IND_COMPRADOR_ACOGE_AYUDA'),
	T_TIPO_DATA('','IMP_AYUDA_FINANCIACION'),
	T_TIPO_DATA('','FEC_VENCIMIENTO_SEGURO'),
	T_TIPO_DATA('','FEC_DEVOLUCION_AYUDA'),
	T_TIPO_DATA('','IMP_PRECIO_VENTA'),
	T_TIPO_DATA('','PRECIO_VENTA_NEGOCIABLE'),
	T_TIPO_DATA('','DESC_COL_PRECIO_CAMP_VENTA'),
	T_TIPO_DATA('','IMP_PRECIO_CAMP_VENTA'),
	T_TIPO_DATA('','PRECIO_CAMP_VENTA_NEGOCIABLE'),
	T_TIPO_DATA('','DESC_COL_PRECIO_VENTA'),
	T_TIPO_DATA('','FEC_INICIO_PRECIO_VENTA'),
	T_TIPO_DATA('','FEC_FIN_PRECIO_VENTA'),
	T_TIPO_DATA('','FEC_INICIO_PRECIO_CAMP_VENTA'),
	T_TIPO_DATA('','FEC_FIN_PRECIO_CAMP_VENTA'),
	T_TIPO_DATA('','IND_ENTREGA_VOL_POSESI'),
	T_TIPO_DATA('','SEGMENTACION_CARTERA')

    ); 
    V_TMP_TIPO_DATA T_TIPO_DATA;
    
BEGIN	
	
    DBMS_OUTPUT.PUT_LINE('[INICIO] ');
    DBMS_OUTPUT.PUT_LINE('[INFO]: TRUNCAMOS LA TABLA AUX_CONTROL_STOCK_UAS');
    	V_MSQL := 'TRUNCATE TABLE '|| V_ESQUEMA ||'.AUX_CONTROL_STOCK_UAS';
       EXECUTE IMMEDIATE V_MSQL;
    DBMS_OUTPUT.PUT_LINE('[INFO]: TRUNCADO CORRECTAMENTE');
	
    DBMS_OUTPUT.PUT_LINE('[INFO]: INSERCION EN AUX_CONTROL_STOCK_UAS] ');
    FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
      LOOP
      
        V_TMP_TIPO_DATA := V_TIPO_DATA(I);   
       
          DBMS_OUTPUT.PUT_LINE('[INFO]: INSERTAMOS EL REGISTRO '''|| TRIM(V_TMP_TIPO_DATA(1)) ||'''');   
          V_MSQL := 'INSERT INTO '|| V_ESQUEMA ||'.AUX_CONTROL_STOCK_UAS (UNIDAD_INMOBILIARIA, SUPERFICIE_INMOBILIARIA)VALUES ('''||V_TMP_TIPO_DATA(1)||''','''||TRIM(V_TMP_TIPO_DATA(2))||''')';
          EXECUTE IMMEDIATE V_MSQL;
          DBMS_OUTPUT.PUT_LINE('[INFO]: REGISTRO INSERTADO CORRECTAMENTE');
        
      END LOOP;
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('[FIN]: DICCIONARIO DD_SCG_SUBESTADO_CARGA ACTUALIZADO CORRECTAMENTE ');
   

EXCEPTION
     WHEN OTHERS THEN
          err_num := SQLCODE;
          err_msg := SQLERRM;

          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(err_msg);

          ROLLBACK;
          RAISE;          

END;

/

EXIT;
