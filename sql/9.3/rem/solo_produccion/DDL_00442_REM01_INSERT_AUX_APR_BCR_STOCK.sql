--/*
--#########################################
--## AUTOR=Juan Bautista Alfonso
--## FECHA_CREACION=20220913
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP_12410
--## PRODUCTO=NO
--## 
--## Finalidad: Creación de la tabla backup y recuperar datos de vista
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE

TABLE_COUNT NUMBER(1,0) := 0;
V_ESQUEMA_1 VARCHAR2(20 CHAR) := '#ESQUEMA#';
V_ESQUEMA_2 VARCHAR2(20 CHAR) := 'REMMASTER';
V_ESQUEMA_3 VARCHAR2(20 CHAR) := 'REM_QUERY';
V_ESQUEMA_4 VARCHAR2(20 CHAR) := 'PFSREM';
V_TABLA_BACK VARCHAR2(40 CHAR) := 'BCR_STOCK_BACKUP_';
V_TABLA VARCHAR2(40 CHAR) := 'AUX_APR_BCR_STOCK';
V_VISTA_MAT VARCHAR2(40 CHAR) := 'AUX_APR_BCR_STOCK_M';
V_USUARIO VARCHAR2(100 CHAR):='REMVIP_12410';
V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
V_TABLA_CONCAT VARCHAR2(200 CHAR);


BEGIN
	DBMS_OUTPUT.PUT_LINE('[INICIO] ');
    V_TABLA_CONCAT:= ''||V_TABLA_BACK||''||V_USUARIO||'';
    DBMS_OUTPUT.PUT_LINE('[INFO]: Comprobar existencia tabla backup concatenada: '||V_TABLA_CONCAT);
 
 V_MSQL := 'SELECT COUNT(1) FROM ALL_TABLES WHERE TABLE_NAME = '''||V_TABLA_CONCAT||''' AND OWNER = '''||V_ESQUEMA_1||'''';
 EXECUTE IMMEDIATE V_MSQL INTO TABLE_COUNT;
DBMS_OUTPUT.PUT_LINE('[INICIO] ');
IF TABLE_COUNT > 0 THEN

    DBMS_OUTPUT.PUT_LINE('[WARN] TABLA '||V_ESQUEMA_1||'.'''||V_TABLA_CONCAT||''' YA EXISTENTE. SE PROCEDE A BORRAR Y CREAR DE NUEVO.');
    EXECUTE IMMEDIATE 'DROP TABLE '||V_ESQUEMA_1||'.'||V_TABLA_CONCAT||'';
    
END IF;

EXECUTE IMMEDIATE 
'CREATE TABLE '||V_ESQUEMA_1||'.'||V_TABLA_CONCAT||' AS (
SELECT NUM_IDENTIFICATIVO, NUM_UNIDAD,CLASE_USO,NUM_INMUEBLE,CUOTA,
GRADO_PROPIEDAD,FEC_VALIDO_DE,FEC_VALIDO_A,STATUS_USUARIO,SITUACION_ALQUILER,
SOCIEDAD_PATRIMONIAL,SUBTIPO_VIVIENDA,SUBTIPO_SUELO,NUM_INMUEBLE_ANTERIOR,PRODUCTO,
PROCEDENCIA_PRODUCTO,SOCIEDAD_ORIGEN,BANCO_ORIGEN,FINCA,LIBRO,TOMO,FOLIO,INSCRIPCION,
NUM_CARTILLA,ORIGEN_REGULATORIO,CLASE_USO_REGISTRAL,IDUFIR,VIVIENDA_HABITUAL,
FEC_PRESENTACION_REGISTRO,FEC_INSC_TITULO,FEC_ADJUDICACION,FEC_TITULO_FIRME,
IMPORTE_CESION,FEC_CESION_REMATE,FEC_PRESENTADO,INDICADOR_LLAVES,FEC_RECEP_LLAVES,
NUM_AUTOS_JUZGADO,TIPO_IMPUESTO_COMPRA,SUBTIPO_IMPUESTO_COMPRA,PORC_IMPUESTO_COMPRA,
COD_TP_IVA_COMPRA,NUM_CARGAS,COD_GESTORIA,NOMBRE_REGISTRO_PROPIEDAD,
NUMERO_REGISTRO_PROPIEDAD,COD_GESTORIA_ADMINIS,TIPO_ALQUILER,COMPLEMENTO,CALLE,NUMERO,
APARTADO,POBLACION,REGION,PAIS,CALLE2,DISTRITO,ALA_EDIFICIO,PLANTA,NUM_UBICACION,
X_GOOGLE,Y_GOOGLE,SIGLA_EDIFICIO,ESTADO_TITULARIDAD,FEC_ESTADO_TITULARIDAD,
ESTADO_POSESORIO,FEC_ESTADO_POSESORIO,ESTADO_COMERCIAL_ALQUILER,
FEC_ESTADO_COMERCIAL_ALQUILER,ESTADO_COMERCIAL_VENTA,FEC_ESTADO_COMERCIAL_VENTA,
ESTADO_TECNICO,FEC_ESTADO_TECNICO,EST_COMERCIAL_SERVICER,FEC_COMERCIAL_SERVICER,
EST_DESA_PROMO_DETALLADO,FEC_DESA_PROMO_DETALLADO,EST_DESA_PROMO_GENERAL,
FEC_DESA_PROMO_GENERAL,EST_ENTR_PROD_MANT_VENTA,FEC_ENTR_PROD_MANT_VENTA,
EST_ENTR_PROD_MANT_ALQ,FEC_ENTR_PROD_MANT_ALQ,PROMO_CONJUNTA_OB_REM,
PROMO_CONJUNTA_VENTA,PROMO_CONJUNTA_ALQUILER,ACTIVO_CARTERA_CONCENTRADA,
ACTIVO_AAMM,ACTIVO_PROMO_ESTRATEG,DESTINO_COMERCIAL,CANAL_DISTRIBUCION_VENTA,
MOTIVO_NO_COMERCIAL,FEC_INICIO_CONCURENCIA,FEC_FIN_CONCURENCIA,
FEC_VISITA_INMB_SERVICER,FEC_PUBLICACION_SERVICER,PUBLICABLE_PORT_PUBLI_VENTA,
PUBLICABLE_PORT_PUBLI_ALQUI,PUBLICABLE_PORT_INVER_VENTA,PUBLICABLE_PORT_INVER_ALQUI,
PUBLICABLE_PORT_API_VENTA,PUBLICABLE_PORT_API_ALQUI,NECESIDAD_ARRAS,
MOT_NECESIDAD_ARRAS,RENUNCIA_EXENSION,CARTERA_VENTA_ACTIVOS,CARTERA_VENTA_CREDITOS,
CAT_COMERCIALIZACION,TRIBUT_PROPUESTA_VENTA,TRIBUT_PROPUESTA_CLI_EXT_IVA,
CANAL_DISTRIBUCION_ALQ,PROMO_COMERCIAL,TXT_COMERCIAL_CAS_1,
TXT_COMERCIAL_CAS_2,TXT_COMERCIAL_ENG_1,TXT_COMERCIAL_ENG_2,
FEC_PUBLI_SERVICER_APIS,FEC_PUBLI_PORT_INVERSOR,FEC_INICIO_INFORME,
FEC_FIN_INFORME,ANYO_CONCESION,FEC_FIN_CONCESION,
CALIFICACION_ENERGETICA,CERTIFICADO_REGISTRADO,FEC_SOLICITUD,
FEC_FIN_VIGENCIA,LISTA_EMISIONES,VALORES_EMISIONES,LISTA_ENERGIA,
VALOR_ENERGIA,CEDULA_HABITABILIDAD,PRECIO_MAX_MOD_VENTA,PRECIO_MAX_MOD_ALQUILER,
SITUACION_VPO,NECESARIA_AUTORI_TRANS,TANTEO_RETRACTO_TRANS,IND_COMPRADOR_ACOGE_AYUDA,
IMP_AYUDA_FINANCIACION,FEC_VENCIMIENTO_SEGURO,FEC_DEVOLUCION_AYUDA,SITUACION_CEE,
MOTIVO_EXONERACION_CEE,INCIDENCIA_CEE,NUMERO_CEE,CODIGO_SST,SUP_TASACION_SOLAR,
PORC_OBRA_EJECUTADA,SUP_TASACION_UTIL,SUP_REGISTRAL_UTIL,SUP_TASACION_CONSTRUIDA,
NUM_HABITACIONES,NUM_BANYOS,NUM_TERRAZAS,ANYO_CONSTRUCCION,ANYO_ULTIMA_REFORMA,
SUP_SOBRE_RASANTE,SUP_BAJO_RASANTE,NUM_APARACAMIENTOS,IDEN_PL_PARKING,
IDEN_TRASTERO,SUP_REG_CONSTRUIDA,SUP_REG_SOLAR,TIENE_ASCENSOR,TIENE_TRASTERO,
INMUEBLE_VACACIONAL,EQUIPAMIENTO_015001,BALCON,CALEFACCION,COCINA_EQUIPADA,
EST_CONSERVACION,JARDIN,USO_JARDIN,PISCINA,SALIDA_HUMOS,TERRAZA,TIPO_VIVIENDA_INF,
TIPOLOGIA_EDIFICIO,SEG_INVERSION_PROM,IMP_PRECIO_VENTA,PRECIO_VENTA_NEGOCIABLE,
DESC_COLEC_PRECIO_ALQUI,IMP_PRECIO_ALQUI,PRECIO_ALQUI_NEGOCIABLE,
DESC_COL_PRECIO_CAMP_ALQUI,IMP_PRECIO_CAMP_ALQUI,PRECIO_CAMP_ALQUI_NEGOCIABLE,
DESC_COL_PRECIO_CAMP_VENTA,IMP_PRECIO_CAMP_VENTA,PRECIO_CAMP_VENTA_NEGOCIABLE,
DESC_COL_PRECIO_VENTA,IMP_PRECIO_REF_ALQUI,FEC_INICIO_PRECIO_VENTA,
FEC_FIN_PRECIO_VENTA,FEC_INICIO_PRECIO_ALQUI,FEC_FIN_PRECIO_ALQUI,
FEC_INICIO_PRECIO_CAMP_VENTA,FEC_FIN_PRECIO_CAMP_VENTA,
FEC_INICIO_PRECIO_CAMP_ALQUI,FEC_FIN_PRECIO_CAMP_ALQUI,
FEC_POSESION,FEC_SENYAL_LANZAMIENTO,FEC_LANZAMIENTO,AVISO_OCUP_SERVICER,
IND_FUERZA_PUBLICA,IND_OCUPANTES_VIVIENDA,FEC_RESOLUCION_MORA,IND_ENTREGA_VOL_POSESI,
SEGMENTACION_CARTERA,FLAG_EN_REM,FLAG_FICHEROS,FLAG_OFERTA_VIVA FROM '||V_ESQUEMA_1||'.'||V_TABLA||'
)'
;

DBMS_OUTPUT.PUT_LINE('[INFO] '||V_ESQUEMA_1||'.'||V_TABLA_CONCAT||' CREADA');  

IF V_ESQUEMA_2 != V_ESQUEMA_1 THEN

	EXECUTE IMMEDIATE 'GRANT ALL ON "'||V_ESQUEMA_1||'"."'||V_TABLA_CONCAT||'" TO "'||V_ESQUEMA_2||'" WITH GRANT OPTION';
	DBMS_OUTPUT.PUT_LINE('[INFO] PERMISOS SOBRE LA TABLA '||V_ESQUEMA_1||'.'||V_TABLA_CONCAT||' OTORGADOS A '||V_ESQUEMA_2||''); 

END IF;

IF V_ESQUEMA_3 != V_ESQUEMA_1 THEN

	EXECUTE IMMEDIATE 'GRANT ALL ON "'||V_ESQUEMA_1||'"."'||V_TABLA_CONCAT||'" TO "'||V_ESQUEMA_3||'" WITH GRANT OPTION';
	DBMS_OUTPUT.PUT_LINE('[INFO] PERMISOS SOBRE LA TABLA '||V_ESQUEMA_1||'.'||V_TABLA_CONCAT||' OTORGADOS A '||V_ESQUEMA_3||''); 

END IF;

IF V_ESQUEMA_4 != V_ESQUEMA_1 THEN
	
	EXECUTE IMMEDIATE 'GRANT ALL ON "'||V_ESQUEMA_1||'"."'||V_TABLA_CONCAT||'" TO "'||V_ESQUEMA_4||'" WITH GRANT OPTION';
	DBMS_OUTPUT.PUT_LINE('[INFO] PERMISOS SOBRE LA TABLA '||V_ESQUEMA_1||'.'||V_TABLA_CONCAT||' OTORGADOS A '||V_ESQUEMA_4||''); 

END IF;

DBMS_OUTPUT.PUT_LINE('[INFO]: SE TRUNCA TABLA: '||V_TABLA);

  --############@@@@@@@@@#########  CUIDADO HAY UN TRUNCATE AQUI | ############
  --                                                             V
	V_MSQL := 'TRUNCATE TABLE '||V_ESQUEMA_1||'.'||V_TABLA||'';
  EXECUTE IMMEDIATE V_MSQL;
  COMMIT;
  --############TRUNCATE#############

DBMS_OUTPUT.PUT_LINE('[INFO]: SE INSERTA EN TABLA: '||V_TABLA||' REGISTROS DE VISTA '||V_VISTA_MAT);

    V_MSQL := 'INSERT INTO '||V_ESQUEMA_1||'.'||V_TABLA||' (
        NUM_IDENTIFICATIVO, NUM_UNIDAD,CLASE_USO,NUM_INMUEBLE,CUOTA,
GRADO_PROPIEDAD,FEC_VALIDO_DE,FEC_VALIDO_A,STATUS_USUARIO,SITUACION_ALQUILER,
SOCIEDAD_PATRIMONIAL,SUBTIPO_VIVIENDA,SUBTIPO_SUELO,NUM_INMUEBLE_ANTERIOR,PRODUCTO,
PROCEDENCIA_PRODUCTO,SOCIEDAD_ORIGEN,BANCO_ORIGEN,FINCA,LIBRO,TOMO,FOLIO,INSCRIPCION,
NUM_CARTILLA,ORIGEN_REGULATORIO,CLASE_USO_REGISTRAL,IDUFIR,VIVIENDA_HABITUAL,
FEC_PRESENTACION_REGISTRO,FEC_INSC_TITULO,FEC_ADJUDICACION,FEC_TITULO_FIRME,
IMPORTE_CESION,FEC_CESION_REMATE,FEC_PRESENTADO,INDICADOR_LLAVES,FEC_RECEP_LLAVES,
NUM_AUTOS_JUZGADO,TIPO_IMPUESTO_COMPRA,SUBTIPO_IMPUESTO_COMPRA,PORC_IMPUESTO_COMPRA,
COD_TP_IVA_COMPRA,NUM_CARGAS,COD_GESTORIA,NOMBRE_REGISTRO_PROPIEDAD,
NUMERO_REGISTRO_PROPIEDAD,COD_GESTORIA_ADMINIS,TIPO_ALQUILER,COMPLEMENTO,CALLE,NUMERO,
APARTADO,POBLACION,REGION,PAIS,CALLE2,DISTRITO,ALA_EDIFICIO,PLANTA,NUM_UBICACION,
X_GOOGLE,Y_GOOGLE,SIGLA_EDIFICIO,ESTADO_TITULARIDAD,FEC_ESTADO_TITULARIDAD,
ESTADO_POSESORIO,FEC_ESTADO_POSESORIO,ESTADO_COMERCIAL_ALQUILER,
FEC_ESTADO_COMERCIAL_ALQUILER,ESTADO_COMERCIAL_VENTA,FEC_ESTADO_COMERCIAL_VENTA,
ESTADO_TECNICO,FEC_ESTADO_TECNICO,EST_COMERCIAL_SERVICER,FEC_COMERCIAL_SERVICER,
EST_DESA_PROMO_DETALLADO,FEC_DESA_PROMO_DETALLADO,EST_DESA_PROMO_GENERAL,
FEC_DESA_PROMO_GENERAL,EST_ENTR_PROD_MANT_VENTA,FEC_ENTR_PROD_MANT_VENTA,
EST_ENTR_PROD_MANT_ALQ,FEC_ENTR_PROD_MANT_ALQ,PROMO_CONJUNTA_OB_REM,
PROMO_CONJUNTA_VENTA,PROMO_CONJUNTA_ALQUILER,ACTIVO_CARTERA_CONCENTRADA,
ACTIVO_AAMM,ACTIVO_PROMO_ESTRATEG,DESTINO_COMERCIAL,CANAL_DISTRIBUCION_VENTA,
MOTIVO_NO_COMERCIAL,FEC_INICIO_CONCURENCIA,FEC_FIN_CONCURENCIA,
FEC_VISITA_INMB_SERVICER,FEC_PUBLICACION_SERVICER,PUBLICABLE_PORT_PUBLI_VENTA,
PUBLICABLE_PORT_PUBLI_ALQUI,PUBLICABLE_PORT_INVER_VENTA,PUBLICABLE_PORT_INVER_ALQUI,
PUBLICABLE_PORT_API_VENTA,PUBLICABLE_PORT_API_ALQUI,NECESIDAD_ARRAS,
MOT_NECESIDAD_ARRAS,RENUNCIA_EXENSION,CARTERA_VENTA_ACTIVOS,CARTERA_VENTA_CREDITOS,
CAT_COMERCIALIZACION,TRIBUT_PROPUESTA_VENTA,TRIBUT_PROPUESTA_CLI_EXT_IVA,
CANAL_DISTRIBUCION_ALQ,PROMO_COMERCIAL,TXT_COMERCIAL_CAS_1,
TXT_COMERCIAL_CAS_2,TXT_COMERCIAL_ENG_1,TXT_COMERCIAL_ENG_2,
FEC_PUBLI_SERVICER_APIS,FEC_PUBLI_PORT_INVERSOR,FEC_INICIO_INFORME,
FEC_FIN_INFORME,ANYO_CONCESION,FEC_FIN_CONCESION,
CALIFICACION_ENERGETICA,CERTIFICADO_REGISTRADO,FEC_SOLICITUD,
FEC_FIN_VIGENCIA,LISTA_EMISIONES,VALORES_EMISIONES,LISTA_ENERGIA,
VALOR_ENERGIA,CEDULA_HABITABILIDAD,PRECIO_MAX_MOD_VENTA,PRECIO_MAX_MOD_ALQUILER,
SITUACION_VPO,NECESARIA_AUTORI_TRANS,TANTEO_RETRACTO_TRANS,IND_COMPRADOR_ACOGE_AYUDA,
IMP_AYUDA_FINANCIACION,FEC_VENCIMIENTO_SEGURO,FEC_DEVOLUCION_AYUDA,SITUACION_CEE,
MOTIVO_EXONERACION_CEE,INCIDENCIA_CEE,NUMERO_CEE,CODIGO_SST,SUP_TASACION_SOLAR,
PORC_OBRA_EJECUTADA,SUP_TASACION_UTIL,SUP_REGISTRAL_UTIL,SUP_TASACION_CONSTRUIDA,
NUM_HABITACIONES,NUM_BANYOS,NUM_TERRAZAS,ANYO_CONSTRUCCION,ANYO_ULTIMA_REFORMA,
SUP_SOBRE_RASANTE,SUP_BAJO_RASANTE,NUM_APARACAMIENTOS,IDEN_PL_PARKING,
IDEN_TRASTERO,SUP_REG_CONSTRUIDA,SUP_REG_SOLAR,TIENE_ASCENSOR,TIENE_TRASTERO,
INMUEBLE_VACACIONAL,EQUIPAMIENTO_015001,BALCON,CALEFACCION,COCINA_EQUIPADA,
EST_CONSERVACION,JARDIN,USO_JARDIN,PISCINA,SALIDA_HUMOS,TERRAZA,TIPO_VIVIENDA_INF,
TIPOLOGIA_EDIFICIO,SEG_INVERSION_PROM,IMP_PRECIO_VENTA,PRECIO_VENTA_NEGOCIABLE,
DESC_COLEC_PRECIO_ALQUI,IMP_PRECIO_ALQUI,PRECIO_ALQUI_NEGOCIABLE,
DESC_COL_PRECIO_CAMP_ALQUI,IMP_PRECIO_CAMP_ALQUI,PRECIO_CAMP_ALQUI_NEGOCIABLE,
DESC_COL_PRECIO_CAMP_VENTA,IMP_PRECIO_CAMP_VENTA,PRECIO_CAMP_VENTA_NEGOCIABLE,
DESC_COL_PRECIO_VENTA,IMP_PRECIO_REF_ALQUI,FEC_INICIO_PRECIO_VENTA,
FEC_FIN_PRECIO_VENTA,FEC_INICIO_PRECIO_ALQUI,FEC_FIN_PRECIO_ALQUI,
FEC_INICIO_PRECIO_CAMP_VENTA,FEC_FIN_PRECIO_CAMP_VENTA,
FEC_INICIO_PRECIO_CAMP_ALQUI,FEC_FIN_PRECIO_CAMP_ALQUI,
FEC_POSESION,FEC_SENYAL_LANZAMIENTO,FEC_LANZAMIENTO,AVISO_OCUP_SERVICER,
IND_FUERZA_PUBLICA,IND_OCUPANTES_VIVIENDA,FEC_RESOLUCION_MORA,IND_ENTREGA_VOL_POSESI,
SEGMENTACION_CARTERA,FLAG_EN_REM,FLAG_FICHEROS,FLAG_OFERTA_VIVA
) (
        SELECT NUM_IDENTIFICATIVO, NUM_UNIDAD,CLASE_USO,NUM_INMUEBLE,CUOTA,
GRADO_PROPIEDAD,FEC_VALIDO_DE,FEC_VALIDO_A,STATUS_USUARIO,SITUACION_ALQUILER,
SOCIEDAD_PATRIMONIAL,SUBTIPO_VIVIENDA,SUBTIPO_SUELO,NUM_INMUEBLE_ANTERIOR,PRODUCTO,
PROCEDENCIA_PRODUCTO,SOCIEDAD_ORIGEN,BANCO_ORIGEN,FINCA,LIBRO,TOMO,FOLIO,INSCRIPCION,
NUM_CARTILLA,ORIGEN_REGULATORIO,CLASE_USO_REGISTRAL,IDUFIR,VIVIENDA_HABITUAL,
FEC_PRESENTACION_REGISTRO,FEC_INSC_TITULO,FEC_ADJUDICACION,FEC_TITULO_FIRME,
IMPORTE_CESION,FEC_CESION_REMATE,FEC_PRESENTADO,INDICADOR_LLAVES,FEC_RECEP_LLAVES,
NUM_AUTOS_JUZGADO,TIPO_IMPUESTO_COMPRA,SUBTIPO_IMPUESTO_COMPRA,PORC_IMPUESTO_COMPRA,
COD_TP_IVA_COMPRA,NUM_CARGAS,COD_GESTORIA,NOMBRE_REGISTRO_PROPIEDAD,
NUMERO_REGISTRO_PROPIEDAD,COD_GESTORIA_ADMINIS,TIPO_ALQUILER,COMPLEMENTO,CALLE,NUMERO,
APARTADO,POBLACION,REGION,PAIS,CALLE2,DISTRITO,ALA_EDIFICIO,PLANTA,NUM_UBICACION,
X_GOOGLE,Y_GOOGLE,SIGLA_EDIFICIO,ESTADO_TITULARIDAD,FEC_ESTADO_TITULARIDAD,
ESTADO_POSESORIO,FEC_ESTADO_POSESORIO,ESTADO_COMERCIAL_ALQUILER,
FEC_ESTADO_COMERCIAL_ALQUILER,ESTADO_COMERCIAL_VENTA,FEC_ESTADO_COMERCIAL_VENTA,
ESTADO_TECNICO,FEC_ESTADO_TECNICO,EST_COMERCIAL_SERVICER,FEC_COMERCIAL_SERVICER,
EST_DESA_PROMO_DETALLADO,FEC_DESA_PROMO_DETALLADO,EST_DESA_PROMO_GENERAL,
FEC_DESA_PROMO_GENERAL,EST_ENTR_PROD_MANT_VENTA,FEC_ENTR_PROD_MANT_VENTA,
EST_ENTR_PROD_MANT_ALQ,FEC_ENTR_PROD_MANT_ALQ,PROMO_CONJUNTA_OB_REM,
PROMO_CONJUNTA_VENTA,PROMO_CONJUNTA_ALQUILER,ACTIVO_CARTERA_CONCENTRADA,
ACTIVO_AAMM,ACTIVO_PROMO_ESTRATEG,DESTINO_COMERCIAL,CANAL_DISTRIBUCION_VENTA,
MOTIVO_NO_COMERCIAL,FEC_INICIO_CONCURENCIA,FEC_FIN_CONCURENCIA,
FEC_VISITA_INMB_SERVICER,FEC_PUBLICACION_SERVICER,PUBLICABLE_PORT_PUBLI_VENTA,
PUBLICABLE_PORT_PUBLI_ALQUI,PUBLICABLE_PORT_INVER_VENTA,PUBLICABLE_PORT_INVER_ALQUI,
PUBLICABLE_PORT_API_VENTA,PUBLICABLE_PORT_API_ALQUI,NECESIDAD_ARRAS,
MOT_NECESIDAD_ARRAS,RENUNCIA_EXENSION,CARTERA_VENTA_ACTIVOS,CARTERA_VENTA_CREDITOS,
CAT_COMERCIALIZACION,TRIBUT_PROPUESTA_VENTA,TRIBUT_PROPUESTA_CLI_EXT_IVA,
CANAL_DISTRIBUCION_ALQ,PROMO_COMERCIAL,TXT_COMERCIAL_CAS_1,
TXT_COMERCIAL_CAS_2,TXT_COMERCIAL_ENG_1,TXT_COMERCIAL_ENG_2,
FEC_PUBLI_SERVICER_APIS,FEC_PUBLI_PORT_INVERSOR,FEC_INICIO_INFORME,
FEC_FIN_INFORME,ANYO_CONCESION,FEC_FIN_CONCESION,
CALIFICACION_ENERGETICA,CERTIFICADO_REGISTRADO,FEC_SOLICITUD,
FEC_FIN_VIGENCIA,LISTA_EMISIONES,VALORES_EMISIONES,LISTA_ENERGIA,
VALOR_ENERGIA,CEDULA_HABITABILIDAD,PRECIO_MAX_MOD_VENTA,PRECIO_MAX_MOD_ALQUILER,
SITUACION_VPO,NECESARIA_AUTORI_TRANS,TANTEO_RETRACTO_TRANS,IND_COMPRADOR_ACOGE_AYUDA,
IMP_AYUDA_FINANCIACION,FEC_VENCIMIENTO_SEGURO,FEC_DEVOLUCION_AYUDA,SITUACION_CEE,
MOTIVO_EXONERACION_CEE,INCIDENCIA_CEE,NUMERO_CEE,CODIGO_SST,SUP_TASACION_SOLAR,
PORC_OBRA_EJECUTADA,SUP_TASACION_UTIL,SUP_REGISTRAL_UTIL,SUP_TASACION_CONSTRUIDA,
NUM_HABITACIONES,NUM_BANYOS,NUM_TERRAZAS,ANYO_CONSTRUCCION,ANYO_ULTIMA_REFORMA,
SUP_SOBRE_RASANTE,SUP_BAJO_RASANTE,NUM_APARACAMIENTOS,IDEN_PL_PARKING,
IDEN_TRASTERO,SUP_REG_CONSTRUIDA,SUP_REG_SOLAR,TIENE_ASCENSOR,TIENE_TRASTERO,
INMUEBLE_VACACIONAL,EQUIPAMIENTO_015001,BALCON,CALEFACCION,COCINA_EQUIPADA,
EST_CONSERVACION,JARDIN,USO_JARDIN,PISCINA,SALIDA_HUMOS,TERRAZA,TIPO_VIVIENDA_INF,
TIPOLOGIA_EDIFICIO,SEG_INVERSION_PROM,IMP_PRECIO_VENTA,PRECIO_VENTA_NEGOCIABLE,
DESC_COLEC_PRECIO_ALQUI,IMP_PRECIO_ALQUI,PRECIO_ALQUI_NEGOCIABLE,
DESC_COL_PRECIO_CAMP_ALQUI,IMP_PRECIO_CAMP_ALQUI,PRECIO_CAMP_ALQUI_NEGOCIABLE,
DESC_COL_PRECIO_CAMP_VENTA,IMP_PRECIO_CAMP_VENTA,PRECIO_CAMP_VENTA_NEGOCIABLE,
DESC_COL_PRECIO_VENTA,IMP_PRECIO_REF_ALQUI,FEC_INICIO_PRECIO_VENTA,
FEC_FIN_PRECIO_VENTA,FEC_INICIO_PRECIO_ALQUI,FEC_FIN_PRECIO_ALQUI,
FEC_INICIO_PRECIO_CAMP_VENTA,FEC_FIN_PRECIO_CAMP_VENTA,
FEC_INICIO_PRECIO_CAMP_ALQUI,FEC_FIN_PRECIO_CAMP_ALQUI,
FEC_POSESION,FEC_SENYAL_LANZAMIENTO,FEC_LANZAMIENTO,AVISO_OCUP_SERVICER,
IND_FUERZA_PUBLICA,IND_OCUPANTES_VIVIENDA,FEC_RESOLUCION_MORA,IND_ENTREGA_VOL_POSESI,
SEGMENTACION_CARTERA,FLAG_EN_REM,FLAG_FICHEROS,FLAG_OFERTA_VIVA FROM '||V_ESQUEMA_1||'.'||V_VISTA_MAT||'
    )';
    EXECUTE IMMEDIATE V_MSQL;


COMMIT;

EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
        ROLLBACK;
        RAISE;
END;
/

EXIT;