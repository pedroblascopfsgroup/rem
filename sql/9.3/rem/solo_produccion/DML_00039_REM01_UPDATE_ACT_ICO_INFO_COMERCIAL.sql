--/*
--###########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20191126
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-5853
--## PRODUCTO=NO
--## 
--## Finalidad: UPDATE ACT_ICO_INFO_COMERCIAL
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versi√≥n inicial
--###########################################
----*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar    
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquemas
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    V_NUM_FILAS NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_2 NUMBER(16); -- Vble. para validar la existencia de un registro.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USR VARCHAR2(30 CHAR) := 'REMVIP-5853'; -- USUARIOCREAR/USUARIOMODIFICAR.
    
    ACT_ID NUMBER(16);
    MEDIADOR_ID NUMBER(16);
    V_COUNT_UPDATE NUMBER(16):= 0; -- Vble. para contar updates
    
    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
			T_JBV(252608,2217),
			T_JBV(285863,5034),
			T_JBV(290235,3903),
			T_JBV(332923,5034),
			T_JBV(218842,10193),
			T_JBV(221799,10193),
			T_JBV(231780,10193),
			T_JBV(236262,10193),
			T_JBV(237199,10193),
			T_JBV(237959,10193),
			T_JBV(247812,10193),
			T_JBV(248242,10193),
			T_JBV(249221,10193),
			T_JBV(175527,10193),
			T_JBV(332983,5034),
			T_JBV(332991,5034),
			T_JBV(274973,1689),
			T_JBV(270912,10193),
			T_JBV(273901,10193),
			T_JBV(275329,10193),
			T_JBV(293759,10193),
			T_JBV(325049,10193),
			T_JBV(250941,10193),
			T_JBV(251539,10193),
			T_JBV(250585,10193),
			T_JBV(246807,10193),
			T_JBV(251439,10193),
			T_JBV(251921,10193),
			T_JBV(252520,10193),
			T_JBV(249170,10193),
			T_JBV(332841,5034),
			T_JBV(251604,10193),
			T_JBV(261302,10193),
			T_JBV(264051,10193),
			T_JBV(259526,3927),
			T_JBV(274885,5095),
			T_JBV(74826,3931),
			T_JBV(74857,3931),
			T_JBV(74872,3931),
			T_JBV(74843,3931),
			T_JBV(349438,27100),
			T_JBV(361306,3685),
			T_JBV(411444,3903),
			T_JBV(417948,24448),
			T_JBV(417949,24448),
			T_JBV(427736,139908),
			T_JBV(266663,23174),
			T_JBV(290119,72263),
			T_JBV(277353,2194),
			T_JBV(280993,3903),
			T_JBV(232529,10193),
			T_JBV(333014,5034),
			T_JBV(222842,10193),
			T_JBV(230475,10193),
			T_JBV(235547,10193),
			T_JBV(235944,10193),
			T_JBV(250705,10193),
			T_JBV(332885,5034),
			T_JBV(333232,5034),
			T_JBV(270962,10193),
			T_JBV(271325,10193),
			T_JBV(273554,10193),
			T_JBV(290995,10193),
			T_JBV(293755,10193),
			T_JBV(251540,10193),
			T_JBV(251839,10193),
			T_JBV(252067,10193),
			T_JBV(251769,10193),
			T_JBV(251073,10193),
			T_JBV(252841,10193),
			T_JBV(250890,10193),
			T_JBV(253392,10193),
			T_JBV(252979,10193),
			T_JBV(250217,10193),
			T_JBV(254663,10193),
			T_JBV(261073,10193),
			T_JBV(261183,10193),
			T_JBV(262889,10193),
			T_JBV(74870,3931),
			T_JBV(74823,3931),
			T_JBV(74832,3931),
			T_JBV(74831,3931),
			T_JBV(74853,3931),
			T_JBV(74830,3931),
			T_JBV(312964,26918),
			T_JBV(344295,26918),
			T_JBV(349602,3361),
			T_JBV(341747,27375),
			T_JBV(358436,24133),
			T_JBV(361293,3685),
			T_JBV(361318,3685),
			T_JBV(361290,3685),
			T_JBV(361309,3685),
			T_JBV(361315,3685),
			T_JBV(400755,1062),
			T_JBV(303556,27100),
			T_JBV(309813,27100),
			T_JBV(321368,27100),
			T_JBV(401207,1078),
			T_JBV(418013,20354),
			T_JBV(417945,24448),
			T_JBV(427729,1095),
			T_JBV(286583,3053),
			T_JBV(251916,3918),
			T_JBV(275880,1062),
			T_JBV(283348,2815),
			T_JBV(281201,3903),
			T_JBV(293361,3903),
			T_JBV(288743,3903),
			T_JBV(309973,26918),
			T_JBV(332940,5034),
			T_JBV(332946,5034),
			T_JBV(201939,10193),
			T_JBV(209221,10193),
			T_JBV(209222,10193),
			T_JBV(221798,10193),
			T_JBV(231342,10193),
			T_JBV(231996,10193),
			T_JBV(235926,10193),
			T_JBV(236286,10193),
			T_JBV(240499,10193),
			T_JBV(242937,10193),
			T_JBV(332880,5034),
			T_JBV(332917,5034),
			T_JBV(333243,5034),
			T_JBV(271322,10193),
			T_JBV(273356,10193),
			T_JBV(291514,10193),
			T_JBV(291511,10193),
			T_JBV(293757,10193),
			T_JBV(251574,10193),
			T_JBV(252687,10193),
			T_JBV(252686,10193),
			T_JBV(253568,10193),
			T_JBV(261195,10193),
			T_JBV(264964,10193),
			T_JBV(74856,3931),
			T_JBV(74874,3931),
			T_JBV(74869,3931),
			T_JBV(74834,3931),
			T_JBV(74822,3931),
			T_JBV(74881,3931),
			T_JBV(358517,1062),
			T_JBV(361302,3685),
			T_JBV(361304,3685),
			T_JBV(361291,3685),
			T_JBV(361308,3685),
			T_JBV(204532,1066),
			T_JBV(295007,27100),
			T_JBV(393715,2194),
			T_JBV(418010,20354),
			T_JBV(417955,24448),
			T_JBV(417953,24448),
			T_JBV(417946,24448),
			T_JBV(310450,27100),
			T_JBV(418024,20354),
			T_JBV(423435,1043),
			T_JBV(427557,25704),
			T_JBV(253481,2823),
			T_JBV(278605,3918),
			T_JBV(266154,2194),
			T_JBV(275859,1062),
			T_JBV(238483,3927),
			T_JBV(286396,3903),
			T_JBV(333656,10193),
			T_JBV(333009,5034),
			T_JBV(238027,10193),
			T_JBV(247093,10193),
			T_JBV(333249,5034),
			T_JBV(271333,10193),
			T_JBV(274883,10193),
			T_JBV(293760,10193),
			T_JBV(293756,10193),
			T_JBV(246808,10193),
			T_JBV(251442,10193),
			T_JBV(252214,10193),
			T_JBV(249659,10193),
			T_JBV(250596,10193),
			T_JBV(252854,10193),
			T_JBV(252458,10193),
			T_JBV(344104,21811),
			T_JBV(264459,10193),
			T_JBV(266886,10193),
			T_JBV(341768,27319),
			T_JBV(74842,3931),
			T_JBV(74876,3931),
			T_JBV(74851,3931),
			T_JBV(74835,3931),
			T_JBV(74825,3931),
			T_JBV(74827,3931),
			T_JBV(353634,21811),
			T_JBV(347192,27100),
			T_JBV(361296,3685),
			T_JBV(361311,3685),
			T_JBV(370677,3647),
			T_JBV(309812,27100),
			T_JBV(417952,24448),
			T_JBV(313130,27100),
			T_JBV(418026,20354),
			T_JBV(252562,1043),
			T_JBV(278355,3927),
			T_JBV(292932,23253),
			T_JBV(281355,5034),
			T_JBV(184265,3813),
			T_JBV(277173,3903),
			T_JBV(175014,10193),
			T_JBV(207187,10193),
			T_JBV(208193,10193),
			T_JBV(231343,10193),
			T_JBV(240500,10193),
			T_JBV(242290,10193),
			T_JBV(181092,10193),
			T_JBV(250704,10193),
			T_JBV(232528,10193),
			T_JBV(332971,5034),
			T_JBV(332988,5034),
			T_JBV(233003,10193),
			T_JBV(290976,10193),
			T_JBV(334206,10193),
			T_JBV(250967,10193),
			T_JBV(248775,10193),
			T_JBV(251398,10193),
			T_JBV(251441,10193),
			T_JBV(250936,10193),
			T_JBV(240663,10193),
			T_JBV(249843,10193),
			T_JBV(252511,10193),
			T_JBV(252685,10193),
			T_JBV(253982,10193),
			T_JBV(264048,10193),
			T_JBV(265313,10193),
			T_JBV(265935,10193),
			T_JBV(267006,10193),
			T_JBV(74849,3931),
			T_JBV(74838,3931),
			T_JBV(74841,3931),
			T_JBV(74878,3931),
			T_JBV(74821,3931),
			T_JBV(74852,3931),
			T_JBV(74820,3931),
			T_JBV(74844,3931),
			T_JBV(345787,21811),
			T_JBV(358435,1062),
			T_JBV(377022,5075),
			T_JBV(361299,3685),
			T_JBV(361303,3685),
			T_JBV(361287,3685),
			T_JBV(393948,3903),
			T_JBV(400753,3903),
			T_JBV(321725,27100),
			T_JBV(417956,24448),
			T_JBV(417954,24448),
			T_JBV(417950,24448),
			T_JBV(418040,20354),
			T_JBV(426997,1095),
			T_JBV(240974,2194),
			T_JBV(282254,3053),
			T_JBV(277009,5034),
			T_JBV(290299,3903),
			T_JBV(233013,10193),
			T_JBV(277419,3903),
			T_JBV(193522,10193),
			T_JBV(195266,10193),
			T_JBV(212470,10193),
			T_JBV(216751,10193),
			T_JBV(237194,10193),
			T_JBV(237196,10193),
			T_JBV(239430,10193),
			T_JBV(239189,10193),
			T_JBV(333049,5034),
			T_JBV(332978,5034),
			T_JBV(333151,5034),
			T_JBV(271730,10193),
			T_JBV(293754,10193),
			T_JBV(249487,10193),
			T_JBV(251869,10193),
			T_JBV(252114,10193),
			T_JBV(253071,10193),
			T_JBV(251852,10193),
			T_JBV(260458,10193),
			T_JBV(261271,10193),
			T_JBV(261998,10193),
			T_JBV(263026,10193),
			T_JBV(264047,10193),
			T_JBV(264210,10193),
			T_JBV(264801,10193),
			T_JBV(264971,10193),
			T_JBV(346564,3903),
			T_JBV(74868,3931),
			T_JBV(74833,3931),
			T_JBV(290408,4518),
			T_JBV(252940,1043),
			T_JBV(252941,1043),
			T_JBV(377017,5075),
			T_JBV(361305,3685),
			T_JBV(361307,3685),
			T_JBV(361292,3685),
			T_JBV(361294,3685),
			T_JBV(295726,27100),
			T_JBV(347517,1655),
			T_JBV(417951,24448),
			T_JBV(417944,24448),
			T_JBV(417947,24448),
			T_JBV(253365,24133),
			T_JBV(254563,3334),
			T_JBV(282039,4518),
			T_JBV(275879,1062),
			T_JBV(275873,1062),
			T_JBV(280752,3903),
			T_JBV(230944,3903),
			T_JBV(283033,3903),
			T_JBV(332959,5034),
			T_JBV(183142,10193),
			T_JBV(220794,10193),
			T_JBV(236285,10193),
			T_JBV(237198,10193),
			T_JBV(243126,10193),
			T_JBV(245251,10193),
			T_JBV(247385,10193),
			T_JBV(250649,10193),
			T_JBV(332970,5034),
			T_JBV(333133,5034),
			T_JBV(332943,5034),
			T_JBV(333127,5034),
			T_JBV(267619,10193),
			T_JBV(269460,10193),
			T_JBV(269568,10193),
			T_JBV(271335,10193),
			T_JBV(274300,10193),
			T_JBV(271497,10193),
			T_JBV(271897,10193),
			T_JBV(272864,10193),
			T_JBV(275377,10193),
			T_JBV(275843,10193),
			T_JBV(291967,10193),
			T_JBV(279213,5031),
			T_JBV(251440,10193),
			T_JBV(249599,10193),
			T_JBV(232413,10193),
			T_JBV(251298,10193),
			T_JBV(253095,10193),
			T_JBV(252674,10193),
			T_JBV(253547,10193),
			T_JBV(258880,10193),
			T_JBV(259193,10193),
			T_JBV(261266,10193),
			T_JBV(261444,10193),
			T_JBV(264456,10193),
			T_JBV(74880,3931),
			T_JBV(74875,3931),
			T_JBV(74861,3931),
			T_JBV(74858,3931),
			T_JBV(74829,3931),
			T_JBV(74839,3931),
			T_JBV(303256,26918),
			T_JBV(346223,27275),
			T_JBV(349467,27100),
			T_JBV(358106,21811),
			T_JBV(347121,26942),
			T_JBV(361300,3685),
			T_JBV(361295,3685),
			T_JBV(418924,3382),
			T_JBV(426594,24932),
			T_JBV(417957,24448),
			T_JBV(418002,20354),
			T_JBV(418070,20354),
			T_JBV(418019,20354),
			T_JBV(418015,20354),
			T_JBV(313867,27100),
			T_JBV(392732,1044),
			T_JBV(393584,23253),
			T_JBV(134840,1062),
			T_JBV(248325,1065),
			T_JBV(281320,3813),
			T_JBV(275853,1062),
			T_JBV(275867,1062),
			T_JBV(275881,1062),
			T_JBV(310352,26918),
			T_JBV(237195,10193),
			T_JBV(237197,10193),
			T_JBV(238951,10193),
			T_JBV(242847,10193),
			T_JBV(247369,10193),
			T_JBV(197051,10193),
			T_JBV(332860,5034),
			T_JBV(332941,5034),
			T_JBV(332935,5034),
			T_JBV(269466,10193),
			T_JBV(292480,10193),
			T_JBV(293734,10193),
			T_JBV(250586,10193),
			T_JBV(232414,10193),
			T_JBV(252334,10193),
			T_JBV(248260,10193),
			T_JBV(248261,10193),
			T_JBV(253013,10193),
			T_JBV(249171,10193),
			T_JBV(252688,10193),
			T_JBV(260701,10193),
			T_JBV(74854,3931),
			T_JBV(74848,3931),
			T_JBV(74824,3931),
			T_JBV(74828,3931),
			T_JBV(74837,3931),
			T_JBV(74862,3931),
			T_JBV(74840,3931),
			T_JBV(74879,3931),
			T_JBV(74855,3931),
			T_JBV(74873,3931),
			T_JBV(344329,21422),
			T_JBV(276900,4518),
			T_JBV(346335,3903),
			T_JBV(349445,27100),
			T_JBV(252937,1043),
			T_JBV(349502,27100),
			T_JBV(265303,2783),
			T_JBV(377018,5075),
			T_JBV(361301,3685),
			T_JBV(361289,3685),
			T_JBV(361312,3685),
			T_JBV(361285,3685),
			T_JBV(411435,2821),
			T_JBV(417672,4476),
			T_JBV(418073,20354),
			T_JBV(418074,20354),
			T_JBV(423077,4476)
	); 
	V_TMP_JBV T_JBV;
    
BEGIN	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ACTUALIZACION ACT_ICO_INFO_COMERCIAL');
	
	FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);
	
  	ACT_ID := TRIM(V_TMP_JBV(1));

	MEDIADOR_ID := TRIM(V_TMP_JBV(2));

	V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL WHERE ACT_ID = '||ACT_ID;
	
	EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS;
	
	IF V_NUM_FILAS > 0 THEN
	
		V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_ICO_INFO_COMERCIAL 
				   SET ICO_MEDIADOR_ID = '||MEDIADOR_ID||',
				   USUARIOMODIFICAR = '''||V_USR||''',
				   FECHAMODIFICAR = SYSDATE 
				   WHERE ACT_ID = '||ACT_ID||'';
	
		EXECUTE IMMEDIATE V_MSQL;
    
		DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO CON ACT_ID: '||ACT_ID||' ACTUALIZADO');
		
		V_COUNT_UPDATE := V_COUNT_UPDATE + 1;
		
	ELSE
		
		DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO NO EXISTE');
		
	END IF;
	
	END LOOP;
		
	COMMIT;
	
	DBMS_OUTPUT.PUT_LINE('[FIN] Se han updateado en total '||V_COUNT_UPDATE||' registros');
 
EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecuci√≥n:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
