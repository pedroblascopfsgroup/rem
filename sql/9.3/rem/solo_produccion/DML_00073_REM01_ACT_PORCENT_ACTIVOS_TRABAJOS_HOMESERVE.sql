--/*
--#########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20200113
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-6148
--## PRODUCTO=NO
--## 
--## Finalidad: ACTUALIZAR PORCENTAJE PARTICIPACION ACTIVOS A 100%, TRABAJOS DE UN ACTIVO DE HOMESERVE
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/
--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
	
    err_num NUMBER; -- Numero de error.
    err_msg VARCHAR2(2048); -- Mensaje de error.
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#';-- '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#';-- '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_USUARIOMODIFICAR VARCHAR(100 CHAR):= 'REMVIP-6148';
    V_SQL VARCHAR2(32000 CHAR);
    V_NUM_TABLAS NUMBER;
    V_COUNT NUMBER(16):= 0; -- Vble. para contar updates
    
BEGIN	

    DBMS_OUTPUT.PUT_LINE('[INICIO]');
    DBMS_OUTPUT.PUT_LINE('[INFO]: ACTUALIZAR IMPORTE TOTAL TRABAJOS');

    V_SQL :='MERGE INTO '||V_ESQUEMA||'.ACT_TBJ T1 USING (
		SELECT TBJ_ID FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO WHERE TBJ_NUM_TRABAJO IN (155752,
152247,
169964,
166938,
150258,
148818,
170072,
166173,
163872,
170697,
159301,
155774,
148973,
167608,
161400,
168178,
170937,
168421,
167022,
163900,
157825,
169307,
160384,
167544,
166244,
154780,
165959,
152965,
166480,
154863,
163175,
170566,
168149,
170379,
152000,
169477,
170310,
168004,
170375,
166385,
169358,
169944,
156581,
168287,
168573,
166856,
164659,
157436,
167673,
168417,
152004,
170167,
165485,
166765,
170237,
152983,
167509,
155389,
167674,
155202,
152318,
168618,
167859,
170926,
158763,
170030,
157726,
166410,
168892,
170754,
167998,
160451,
167583,
155946,
169382,
166946,
170581,
165927,
168866,
150560,
167829,
165541,
167330,
168148,
169946,
170570,
167137,
148755,
168003,
167172,
170731,
170601,
150473,
155209,
167170,
171011,
155172,
170988,
158154,
170751,
169518,
167852,
169943,
171055,
168299,
152634,
161826,
169013,
170902,
154104,
165196,
160440,
169270,
169512,
163922,
151239,
168853,
166382,
166451,
166669,
167407,
154672,
169586,
166857,
158143,
170422,
158226,
159069,
159729,
168746,
166679,
170804,
167299,
165833,
169690,
162858,
169138,
169948,
164710,
167862,
169255,
168297,
168144,
162986,
167988,
168565,
169354,
171081,
168416,
154999,
170438,
167554,
169459,
163944,
169559,
167856,
159335,
168787,
166942,
158378,
167369,
168337,
169324,
168384,
166664,
166668,
170221,
168330,
168404,
153263,
155250,
170867,
169383,
168517,
168476,
168002,
170713,
170214,
169561,
169571,
155203,
150791,
170762,
169086,
169722,
167845,
161702,
158146,
154322,
151627,
166649,
170740,
169171,
170382,
166881,
153375,
168011,
155112,
169351,
170249,
165738,
151897,
153372,
155204,
168412,
170893,
166455,
162574,
168595,
154135,
170795,
166375,
166431,
170707,
169684,
169022,
158145
)
		)T2
		ON (T1.TBJ_ID=T2.TBJ_ID)
		WHEN MATCHED THEN UPDATE SET 
		T1.ACT_TBJ_PARTICIPACION = 100
		,T1.VERSION = 1'; 	


      EXECUTE IMMEDIATE V_SQL;
    
      DBMS_OUTPUT.PUT_LINE('[INFO] Se han actualizado  '||SQL%ROWCOUNT||' registros .');

     COMMIT;

     DBMS_OUTPUT.PUT_LINE('[FIN]');

EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
        ROLLBACK;
        RAISE;
END;
/
EXIT
