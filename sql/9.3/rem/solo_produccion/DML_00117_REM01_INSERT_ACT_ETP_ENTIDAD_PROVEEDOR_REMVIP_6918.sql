--/*
--##########################################
--## AUTOR=Adrián Molina
--## FECHA_CREACION=20200409
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-6918
--## PRODUCTO=NO
--##
--## Finalidad:
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
    V_ESQUEMA VARCHAR2(25 CHAR) := '#ESQUEMA#'; -- Configuracion Esquema.
    V_ESQUEMA_MASTER VARCHAR2(25 CHAR) := '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master.
    ERR_NUM NUMBER(25); -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(10024 CHAR); -- Vble. auxiliar para registrar errores en el script.

    V_USUARIOMODIFICAR VARCHAR(100 CHAR):= 'REMVIP-6918'; -- Vble. para el usuario modificar.
    V_MSQL VARCHAR2(32000 CHAR); -- Vble. auxiliar para almacenar la sentencia a ejecutar.
	V_PVE_ID NUMBER(16);
	V_COUNT NUMBER(16);
	V_SQL VARCHAR2(4000 CHAR);
	V_NUM_REGISTRO NUMBER(16);

	TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV;

	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
T_JBV(166962),
T_JBV(166964),
T_JBV(167061),
T_JBV(167063),
T_JBV(167073),
T_JBV(167103),
T_JBV(167104),
T_JBV(167106),
T_JBV(167109),
T_JBV(167127),
T_JBV(167129),
T_JBV(167130),
T_JBV(167144),
T_JBV(167158),
T_JBV(167174),
T_JBV(167175),
T_JBV(167195),
T_JBV(167201),
T_JBV(167202),
T_JBV(167206),
T_JBV(167210),
T_JBV(167217),
T_JBV(167224),
T_JBV(167227),
T_JBV(167229),
T_JBV(167230),
T_JBV(167233),
T_JBV(167249),
T_JBV(167256),
T_JBV(167263),
T_JBV(167264),
T_JBV(167279),
T_JBV(167292),
T_JBV(167293),
T_JBV(167296),
T_JBV(167298),
T_JBV(167302),
T_JBV(167308),
T_JBV(167324),
T_JBV(167328),
T_JBV(167333),
T_JBV(167334),
T_JBV(167336),
T_JBV(167337),
T_JBV(167345),
T_JBV(167346),
T_JBV(167350),
T_JBV(167351),
T_JBV(167353),
T_JBV(167383),
T_JBV(167405),
T_JBV(167417),
T_JBV(167421),
T_JBV(167432),
T_JBV(167445),
T_JBV(167446),
T_JBV(167458),
T_JBV(167483),
T_JBV(167487),
T_JBV(167491),
T_JBV(167492),
T_JBV(167500),
T_JBV(167502),
T_JBV(167507),
T_JBV(167523),
T_JBV(167528),
T_JBV(167537),
T_JBV(167564),
T_JBV(167571),
T_JBV(167584),
T_JBV(167590),
T_JBV(167591),
T_JBV(167600),
T_JBV(167615),
T_JBV(167696),
T_JBV(167698),
T_JBV(167700),
T_JBV(167703),
T_JBV(167705),
T_JBV(167706),
T_JBV(167707),
T_JBV(167711),
T_JBV(167714),
T_JBV(167725),
T_JBV(167732),
T_JBV(167736),
T_JBV(167750),
T_JBV(167785),
T_JBV(167814),
T_JBV(167818),
T_JBV(167819),
T_JBV(167825),
T_JBV(167836),
T_JBV(167839),
T_JBV(167840),
T_JBV(167881),
T_JBV(167902),
T_JBV(167904),
T_JBV(167907),
T_JBV(167911),
T_JBV(167921),
T_JBV(167924),
T_JBV(167978),
T_JBV(167987),
T_JBV(167991),
T_JBV(168016),
T_JBV(168035),
T_JBV(168036),
T_JBV(168039),
T_JBV(168047),
T_JBV(168048),
T_JBV(168087),
T_JBV(168123),
T_JBV(168128),
T_JBV(168133),
T_JBV(168157),
T_JBV(168176),
T_JBV(168177),
T_JBV(168192),
T_JBV(168200),
T_JBV(168207),
T_JBV(168481),
T_JBV(168499),
T_JBV(168548),
T_JBV(168586),
T_JBV(168621),
T_JBV(168737),
T_JBV(168756),
T_JBV(168767),
T_JBV(168827),
T_JBV(168849),
T_JBV(168856),
T_JBV(168888),
T_JBV(168891),
T_JBV(168901),
T_JBV(168924),
T_JBV(82828),
T_JBV(42),
T_JBV(29),
T_JBV(80338),
T_JBV(63),
T_JBV(144597),
T_JBV(101),
T_JBV(93),
T_JBV(36)
	);
	V_TMP_JBV T_JBV;

BEGIN
    DBMS_OUTPUT.PUT_LINE('[INICIO]');

	V_COUNT := 0;

	FOR I IN V_JBV.FIRST .. V_JBV.LAST

	LOOP

	V_TMP_JBV := V_JBV(I);
	V_PVE_ID := TRIM(V_TMP_JBV(1));

	V_SQL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.ACT_PVE_PROVEEDOR WHERE PVE_ID = '||V_PVE_ID||'';
	EXECUTE IMMEDIATE V_SQL INTO V_NUM_REGISTRO;

    IF V_NUM_REGISTRO > 0 THEN

        V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.ACT_ETP_ENTIDAD_PROVEEDOR (
                   ETP_ID
                  , DD_CRA_ID
                  , PVE_ID
                  , VERSION
                  , USUARIOCREAR
                  , FECHACREAR
                  , BORRADO)
                  VALUES ('||V_ESQUEMA||'.S_ACT_ETP_ENTIDAD_PROVEEDOR.NEXTVAL
                  , 42
                  ,'||V_PVE_ID||'
                  , 0
                  , ''REMVIP-6918''
                  , SYSDATE
                  , 0)';
        EXECUTE IMMEDIATE V_MSQL;
    END IF;

	V_COUNT := V_COUNT +1;

	END LOOP;

	DBMS_OUTPUT.PUT_LINE('	[INFO] '||V_COUNT||' REGISTROS INSERTADOS');

    DBMS_OUTPUT.PUT_LINE('[FIN]');
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
         ERR_NUM := SQLCODE;
         ERR_MSG := SQLERRM;
         DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
         DBMS_OUTPUT.put_line('-----------------------------------------------------------');
         DBMS_OUTPUT.put_line(ERR_MSG);
         ROLLBACK;
         RAISE;
END;
/
EXIT;