--/*
--##########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20200317
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-6688
--## PRODUCTO=NO
--##
--## INSTRUCCIONES: 
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF; 
DECLARE

    PL_OUTPUT VARCHAR2(32000 CHAR);
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar    
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquemas
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    V_NUM_FILAS NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_1 NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_2 NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_3 NUMBER(16); -- Vble. para validar la existencia de un registro.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USR VARCHAR2(30 CHAR) := 'REMVIP-6688'; -- USUARIOCREAR/USUARIOMODIFICAR.
    V_ECO_ID NUMBER(16); 
    
    TRA_ID NUMBER(16);
    TAR_ID NUMBER(16);
    TEX_ID NUMBER(16);
    ACT_ID NUMBER(16);
    USU_ID NUMBER(16);
    SUP_ID NUMBER(16);
    ECO_ID NUMBER(16);
    TEX_TOKEN NUMBER(16);

    SEQ_TAR_ID NUMBER(16);

    V_COUNT_UPDATE_1 NUMBER(16):= 0; -- Vble. para contar updates
    V_COUNT_UPDATE_2 NUMBER(16):= 0; -- Vble. para contar updates
    V_COUNT_UPDATE_3 NUMBER(16):= 0; -- Vble. para contar updates

    
    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	--TRA_ID , TAR_ID, ACT_ID, USU_ID, ECO_NUM_EXPEDIENTE

	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
		T_JBV(29007, 4436965 ,55981 ,39451 ,4229),
		T_JBV(29097, 4710072 ,55984 ,39451 ,4656),
		T_JBV(29098, 2992942 ,67591 ,53048 ,6482),
		T_JBV(29105, 2992949 ,67605 ,53048 ,7873),
		T_JBV(29124, 2992968 ,59163 ,53048 ,9149),
		T_JBV(29141, 4710066 ,56011 ,39451 ,4243),
		T_JBV(29150, 2992994 ,58544 ,39900 ,9162),
		T_JBV(29153, 2992997 ,58931 ,53048 ,4182),
		T_JBV(29177, 2993690 ,55124 ,39451 ,7923),
		T_JBV(29206, 2993050 ,67613 ,53048 ,6481),
		T_JBV(29231, 2993075 ,61716 ,53048 ,4081),
		T_JBV(29273, 2993117 ,62246 ,53048 ,8719),
		T_JBV(29294, 2993138 ,58822 ,39451 ,4894),
		T_JBV(29298, 2993142 ,56010 ,39451 ,4648),
		T_JBV(29304, 2993148 ,61508 ,39451 ,6544),
		T_JBV(29375, 2993219 ,61714 ,53048 ,4110),
		T_JBV(35969, 3022056 ,113102 ,53048 ,17944),
		T_JBV(67190, 3078720 ,113056 ,39372 ,86716),
		T_JBV(74669, 3114774 ,72142 ,39451 ,89402),
		T_JBV(74703, 3115003 ,72149 ,39451 ,89417),
		T_JBV(81477, 3148974 ,260025 ,39900 ,92011),
		T_JBV(88403, 4362553 ,253954 ,39451 ,93496),
		T_JBV(90096, 3179926 ,65075 ,53048 ,94160),
		T_JBV(92241, 3191133 ,65092 ,53048 ,95168),
		T_JBV(92262, 3191300 ,65094 ,53048 ,95176),
		T_JBV(105760, 3261747 ,68128 ,53048 ,101023),
		T_JBV(107565, 4362560 ,253956 ,39451 ,101791),
		T_JBV(117328, 3324050 ,72038 ,39451 ,105041),
		T_JBV(128335, 3372659 ,67470 ,53048 ,107374),
		T_JBV(145499, 3446734 ,67483 ,53048 ,110717),
		T_JBV(176000, 3601900 ,269473 ,39274 ,115267),
		T_JBV(177724, 3585057 ,273367 ,39900 ,115771),
		T_JBV(222457, 3754427 ,66284 ,53048 ,129790),
		T_JBV(223719, 3760004 ,66298 ,53048 ,130190),
		T_JBV(228556, 3785751 ,253737 ,39451 ,132061),
		T_JBV(228558, 3785762 ,253742 ,39451 ,132062),
		T_JBV(237748, 3835221 ,62594 ,39451 ,135794),
		T_JBV(237751, 3835237 ,69636 ,39451 ,135795),
		T_JBV(252346, 3910977 ,69405 ,39451 ,141045),
		T_JBV(275351, 4032623 ,271703 ,53048 ,148824),
		T_JBV(275353, 4032653 ,271695 ,53048 ,148826),
		T_JBV(275362, 4032680 ,271714 ,53048 ,148832),
		T_JBV(275363, 4032718 ,271698 ,53048 ,148833),
		T_JBV(275375, 4032762 ,271700 ,53048 ,148842),
		T_JBV(275379, 4032793 ,271702 ,53048 ,148845),
		T_JBV(275482, 4033388 ,294103 ,53048 ,148901),
		T_JBV(275490, 4033427 ,294106 ,53048 ,148909),
		T_JBV(275539, 4033755 ,294091 ,53048 ,148935),
		T_JBV(275547, 4362573 ,294092 ,53048 ,148940),
		T_JBV(277466, 4044743 ,56122 ,53048 ,149756),
		T_JBV(280920, 4063585 ,292841 ,53048 ,151132),
		T_JBV(284180, 4082262 ,292857 ,53048 ,152590),
		T_JBV(285763, 4091735 ,332615 ,53048 ,153284),
		T_JBV(285768, 4091776 ,332622 ,53048 ,153288),
		T_JBV(285773, 4091809 ,332633 ,53048 ,153292),
		T_JBV(285781, 4091831 ,332628 ,53048 ,153297),
		T_JBV(285786, 4091876 ,57832 ,53048 ,153299),
		T_JBV(285830, 4092038 ,332623 ,53048 ,153320),
		T_JBV(285842, 4092115 ,332621 ,53048 ,153326),
		T_JBV(285851, 4092148 ,332619 ,53048 ,153333),
		T_JBV(285858, 4092198 ,332624 ,53048 ,153335),
		T_JBV(285863, 4092216 ,332617 ,53048 ,153338),
		T_JBV(285866, 4092233 ,332618 ,53048 ,153341),
		T_JBV(285873, 4092267 ,332625 ,53048 ,153346),
		T_JBV(304691, 4206371 ,272274 ,39451 ,160046),
		T_JBV(304694, 4206401 ,272277 ,39451 ,160047),
		T_JBV(313126, 4247895 ,265926 ,39451 ,162824),
		T_JBV(313392, 4249196 ,4837 ,53048 ,162910),
		T_JBV(314525, 4255044 ,349734 ,39451 ,163224),
		T_JBV(320539, 4287146 ,3625 ,39451 ,165175),
		T_JBV(327700, 4325374 ,265030 ,39372 ,167126),
		T_JBV(328050, 4588308 ,262302 ,39451 ,167235),
		T_JBV(329648, 4334162 ,332176 ,39451 ,167662),
		T_JBV(340647, 4387381 ,275706 ,53048 ,169953),
		T_JBV(340729, 4387400 ,275707 ,53048 ,169979),
		T_JBV(340750, 4387368 ,275708 ,53048 ,169986),
		T_JBV(340755, 4387361 ,275709 ,53048 ,169987),
		T_JBV(340760, 4387341 ,275704 ,53048 ,169990),
		T_JBV(340767, 4387226 ,275705 ,53048 ,169993),
		T_JBV(343538, 4399656 ,332178 ,39451 ,170583),
		T_JBV(356575, 4459943 ,38790 ,39451 ,173691),
		T_JBV(358382, 4468580 ,264867 ,39372 ,174146),
		T_JBV(365174, 4500174 ,49189 ,39372 ,175605),
		T_JBV(366779, 4506932 ,1005 ,39372 ,175883),
		T_JBV(367963, 4512073 ,49398 ,39372 ,176075),
		T_JBV(378810, 4613661 ,73755 ,39451 ,178990),
		T_JBV(385705, 4614538 ,48207 ,39274 ,180868),
		T_JBV(402423, 4701340 ,263815 ,39900 ,185750),
		T_JBV(402424, 4701342 ,263811 ,39900 ,185751),
		T_JBV(403494, 4706638 ,421351 ,39900 ,185989),
		T_JBV(404764, 4713259 ,263819 ,39900 ,186300),
		T_JBV(406887, 4726357 ,263974 ,39274 ,186920),
		T_JBV(407207, 4728131 ,72211 ,39900 ,187033),
		T_JBV(409704, 4937606 ,2298 ,39274 ,187509),
		T_JBV(410313, 4741058 ,263800 ,39900 ,187538),
		T_JBV(415131, 4850421 ,1223 ,39274 ,188777),
		T_JBV(415518, 4768289 ,410090 ,39451 ,188864),
		T_JBV(419524, 4831559 ,2861 ,39272 ,189574),
		T_JBV(422700, 4794796 ,430371 ,53048 ,190003),
		T_JBV(422732, 4795014 ,430551 ,53048 ,190016),
		T_JBV(425781, 4814598 ,271706 ,53048 ,190685),
		T_JBV(427088, 4814604 ,271708 ,53048 ,190978),
		T_JBV(427089, 4814608 ,271719 ,53048 ,190979),
		T_JBV(428956, 4824413 ,270008 ,39900 ,191396),
		T_JBV(429591, 4827145 ,292411 ,53048 ,191492),
		T_JBV(432235, 4842213 ,2992 ,39272 ,192267),
		T_JBV(433209, 4845244 ,13300 ,39274 ,192474),
		T_JBV(433209, 5026185 ,13300 ,39274 ,192474),
		T_JBV(433519, 4917853 ,3800 ,39272 ,192506),
		T_JBV(435947, 4961720 ,333940 ,39274 ,193218),
		T_JBV(438689, 4874548 ,42579 ,53048 ,193744),
		T_JBV(439038, 4957653 ,357251 ,39272 ,193823),
		T_JBV(439038, 5026961 ,357251 ,39272 ,193823),
		T_JBV(440339, 4883736 ,139 ,39272 ,194198),
		T_JBV(441309, 4886525 ,44653 ,39272 ,194291),
		T_JBV(441628, 4987163 ,2505 ,39274 ,194351),
		T_JBV(441628, 4987164 ,2505 ,39372 ,194351),
		T_JBV(441736, 4909770 ,42961 ,39274 ,194368),
		T_JBV(442759, 4893286 ,46271 ,39900 ,194606),
		T_JBV(443861, 4899304 ,13185 ,39451 ,194826),
		T_JBV(443985, 4900209 ,270093 ,39900 ,194861),
		T_JBV(444095, 4925617 ,51823 ,39900 ,194879),
		T_JBV(444161, 4957516 ,74030 ,39272 ,194894),
		T_JBV(444907, 5026178 ,1188 ,39900 ,195062),
		T_JBV(445397, 5022541 ,344998 ,39274 ,195239),
		T_JBV(445505, 4909700 ,3679 ,39272 ,195285),
		T_JBV(445809, 4911679 ,1925 ,39272 ,195353),
		T_JBV(445809, 5018719 ,1925 ,39272 ,195353),
		T_JBV(446353, 4915784 ,3642 ,39372 ,195575),
		T_JBV(446700, 4918064 ,73640 ,39274 ,195688),
		T_JBV(446808, 4918622 ,73997 ,39451 ,195700),
		T_JBV(447875, 4947042 ,49612 ,39272 ,195742),
		T_JBV(449281, 4928396 ,13193 ,39451 ,196092),
		T_JBV(449874, 4930490 ,263965 ,39372 ,196214),
		T_JBV(450347, 4933078 ,2755 ,39451 ,196319),
		T_JBV(450465, 4933909 ,2631 ,39451 ,196372),
		T_JBV(450510, 5009349 ,42997 ,39274 ,196396),
		T_JBV(450516, 4934410 ,73786 ,39272 ,196399),
		T_JBV(452046, 4940477 ,271877 ,39900 ,196675),
		T_JBV(452274, 4941196 ,1173 ,39272 ,196684),
		T_JBV(452565, 4987166 ,418253 ,39272 ,196744),
		T_JBV(452690, 4942785 ,417131 ,39451 ,196780),
		T_JBV(452969, 4944515 ,3245 ,39272 ,196842),
		T_JBV(452969, 4975111 ,3245 ,39900 ,196842),
		T_JBV(453088, 4945250 ,353745 ,39272 ,196885),
		T_JBV(453523, 4986514 ,43687 ,39372 ,197005),
		T_JBV(453524, 4973906 ,43719 ,39372 ,197006),
		T_JBV(453612, 4948365 ,75078 ,39272 ,197046),
		T_JBV(454202, 4951405 ,1920 ,39272 ,197209),
		T_JBV(454240, 4957497 ,579 ,39451 ,197217),
		T_JBV(454675, 4975620 ,390673 ,39900 ,197349),
		T_JBV(455190, 4978942 ,42256 ,39272 ,197395),
		T_JBV(455190, 4978944 ,42256 ,53048 ,197395),
		T_JBV(455730, 4960308 ,1919 ,39272 ,197541),
		T_JBV(455865, 4996403 ,74264 ,39272 ,197581),
		T_JBV(455865, 4996406 ,74264 ,53048 ,197581),
		T_JBV(455940, 4959018 ,421024 ,39451 ,197619),
		T_JBV(455943, 4959069 ,13172 ,39451 ,197620),
		T_JBV(456061, 4969279 ,122729 ,39274 ,197673),
		T_JBV(456176, 4960452 ,13401 ,39900 ,197700),
		T_JBV(456260, 4966423 ,374 ,39451 ,197737),
		T_JBV(456373, 4961801 ,5673 ,53048 ,197770),
		T_JBV(456385, 4961975 ,389339 ,53048 ,197775),
		T_JBV(456388, 4961991 ,389326 ,53048 ,197777),
		T_JBV(457361, 5024723 ,390330 ,39372 ,197936),
		T_JBV(457403, 4965825 ,42360 ,39272 ,197953),
		T_JBV(457506, 4966272 ,42155 ,39272 ,198001),
		T_JBV(457621, 4967307 ,37717 ,39272 ,198062),
		T_JBV(458304, 4970367 ,73425 ,39451 ,198210),
		T_JBV(458505, 4987156 ,3845 ,53048 ,198298),
		T_JBV(458554, 4995329 ,42323 ,39272 ,198313),
		T_JBV(458554, 4995334 ,42323 ,53048 ,198313),
		T_JBV(458632, 4980608 ,4191 ,53048 ,198331),
		T_JBV(458880, 4975151 ,261307 ,39900 ,198379),
		T_JBV(458881, 4975153 ,261348 ,39900 ,198380),
		T_JBV(458898, 4975148 ,73835 ,39900 ,198388),
		T_JBV(458960, 4987183 ,344262 ,39272 ,198405),
		T_JBV(458960, 4987192 ,344262 ,53048 ,198405),
		T_JBV(458971, 5000046 ,292121 ,39272 ,198411),
		T_JBV(458971, 5000049 ,292121 ,53048 ,198411),
		T_JBV(458984, 4974276 ,48843 ,53048 ,198417),
		T_JBV(459007, 4974419 ,408420 ,53048 ,198431),
		T_JBV(459019, 4994514 ,13313 ,39451 ,198437),
		T_JBV(459055, 4996830 ,429356 ,39272 ,198454),
		T_JBV(459055, 4996832 ,429356 ,53048 ,198454),
		T_JBV(459057, 5006376 ,4757 ,39272 ,198455),
		T_JBV(459057, 5006381 ,4757 ,39900 ,198455),
		T_JBV(459058, 5018809 ,3803 ,39272 ,198456),
		T_JBV(459058, 5018811 ,3803 ,39900 ,198456),
		T_JBV(459091, 4996903 ,427248 ,39272 ,198465),
		T_JBV(459091, 4996906 ,427248 ,53048 ,198465),
		T_JBV(459096, 4996958 ,427290 ,39272 ,198468),
		T_JBV(459096, 4996960 ,427290 ,53048 ,198468),
		T_JBV(459103, 4975028 ,355 ,39451 ,198471),
		T_JBV(459111, 4996989 ,427370 ,39272 ,198475),
		T_JBV(459111, 4996992 ,427370 ,53048 ,198475),
		T_JBV(459651, 4976995 ,37719 ,39272 ,198539),
		T_JBV(459674, 4980328 ,355959 ,39372 ,198550),
		T_JBV(459681, 4987368 ,411577 ,39274 ,198555),
		T_JBV(459915, 4998664 ,261345 ,39900 ,198591),
		T_JBV(461151, 4984316 ,3305 ,39272 ,198832),
		T_JBV(461151, 4984321 ,3305 ,53048 ,198832),
		T_JBV(461201, 4997077 ,429208 ,39272 ,198848),
		T_JBV(461201, 4997081 ,429208 ,53048 ,198848),
		T_JBV(461325, 5003334 ,334326 ,39272 ,198888),
		T_JBV(461347, 4997125 ,427381 ,39272 ,198896),
		T_JBV(461347, 4997128 ,427381 ,53048 ,198896),
		T_JBV(461371, 4988963 ,39778 ,39372 ,198907),
		T_JBV(461375, 4986375 ,39769 ,39372 ,198909),
		T_JBV(461682, 4997169 ,429473 ,39272 ,198973),
		T_JBV(461682, 4997172 ,429473 ,53048 ,198973),
		T_JBV(461993, 5003812 ,2655 ,39272 ,199059),
		T_JBV(462112, 5020404 ,412799 ,39272 ,199079),
		T_JBV(462112, 5020449 ,412799 ,39900 ,199079),
		T_JBV(462330, 5018047 ,346537 ,39274 ,199146),
		T_JBV(462330, 5018048 ,346537 ,39372 ,199146),
		T_JBV(462738, 4993354 ,5927 ,39272 ,199188),
		T_JBV(462738, 4993360 ,5927 ,39451 ,199188),
		T_JBV(462825, 5026449 ,46546 ,39274 ,199223),
		T_JBV(462848, 5024615 ,46025 ,39274 ,199234),
		T_JBV(462848, 5024618 ,46025 ,39451 ,199234),
		T_JBV(462895, 4994495 ,40066 ,53048 ,199247),
		T_JBV(462944, 5001472 ,248 ,53048 ,199263),
		T_JBV(463002, 4996056 ,418379 ,39372 ,199279),
		T_JBV(463013, 5001603 ,427254 ,39272 ,199281),
		T_JBV(463013, 5001605 ,427254 ,53048 ,199281),
		T_JBV(463048, 4996226 ,3850 ,53048 ,199288),
		T_JBV(463057, 4995591 ,1223 ,39900 ,199289),
		T_JBV(463074, 4995419 ,39805 ,39372 ,199292),
		T_JBV(463088, 5007562 ,275874 ,39900 ,199298),
		T_JBV(463116, 4995603 ,358017 ,39451 ,199306),
		T_JBV(463126, 4995741 ,39740 ,39372 ,199307),
		T_JBV(463181, 5010681 ,355956 ,39372 ,199323),
		T_JBV(463212, 4996589 ,13256 ,39451 ,199333),
		T_JBV(463666, 4999034 ,355822 ,39272 ,199417),
		T_JBV(463666, 4999038 ,355822 ,53048 ,199417),
		T_JBV(463668, 5018480 ,354908 ,39900 ,199418),
		T_JBV(463704, 4999138 ,48827 ,53048 ,199423),
		T_JBV(463804, 5003318 ,270673 ,39900 ,199457),
		T_JBV(463813, 5000210 ,355899 ,39272 ,199460),
		T_JBV(463813, 5000213 ,355899 ,53048 ,199460),
		T_JBV(463897, 5000722 ,5480 ,39272 ,199473),
		T_JBV(463897, 5000724 ,5480 ,39900 ,199473),
		T_JBV(464007, 5022196 ,73225 ,39272 ,199485),
		T_JBV(464007, 5022199 ,73225 ,53048 ,199485),
		T_JBV(464145, 5001925 ,270900 ,53048 ,199527),
		T_JBV(464160, 5002108 ,38994 ,39372 ,199533),
		T_JBV(464222, 5002896 ,437716 ,39900 ,199563),
		T_JBV(464239, 5014488 ,3258 ,39272 ,199568),
		T_JBV(464239, 5014491 ,3258 ,53048 ,199568),
		T_JBV(464306, 5004090 ,39468 ,39900 ,199592),
		T_JBV(464321, 5005637 ,122860 ,39272 ,199597),
		T_JBV(464676, 5005268 ,73425 ,39451 ,199664),
		T_JBV(464909, 5016650 ,344171 ,39274 ,199718),
		T_JBV(464939, 5010674 ,4062 ,53048 ,199719),
		T_JBV(464948, 5015605 ,353699 ,39900 ,199720),
		T_JBV(465484, 5016615 ,269735 ,39274 ,199850),
		T_JBV(465498, 5014572 ,349291 ,39272 ,199855),
		T_JBV(465498, 5014577 ,349291 ,53048 ,199855),
		T_JBV(465646, 5018884 ,44705 ,39272 ,199896),
		T_JBV(465646, 5018888 ,44705 ,39900 ,199896),
		T_JBV(466231, 5021663 ,354842 ,39272 ,199912),
		T_JBV(466518, 5012326 ,73029 ,39451 ,199959),
		T_JBV(466578, 5024682 ,2718 ,39274 ,199979),
		T_JBV(466578, 5024689 ,2718 ,39451 ,199979),
		T_JBV(466591, 5020775 ,2565 ,39451 ,199987),
		T_JBV(466608, 5012876 ,389323 ,53048 ,199991),
		T_JBV(466619, 5012951 ,389321 ,53048 ,199995),
		T_JBV(466647, 5013125 ,389329 ,53048 ,200001),
		T_JBV(466654, 5013565 ,389320 ,53048 ,200005),
		T_JBV(466741, 5013664 ,389306 ,53048 ,200049),
		T_JBV(466787, 5026495 ,412005 ,39272 ,200072),
		T_JBV(466894, 5014634 ,264399 ,53048 ,200099),
		T_JBV(466900, 5014663 ,253734 ,53048 ,200102),
		T_JBV(466975, 5022234 ,427260 ,39272 ,200117),
		T_JBV(466975, 5022237 ,427260 ,53048 ,200117),
		T_JBV(467126, 5016182 ,260467 ,39272 ,200162),
		T_JBV(467200, 5016530 ,271222 ,39451 ,200185),
		T_JBV(467404, 5017886 ,3388 ,39451 ,200226),
		T_JBV(467422, 5018075 ,345412 ,53048 ,200231),
		T_JBV(467469, 5018597 ,353699 ,39900 ,200239),
		T_JBV(467500, 5027833 ,421272 ,39272 ,200243),
		T_JBV(467500, 5027839 ,421272 ,53048 ,200243),
		T_JBV(467516, 5018796 ,2886 ,39451 ,200246),
		T_JBV(467557, 5022706 ,272059 ,39272 ,200250),
		T_JBV(467557, 5022710 ,272059 ,53048 ,200250),
		T_JBV(468043, 5021776 ,270679 ,39272 ,200349),
		T_JBV(468043, 5021779 ,270679 ,39900 ,200349),
		T_JBV(468065, 5021906 ,73187 ,39451 ,200356),
		T_JBV(468072, 5025333 ,42363 ,39272 ,200359),
		T_JBV(468090, 5022133 ,292461 ,53048 ,200368),
		T_JBV(468127, 5024309 ,1834 ,39274 ,200378),
		T_JBV(468127, 5024310 ,1834 ,39372 ,200378),
		T_JBV(468234, 5023795 ,1868 ,39274 ,200404),
		T_JBV(468234, 5023796 ,1868 ,39372 ,200404),
		T_JBV(468236, 5023296 ,48786 ,53048 ,200405),
		T_JBV(468412, 5026971 ,1294 ,39272 ,200481),
		T_JBV(468412, 5026976 ,1294 ,39900 ,200481),
		T_JBV(468415, 5024624 ,272561 ,39274 ,200482),
		T_JBV(468415, 5024625 ,272561 ,39372 ,200482),
		T_JBV(468469, 5025262 ,13186 ,39274 ,200497),
		T_JBV(468469, 5025265 ,13186 ,39451 ,200497),
		T_JBV(468551, 5025468 ,291137 ,39900 ,200529),
		T_JBV(468643, 5025914 ,427303 ,53048 ,200569)

		); 
	V_TMP_JBV T_JBV;
    
BEGIN	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ACTUALIZACION TRAMITES Y TAREAS');

	FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);
	
  	TRA_ID := TRIM(V_TMP_JBV(1));
  	
  	TAR_ID := TRIM(V_TMP_JBV(2));

	ACT_ID := TRIM(V_TMP_JBV(3));

	USU_ID := TRIM(V_TMP_JBV(4));
  	
  	ECO_ID := TRIM(V_TMP_JBV(5));


	--COMPROBAMOS SI EXISTE TRABAJO

	V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL WHERE ECO_NUM_EXPEDIENTE = '||ECO_ID;
	
	EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS;
	
	IF V_NUM_FILAS > 0 THEN 
	
	--QUITAMOS EL TOKEN DEL TRAMITE

		V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS WHERE TRA_ID = '||TRA_ID||' AND TAR_ID = '||TAR_ID||' AND ACT_ID = '||ACT_ID||'';
	
		EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS_1;
	
		IF V_NUM_FILAS_1 > 0 THEN
	
			V_MSQL := 'UPDATE '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS 
					   SET USU_ID = '||USU_ID||',
					   USUARIOMODIFICAR = '''||V_USR||''',
					   FECHAMODIFICAR = SYSDATE 
					   WHERE TRA_ID = '||TRA_ID||' AND TAR_ID = '||TAR_ID||' AND ACT_ID = '||ACT_ID||'';
	

			EXECUTE IMMEDIATE V_MSQL;
	    
			DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO CON TRA_ID: '||TRA_ID||' ACTUALIZADO');
		
			V_COUNT_UPDATE_1 := V_COUNT_UPDATE_1 + 1;
		
		ELSE
		
			DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO NO EXISTE');
		
		END IF;
        
   	ELSE
		
	DBMS_OUTPUT.PUT_LINE('[INFO] EXPEDIENTE NO EXISTE');
		
	END IF; 

   	END LOOP;

	DBMS_OUTPUT.PUT_LINE('********************************************************************');

	DBMS_OUTPUT.PUT_LINE('[FIN] Se han updateado en total '||V_COUNT_UPDATE_1||' registros EN TAC_TAREAS_ACTIVOS');

	DBMS_OUTPUT.PUT_LINE('********************************************************************');

	DBMS_OUTPUT.PUT_LINE('[FIN] ');

	COMMIT;

EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
