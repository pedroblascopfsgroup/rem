--/*
--#########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20200403
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-6836
--## PRODUCTO=NO
--## 
--## Finalidad: 
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
	
    err_num NUMBER; -- Numero de error.
    err_msg VARCHAR2(2048); -- Mensaje de error.
    V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; -- Configuracion Esquemas.
    V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; -- Configuracion Esquemas.
    V_USUARIOMODIFICAR VARCHAR(100 CHAR):= 'REMVIP-6836';
    V_SQL VARCHAR2(32000 CHAR);

BEGIN			
			
	DBMS_OUTPUT.PUT_LINE('[INICIO] Actualiza cuentas y partidas gastos ');			


	V_SQL := ' MERGE INTO '||V_ESQUEMA||'.GIC_GASTOS_INFO_CONTABILIDAD T1
		USING (	
		SELECT DISTINCT GPV.GPV_ID
		FROM '||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR GPV
		WHERE GPV.GPV_NUM_GASTO_HAYA IN (11385773,
			11385774,
			11385775,
			11388207,
			11393746,
			11393753,
			11393754,
			11393755,
			11393756,
			11393757,
			11393758,
			11393770,
			11393772,
			11393773,
			11393774,
			11393775,
			11393776,
			11393777,
			11393778,
			11393782,
			11393783,
			11393784,
			11393785,
			11393786,
			11393787,
			11393788,
			11393792,
			11393793,
			11393795,
			11393796,
			11393797,
			11393798,
			11393799,
			11393800,
			11393801,
			11393805,
			11393806,
			11393807,
			11393808,
			11393809,
			11393810,
			11393811,
			11393812,
			11393813,
			11393814,
			11393815,
			11393816,
			11393817,
			11393818,
			11395139,
			11395140,
			11395141,
			11395164,
			11395165,
			11395166,
			11395167,
			11395168,
			11395169,
			11395170,
			11395171,
			11395172,
			11395173,
			11395174,
			11395175,
			11395176,
			11395177,
			11395178,
			11395179,
			11395180,
			11395181,
			11396336,
			11396338,
			11396377,
			11396378,
			11396379,
			11396380,
			11396381,
			11396382,
			11396383,
			11396384,
			11396452,
			11397507,
			11397508,
			11397546,
			11397547,
			11397548,
			11397549,
			11397550,
			11397551,
			11397552,
			11397553,
			11397554,
			11397555,
			11397556,
			11397557,
			11397558,
			11397559,
			11397560,
			11397561,
			11397562,
			11397563,
			11397564,
			11397565,
			11397566,
			11397567,
			11397568,
			11397569,
			11397571,
			11397572,
			11397574,
			11397792,
			11397793,
			11397794,
			11397795,
			11397804,
			11397805,
			11397806,
			11397807,
			11397808,
			11397809,
			11397811,
			11397812,
			11397813,
			11397814,
			11398312,
			11398313,
			11398314,
			11398315,
			11398316,
			11398317,
			11398318,
			11398319,
			11398320,
			11398323,
			11398324,
			11398325,
			11398326,
			11398343,
			11398344,
			11398345,
			11398346,
			11398347,
			11398348,
			11398349,
			11398350,
			11398351,
			11398352,
			11398353,
			11398354,
			11398355,
			11398356,
			11398357,
			11398358,
			11398359,
			11398360,
			11398361,
			11398362,
			11398363,
			11398364,
			11398365,
			11398366,
			11398367,
			11398368,
			11398369,
			11398370,
			11398371,
			11398372,
			11398373,
			11398374,
			11398375,
			11398376,
			11398377,
			11398378,
			11398379,
			11398380,
			11398381,
			11398382,
			11398383,
			11398384,
			11398385,
			11398386,
			11398387,
			11398388,
			11398389,
			11398390,
			11398391,
			11398392,
			11398393,
			11398394,
			11398395,
			11398396,
			11398397,
			11398398,
			11398399,
			11398400,
			11398401,
			11398402,
			11398403,
			11398404,
			11398405,
			11398406,
			11398407,
			11398408,
			11398409,
			11398410,
			11398411,
			11398412,
			11398413,
			11398414,
			11398415,
			11398416,
			11398417,
			11398418,
			11398419,
			11398420,
			11398421,
			11398422,
			11398423,
			11398424,
			11398425,
			11398426,
			11398427,
			11398428,
			11398429,
			11398430,
			11398431,
			11398432,
			11398433,
			11398434,
			11398435,
			11398436,
			11398437,
			11398438,
			11398439,
			11398440,
			11398441,
			11398442,
			11398443,
			11398444,
			11398445,
			11398446,
			11398447,
			11398448,
			11398449,
			11398450,
			11398451,
			11398452,
			11398453,
			11398454,
			11398455,
			11398456,
			11398457,
			11398458,
			11398459,
			11398460,
			11398461,
			11398462,
			11398463,
			11398464,
			11398465,
			11398466,
			11398467,
			11398468,
			11398469,
			11398470,
			11398471,
			11398472,
			11398473,
			11398474,
			11398475,
			11398476,
			11398477,
			11398478,
			11398479,
			11398480,
			11398481,
			11398482,
			11398483,
			11398484,
			11398485,
			11398486,
			11398487,
			11398488,
			11398489,
			11398490,
			11398491,
			11398492,
			11398493,
			11398494,
			11398495,
			11398496,
			11398497,
			11398498,
			11398499,
			11398500,
			11398501,
			11398502,
			11398503,
			11398504,
			11398505,
			11398506,
			11398507,
			11398508,
			11398509,
			11398510,
			11398511,
			11398512,
			11398513,
			11398514,
			11398515,
			11398516,
			11398557,
			11398558,
			11398559,
			11398560,
			11398561,
			11398562,
			11398563,
			11398567,
			11398568,
			11398569,
			11398570,
			11398571,
			11398572,
			11398573,
			11398577,
			11398578,
			11398579,
			11398580,
			11398581,
			11398582,
			11398583,
			11398592,
			11398593,
			11398602,
			11398603,
			11398604,
			11398605,
			11398606,
			11398607,
			11398608,
			11398612,
			11398613,
			11398615,
			11398616,
			11398617,
			11398620,
			11398621,
			11398622,
			11398623,
			11398624,
			11398625,
			11398626,
			11398630,
			11398631,
			11398632,
			11398633,
			11398634,
			11398635,
			11398636,
			11398637,
			11398638,
			11398639,
			11398640,
			11398641,
			11398642,
			11398643,
			11398654,
			11398655,
			11398709,
			11398710,
			11398711,
			11398712,
			11398713,
			11398714,
			11398715,
			11398718,
			11398719,
			11398720,
			11398721,
			11398722,
			11398723,
			11398724,
			11399015,
			11399016,
			11399017,
			11399018,
			11399019,
			11399027,
			11399028,
			11399029,
			11399030,
			11399031,
			11399037,
			11400967,
			11400968,
			11400969,
			11400970,
			11400971,
			11400972,
			11400973,
			11401002,
			11401028,
			11401029
			)
			) T2
		ON (T1.GPV_ID = T2.GPV_ID)
		WHEN MATCHED THEN UPDATE
		SET 	T1.GIC_CUENTA_CONTABLE = ''6220000000'',
	   	 	T1.GIC_PTDA_PRESUPUESTARIA = ''PP011'',
	    		T1.USUARIOMODIFICAR = ''' || V_USUARIOMODIFICAR || ''',
	   	 	T1.FECHAMODIFICAR   = SYSDATE';

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Actualizados '||SQL%ROWCOUNT||' registros en GIC_GASTOS_INFO_CONTABILIDAD');  

	V_SQL := ' MERGE INTO '||V_ESQUEMA||'.GIC_GASTOS_INFO_CONTABILIDAD T1
		USING (	
		SELECT DISTINCT GPV.GPV_ID
		FROM '||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR GPV
		WHERE GPV.GPV_NUM_GASTO_HAYA IN (11124408,
			11136687,
			11136694,
			11136712,
			11136713,
			11136714,
			11136715,
			11154794,
			11154795,
			11242581,
			11242582,
			11242583,
			11242584,
			11242585,
			11242586,
			11253008,
			11253015,
			11380059,
			11383835
			)
			) T2
		ON (T1.GPV_ID = T2.GPV_ID)
		WHEN MATCHED THEN UPDATE
		SET 	T1.GIC_CUENTA_CONTABLE = ''6220000000'',
	   	 	T1.GIC_PTDA_PRESUPUESTARIA = ''G011339'',
	    		T1.USUARIOMODIFICAR = ''' || V_USUARIOMODIFICAR || ''',
	   	 	T1.FECHAMODIFICAR   = SYSDATE';

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Actualizados '||SQL%ROWCOUNT||' registros en GIC_GASTOS_INFO_CONTABILIDAD');  

	V_SQL := ' MERGE INTO '||V_ESQUEMA||'.GIC_GASTOS_INFO_CONTABILIDAD T1
		USING (	
		SELECT DISTINCT GPV.GPV_ID
		FROM '||V_ESQUEMA||'.GPV_GASTOS_PROVEEDOR GPV
		WHERE GPV.GPV_NUM_GASTO_HAYA IN (11124405,
			11307275
			)
			) T2
		ON (T1.GPV_ID = T2.GPV_ID)
		WHEN MATCHED THEN UPDATE
		SET 	T1.GIC_CUENTA_CONTABLE = ''6220000010'',
	   	 	T1.GIC_PTDA_PRESUPUESTARIA = ''G011339'',
	    		T1.USUARIOMODIFICAR = ''' || V_USUARIOMODIFICAR || ''',
	   	 	T1.FECHAMODIFICAR   = SYSDATE';

	EXECUTE IMMEDIATE V_SQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Actualizados '||SQL%ROWCOUNT||' registros en GIC_GASTOS_INFO_CONTABILIDAD');  

	COMMIT;

	DBMS_OUTPUT.PUT_LINE('[FIN] Proceso realizado');
	

EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
        ROLLBACK;
        RAISE;
END;
/
EXIT
