--/*
--#########################################
--## AUTOR=Carles Molins
--## FECHA_CREACION=20200411
--## ARTEFACTO=migracion
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-6940
--## PRODUCTO=NO
--## 
--## Finalidad:
--##                    
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;

DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar    
    V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; -- Configuracion Esquemas
    V_ESQUEMA_M VARCHAR2(25 CHAR):= 'REMMASTER'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    V_NUM_FILAS NUMBER(16); -- Vble. para validar la existencia de un registro.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    PL_OUTPUT VARCHAR2(32000 char);
    
    V_USUARIO VARCHAR(50 CHAR):= 'REMVIP-6940';
    OFR_NUM_OFERTA NUMBER(16);
    TAP_CODIGO VARCHAR2(50 CHAR);
    ECO_NUM_EXPEDIENTE NUMBER(16);
    TRA_ID NUMBER(16);

BEGIN
    
    DBMS_OUTPUT.put_line('  [INFO] BORRADO TAREAS T017_RespuestaOfertanteCES');

    V_SQL := 'DELETE '||V_ESQUEMA||'.TEV_TAREA_EXTERNA_VALOR TEX 
                WHERE EXISTS (
                    SELECT DISTINCT AUX.TAR_ID 
                    FROM '||V_ESQUEMA||'.AUX_POS_TRAMITE_COMERCIAL_APPLE AUX 
                    WHERE TAP = ''T017_RespuestaOfertanteCES''
                    AND TEX.TEX_ID = AUX.TEX_ID
                )';
    EXECUTE IMMEDIATE V_SQL;

    V_SQL := 'DELETE '||V_ESQUEMA||'.TEX_TAREA_EXTERNA TEX 
                WHERE EXISTS (
                    SELECT DISTINCT AUX.TAR_ID 
                    FROM '||V_ESQUEMA||'.AUX_POS_TRAMITE_COMERCIAL_APPLE AUX 
                    WHERE TAP = ''T017_RespuestaOfertanteCES''
                    AND TEX.TEX_ID = AUX.TEX_ID
                )';
    EXECUTE IMMEDIATE V_SQL;
                
    V_SQL := 'DELETE '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS TAC 
                WHERE EXISTS (
                    SELECT DISTINCT AUX.TAR_ID 
                    FROM '||V_ESQUEMA||'.AUX_POS_TRAMITE_COMERCIAL_APPLE AUX 
                    WHERE TAP = ''T017_RespuestaOfertanteCES''
                    AND TAC.TAR_ID = AUX.TAR_ID
                )';
    EXECUTE IMMEDIATE V_SQL;
    
    V_SQL := 'DELETE '||V_ESQUEMA||'.TAR_TAREAS_NOTIFICACIONES TAR 
                WHERE EXISTS (
                    SELECT DISTINCT AUX.TAR_ID 
                    FROM '||V_ESQUEMA||'.AUX_POS_TRAMITE_COMERCIAL_APPLE AUX 
                    WHERE TAP = ''T017_RespuestaOfertanteCES''
                    AND TAR.TAR_ID = AUX.TAR_ID
                )';
    EXECUTE IMMEDIATE V_SQL;
    
    DBMS_OUTPUT.put_line('  [INFO] AVANCE_TRAMITE_MIG_DIVARIAN T017_RecomendCES');
    
    REM01.AVANCE_TRAMITE_MIG_DIVARIAN (''||V_USUARIO||'',
       '201875,
        201959,
        202731,
        207093,
        207166,
        208171,
        207374,
        206726,
        206765,
        208534,
        208538,
        208621,
        207754,
        206149,
        203595,
        202884,
        205103,
        201893,
        202089,
        202669,
        202447,
        202460,
        208380,
        206652,
        208561,
        208622,
        206262,
        202902,
        203102,
        204041,
        203405,
        204344,
        206121,
        201549,
        201980,
        202285,
        202646,
        202591,
        202375,
        202636,
        207912,
        207090,
        207103,
        206603,
        206610,
        203504,
        206320,
        202908,
        205545,
        203100,
        205760,
        203152,
        204072,
        203369,
        204312,
        202126,
        201916,
        202643,
        206380,
        208209,
        208255,
        208303,
        208465,
        208543,
        208583,
        208584,
        206316,
        206344,
        205438,
        202894,
        203128,
        203186,
        205908,
        206069,
        203467,
        202004,
        202029,
        202575,
        202750,
        202429,
        202184,
        207293,
        206422,
        206751,
        206885,
        203572,
        206272,
        204591,
        205674,
        203174,
        205984,
        201906,
        201927,
        202313,
        202556,
        202335,
        206954,
        208680,
        208681,
        208256,
        208321,
        208508,
        208564,
        208577,
        206842,
        207707,
        207781,
        206169,
        206271,
        206309,
        203744,
        202889,
        203150,
        201994,
        202020,
        202594,
        202507,
        202242,
        202260,
        208652,
        208682,
        208148,
        206435,
        208369,
        208388,
        206642,
        208559,
        208581,
        208604,
        208617,
        206861,
        203623,
        202869,
        202874,
        205526,
        205637,
        204889,
        204199,
        206073,
        205231,
        202154,
        202740,
        202409,
        202810,
        202229,
        202240,
        207008,
        206387,
        206427,
        206606,
        207501,
        208542,
        208555,
        208562,
        206896,
        206273,
        202867,
        202910,
        202972,
        203061,
        203070,
        205742,
        205815'
        , 'T017_RecomendCES', NULL, NULL);
        
    DBMS_OUTPUT.put_line('  [INFO] AVANCE_TRAMITE_MIG_DIVARIAN T017_InstruccionesReserva');
    
    REM01.AVANCE_TRAMITE_MIG_DIVARIAN (''||V_USUARIO||'', 
       '204449,
        204805,
        205180,
        205539,
        205540,
        202373,
        203689,
        204283,
        204826,
        205212,
        205215,
        201577,
        201821,
        204837,
        205224,
        205229,
        205263,
        201602,
        201603,
        202705,
        202950,
        204886,
        204902,
        205270,
        205288,
        204916,
        204927,
        205304,
        203495,
        204575,
        204577,
        204578,
        205326,
        205329,
        205334,
        204950,
        205337,
        205342,
        205344,
        205355,
        204982,
        205357,
        205367,
        205376,
        205378,
        203839,
        203840,
        204124,
        204642,
        201526,
        204327,
        204333,
        204657,
        204662,
        205045,
        205400,
        205414,
        203063,
        203888,
        203894,
        205058,
        205417,
        205426,
        205077,
        205078,
        205446,
        205448,
        205451,
        204378,
        205101,
        205468,
        204397,
        204762,
        205155,
        205485,
        205486,
        205489,
        205494,
        205496,
        205497,
        203130,
        203362,
        204244,
        204774,
        204780,
        205504,
        205507,
        205517,
        205525,
        203165,
        205898,
        205901,
        205907,
        206260,
        206263,
        206268,
        206278,
        206279,
        206280,
        207506,
        207985,
        207991,
        208008,
        208532,
        208552,
        205547,
        205554,
        205567,
        205912,
        205916,
        205924,
        205930,
        206285,
        206288,
        206290,
        206292,
        206300,
        206302,
        207537,
        208025,
        208013,
        208014,
        208020,
        201559,
        208560,
        208561,
        208576,
        205949,
        208039,
        208046,
        205570,
        205578,
        205580,
        205581,
        205941,
        205944,
        205945,
        208054,
        208065,
        208072,
        208076,
        208610,
        205597,
        201540,
        205953,
        205957,
        205966,
        205967,
        205968,
        205973,
        205974,
        206338,
        206312,
        206321,
        206336,
        208077,
        208082,
        208084,
        208089,
        208091,
        208094,
        208100,
        208102,
        205616,
        205624,
        206003,
        207606,
        205982,
        205988,
        205999,
        206000,
        206343,
        206344,
        201560,
        208644,
        208651,
        206009,
        206015,
        206021,
        206022,
        208149,
        206356,
        206358,
        207633,
        207651,
        208114,
        208118,
        206368,
        208130,
        208139,
        205639,
        205645,
        205649,
        206028,
        208156,
        208160,
        208162,
        208163,
        208164,
        208165,
        208166,
        208669,
        201541,
        205656,
        205659,
        205664,
        205666,
        206033,
        206034,
        206035,
        206039,
        206042,
        206050,
        206052,
        206391,
        207686,
        208179,
        208195,
        208208,
        205692,
        205697,
        206055,
        207730,
        208215,
        208216,
        208219,
        208226,
        208230,
        205711,
        201542,
        205723,
        208174,
        206397,
        206401,
        207698,
        207728,
        208234,
        208237,
        208241,
        205716,
        205717,
        205722,
        205725,
        205730,
        206078,
        206080,
        206081,
        206084,
        208244,
        205733,
        205745,
        205746,
        205750,
        206102,
        206106,
        206107,
        206112,
        206113,
        205770,
        206073,
        206075,
        206733,
        207765,
        206117,
        205758,
        205761,
        205762,
        205763,
        205767,
        205772,
        205779,
        206122,
        206128,
        206145,
        207221,
        207235,
        207243,
        206133,
        206143,
        206440,
        208329,
        208345,
        208348,
        205787,
        205797,
        206147,
        206148,
        206152,
        206153,
        206157,
        206165,
        207328,
        207349,
        208364,
        208372,
        208374,
        208378,
        205825,
        207819,
        207842,
        205802,
        205807,
        205813,
        205822,
        207860,
        206168,
        206175,
        206183,
        206189,
        206850,
        208395,
        208399,
        208403,
        208404,
        208412,
        208414,
        208423,
        205831,
        206191,
        206195,
        206196,
        206197,
        206200,
        206207,
        206212,
        208437,
        208445,
        208446,
        208458,
        205865,
        207886,
        207899,
        205854,
        205863,
        205864,
        207917,
        207923,
        205867,
        206213,
        206233,
        206227,
        206229,
        206231,
        206234,
        208479,
        205878,
        205882,
        205883,
        205884,
        205886,
        205887,
        205888,
        205889,
        205890,
        206240,
        206241,
        206243,
        206245,
        206257,
        207974,
        207980,
        208501,
        208506,
        208507,
        207962,
        207425,
        207944,
        207947,
        207469'
        , 'T017_InstruccionesReserva', NULL, NULL);
        
    DBMS_OUTPUT.put_line('  [INFO] AVANCE_TRAMITE_MIG_DIVARIAN T017_PBCReserva');
    
    REM01.AVANCE_TRAMITE_MIG_DIVARIAN (''||V_USUARIO||'',
       '201565,
        201749,
        201874,
        202064,
        202207,
        202587,
        202822,
        202845,
        202854,
        203348,
        203350,
        203567,
        203596,
        203638,
        203769,
        203808,
        203905,
        203921,
        203923,
        204105,
        204160,
        204351,
        204404,
        204459,
        204507,
        204622,
        204665,
        204681,
        204776,
        204789,
        204908,
        204962,
        204985,
        205012,
        205025,
        205030,
        205031,
        205055,
        205059,
        205103,
        205105,
        205117,
        205118,
        205156,
        205190,
        205220,
        205231,
        205247,
        205250,
        205260,
        205280,
        205313,
        205316,
        205320,
        205328,
        205371,
        205389,
        205413,
        205420,
        205422,
        205432,
        205443,
        205447,
        205453,
        205464,
        205466,
        205493,
        205515,
        205519,
        205522,
        205528,
        205536,
        205542,
        205572,
        205574,
        205583,
        205592,
        205593,
        205594,
        205601,
        205609,
        205620,
        205630,
        205637,
        205646,
        205651,
        205653,
        205667,
        205674,
        205675,
        205688,
        205699,
        205707,
        205709,
        205710,
        205712,
        205719,
        205735,
        205738,
        205752,
        205753,
        205757,
        205759,
        205774,
        205778,
        205780,
        205793,
        205796,
        205798,
        205800,
        205803,
        205816,
        205818,
        205820,
        205823,
        205826,
        205828,
        205829,
        205830,
        205832,
        205835,
        205839,
        205841,
        205851,
        205853,
        205857,
        205866,
        205873,
        205874,
        201544,
        205896,
        205897,
        205903,
        205906,
        205909,
        205913,
        205915,
        205918,
        205920,
        205922,
        205931,
        205940,
        205954,
        205956,
        205958,
        205962,
        205965,
        205969,
        205970,
        205972,
        205976,
        205977,
        205980,
        205981,
        205983,
        205984,
        205985,
        205986,
        205990,
        205991,
        205993,
        205997,
        206001,
        206002,
        206010,
        206011,
        206012,
        206013,
        206014,
        206016,
        206018,
        206025,
        206026,
        206032,
        206037,
        206038,
        206040,
        206045,
        206046,
        206047,
        206048,
        206049,
        206053,
        206057,
        206062,
        206063,
        206064,
        206067,
        206068,
        206072,
        206076,
        206082,
        206083,
        206086,
        206088,
        206091,
        206092,
        206093,
        206094,
        206096,
        206099,
        206105,
        206108,
        206110,
        206114,
        206119,
        206121,
        206123,
        206125,
        206127,
        206130,
        206137,
        206139,
        206140,
        206146,
        206155,
        206159,
        206162,
        206163,
        206164,
        206166,
        206173,
        206177,
        206178,
        206181,
        206184,
        206185,
        206190,
        206192,
        206193,
        206194,
        206201,
        206202,
        206204,
        206205,
        206206,
        206209,
        206210,
        206216,
        201547,
        206217,
        206218,
        206220,
        206223,
        206224,
        206228,
        206232,
        206235,
        206237,
        206238,
        206242,
        206244,
        206246,
        206247,
        206248,
        206249,
        206253,
        206254,
        206256,
        206258,
        206262,
        206266,
        206267,
        201548,
        206274,
        206275,
        206276,
        206277,
        206283,
        206284,
        206286,
        206289,
        206293,
        206294,
        206296,
        206298,
        206299,
        206301,
        206303,
        206308,
        206309,
        206310,
        206316,
        206319,
        206322,
        206323,
        206325,
        206326,
        206327,
        206328,
        206332,
        206335,
        206337,
        206340,
        206341,
        206342,
        206346,
        206348,
        206349,
        206350,
        206351,
        206352,
        206353,
        206354,
        206355,
        206357,
        206360,
        206364,
        206365,
        206367,
        206369,
        206372,
        206373,
        206374,
        206375,
        206376,
        206379,
        206381,
        206382,
        206384,
        206385,
        206386,
        206387,
        206388,
        206389,
        206390,
        206392,
        206393,
        206394,
        206398,
        206400,
        206402,
        206403,
        206404,
        206405,
        206407,
        206408,
        206409,
        206410,
        206411,
        206412,
        206413,
        206415,
        206416,
        206417,
        201501,
        206418,
        206419,
        206420,
        206421,
        206422,
        206423,
        206424,
        206426,
        206427,
        206429,
        206430,
        206431,
        206432,
        206434,
        206435,
        206436,
        206437,
        206438,
        206439,
        206446,
        206458,
        206474,
        206483,
        206502,
        206503,
        206976,
        207076,
        207378,
        207527,
        207570,
        207664,
        207706,
        207713,
        207768,
        207828,
        207832,
        207846,
        207861,
        207878,
        207882,
        207884,
        207885,
        207902,
        207922,
        207933,
        207938,
        207949,
        207955,
        207970,
        208000,
        208010,
        208018,
        208019,
        208022,
        208027,
        208030,
        208040,
        208041,
        208055,
        208057,
        208062,
        208071,
        208079,
        208083,
        208088,
        208103,
        208104,
        208105,
        208119,
        208122,
        208132,
        208142,
        208143,
        208147,
        208150,
        208152,
        208153,
        208157,
        208167,
        208168,
        208171,
        208182,
        208188,
        208189,
        208190,
        208193,
        208196,
        208197,
        208200,
        208201,
        208205,
        208209,
        208210,
        208211,
        208212,
        208218,
        208221,
        208225,
        208227,
        208231,
        208232,
        208233,
        208238,
        208242,
        208243,
        208245,
        208248,
        208249,
        208264,
        208273,
        208282,
        208290,
        208297,
        208302,
        208309,
        208316,
        208317,
        208325,
        208328,
        208331,
        208333,
        208334,
        208336,
        208337,
        208339,
        208341,
        208344,
        208347,
        208355,
        208356,
        208358,
        208359,
        208360,
        208361,
        208365,
        208366,
        208367,
        208368,
        208369,
        208370,
        208373,
        208375,
        208376,
        208377,
        208379,
        208380,
        208381,
        208382,
        208384,
        208387,
        208389,
        208390,
        208393,
        208396,
        208398,
        208410,
        208411,
        208413,
        208415,
        208416,
        208417,
        208418,
        208420,
        208421,
        208422,
        208425,
        208426,
        208428,
        208430,
        208431,
        208432,
        208439,
        208441,
        208444,
        208447,
        208448,
        208449,
        208450,
        208451,
        208453,
        208454,
        208455,
        208456,
        208459,
        208460,
        201563,
        208461,
        208463,
        208464,
        208465,
        208466,
        208467,
        208468,
        208471,
        208474,
        208475,
        208476,
        208477,
        208478,
        208481,
        208484,
        208487,
        208489,
        208490,
        208491,
        208492,
        208493,
        208494,
        208495,
        208496,
        208498,
        208499,
        208503,
        208504,
        208505,
        208509,
        208510,
        208512,
        208515,
        208516,
        208518,
        208519,
        208520,
        208521,
        208522,
        208524,
        208525,
        208526,
        208527,
        208528,
        208530,
        208533,
        208534,
        208535,
        208536,
        208537,
        208538,
        208540,
        208541,
        208542,
        208543,
        208544,
        208547,
        208548,
        208549,
        208554,
        208555,
        208557,
        208558,
        208559,
        208562,
        208564,
        208567,
        208568,
        208569,
        208570,
        208571,
        208572,
        208573,
        208574,
        208575,
        208577,
        208579,
        208580,
        208581,
        208582,
        208583,
        208584,
        208585,
        208590,
        208591,
        208593,
        208595,
        208596,
        208597,
        208598,
        208599,
        208600,
        208601,
        208602,
        208603,
        208606,
        208609,
        208615,
        208616,
        208617,
        208619,
        208621,
        208622,
        208624,
        208625,
        208626,
        208627,
        208629,
        208630,
        208631,
        208632,
        208633,
        208634,
        208635,
        208636,
        208637,
        208638,
        208639,
        208640,
        208641,
        208642,
        208643,
        208645,
        208646,
        208647,
        208648,
        208649,
        208650,
        208652,
        208653,
        208654,
        208655,
        208656,
        208657,
        208658,
        208659,
        208660,
        208661,
        208662,
        208663,
        208664,
        208665,
        208666,
        208668,
        208674,
        208676,
        208677,
        208678,
        208679,
        208680,
        208682'
        , 'T017_PBCReserva', NULL, NULL);
        
    DBMS_OUTPUT.put_line('  [INFO] AVANCE_TRAMITE_MIG_DIVARIAN T017_PBCVenta');
        
    REM01.AVANCE_TRAMITE_MIG_DIVARIAN (''||V_USUARIO||'',
       '204274,
        204275,
        204810,
        205194,
        205196,
        205534,
        205543,
        204292,
        204477,
        204482,
        204822,
        205198,
        205200,
        205223,
        201566,
        204499,
        204836,
        202109,
        204508,
        204532,
        204888,
        205269,
        205271,
        204565,
        205291,
        204580,
        204972,
        204618,
        204629,
        204975,
        205356,
        205361,
        205011,
        205385,
        204337,
        204679,
        205418,
        205431,
        205079,
        205086,
        205088,
        205442,
        205444,
        205461,
        205462,
        205121,
        205469,
        205471,
        205480,
        205134,
        205138,
        204233,
        205516,
        205518,
        205524,
        205563,
        205564,
        205971,
        203201,
        204018,
        202704,
        203759,
        203767,
        203511,
        204082,
        201690,
        203550,
        203834,
        204148,
        204161,
        201764,
        203097,
        205498,
        203970,
        204252,
        204437,
        205160,
        205161,
        205904,
        205921,
        205934,
        205947,
        205955,
        205618,
        205623,
        205626,
        205634,
        206305,
        206306,
        205640,
        205642,
        205654,
        206020,
        205662,
        205687,
        205695,
        205702,
        205704,
        205714,
        205720,
        205731,
        205732,
        205741,
        205747,
        205754,
        205885,
        207966,
        208113,
        208117,
        206363,
        206264,
        206295,
        206318,
        207994,
        208017,
        207180,
        208056,
        208058,
        208064,
        208095,
        208106,
        208109,
        208550,
        208551,
        207675,
        208565,
        208566,
        208589,
        208592,
        208594,
        208604,
        208607,
        208623,
        208628,
        207522,
        207581,
        207596,
        207055,
        206587,
        206008,
        206027,
        206651,
        207646,
        207658,
        208148,
        208154,
        208667,
        208670,
        208671,
        208672,
        208673,
        205670,
        205672,
        205679,
        208185,
        208199,
        208681,
        208683,
        207717,
        207721,
        207737,
        208236,
        207384,
        207749,
        207750,
        207763,
        207766,
        206118,
        207260,
        207275,
        207792,
        207799,
        208318,
        208349,
        205781,
        205789,
        206141,
        206150,
        206171,
        206799,
        207835,
        207836,
        205804,
        205806,
        205810,
        205811,
        205815,
        205834,
        205844,
        206179,
        206187,
        206853,
        207867,
        207896,
        207409,
        207924,
        207925,
        208436,
        208440,
        208452,
        206222,
        207440,
        207940,
        208469'
        , 'T017_PBCVenta', NULL, NULL);*/
    
    DBMS_OUTPUT.put_line('  [INFO] BORRADO TRA_PROCESS_BPM');
    
    V_SQL := 'UPDATE ACT_TRA_TRAMITE T1
                SET TRA_PROCESS_BPM = NULL
                    ,USUARIOMODIFICAR = '''||V_USUARIO||'''
                    ,FECHAMODIFICAR = SYSDATE
                WHERE EXISTS (
                    SELECT DISTINCT TRA.TRA_ID
                    FROM '||V_ESQUEMA||'.OFR_OFERTAS OFR
                    JOIN '||V_ESQUEMA||'.ACT_OFR AO ON AO.OFR_ID = OFR.OFR_ID
                    JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL ECO ON ECO.OFR_ID = OFR.OFR_ID
                    JOIN '||V_ESQUEMA||'.ACT_TRA_TRAMITE TRA ON TRA.TBJ_ID = ECO.TBJ_ID
                    JOIN '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS TAC ON TAC.TRA_ID = TRA.TRA_ID
                    JOIN '||V_ESQUEMA||'.AUX_REMVIP_6940 AUX ON AUX.OFR_NUM_OFERTA = OFR.OFR_NUM_OFERTA
                    WHERE TRA.TRA_ID = T1.TRA_ID
                )';
    EXECUTE IMMEDIATE V_SQL;
    
    DBMS_OUTPUT.put_line('  [INFO] BORRADO TEX_TOKEN_ID_BPM');
    
    V_SQL := 'UPDATE TEX_TAREA_EXTERNA TEX
                SET TEX_TOKEN_ID_BPM = NULL
                    ,USUARIOMODIFICAR = '''||V_USUARIO||'''
                    ,FECHAMODIFICAR = SYSDATE
                WHERE EXISTS (
                    SELECT DISTINCT TAC.TAR_ID
                    FROM '||V_ESQUEMA||'.OFR_OFERTAS OFR
                    JOIN '||V_ESQUEMA||'.ACT_OFR AO ON AO.OFR_ID = OFR.OFR_ID
                    JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL ECO ON ECO.OFR_ID = OFR.OFR_ID
                    JOIN '||V_ESQUEMA||'.ACT_TRA_TRAMITE TRA ON TRA.TBJ_ID = ECO.TBJ_ID
                    JOIN '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS TAC ON TAC.TRA_ID = TRA.TRA_ID
                    JOIN '||V_ESQUEMA||'.AUX_REMVIP_6940 AUX ON AUX.OFR_NUM_OFERTA = OFR.OFR_NUM_OFERTA
                    WHERE TEX.TAR_ID = TAC.TAR_ID
                )
                AND BORRADO = 0';
	EXECUTE IMMEDIATE V_SQL;
    
    DBMS_OUTPUT.put_line('  [INFO] ALTA_BPM_INSTANCES');
    
    REM01.ALTA_BPM_INSTANCES (''||V_USUARIO||'', PL_OUTPUT);
		
	COMMIT;
 
EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;