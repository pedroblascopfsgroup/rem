--/*
--##########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20200514
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-7294
--## PRODUCTO=NO
--##
--## INSTRUCCIONES: actualizar destinatario de tarea a nesteban
--## VERSIONES:
--##        0.1 Versi√≥n inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF; 
DECLARE

    PL_OUTPUT VARCHAR2(32000 CHAR);
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar    
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquemas
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    V_NUM_FILAS NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_1 NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_2 NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_3 NUMBER(16); -- Vble. para validar la existencia de un registro.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USR VARCHAR2(30 CHAR) := 'REMVIP-7294'; -- USUARIOCREAR/USUARIOMODIFICAR.
    V_ECO_ID NUMBER(16); 
    
    TRA_ID NUMBER(16);
    TAR_ID NUMBER(16);
    TEX_ID NUMBER(16);
    ACT_ID NUMBER(16);
    USU_ID NUMBER(16);
    SUP_ID NUMBER(16);
    NUM_TBJ NUMBER(16);
    TEX_TOKEN NUMBER(16);

    SEQ_TAR_ID NUMBER(16);

    V_COUNT_UPDATE_1 NUMBER(16):= 0; -- Vble. para contar updates
    V_COUNT_UPDATE_2 NUMBER(16):= 0; -- Vble. para contar updates
    V_COUNT_UPDATE_3 NUMBER(16):= 0; -- Vble. para contar updates

    
    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	--TRA_ID , TAR_ID, ACT_ID, USU_ID, NUM_TBJ

	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
T_JBV(481251, 5078347, 480313 , 29638 ,915112500001 ),
T_JBV(487627, 5084723, 491021 , 89631 ,915358700001 ),
T_JBV(514354, 5111450, 499749 , 29638 ,914535000001 ),
T_JBV(498571, 5095667, 473766 , 29638 ,915611400001 ),
T_JBV(514354, 5111450, 499776 , 29638 ,914535000001 ),
T_JBV(499178, 5096274, 469025 , 89631 ,916290300001 ),
T_JBV(501108, 5098204, 448034 , 29638 ,913692800001 ),
T_JBV(505120, 5102216, 482645 , 29638 ,916609700002 ),
T_JBV(514354, 5111450, 499743 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499735 , 29638 ,914535000001 ),
T_JBV(524013, 5121109, 499942 , 89631 ,914806200001 ),
T_JBV(525615, 5122711, 475526 , 89631 ,915067400001 ),
T_JBV(528567, 5125663, 452690 , 29638 ,915303100001 ),
T_JBV(531270, 5128366, 457008 , 29601 ,916658200001 ),
T_JBV(532752, 5129848, 445509 , 89631 ,915994000001 ),
T_JBV(534461, 5131557, 480996 , 29638 ,915600000003 ),
T_JBV(534479, 5131575, 481084 , 29638 ,916513900001 ),
T_JBV(535341, 5132437, 492930 , 89631 ,916922000001 ),
T_JBV(535521, 5132617, 485105 , 29638 ,914340900001 ),
T_JBV(537570, 5134666, 479572 , 29638 ,915477600001 ),
T_JBV(543846, 5140942, 454969 , 89631 ,915911500001 ),
T_JBV(544159, 5141255, 478985 , 29638 ,914933900001 ),
T_JBV(544309, 5141405, 465927 , 89631 ,915786000001 ),
T_JBV(514354, 5111450, 499775 , 29638 ,914535000001 ),
T_JBV(554991, 5152087, 465299 , 89631 ,916822500001 ),
T_JBV(555807, 5152903, 448610 , 29601 ,916275700001 ),
T_JBV(514354, 5111450, 499768 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499771 , 29638 ,914535000001 ),
T_JBV(481867, 5078963, 470528 , 29601 ,916922900001 ),
T_JBV(488548, 5085644, 452690 , 29638 ,915303100002 ),
T_JBV(489503, 5086599, 480087 , 29638 ,915970200001 ),
T_JBV(495567, 5092663, 486300 , 29544 ,916905200001 ),
T_JBV(514354, 5111450, 499748 , 29638 ,914535000001 ),
T_JBV(549499, 5146595, 492920 , 89631 ,915405200001 ),
T_JBV(514354, 5111450, 499779 , 29638 ,914535000001 ),
T_JBV(500523, 5097619, 463343 , 29583 ,916893200003 ),
T_JBV(514354, 5111450, 499787 , 29638 ,914535000001 ),
T_JBV(515116, 5112212, 480385 , 29638 ,915281800001 ),
T_JBV(515511, 5112607, 482645 , 29638 ,916609700001 ),
T_JBV(549499, 5146595, 492913 , 89631 ,915405200001 ),
T_JBV(549499, 5146595, 492928 , 89631 ,915405200001 ),
T_JBV(519791, 5116887, 473971 , 89632 ,916753400001 ),
T_JBV(514354, 5111450, 499744 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499750 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499751 , 29638 ,914535000001 ),
T_JBV(525504, 5122600, 495900 , 29638 ,916151000001 ),
T_JBV(527748, 5124844, 485488 , 89632 ,916394400001 ),
T_JBV(536605, 5133701, 483560 , 29638 ,916668500001 ),
T_JBV(537713, 5134809, 487783 , 89631 ,916928400002 ),
T_JBV(514354, 5111450, 499745 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499747 , 29638 ,914535000001 ),
T_JBV(543448, 5140544, 448610 , 29601 ,916783700003 ),
T_JBV(553065, 5150161, 444529 , 29638 ,916685200001 ),
T_JBV(554921, 5152017, 474985 , 89631 ,915526000001 ),
T_JBV(514354, 5111450, 499754 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499756 , 29638 ,914535000001 ),
T_JBV(557369, 5154465, 467910 , 29638 ,915581400001 ),
T_JBV(557641, 5154737, 496729 , 29638 ,916294700001 ),
T_JBV(482725, 5079821, 487336 , 29638 ,916383700001 ),
T_JBV(484086, 5081182, 477880 , 29638 ,914708100002 ),
T_JBV(490834, 5087930, 457161 , 29544 ,913650900001 ),
T_JBV(491701, 5088797, 447655 , 29638 ,915823700001 ),
T_JBV(493868, 5090964, 454494 , 29638 ,916187900002 ),
T_JBV(514354, 5111450, 499752 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499759 , 29638 ,914535000001 ),
T_JBV(496490, 5093586, 480996 , 29638 ,915600000002 ),
T_JBV(496494, 5093590, 480996 , 29638 ,915600000001 ),
T_JBV(505129, 5102225, 482656 , 29638 ,915762600001 ),
T_JBV(514354, 5111450, 499781 , 29638 ,914535000001 ),
T_JBV(506797, 5103893, 495551 , 29638 ,914764600001 ),
T_JBV(549499, 5146595, 492919 , 89631 ,915405200001 ),
T_JBV(507597, 5104693, 496755 , 29638 ,916295000001 ),
T_JBV(513105, 5110201, 452486 , 89631 ,916885700001 ),
T_JBV(514134, 5111230, 486240 , 29638 ,915140500001 ),
T_JBV(514383, 5111479, 499942 , 89631 ,914806200002 ),
T_JBV(549499, 5146595, 492929 , 89631 ,915405200001 ),
T_JBV(521727, 5118823, 477843 , 29638 ,916928500001 ),
T_JBV(514354, 5111450, 499732 , 29638 ,914535000001 ),
T_JBV(523735, 5120831, 474629 , 89631 ,915771700001 ),
T_JBV(525614, 5122710, 475526 , 89631 ,915067400002 ),
T_JBV(526305, 5123401, 497357 , 89631 ,916926300002 ),
T_JBV(514354, 5111450, 499765 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499785 , 29638 ,914535000001 ),
T_JBV(545262, 5142358, 473264 , 89632 ,916795800001 ),
T_JBV(555187, 5152283, 481166 , 29638 ,914499800001 ),
T_JBV(514354, 5111450, 499764 , 29638 ,914535000001 ),
T_JBV(481010, 5078106, 444528 , 29638 ,915013200001 ),
T_JBV(482061, 5079157, 482603 , 29638 ,915184300001 ),
T_JBV(549499, 5146595, 492922 , 89631 ,915405200001 ),
T_JBV(549499, 5146595, 492926 , 89631 ,915405200001 ),
T_JBV(485511, 5082607, 478710 , 29638 ,915608800001 ),
T_JBV(492222, 5089318, 496732 , 29638 ,916294900001 ),
T_JBV(514354, 5111450, 499746 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499770 , 29638 ,914535000001 ),
T_JBV(505185, 5102281, 449120 , 89631 ,915912100001 ),
T_JBV(506211, 5103307, 449417 , 29638 ,916129500001 ),
T_JBV(549499, 5146595, 492927 , 89631 ,915405200001 ),
T_JBV(507351, 5104447, 477503 , 29638 ,915990000002 ),
T_JBV(507740, 5104836, 481742 , 29638 ,914741100001 ),
T_JBV(509215, 5106311, 449417 , 29638 ,915828400001 ),
T_JBV(509417, 5106513, 481161 , 29638 ,914785500001 ),
T_JBV(509418, 5106514, 481163 , 29638 ,914505900001 ),
T_JBV(509419, 5106515, 481163 , 29638 ,914786200001 ),
T_JBV(509443, 5106539, 453252 , 89632 ,915157000001 ),
T_JBV(514354, 5111450, 499763 , 29638 ,914535000001 ),
T_JBV(549499, 5146595, 492916 , 89631 ,915405200001 ),
T_JBV(524803, 5121899, 487037 , 89631 ,916691900001 ),
T_JBV(531184, 5128280, 484548 , 29638 ,915619800001 ),
T_JBV(532311, 5129407, 444535 , 29638 ,915940400001 ),
T_JBV(534498, 5131594, 481161 , 29638 ,914504700001 ),
T_JBV(535197, 5132293, 485030 , 29638 ,916448200001 ),
T_JBV(536430, 5133526, 497672 , 29638 ,915063900001 ),
T_JBV(538103, 5135199, 499044 , 89631 ,916907600001 ),
T_JBV(539356, 5136452, 452823 , 29638 ,914756600001 ),
T_JBV(545231, 5142327, 477536 , 29638 ,914750000001 ),
T_JBV(549499, 5146595, 492925 , 89631 ,915405200001 ),
T_JBV(553268, 5150364, 454774 , 29638 ,915843500001 ),
T_JBV(514354, 5111450, 499782 , 29638 ,914535000001 ),
T_JBV(549499, 5146595, 492915 , 89631 ,915405200001 ),
T_JBV(488928, 5086024, 464900 , 29544 ,915658600001 ),
T_JBV(490893, 5087989, 463343 , 29583 ,916893200001 ),
T_JBV(491988, 5089084, 453569 , 89632 ,916348200001 ),
T_JBV(492249, 5089345, 497038 , 29638 ,914640300001 ),
T_JBV(492761, 5089857, 465995 , 29638 ,915572000002 ),
T_JBV(493164, 5090260, 454159 , 29638 ,915633100001 ),
T_JBV(493514, 5090610, 466290 , 29638 ,916806700001 ),
T_JBV(495956, 5093052, 452848 , 89912 ,915161100001 ),
T_JBV(496529, 5093625, 481162 , 29638 ,914505800001 ),
T_JBV(499172, 5096268, 468999 , 29544 ,915195700001 ),
T_JBV(501380, 5098476, 448209 , 89631 ,916391300001 ),
T_JBV(501450, 5098546, 460081 , 89631 ,916932500001 ),
T_JBV(501934, 5099030, 468172 , 89632 ,916044000001 ),
T_JBV(511458, 5108554, 462152 , 89631 ,916921300001 ),
T_JBV(514354, 5111450, 499755 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499761 , 29638 ,914535000001 ),
T_JBV(514488, 5111584, 474657 , 89631 ,916895300001 ),
T_JBV(516157, 5113253, 475048 , 89632 ,916487700002 ),
T_JBV(523448, 5120544, 476584 , 29638 ,916603800001 ),
T_JBV(514354, 5111450, 499742 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499766 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499786 , 29638 ,914535000001 ),
T_JBV(531349, 5128445, 463343 , 29583 ,916893200002 ),
T_JBV(519872, 5116968, 444457 , 29638 ,915346300001 ),
T_JBV(533829, 5130925, 474782 , 89631 ,916926400001 ),
T_JBV(534808, 5131904, 478966 , 29638 ,914749800001 ),
T_JBV(535401, 5132497, 493120 , 29638 ,915784600001 ),
T_JBV(536051, 5133147, 497357 , 89631 ,916926300001 ),
T_JBV(537406, 5134502, 483754 , 29638 ,915191700001 ),
T_JBV(537564, 5134660, 479502 , 29638 ,916012000001 ),
T_JBV(543699, 5140795, 464279 , 89632 ,914116500001 ),
T_JBV(545390, 5142486, 457836 , 29638 ,916618200001 ),
T_JBV(545408, 5142504, 458020 , 29638 ,916000100001 ),
T_JBV(545783, 5142879, 446284 , 89631 ,916620600001 ),
T_JBV(549265, 5146361, 459933 , 29638 ,915974600001 ),
T_JBV(549849, 5146945, 493124 , 29638 ,915096500001 ),
T_JBV(551286, 5148382, 469834 , 29638 ,915117100001 ),
T_JBV(552921, 5150017, 448610 , 29601 ,916783700001 ),
T_JBV(554075, 5151171, 461126 , 89631 ,915572700001 ),
T_JBV(554990, 5152086, 465299 , 89631 ,916822500002 ),
T_JBV(481019, 5078115, 444535 , 29638 ,915940400002 ),
T_JBV(481744, 5078840, 475048 , 89632 ,916487700001 ),
T_JBV(549499, 5146595, 492917 , 89631 ,915405200001 ),
T_JBV(487585, 5084681, 483564 , 29638 ,916812900001 ),
T_JBV(487797, 5084893, 448622 , 89632 ,915256800001 ),
T_JBV(491461, 5088557, 478961 , 29638 ,915007400003 ),
T_JBV(491757, 5088853, 467830 , 29638 ,916427400001 ),
T_JBV(493279, 5090375, 468094 , 29638 ,914348300001 ),
T_JBV(494818, 5091914, 445555 , 89632 ,915143800001 ),
T_JBV(514354, 5111450, 499753 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499784 , 29638 ,914535000001 ),
T_JBV(497637, 5094733, 448777 , 29638 ,916141300001 ),
T_JBV(514354, 5111450, 499740 , 29638 ,914535000001 ),
T_JBV(501033, 5098129, 465995 , 29638 ,915572000001 ),
T_JBV(514354, 5111450, 499760 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499769 , 29638 ,914535000001 ),
T_JBV(509599, 5106695, 461614 , 89631 ,915756000001 ),
T_JBV(549499, 5146595, 492918 , 89631 ,915405200001 ),
T_JBV(510791, 5107887, 496755 , 29638 ,916295700001 ),
T_JBV(512069, 5109165, 463931 , 89631 ,916921700001 ),
T_JBV(514155, 5111251, 446779 , 29638 ,915234200001 ),
T_JBV(515102, 5112198, 480311 , 29638 ,915112400001 ),
T_JBV(515889, 5112985, 488327 , 89631 ,916921400001 ),
T_JBV(516397, 5113493, 485006 , 29638 ,916069300001 ),
T_JBV(549499, 5146595, 492923 , 89631 ,915405200001 ),
T_JBV(517682, 5114778, 496755 , 29638 ,916295000002 ),
T_JBV(522364, 5119460, 476330 , 29638 ,911092100001 ),
T_JBV(523042, 5120138, 480314 , 29638 ,915112600001 ),
T_JBV(523800, 5120896, 482600 , 29638 ,914747700001 ),
T_JBV(524441, 5121537, 481146 , 29638 ,916562400001 ),
T_JBV(533905, 5131001, 470712 , 29638 ,915095500001 ),
T_JBV(535636, 5132732, 496319 , 29583 ,916570100001 ),
T_JBV(536159, 5133255, 487336 , 29638 ,916383700002 ),
T_JBV(538831, 5135927, 499644 , 29638 ,914832600001 ),
T_JBV(514354, 5111450, 499733 , 29638 ,914535000001 ),
T_JBV(539301, 5136397, 491569 , 89631 ,915046700001 ),
T_JBV(542102, 5139198, 485132 , 29638 ,916749500001 ),
T_JBV(546720, 5143816, 477880 , 29638 ,914708100001 ),
T_JBV(547416, 5144512, 471857 , 29638 ,915043400001 ),
T_JBV(548311, 5145407, 453326 , 29544 ,916945100001 ),
T_JBV(553926, 5151022, 480557 , 29638 ,913338700001 ),
T_JBV(514354, 5111450, 499757 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499780 , 29638 ,914535000001 ),
T_JBV(483246, 5080342, 471243 , 89632 ,916481500001 ),
T_JBV(484716, 5081812, 485844 , 29638 ,914441200001 ),
T_JBV(493788, 5090884, 464195 , 29638 ,914885900001 ),
T_JBV(494890, 5091986, 452486 , 89631 ,916885700002 ),
T_JBV(495172, 5092268, 474458 , 29638 ,916061400001 ),
T_JBV(514354, 5111450, 499762 , 29638 ,914535000001 ),
T_JBV(495927, 5093023, 474840 , 29601 ,915993800001 ),
T_JBV(496462, 5093558, 494980 , 89631 ,916569100001 ),
T_JBV(549499, 5146595, 492924 , 89631 ,915405200001 ),
T_JBV(497682, 5094778, 454917 , 89631 ,916063200001 ),
T_JBV(514354, 5111450, 499772 , 29638 ,914535000001 ),
T_JBV(500254, 5097350, 457174 , 29638 ,915482400001 ),
T_JBV(502819, 5099915, 458416 , 89631 ,916927700001 ),
T_JBV(514354, 5111450, 499774 , 29638 ,914535000001 ),
T_JBV(506109, 5103205, 477011 , 29638 ,915348400001 ),
T_JBV(514354, 5111450, 499738 , 29638 ,914535000001 ),
T_JBV(515201, 5112297, 482599 , 29638 ,914747600001 ),
T_JBV(516426, 5113522, 494699 , 89631 ,916063100001 ),
T_JBV(517675, 5114771, 496723 , 29638 ,916294800001 ),
T_JBV(519592, 5116688, 487783 , 89631 ,916928400001 ),
T_JBV(519872, 5116968, 444458 , 29638 ,915346300001 ),
T_JBV(520397, 5117493, 484365 , 29638 ,916005600001 ),
T_JBV(514354, 5111450, 499739 , 29638 ,914535000001 ),
T_JBV(527234, 5124330, 477352 , 89631 ,915932000001 ),
T_JBV(530074, 5127170, 488134 , 29638 ,916885600001 ),
T_JBV(531184, 5128280, 484536 , 29638 ,915619800001 ),
T_JBV(514354, 5111450, 499736 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499777 , 29638 ,914535000001 ),
T_JBV(538887, 5135983, 499816 , 89632 ,916359500001 ),
T_JBV(539337, 5136433, 473971 , 89632 ,916753400002 ),
T_JBV(539376, 5136472, 452936 , 89631 ,916658300001 ),
T_JBV(540863, 5137959, 467911 , 29638 ,915581600001 ),
T_JBV(541009, 5138105, 457163 , 29544 ,913183000001 ),
T_JBV(549499, 5146595, 492914 , 89631 ,915405200001 ),
T_JBV(549499, 5146595, 492921 , 89631 ,915405200001 ),
T_JBV(514354, 5111450, 499773 , 29638 ,914535000001 ),
T_JBV(480944, 5078040, 477503 , 29638 ,915990000001 ),
T_JBV(484042, 5081138, 485488 , 89632 ,916394400002 ),
T_JBV(484982, 5082078, 472403 , 89633 ,916598100001 ),
T_JBV(484985, 5082081, 472458 , 29638 ,914614500001 ),
T_JBV(490220, 5087316, 453430 , 89631 ,916927400001 ),
T_JBV(514354, 5111450, 499783 , 29638 ,914535000001 ),
T_JBV(496216, 5093312, 480864 , 29638 ,915230300001 ),
T_JBV(524803, 5121899, 487036 , 89631 ,916691900001 ),
T_JBV(497848, 5094944, 473427 , 29638 ,915016000001 ),
T_JBV(498691, 5095787, 449190 , 29638 ,916122800001 ),
T_JBV(514354, 5111450, 499734 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499741 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499758 , 29638 ,914535000001 ),
T_JBV(499784, 5096880, 478686 , 89632 ,916676900001 ),
T_JBV(500829, 5097925, 478961 , 29638 ,915007400002 ),
T_JBV(502158, 5099254, 454494 , 29638 ,916187900001 ),
T_JBV(504207, 5101303, 444747 , 29638 ,914285000001 ),
T_JBV(514354, 5111450, 499737 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499767 , 29638 ,914535000001 ),
T_JBV(514354, 5111450, 499778 , 29638 ,914535000001 ),
T_JBV(508671, 5105767, 468170 , 89632 ,916043800001 ),
T_JBV(549499, 5146595, 492930 , 89631 ,915405200001 ),
T_JBV(511346, 5108442, 448209 , 89631 ,916908200001 ),
T_JBV(511457, 5108553, 462152 , 89631 ,916921300002 ),
T_JBV(515525, 5112621, 482678 , 29638 ,914807900001 ),
T_JBV(523805, 5120901, 482605 , 29638 ,914748100001 ),
T_JBV(527607, 5124703, 454914 , 89631 ,916062800001 ),
T_JBV(528034, 5125130, 483565 , 29638 ,916819400001 ),
T_JBV(530515, 5127611, 472527 , 89632 ,916771600001 ),
T_JBV(534033, 5131129, 484713 , 29638 ,916552300001 ),
T_JBV(534499, 5131595, 481168 , 29638 ,914800300001 ),
T_JBV(536599, 5133695, 483554 , 29638 ,916819500001 ),
T_JBV(537562, 5134658, 479502 , 29638 ,916012000002 ),
T_JBV(539899, 5136995, 489811 , 89631 ,916719400001 ),
T_JBV(540784, 5137880, 447649 , 29638 ,915192400001 ),
T_JBV(541629, 5138725, 478961 , 29638 ,915007400001 ),
T_JBV(551449, 5148545, 448034 , 29638 ,914998100001 ),
T_JBV(552142, 5149238, 458020 , 29638 ,915802500001 ),
T_JBV(552922, 5150018, 448610 , 29601 ,916783700002 ),
T_JBV(553284, 5150380, 454916 , 89631 ,916063000001 ),
T_JBV(553285, 5150381, 454918 , 89631 ,916063300001 )

		); 
	V_TMP_JBV T_JBV;
    
BEGIN	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ACTUALIZACION TRAMITES Y TAREAS');

	FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);
	
  	TRA_ID := TRIM(V_TMP_JBV(1));
  	
  	TAR_ID := TRIM(V_TMP_JBV(2));

	ACT_ID := TRIM(V_TMP_JBV(3));

	USU_ID := TRIM(V_TMP_JBV(4));
  	
  	NUM_TBJ := TRIM(V_TMP_JBV(5));


	--COMPROBAMOS SI EXISTE TRABAJO

	V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO WHERE TBJ_NUM_TRABAJO = '||NUM_TBJ;
	
	EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS;
	
	IF V_NUM_FILAS > 0 THEN 
	
	--COMPROBAMOS SI EXISTE TAREA

		DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZANDO TRAMITE DE TRABAJO '||NUM_TBJ||'');

		V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS WHERE TRA_ID = '||TRA_ID||' AND TAR_ID = '||TAR_ID||' AND ACT_ID = '||ACT_ID||'';
	
		EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS_1;
	
		IF V_NUM_FILAS_1 > 0 THEN
	
			V_MSQL := 'UPDATE '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS 
					   SET USU_ID = '||USU_ID||' ,
					   USUARIOMODIFICAR = '''||V_USR||''',
					   FECHAMODIFICAR = SYSDATE 
					   WHERE TRA_ID = '||TRA_ID||' AND TAR_ID = '||TAR_ID||' AND ACT_ID = '||ACT_ID||'';
	

			EXECUTE IMMEDIATE V_MSQL;
	    
			DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO CON TRA_ID: '||TRA_ID||' ACTUALIZADO');
		
			V_COUNT_UPDATE_1 := V_COUNT_UPDATE_1 + 1;
		
		ELSE
		
			DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO NO EXISTE');
		
		END IF;
        
   	ELSE
		
	DBMS_OUTPUT.PUT_LINE('[INFO] TRABAJO NO EXISTE');
		
	END IF; 

   	END LOOP;

	DBMS_OUTPUT.PUT_LINE('********************************************************************');

	DBMS_OUTPUT.PUT_LINE('[FIN] Se han updateado en total '||V_COUNT_UPDATE_1||' registros EN TAC_TAREAS_ACTIVOS');

	DBMS_OUTPUT.PUT_LINE('********************************************************************');

	DBMS_OUTPUT.PUT_LINE('[FIN] ');

	COMMIT;

EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecuci√≥n:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
