--/*
--##########################################
--## AUTOR=Carles Molins
--## FECHA_CREACION=20200605
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-7475
--## PRODUCTO=NO
--##
--## Finalidad:
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USUARIOMODIFICAR VARCHAR2(25 CHAR):= 'REMVIP-7475'; -- Configuracion Esquema
    V_COUNT NUMBER(16):= 0;

BEGIN

    DBMS_OUTPUT.PUT_LINE('[INICIO]');
				    
	V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA
				SET SPS_COMBO_OTRO = 1,
				    SPS_OTRO = ''Vigencia del contrato:La establecida en la Ley 29/1994 de Arrendamientos Urbanos (LAU), la renta se actualizará conforme al IPC,gastos de comunidad e IBI incluidos, fianza: mínima establecida legalmente y tasas municipales excluidas en el precio de renta'',
				    USUARIOMODIFICAR = '''||V_USUARIOMODIFICAR||''',
				    FECHAMODIFICAR = SYSDATE
				WHERE ACT_ID IN (
				    SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO IN (
						6825664,
						6825858,
						6825985,
						6825987,
						6825990,
						6825992,
						6826000,
						6826006,
						6826013,
						6826024,
						6826030,
						6826040,
						6826045,
						6826082,
						6826085,
						6826104,
						6826113,
						6826118,
						6826122,
						6826125,
						6826136,
						6826137,
						6826139,
						6826141,
						6826153,
						6826164,
						6826181,
						6826196,
						6826201,
						6826208,
						6826212,
						6826217,
						6826219,
						6826220,
						6826222,
						6826224,
						6826229,
						6826233,
						6826241,
						6826333,
						6826336,
						6826338,
						6826341,
						6826346,
						6826348,
						6826358,
						6826359,
						6826362,
						6826363,
						6826367,
						6826371,
						6826376,
						6826381,
						6826388,
						6826392,
						6826393,
						6826394,
						6826401,
						6826418,
						6826423,
						6826424,
						6826430,
						6826432,
						6826437,
						6826441,
						6826447,
						6826452,
						6826455,
						6826501,
						6826502,
						6826506,
						6826507,
						6826595,
						6826757,
						6848511,
						6848654,
						6848655,
						6848742,
						6848879,
						6849283,
						6849294,
						6849344,
						6849562,
						6849669,
						6849693,
						6849904,
						6849936,
						6850013,
						6850116,
						6850117,
						6850120,
						6850270,
						6850418,
						6850540,
						6850541,
						6850542,
						6850543,
						6850544,
						6850545,
						6850586,
						6850689,
						6850699,
						6850700,
						6850701,
						6850702,
						6850703,
						6850704,
						6850705,
						6850706,
						6850707,
						6850708,
						6850777,
						6850856,
						6850868,
						6850888,
						6850947,
						6850999,
						6851113,
						6851127,
						6851128,
						6851129,
						6851130,
						6851131,
						6851132,
						6851133,
						6851134,
						6851135,
						6851138,
						6851139,
						6851151,
						6851210,
						6851219,
						6851257,
						6851263,
						6851264,
						6851265,
						6851280,
						6851377,
						6851387,
						6851714,
						6851718,
						6851780,
						6851927,
						6851928,
						6851962,
						6851998,
						6852016,
						6852023,
						6852024,
						6852064,
						6852070,
						6852071,
						6852135,
						6852136,
						6852137,
						6852138,
						6852139,
						6852140,
						6852215,
						6852308,
						6852309,
						6852310,
						6852311,
						6852312,
						6852328,
						6852337,
						6852477,
						6852478,
						6852479,
						6852545,
						6852546,
						6852547,
						6852594,
						6852595,
						6852596,
						6852607,
						6852608,
						6852609,
						6852610,
						6852611,
						6852612,
						6852613,
						6852614,
						6852615,
						6852616,
						6852617,
						6852618,
						6852619,
						6852620,
						6852621,
						6852686,
						6852687,
						6852688,
						6852689,
						6852690,
						6852691,
						6852692,
						6852693,
						6852711,
						6852712,
						6852713,
						6852714,
						6852769,
						6852770,
						6852771,
						6852772,
						6852773,
						6852774,
						6852775,
						6852830,
						6852831,
						6852832,
						6852833,
						6852834,
						6852854,
						6852855,
						6852856,
						6852857,
						6852858,
						6852859,
						6852860,
						6852861,
						6852862,
						6852863,
						6852864,
						6852865,
						6852866,
						6852867,
						6852868,
						6852969,
						6853043,
						6853046,
						6853047,
						6853048,
						6853049,
						6853050,
						6853051,
						6853052,
						6853053,
						6853054,
						6853128,
						6853129,
						6853283,
						6853329,
						6853353,
						6853354,
						6853355,
						6853356,
						6853357,
						6853358,
						6853359,
						6853360,
						6853361,
						6853397,
						6853398,
						6853399,
						6853400,
						6853401,
						6853541,
						6853550,
						6853642,
						6853643,
						6853647,
						6853833,
						6853836,
						6853838,
						6853894,
						6853895,
						6854053,
						6854063,
						6854064,
						6854065,
						6854066,
						6854153,
						6854619,
						6854660,
						6854661,
						6854670,
						6854671,
						6854672,
						6854673,
						6854758,
						6854759,
						6854813,
						6854814,
						6854908,
						6854909,
						6854934,
						6855138,
						6855139,
						6855140,
						6855154,
						6855155,
						6855156,
						6855245,
						6855282,
						6855283,
						6855386,
						6855387,
						6855388,
						6855389,
						6855390,
						6855523,
						6855525,
						6855526,
						6855527,
						6855528,
						6855532,
						6855533,
						6855534,
						6855537,
						6855538,
						6855539,
						6855544,
						6855579,
						6855618,
						6855619,
						6855620,
						6855625,
						6855629,
						6855649,
						6855650,
						6855651,
						6855652,
						6855653,
						6855654,
						6855689,
						6855690,
						6855691,
						6855693,
						6855695,
						6855755,
						6855756,
						6855757,
						6855759,
						6855760,
						6855763,
						6855764,
						6855768,
						6855769,
						6855770,
						6855771,
						6855772,
						6855773,
						6855774,
						6855776,
						6855780,
						6855853,
						6855854,
						6855857,
						6855895,
						6855896,
						6855898,
						6855899,
						6855900,
						6855901,
						6855902,
						6855908,
						6855909,
						6855910,
						6855911,
						6855912,
						6855917,
						6855920,
						6855921,
						6855922,
						6855987,
						6856115,
						6856116,
						6856117,
						6856118,
						6856119,
						6856122,
						6856248,
						6856249,
						6856255,
						6856256,
						6856266,
						6856267,
						6856268,
						6856269,
						6856270,
						6856276,
						6856307,
						6856308,
						6856309,
						6856311,
						6856312,
						6856313,
						6856317,
						6856318,
						6856319,
						6856353,
						6856384,
						6856385,
						6856386,
						6856387,
						6856390,
						6856391,
						6856392,
						6856395,
						6856396,
						6856397,
						6856398,
						6856399,
						6856402,
						6856403,
						6856404,
						6856413,
						6856473,
						6856486,
						6856490,
						6856491,
						6856492,
						6856562,
						6856563,
						6856564,
						6856565,
						6856584,
						6856585,
						6856586,
						6856587,
						6856588,
						6856589,
						6856592,
						6856596,
						6856597,
						6856598,
						6856600,
						6856601,
						6856608,
						6856617,
						6856618,
						6856619,
						6856624,
						6856658,
						6856822,
						6856823,
						6857052,
						6857101,
						6857102,
						6857133,
						6857134,
						6857135,
						6857136,
						6857137,
						6857305,
						6857306,
						6857307,
						6857308,
						6857309,
						6857310,
						6857311,
						6857312,
						6857358,
						6857359,
						6857361,
						6857462,
						6857463,
						6857478,
						6857514,
						6857515,
						6857516,
						6857517,
						6857518,
						6857519,
						6857520,
						6857521,
						6857522,
						6857523,
						6857524,
						6857580,
						6857581,
						6857624,
						6857669,
						6857670,
						6857671,
						6857685,
						6857702,
						6857703,
						6857704,
						6857705,
						6857706,
						6857707,
						6857708,
						6857709,
						6857812,
						6857813,
						6857814,
						6857815,
						6857818,
						6857819,
						6857820,
						6857821,
						6857822,
						6857823,
						6857827,
						6857828,
						6857953,
						6857954,
						6857955,
						6857958,
						6857959,
						6857960,
						6857961,
						6857962,
						6857963,
						6857964,
						6857965,
						6857966,
						6857967,
						6858005,
						6858010,
						6858011,
						6858192,
						6858213,
						6858214,
						6858219,
						6858220,
						6858263,
						6858264,
						6858265,
						6858269,
						6858270,
						6858271,
						6858274,
						6858275,
						6858276,
						6858277,
						6858278,
						6858279,
						6858376,
						6858510,
						6858523,
						6858555,
						6858556,
						6858690,
						6858691,
						6858861,
						6858866,
						6858867,
						6858868,
						6859055,
						6859113,
						6859157,
						6859174,
						6859381,
						6859534,
						6859715,
						6859729,
						6859787,
						6859788,
						6859789,
						6859877,
						6860332,
						6860355,
						6860668,
						6860791,
						6860806,
						6860830,
						6860872,
						6861075,
						6861077,
						6861352,
						6861353,
						6861354,
						6861355,
						6861356,
						6861357,
						6861358,
						6861528,
						6861536,
						6861597,
						6861598,
						6861610,
						6861611,
						6861777,
						6861890,
						6861916,
						6861929,
						6862162,
						6862163,
						6862164,
						6862165,
						6862231,
						6862233,
						6862262,
						6862556,
						6862557,
						6862801,
						6862803,
						6862875,
						6862876,
						6862877,
						6862878,
						6862879,
						6862880,
						6862895,
						6862905,
						6862938,
						6862940,
						6862941,
						6862942,
						6862943,
						6862944,
						6862947,
						6862948,
						6863029,
						6863030,
						6863031,
						6863032,
						6863189,
						6863190,
						6863209,
						6863210,
						6863211,
						6863221,
						6863222,
						6863223,
						6863224,
						6863244,
						6863332,
						6863333,
						6863334,
						6863335,
						6863336,
						6863337,
						6863338,
						6863339,
						6863340,
						6863392,
						6863483,
						6863494,
						6863702,
						6863823,
						6863825,
						6863846,
						6863849,
						6863874,
						6863875,
						6863895,
						6863896,
						6863900,
						6863989,
						6863990,
						6863992,
						6863993,
						6863994,
						6864005,
						6864006,
						6864013,
						6864080,
						6864087,
						6864088,
						6864161,
						6864166,
						6864170,
						6864172,
						6864217,
						6864262,
						6864263,
						6864264,
						6864265,
						6864267,
						6864268,
						6864274,
						6864303,
						6864382,
						6864409,
						6864432,
						6864433,
						6864434,
						6864458,
						6864467,
						6864594,
						6864684,
						6864811,
						6864812,
						6864935,
						6864936,
						6864941,
						6864942,
						6864943,
						6864995,
						6864997,
						6864998,
						6865062,
						6865100,
						6865101,
						6865106,
						6865107,
						6865120,
						6865122,
						6865189,
						6865195,
						6865301,
						6865539,
						6865978,
						6865979,
						6865980,
						6865982,
						6866017,
						6866102,
						6866348,
						6866370,
						6866389,
						6866604,
						6866605,
						6866606,
						6866686,
						6866687,
						6866767,
						6866842,
						6866999,
						6867082,
						6867130,
						6867134,
						6867317,
						6867327,
						6867328,
						6867377,
						6867513,
						6867602,
						6867673,
						6867676,
						6867677,
						6867678,
						6867696,
						6867715,
						6867716,
						6867717,
						6867718,
						6867726,
						6867799,
						6867947,
						6868014,
						6868020,
						6868021,
						6868022,
						6868288,
						6868356,
						6868365,
						6868366,
						6868367,
						6868387,
						6868437,
						6868471,
						6868472,
						6868574,
						6868575,
						6868637,
						6868638,
						6868640,
						6868644,
						6868645,
						6868646,
						6868647,
						6869014,
						6869015,
						6869018,
						6869019,
						6869020,
						6869021,
						6869022,
						6869151,
						6869158,
						6869317,
						6869385,
						6869386,
						6869387,
						6869388,
						6869389,
						6869390,
						6869634,
						6869635,
						6870063,
						6870064,
						6870065,
						6870066,
						6870067,
						6870068,
						6870069,
						6870167,
						6870168,
						6870213,
						6870256,
						6870257,
						6870258,
						6870259,
						6870260,
						6870261,
						6870262,
						6870580,
						6870600,
						6870601,
						6870639,
						6870640,
						6870641,
						6870642,
						6870643,
						6870644,
						6870645,
						6870646,
						6870647,
						6870648,
						6870649,
						6870650,
						6870754,
						6870755,
						6870756,
						6870757,
						6870758,
						6870759,
						6870760,
						6870761,
						6870762,
						6870816,
						6870817,
						6870901,
						6870959,
						6870960,
						6870961,
						6870962,
						6870963,
						6870964,
						6871165,
						6871243,
						6871244,
						6871245,
						6871246,
						6871271,
						6871377,
						6871418,
						6871421,
						6871494,
						6871495,
						6871496,
						6871497,
						6871596,
						6871598,
						6871602,
						6871621,
						6871642,
						6871718,
						6871719,
						6871720,
						6871721,
						6871722,
						6871723,
						6871807,
						6871809,
						6871897,
						6871898,
						6871899,
						6871965,
						6872192,
						6872499,
						6872549,
						6872550,
						6872551,
						6872552,
						6872700,
						6872918,
						6872919,
						6873024,
						6873059,
						6873159,
						6873220,
						6873254,
						6873309,
						6873432,
						6873514,
						6873554,
						6873723,
						6873725,
						6873733,
						6873806,
						6873814,
						6873815,
						6873816,
						6873817,
						6873824,
						6873829,
						6873860,
						6873874,
						6874237,
						6874296,
						6874328,
						6874353,
						6874374,
						6874388,
						6874422,
						6874486,
						6874715,
						6874719,
						6874813,
						6874814,
						6874988,
						6875046,
						6875047,
						6875068,
						6875077,
						6875216,
						6875252,
						6875402,
						6875463,
						6875464,
						6875487,
						6875594,
						6875646,
						6875699,
						6875914,
						6875931,
						6876112,
						6876576,
						6876840,
						6876871,
						6876913,
						6877024,
						6877076,
						6877744,
						6877916,
						6878116,
						6878380,
						6878381,
						6878382,
						6878405,
						6878589,
						6878618,
						6878675,
						6879284,
						6879381,
						6879441,
						6879442,
						6879462,
						6879463,
						6879464,
						6879543,
						6879621,
						6879764,
						6880369,
						6880530,
						6880531,
						6880532,
						6880533,
						6880534,
						6880535,
						6880549,
						6880583,
						6880627,
						6880628,
						6880629,
						6880632,
						6880682,
						6880798,
						6880799,
						6880800,
						6880801,
						6880802,
						6880803,
						6880804,
						6880805,
						6880920,
						6881007,
						6881167,
						6881220,
						6881333,
						6881334,
						6881335,
						6881336,
						6881337,
						6881338,
						6881470,
						6881471,
						6881472,
						6881473,
						6881474,
						6881475,
						6881489,
						6881542,
						6881544,
						6881639,
						6881726,
						6881727,
						6881728,
						6881729,
						6881730,
						6881733,
						6881877,
						6881879,
						6881970,
						6882069,
						6882119,
						6882365,
						6882366,
						6882403
					)
				)';
	EXECUTE IMMEDIATE V_MSQL;
	
	V_COUNT := SQL%ROWCOUNT;
	
	V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_SPS_SIT_POSESORIA
				SET SPS_COMBO_OTRO = 1,
				    SPS_OTRO = ''Vigencia del contrato:La establecida en la Ley 29/1994 de Arrendamientos Urbanos (LAU), la renta se actualizará conforme al IPC,gastos de comunidad e IBI incluidos, fianza: mínima establecida legalmente y tasas municipales excluidas en el precio de renta'',
				    USUARIOMODIFICAR = '''||V_USUARIOMODIFICAR||''',
				    FECHAMODIFICAR = SYSDATE
				WHERE ACT_ID IN (
				    SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO IN (
						6882405,
						6882406,
						6882409,
						6882432,
						6882437,
						6882445,
						6882446,
						6882447,
						6882448,
						6882451,
						6882452,
						6882488,
						6882492,
						6882541,
						6882550,
						6882551,
						6882701,
						6883465,
						6883570,
						6884029,
						6884336,
						6884446,
						6884777,
						6884801,
						6885186,
						6885215,
						6885447,
						6885477,
						6885531,
						6885532,
						6885548,
						6885621,
						6885623,
						6935164,
						6935165,
						6935315,
						6935555,
						6935741,
						6935742,
						6935751,
						6935755,
						6935758,
						6935770,
						6935797,
						6935906,
						6935967,
						6947708,
						6947709,
						6947711,
						6947713,
						6947716,
						6947718,
						6947720,
						6947721,
						6947725,
						6947739,
						6947748,
						6947772,
						6947775,
						6947781,
						6947792,
						6947814,
						6947816,
						6947818,
						6947825,
						6947837,
						6947838,
						6947839,
						6947840,
						6947842,
						6947844,
						6947846,
						6947847,
						6947850,
						6947851,
						6947852,
						6947853,
						6947854,
						6947855,
						6947860,
						6947869,
						6947872,
						6947910,
						6947914,
						6947929,
						6947932,
						6947939,
						6947941,
						6947942,
						6947943,
						6947950,
						6947955,
						6947957,
						6947959,
						6947960,
						6947963,
						6947964,
						6947965,
						6947973,
						6947976,
						6947990,
						6947996,
						6948021,
						6948022,
						6948025,
						6948026,
						6948027,
						6948036,
						6948038,
						6948043,
						6948047,
						6948048,
						6948050,
						6948052,
						6948054,
						6948061,
						6948062,
						6948067,
						6948069,
						6948071,
						6948075,
						6948078,
						6948080,
						6948089,
						6948104,
						6948107,
						6948112,
						6948133,
						6948227,
						6948271,
						6948323,
						6948359,
						6948432,
						6948519,
						6948556,
						6948600,
						6948733,
						6948736,
						6948741,
						6948743,
						6948744,
						6948747,
						6948750,
						6948754,
						6948763,
						6948764,
						6948767,
						6948771,
						6948778,
						6948788,
						6948789,
						6948796,
						6948817,
						6948834,
						6948855,
						6948858,
						6948869,
						6948876,
						6948881,
						6948885,
						6948888,
						6948889,
						6948890,
						6948897,
						6948901,
						6948903,
						6948909,
						6948911,
						6948913,
						6948914,
						6948920,
						6948935,
						6948939,
						6948956,
						6949089,
						6949094,
						6949104,
						6949108,
						6949118,
						6949124,
						6949125,
						6949129,
						6949132,
						6949133,
						6949134,
						6949140,
						6949141,
						6949142,
						6949143,
						6949148,
						6949153,
						6949167,
						6949170,
						6949196,
						6949213,
						6949263,
						6949299,
						6949386,
						6949435,
						6949436,
						6949442,
						6949456,
						6949462,
						6949500,
						6949510,
						6949526,
						6949530,
						6949531,
						6949540,
						6949552,
						6949553,
						6949561,
						6949569,
						6949575,
						6949579,
						6949580,
						6949581,
						6949589,
						6949591,
						6949709,
						6957107,
						6957135,
						6957767,
						6960857,
						6960869,
						6961822,
						6962396,
						6964246,
						6964642,
						6965033,
						6966654,
						6966656,
						6966664,
						6966669,
						6966672,
						6966673,
						6966679,
						6966686,
						6966693,
						6966695,
						6966696,
						6966698,
						6966699,
						6966701,
						6966704,
						6966706,
						6966708,
						6966711,
						6966712,
						6966714,
						6966718,
						6966719,
						6966720,
						6966722,
						6966723,
						6966725,
						6966726,
						6966728,
						6966732,
						6966736,
						6966737,
						6966740,
						6966741,
						6966742,
						6966748,
						6966750,
						6967678,
						6979244,
						7003831,
						7004063,
						7004896,
						7005094,
						7005248,
						7005249,
						7005295,
						7007594,
						7007856,
						7008926,
						7008935,
						7008956,
						7008958,
						7008959,
						7008973,
						7008974,
						7008979,
						7008984,
						7008988,
						7008989,
						7008993,
						7008994,
						7008999,
						7009006,
						7009012,
						7009013,
						7009015,
						7009021,
						7009029,
						7009031,
						7009036,
						7009042,
						7009044,
						7009049,
						7009052,
						7009054,
						7009061,
						7009066,
						7009067,
						7009080,
						7009083,
						7009084,
						7009091,
						7009093,
						7009096,
						7009098,
						7009099,
						7009103,
						7009105,
						7009106,
						7009108,
						7009667,
						7009761,
						7009762,
						7009765,
						7009789,
						7009896,
						7010010,
						7015132,
						7019852,
						7031667,
						7032382,
						7068771,
						7068913,
						7068935,
						7070924,
						7071339,
						7071689,
						7072313,
						7072315,
						7072324,
						7072332,
						7072343,
						7072350,
						7072360,
						7072674,
						7072970,
						7075984,
						7101054,
						7101058,
						7101061,
						7101176,
						7224152,
						7225940,
						7298277
					)
				)';
	EXECUTE IMMEDIATE V_MSQL;
	
	V_COUNT := V_COUNT + SQL%ROWCOUNT;
    DBMS_OUTPUT.PUT_LINE('	[INFO]	Se ha actualizado el condicionante Otros de '||V_COUNT||' activos');
    
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('[FIN]');

EXCEPTION
	WHEN OTHERS THEN
	err_num := SQLCODE;
	err_msg := SQLERRM;
	
	DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
	DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
	DBMS_OUTPUT.put_line(err_msg);
	
	ROLLBACK;
	RAISE;          

END;
/
EXIT
