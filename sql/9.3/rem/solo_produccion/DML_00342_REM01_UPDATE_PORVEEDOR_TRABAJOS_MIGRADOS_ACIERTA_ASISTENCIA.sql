--/*
--##########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20200618
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-7529
--## PRODUCTO=NO
--##
--## INSTRUCCIONES: actualizar destinatario de tarea a PROVEEDOR
--## VERSIONES:
--##        0.1 Versi√≥n inicial
--##########################################
--*/
WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF; 
DECLARE

    PL_OUTPUT VARCHAR2(32000 CHAR);
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar    
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquemas
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.
    V_NUM_FILAS NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_1 NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_2 NUMBER(16); -- Vble. para validar la existencia de un registro.
    V_NUM_FILAS_3 NUMBER(16); -- Vble. para validar la existencia de un registro.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USR VARCHAR2(30 CHAR) := 'REMVIP-7529'; -- USUARIOCREAR/USUARIOMODIFICAR.
    V_ECO_ID NUMBER(16);
     
    
    TRA_ID NUMBER(16);
    TAR_ID NUMBER(16);
    TEX_ID NUMBER(16);
    ACT_ID NUMBER(16);
    USU_ID NUMBER(16);
    PRO_ID NUMBER(16);
    SUP_ID NUMBER(16);
    NUM_TBJ NUMBER(16);
    V_USUARIO NUMBER(16) ;

    SEQ_TAR_ID NUMBER(16);

    V_COUNT_UPDATE_1 NUMBER(16):= 0; -- Vble. para contar updates
    V_COUNT_UPDATE_2 NUMBER(16):= 0; -- Vble. para contar updates
    V_COUNT_UPDATE_3 NUMBER(16):= 0; -- Vble. para contar updates

    
    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 
	
	--TRA_ID , TAR_ID, ACT_ID, USU_ID, PRO_ID, NUM_TBJ

	V_JBV T_ARRAY_JBV := T_ARRAY_JBV(

T_JBV(506449, 5171904, 486726 ,29544 ,29544,913723000001 ),
T_JBV(538272, 5171450, 446649 ,29544 ,29544,913941700001 ),
T_JBV(498586, 5171827, 447006 ,29544 ,29544,914528000001 ),
T_JBV(544274, 5172202, 469921 ,29544 ,29544,915063800001 ),
T_JBV(558462, 5170809, 458374 ,29544 ,29544,915382900001 ),
T_JBV(558527, 5169655, 495935 ,29544 ,29544,915955600002 ),
T_JBV(558550, 5169289, 495938 ,29544 ,29544,915955900002 ),
T_JBV(494888, 5169406, 452481 ,29544 ,29544,916041700001 ),
T_JBV(500541, 5170682, 463438 ,29544 ,29544,916198800001 ),
T_JBV(525805, 5173330, 449831 ,29544 ,29544,916316600001 ),
T_JBV(550681, 5173066, 449823 ,29544 ,29544,916317400003 ),
T_JBV(500697, 5173328, 449819 ,29544 ,29544,916317700001 ),
T_JBV(531272, 5173074, 457012 ,29544 ,29544,916383000001 ),
T_JBV(492916, 5173193, 456200 ,29544 ,29544,916410300001 ),
T_JBV(511126, 5172936, 456206 ,29544 ,29544,916411100001 ),
T_JBV(520665, 5172621, 456208 ,29544 ,29544,916411200001 ),
T_JBV(504604, 5172826, 445272 ,29544 ,29544,916431200001 ),
T_JBV(528956, 5172584, 458863 ,29544 ,29544,916450500001 ),
T_JBV(498791, 5173080, 499529 ,29544 ,29544,916590300001 ),
T_JBV(485380, 5173027, 490233 ,29544 ,29544,916591800001 ),
T_JBV(525905, 5172774, 455855 ,29544 ,29544,916623900001 ),
T_JBV(514538, 5170633, 459082 ,29544 ,29544,916683600001 ),
T_JBV(493470, 5169648, 457927 ,29544 ,29544,916688300001 ),
T_JBV(484834, 5169350, 489835 ,29544 ,29544,916709300001 ),
T_JBV(487837, 5170647, 454744 ,29544 ,29544,916725300001 ),
T_JBV(488942, 5170098, 446708 ,29544 ,29544,916729700001 ),
T_JBV(511792, 5169590, 466461 ,29544 ,29544,916730300001 ),
T_JBV(512301, 5170097, 445984 ,29544 ,29544,916791900001 ),
T_JBV(499142, 5169699, 494022 ,29544 ,29544,916813400001 ),
T_JBV(557933, 5169257, 456148 ,29544 ,29544,916826600001 ),
T_JBV(508254, 5169619, 456182 ,29544 ,29544,916826900001 ),
T_JBV(511112, 5170483, 456179 ,29544 ,29544,916827700001 ),
T_JBV(541583, 5169446, 456122 ,29544 ,29544,916831400001 ),
T_JBV(492528, 5169821, 456120 ,29544 ,29544,916831500001 ),
T_JBV(520634, 5169448, 456156 ,29544 ,29544,916834000001 ),
T_JBV(541541, 5169817, 456091 ,29544 ,29544,916834600001 ),
T_JBV(481141, 5170901, 445363 ,29544 ,29544,916838600001 ),
T_JBV(529546, 5170790, 491485 ,29544 ,29544,916883000001 ),
T_JBV(498546, 5171696, 491491 ,29544 ,29544,916883600001 ),
T_JBV(484771, 5171697, 491492 ,29544 ,29544,916883700001 ),
T_JBV(529550, 5171698, 491510 ,29544 ,29544,916884000001 ),
T_JBV(513099, 5163590, 452452 ,29544 ,29544,916910900001 ),
T_JBV(487133, 5171335, 464166 ,29544 ,29544,915193600001 ),
T_JBV(543675, 5172125, 458404 ,29544 ,29544,915454700001 ),
T_JBV(524807, 5172055, 492903 ,29544 ,29544,915627000001 ),
T_JBV(488928, 5086024, 464900 ,29544 ,29544,915658600001 ),
T_JBV(501352, 5171791, 470070 ,29544 ,29544,915812800001 ),
T_JBV(542936, 5170976, 464167 ,29544 ,29544,915837800001 ),
T_JBV(558529, 5169863, 495933 ,29544 ,29544,915955500002 ),
T_JBV(551588, 5169620, 462260 ,29544 ,29544,915968100001 ),
T_JBV(549466, 5169324, 486852 ,29544 ,29544,916062300001 ),
T_JBV(525806, 5173331, 449831 ,29544 ,29544,916316600002 ),
T_JBV(557502, 5172616, 449825 ,29544 ,29544,916317200001 ),
T_JBV(507442, 5173065, 449822 ,29544 ,29544,916317500002 ),
T_JBV(550688, 5172618, 449833 ,29544 ,29544,916317800002 ),
T_JBV(493984, 5172941, 456553 ,29544 ,29544,916406100001 ),
T_JBV(492908, 5172933, 456191 ,29544 ,29544,916408100001 ),
T_JBV(492914, 5172781, 456199 ,29544 ,29544,916408700001 ),
T_JBV(501570, 5173337, 456214 ,29544 ,29544,916409600002 ),
T_JBV(520663, 5172783, 456207 ,29544 ,29544,916411400001 ),
T_JBV(510146, 5172906, 447737 ,29544 ,29544,916492500001 ),
T_JBV(526297, 5173097, 497311 ,29544 ,29544,916517000001 ),
T_JBV(536045, 5172516, 497308 ,29544 ,29544,916517500001 ),
T_JBV(507562, 5172664, 496505 ,29544 ,29544,916519600001 ),
T_JBV(507561, 5172663, 496504 ,29544 ,29544,916519800001 ),
T_JBV(541443, 5173077, 451408 ,29544 ,29544,916540700001 ),
T_JBV(490621, 5169584, 447644 ,29544 ,29544,916672500001 ),
T_JBV(501446, 5170453, 460064 ,29544 ,29544,916704000001 ),
T_JBV(543268, 5169319, 446314 ,29544 ,29544,916732900001 ),
T_JBV(527838, 5170435, 458242 ,29544 ,29544,916737400001 ),
T_JBV(556570, 5170256, 499788 ,29544 ,29544,916769100001 ),
T_JBV(498988, 5169435, 455339 ,29544 ,29544,916778600001 ),
T_JBV(492854, 5170481, 456149 ,29544 ,29544,916826500001 ),
T_JBV(508221, 5170480, 456143 ,29544 ,29544,916827100001 ),
T_JBV(508224, 5170670, 456144 ,29544 ,29544,916827400001 ),
T_JBV(551131, 5169445, 456114 ,29544 ,29544,916828000001 ),
T_JBV(541571, 5169820, 456115 ,29544 ,29544,916828200001 ),
T_JBV(508191, 5170476, 456113 ,29544 ,29544,916828300001 ),
T_JBV(551126, 5169611, 456108 ,29544 ,29544,916830000001 ),
T_JBV(501207, 5170664, 456106 ,29544 ,29544,916830200001 ),
T_JBV(541590, 5169615, 456129 ,29544 ,29544,916830400001 ),
T_JBV(492525, 5170665, 456117 ,29544 ,29544,916831800001 ),
T_JBV(557936, 5170672, 456151 ,29544 ,29544,916834500001 ),
T_JBV(526267, 5170661, 456095 ,29544 ,29544,916836800001 ),
T_JBV(541545, 5169442, 456094 ,29544 ,29544,916836900001 ),
T_JBV(544857, 5170937, 488833 ,29544 ,29544,916849000001 ),
T_JBV(518081, 5171635, 497304 ,29544 ,29544,916849400001 ),
T_JBV(500540, 5172199, 463429 ,29544 ,29544,916849500001 ),
T_JBV(489126, 5171513, 491482 ,29544 ,29544,916882600001 ),
T_JBV(489128, 5171138, 491484 ,29544 ,29544,916882900001 ),
T_JBV(536048, 5171636, 497334 ,29544 ,29544,916922500001 ),
T_JBV(505176, 5171960, 449026 ,29544 ,29544,916929300001 ),
T_JBV(553937, 5171159, 452748 ,29544 ,29544,916932200001 ),
T_JBV(504622, 5170902, 445527 ,29544 ,29544,916932900001 ),
T_JBV(548311, 5145407, 453326 ,29544 ,29544,916945100001 ),
T_JBV(551775, 5172021, 470070 ,29544 ,29544,914896400001 ),
T_JBV(524812, 5171837, 492909 ,29544 ,29544,915229800001 ),
T_JBV(480890, 5170738, 487593 ,29544 ,29544,915573400001 ),
T_JBV(488132, 5171269, 446526 ,29544 ,29544,915622700001 ),
T_JBV(546006, 5170962, 491081 ,29544 ,29544,915781200001 ),
T_JBV(490266, 5171166, 459419 ,29544 ,29544,915845500001 ),
T_JBV(537938, 5170718, 445762 ,29544 ,29544,915853500001 ),
T_JBV(510626, 5171211, 455899 ,29544 ,29544,915877500001 ),
T_JBV(558536, 5170257, 495932 ,29544 ,29544,915955100002 ),
T_JBV(525510, 5170515, 495933 ,29544 ,29544,915955500003 ),
T_JBV(558528, 5170318, 495937 ,29544 ,29544,915955800001 ),
T_JBV(503479, 5170543, 445684 ,29544 ,29544,916024300001 ),
T_JBV(496404, 5169919, 494531 ,29544 ,29544,916207300001 ),
T_JBV(557504, 5173184, 449826 ,29544 ,29544,916316300003 ),
T_JBV(557498, 5172614, 449822 ,29544 ,29544,916317500003 ),
T_JBV(521157, 5172405, 475949 ,29544 ,29544,916358300001 ),
T_JBV(512018, 5172821, 498451 ,29544 ,29544,916404700001 ),
T_JBV(489590, 5172383, 450531 ,29544 ,29544,916442600001 ),
T_JBV(547347, 5179164, 493581 ,29544 ,29544,916452600001 ),
T_JBV(491693, 5172745, 447616 ,29544 ,29544,916462600001 ),
T_JBV(511239, 5172796, 457571 ,29544 ,29544,916483800001 ),
T_JBV(532982, 5172384, 450559 ,29544 ,29544,916491300001 ),
T_JBV(518083, 5172975, 497310 ,29544 ,29544,916517300001 ),
T_JBV(557608, 5172974, 496510 ,29544 ,29544,916518600001 ),
T_JBV(550447, 5172973, 496509 ,29544 ,29544,916518800001 ),
T_JBV(510753, 5172662, 496503 ,29544 ,29544,916519900001 ),
T_JBV(550446, 5172514, 496502 ,29544 ,29544,916520000001 ),
T_JBV(545106, 5173308, 460373 ,29544 ,29544,916558600001 ),
T_JBV(491710, 5173051, 447737 ,29544 ,29544,916574800001 ),
T_JBV(489553, 5172269, 468999 ,29544 ,29544,916598000001 ),
T_JBV(558545, 5172635, 457571 ,29544 ,29544,916598300001 ),
T_JBV(500788, 5172619, 455852 ,29544 ,29544,916623600001 ),
T_JBV(550633, 5169241, 460035 ,29544 ,29544,916693500001 ),
T_JBV(499820, 5170036, 462753 ,29544 ,29544,916725400001 ),
T_JBV(499944, 5169585, 447709 ,29544 ,29544,916747100001 ),
T_JBV(536420, 5170079, 497597 ,29544 ,29544,916782500001 ),
T_JBV(496042, 5170649, 461294 ,29544 ,29544,916791100001 ),
T_JBV(492903, 5170484, 456183 ,29544 ,29544,916826800001 ),
T_JBV(520618, 5169825, 456142 ,29544 ,29544,916828800001 ),
T_JBV(551492, 5170219, 456137 ,29544 ,29544,916828900001 ),
T_JBV(541565, 5169612, 456110 ,29544 ,29544,916829200001 ),
T_JBV(511061, 5169823, 456132 ,29544 ,29544,916829800001 ),
T_JBV(492536, 5170217, 456127 ,29544 ,29544,916830700001 ),
T_JBV(551143, 5169822, 456125 ,29544 ,29544,916830800001 ),
T_JBV(508193, 5170215, 456116 ,29544 ,29544,916831900001 ),
T_JBV(508195, 5170477, 456118 ,29544 ,29544,916832000001 ),
T_JBV(507901, 5169816, 456090 ,29544 ,29544,916834700001 ),
T_JBV(507892, 5170211, 456084 ,29544 ,29544,916834900001 ),
T_JBV(507896, 5169815, 456088 ,29544 ,29544,916835600001 ),
T_JBV(551118, 5170028, 456101 ,29544 ,29544,916835900001 ),
T_JBV(507908, 5169610, 456102 ,29544 ,29544,916836000001 ),
T_JBV(539289, 5171320, 491488 ,29544 ,29544,916883300001 ),
T_JBV(548532, 5170819, 453367 ,29544 ,29544,916890900001 ),
T_JBV(495903, 5170799, 474681 ,29544 ,29544,916901200001 ),
T_JBV(535549, 5171884, 490756 ,29544 ,29544,916901500001 ),
T_JBV(512801, 5213766, 454884 ,29544 ,29544,905508400001 ),
T_JBV(541009, 5138105, 457163 ,29544 ,29544,913183000001 ),
T_JBV(512810, 5171961, 454950 ,29544 ,29544,914718300001 ),
T_JBV(539470, 5172170, 461409 ,29544 ,29544,915087700001 ),
T_JBV(499172, 5096268, 468999 ,29544 ,29544,915195700001 ),
T_JBV(532136, 5171939, 448119 ,29544 ,29544,915209500001 ),
T_JBV(519160, 5171889, 479798 ,29544 ,29544,915237300001 ),
T_JBV(558530, 5171042, 457570 ,29544 ,29544,915341900001 ),
T_JBV(558531, 5170873, 457570 ,29544 ,29544,915341900002 ),
T_JBV(493814, 5171648, 446085 ,29544 ,29544,915511100001 ),
T_JBV(489631, 5171165, 459133 ,29544 ,29544,915835800001 ),
T_JBV(502081, 5171917, 464166 ,29544 ,29544,915837500001 ),
T_JBV(492172, 5171583, 455900 ,29544 ,29544,915877700001 ),
T_JBV(513856, 5170001, 464812 ,29544 ,29544,915951800001 ),
T_JBV(487075, 5169572, 458053 ,29544 ,29544,915980700001 ),
T_JBV(534185, 5169970, 474950 ,29544 ,29544,915998000001 ),
T_JBV(517481, 5170399, 479239 ,29544 ,29544,916158700001 ),
T_JBV(510264, 5172772, 449826 ,29544 ,29544,916316300001 ),
T_JBV(557505, 5172376, 449827 ,29544 ,29544,916316400002 ),
T_JBV(500702, 5172615, 449825 ,29544 ,29544,916317200002 ),
T_JBV(525801, 5172771, 449825 ,29544 ,29544,916317200003 ),
T_JBV(557501, 5172926, 449823 ,29544 ,29544,916317400001 ),
T_JBV(557499, 5173329, 449823 ,29544 ,29544,916317400002 ),
T_JBV(525797, 5172925, 449822 ,29544 ,29544,916317500001 ),
T_JBV(492058, 5173187, 449833 ,29544 ,29544,916317800001 ),
T_JBV(525808, 5172773, 449833 ,29544 ,29544,916317800003 ),
T_JBV(496630, 5172904, 447410 ,29544 ,29544,916350100001 ),
T_JBV(533405, 5172431, 485982 ,29544 ,29544,916405700001 ),
T_JBV(557978, 5172381, 456209 ,29544 ,29544,916411300001 ),
T_JBV(492927, 5172937, 456210 ,29544 ,29544,916411600001 ),
T_JBV(505522, 5173247, 488279 ,29544 ,29544,916468900001 ),
T_JBV(529976, 5173166, 465165 ,29544 ,29544,916469500001 ),
T_JBV(507563, 5172515, 496506 ,29544 ,29544,916519500001 ),
T_JBV(539684, 5173198, 468881 ,29544 ,29544,916567700001 ),
T_JBV(515347, 5172492, 457084 ,29544 ,29544,916615800001 ),
T_JBV(496019, 5170449, 459083 ,29544 ,29544,916683900001 ),
T_JBV(498273, 5169577, 464706 ,29544 ,29544,916724300001 ),
T_JBV(544853, 5170375, 488715 ,29544 ,29544,916733800001 ),
T_JBV(552448, 5169231, 464184 ,29544 ,29544,916791700001 ),
T_JBV(487760, 5169234, 458429 ,29544 ,29544,916806600001 ),
T_JBV(492290, 5170709, 497311 ,29544 ,29544,916811400001 ),
T_JBV(541963, 5170223, 456184 ,29544 ,29544,916826700001 ),
T_JBV(520623, 5170220, 456147 ,29544 ,29544,916827000001 ),
T_JBV(492851, 5170671, 456146 ,29544 ,29544,916827200001 ),
T_JBV(520619, 5170031, 456145 ,29544 ,29544,916827300001 ),
T_JBV(541960, 5169449, 456180 ,29544 ,29544,916827600001 ),
T_JBV(511108, 5170222, 456177 ,29544 ,29544,916827900001 ),
T_JBV(511071, 5170669, 456140 ,29544 ,29544,916828500001 ),
T_JBV(511070, 5170667, 456138 ,29544 ,29544,916828700001 ),
T_JBV(492548, 5170479, 456135 ,29544 ,29544,916829400001 ),
T_JBV(511063, 5170478, 456133 ,29544 ,29544,916829700001 ),
T_JBV(508208, 5170218, 456128 ,29544 ,29544,916830600001 ),
T_JBV(551139, 5170029, 456124 ,29544 ,29544,916830900001 ),
T_JBV(501529, 5169826, 456166 ,29544 ,29544,916833000001 ),
T_JBV(492861, 5169258, 456153 ,29544 ,29544,916834200001 ),
T_JBV(498545, 5171695, 491489 ,29544 ,29544,916883400001 ),
T_JBV(552764, 5171448, 446224 ,29544 ,29544,916906500001 ),
T_JBV(525200, 5213767, 492961 ,29544 ,29544,906270000001 ),
T_JBV(490834, 5087930, 457161 ,29544 ,29544,913650900001 ),
T_JBV(506949, 5171295, 488908 ,29544 ,29544,914685300001 ),
T_JBV(543000, 5171449, 446238 ,29544 ,29544,915107900001 ),
T_JBV(528207, 5170807, 452450 ,29544 ,29544,915445800001 ),
T_JBV(510387, 5170064, 495935 ,29544 ,29544,915955600003 ),
T_JBV(486639, 5173141, 479242 ,29544 ,29544,916249300001 ),
T_JBV(557506, 5173186, 449827 ,29544 ,29544,916316400001 ),
T_JBV(550684, 5173185, 449827 ,29544 ,29544,916316400003 ),
T_JBV(507445, 5173067, 449829 ,29544 ,29544,916317000001 ),
T_JBV(514108, 5172721, 485982 ,29544 ,29544,916405700002 ),
T_JBV(492922, 5172486, 456205 ,29544 ,29544,916411000001 ),
T_JBV(480911, 5173242, 487637 ,29544 ,29544,916420100001 ),
T_JBV(539402, 5172901, 453168 ,29544 ,29544,916438600001 ),
T_JBV(554728, 5179176, 461294 ,29544 ,29544,916477600001 ),
T_JBV(532953, 5172627, 468881 ,29544 ,29544,916567700002 ),
T_JBV(558541, 5172272, 457571 ,29544 ,29544,916598300002 ),
T_JBV(527157, 5169423, 460475 ,29544 ,29544,916664100001 ),
T_JBV(486768, 5169802, 466137 ,29544 ,29544,916678200001 ),
T_JBV(541360, 5169626, 463253 ,29544 ,29544,916680200001 ),
T_JBV(512617, 5169481, 445762 ,29544 ,29544,916688700001 ),
T_JBV(493149, 5169240, 454062 ,29544 ,29544,916705800001 ),
T_JBV(526301, 5170323, 497330 ,29544 ,29544,916711400001 ),
T_JBV(557798, 5169458, 497330 ,29544 ,29544,916711400005 ),
T_JBV(545452, 5169403, 464132 ,29544 ,29544,916724500001 ),
T_JBV(551740, 5170691, 463638 ,29544 ,29544,916724700001 ),
T_JBV(553491, 5170162, 491907 ,29544 ,29544,916730000001 ),
T_JBV(524640, 5170316, 495011 ,29544 ,29544,916733100001 ),
T_JBV(525904, 5169811, 455854 ,29544 ,29544,916745800001 ),
T_JBV(550782, 5169606, 455857 ,29544 ,29544,916821200001 ),
T_JBV(514455, 5169761, 492189 ,29544 ,29544,916825400001 ),
T_JBV(501484, 5169614, 456123 ,29544 ,29544,916831100001 ),
T_JBV(508200, 5170216, 456121 ,29544 ,29544,916831600001 ),
T_JBV(508197, 5169613, 456119 ,29544 ,29544,916831700001 ),
T_JBV(557942, 5170221, 456155 ,29544 ,29544,916834300001 ),
T_JBV(526253, 5170027, 456082 ,29544 ,29544,916835200001 ),
T_JBV(492495, 5169439, 456083 ,29544 ,29544,916835300001 ),
T_JBV(492493, 5170471, 456080 ,29544 ,29544,916835400001 ),
T_JBV(501174, 5170472, 456081 ,29544 ,29544,916835500001 ),
T_JBV(510704, 5169255, 456087 ,29544 ,29544,916835700001 ),
T_JBV(501198, 5169444, 456098 ,29544 ,29544,916836400001 ),
T_JBV(510708, 5169441, 456092 ,29544 ,29544,916836500001 ),
T_JBV(510798, 5171261, 496779 ,29544 ,29544,916878700001 ),
T_JBV(498548, 5171899, 491494 ,29544 ,29544,916883900001 ),
T_JBV(513099, 5172123, 452452 ,29544 ,29544,916910900001 ),
T_JBV(513901, 5171190, 449027 ,29544 ,29544,916930500001 ),
T_JBV(545482, 5171731, 448571 ,29544 ,29544,916931800001 ),
T_JBV(541976, 5213762, 456215 ,29544 ,29544,907601200001 ),
T_JBV(492909, 5213771, 456215 ,29544 ,29544,907601200002 ),
T_JBV(558540, 5170869, 451407 ,29544 ,29544,910903100001 ),
T_JBV(552676, 5171647, 445727 ,29544 ,29544,913470800001 ),
T_JBV(497289, 5170721, 492935 ,29544 ,29544,915092900001 ),
T_JBV(549474, 5172054, 492902 ,29544 ,29544,915229000001 ),
T_JBV(498218, 5171127, 479801 ,29544 ,29544,915239200001 ),
T_JBV(537857, 5171313, 479800 ,29544 ,29544,915239300001 ),
T_JBV(497257, 5170065, 495938 ,29544 ,29544,915955900003 ),
T_JBV(529117, 5169509, 493707 ,29544 ,29544,915963200001 ),
T_JBV(512049, 5170178, 458054 ,29544 ,29544,915980800001 ),
T_JBV(515914, 5169346, 488506 ,29544 ,29544,916027600001 ),
T_JBV(513064, 5170545, 446418 ,29544 ,29544,916034200001 ),
T_JBV(514180, 5169887, 446972 ,29544 ,29544,916056600001 ),
T_JBV(481554, 5169162, 476350 ,29544 ,29544,916196100001 ),
T_JBV(512626, 5172527, 445808 ,29544 ,29544,916286400001 ),
T_JBV(500704, 5172478, 449826 ,29544 ,29544,916316300002 ),
T_JBV(556462, 5172611, 455259 ,29544 ,29544,916400900001 ),
T_JBV(520662, 5173192, 456196 ,29544 ,29544,916409200002 ),
T_JBV(551548, 5172382, 456214 ,29544 ,29544,916409600001 ),
T_JBV(492921, 5172485, 456204 ,29544 ,29544,916410800001 ),
T_JBV(496023, 5172473, 455435 ,29544 ,29544,916509300001 ),
T_JBV(550886, 5172262, 497309 ,29544 ,29544,916517400001 ),
T_JBV(557609, 5173096, 496513 ,29544 ,29544,916518100001 ),
T_JBV(499173, 5172494, 468999 ,29544 ,29544,916598000002 ),
T_JBV(496602, 5172673, 447139 ,29544 ,29544,916643700001 ),
T_JBV(511165, 5169295, 497330 ,29544 ,29544,916711400002 ),
T_JBV(511166, 5169868, 497330 ,29544 ,29544,916711400004 ),
T_JBV(489939, 5169888, 447194 ,29544 ,29544,916728900001 ),
T_JBV(541078, 5170004, 453905 ,29544 ,29544,916758400001 ),
T_JBV(496287, 5169582, 459133 ,29544 ,29544,916774700001 ),
T_JBV(541935, 5169617, 456150 ,29544 ,29544,916826300001 ),
T_JBV(511066, 5169256, 456136 ,29544 ,29544,916829500001 ),
T_JBV(511060, 5169616, 456131 ,29544 ,29544,916829900001 ),
T_JBV(526278, 5170213, 456107 ,29544 ,29544,916830100001 ),
T_JBV(507900, 5170660, 456089 ,29544 ,29544,916834800001 ),
T_JBV(501181, 5170659, 456085 ,29544 ,29544,916835100001 ),
T_JBV(492511, 5169609, 456100 ,29544 ,29544,916836200001 ),
T_JBV(519738, 5171514, 491486 ,29544 ,29544,916883100001 ),
T_JBV(489132, 5171898, 491490 ,29544 ,29544,916883500001 ),
T_JBV(542407, 5171125, 490842 ,29544 ,29544,916885900001 ),
T_JBV(549296, 5171867, 488376 ,29544 ,29544,916892300001 ),
T_JBV(495567, 5092663, 486300 ,29544 ,29544,916905200001 ),
T_JBV(541382, 5171233, 463429 ,29544 ,29544,916942900001 ),
T_JBV(558539, 5171037, 451407 ,29544 ,29544,910903100002 ),
T_JBV(548197, 5172003, 450862 ,29544 ,29544,913582000001 ),
T_JBV(553123, 5170715, 445060 ,29544 ,29544,914033500001 ),
T_JBV(528957, 5171533, 458864 ,29544 ,29544,915288800001 ),
T_JBV(558548, 5169862, 495932 ,29544 ,29544,915955100001 ),
T_JBV(517257, 5170514, 495932 ,29544 ,29544,915955100003 ),
T_JBV(558526, 5170258, 495933 ,29544 ,29544,915955500001 ),
T_JBV(558537, 5169288, 495935 ,29544 ,29544,915955600001 ),
T_JBV(510388, 5170705, 495937 ,29544 ,29544,915955800003 ),
T_JBV(558549, 5170319, 495938 ,29544 ,29544,915955900001 ),
T_JBV(518533, 5170554, 493550 ,29544 ,29544,915985900001 ),
T_JBV(491242, 5170640, 459945 ,29544 ,29544,916172700001 ),
T_JBV(504618, 5169315, 445401 ,29544 ,29544,916197400001 ),
T_JBV(556604, 5172467, 461294 ,29544 ,29544,916249800001 ),
T_JBV(509891, 5172777, 461843 ,29544 ,29544,916305000001 ),
T_JBV(550687, 5172617, 449831 ,29544 ,29544,916316600003 ),
T_JBV(551535, 5172484, 456198 ,29544 ,29544,916410200001 ),
T_JBV(541970, 5172380, 456203 ,29544 ,29544,916410700001 ),
T_JBV(489727, 5172698, 488041 ,29544 ,29544,916427200001 ),
T_JBV(507500, 5172482, 450053 ,29544 ,29544,916473700001 ),
T_JBV(507564, 5173217, 496512 ,29544 ,29544,916518400001 ),
T_JBV(510754, 5173095, 496507 ,29544 ,29544,916519200001 ),
T_JBV(541227, 5173068, 455853 ,29544 ,29544,916623500001 ),
T_JBV(510693, 5170470, 456072 ,29544 ,29544,916686600001 ),
T_JBV(535035, 5169899, 492907 ,29544 ,29544,916694200001 ),
T_JBV(544382, 5169799, 448042 ,29544 ,29544,916728700001 ),
T_JBV(485624, 5170131, 478936 ,29544 ,29544,916734200001 ),
T_JBV(557410, 5170320, 496069 ,29544 ,29544,916736500001 ),
T_JBV(554960, 5169415, 459252 ,29544 ,29544,916738900001 ),
T_JBV(554424, 5169598, 455275 ,29544 ,29544,916758600001 ),
T_JBV(553459, 5169892, 445363 ,29544 ,29544,916772700001 ),
T_JBV(532990, 5169260, 450571 ,29544 ,29544,916826000001 ),
T_JBV(557962, 5169259, 456181 ,29544 ,29544,916827500001 ),
T_JBV(501544, 5170033, 456178 ,29544 ,29544,916827800001 ),
T_JBV(501508, 5169447, 456141 ,29544 ,29544,916828400001 ),
T_JBV(508189, 5170475, 456111 ,29544 ,29544,916829100001 ),
T_JBV(508187, 5170214, 456109 ,29544 ,29544,916829300001 ),
T_JBV(557918, 5170030, 456130 ,29544 ,29544,916830300001 ),
T_JBV(541560, 5170663, 456105 ,29544 ,29544,916830500001 ),
T_JBV(541586, 5170666, 456126 ,29544 ,29544,916831000001 ),
T_JBV(501203, 5169818, 456104 ,29544 ,29544,916831200001 ),
T_JBV(520629, 5170482, 456154 ,29544 ,29544,916834100001 ),
T_JBV(501182, 5169440, 456086 ,29544 ,29544,916835000001 ),
T_JBV(557782, 5170474, 456103 ,29544 ,29544,916835800001 ),
T_JBV(551115, 5170662, 456099 ,29544 ,29544,916836100001 ),
T_JBV(507905, 5169443, 456097 ,29544 ,29544,916836300001 ),
T_JBV(501193, 5170473, 456093 ,29544 ,29544,916836600001 ),
T_JBV(540812, 5170824, 453668 ,29544 ,29544,916847900001 ),
T_JBV(481081, 5171440, 445063 ,29544 ,29544,916850300001 ),
T_JBV(502181, 5170828, 460443 ,29544 ,29544,916852200001 ),
T_JBV(523934, 5170846, 461312 ,29544 ,29544,916862300001 ),
T_JBV(545749, 5170904, 446033 ,29544 ,29544,916880300001 ),
T_JBV(485966, 5171727, 465989 ,29544 ,29544,916881100001 ),
T_JBV(539293, 5172112, 491493 ,29544 ,29544,916883800001 ),
T_JBV(546464, 5171085, 446421 ,29544 ,29544,916921000001 ),
T_JBV(553743, 5171437, 498765 ,29544 ,29544,916929000001 ),
T_JBV(549525, 5213763, 492961 ,29544 ,29544,906454900001 ),
T_JBV(487164, 5162571, 454400 ,29544 ,29544,907422800001 ),
T_JBV(490267, 5171724, 459419 ,29544 ,29544,914125400001 ),
T_JBV(519161, 5171312, 479799 ,29544 ,29544,915237400001 ),
T_JBV(492732, 5171654, 476019 ,29544 ,29544,915779900001 ),
T_JBV(558525, 5170704, 495937 ,29544 ,29544,915955800002 ),
T_JBV(547366, 5169916, 493715 ,29544 ,29544,915963000001 ),
T_JBV(485551, 5170226, 463036 ,29544 ,29544,915968700001 ),
T_JBV(495876, 5169700, 494080 ,29544 ,29544,916001100001 ),
T_JBV(524667, 5170317, 495285 ,29544 ,29544,916047400001 ),
T_JBV(512776, 5169429, 448941 ,29544 ,29544,916097400001 ),
T_JBV(556717, 5172849, 494065 ,29544 ,29544,916233200001 ),
T_JBV(492056, 5172927, 449829 ,29544 ,29544,916317000002 ),
T_JBV(510267, 5172479, 449829 ,29544 ,29544,916317000003 ),
T_JBV(525795, 5172375, 449819 ,29544 ,29544,916317700002 ),
T_JBV(550679, 5172770, 449819 ,29544 ,29544,916317700003 ),
T_JBV(534217, 5173007, 476886 ,29544 ,29544,916355800001 ),
T_JBV(520661, 5172379, 456195 ,29544 ,29544,916409000001 ),
T_JBV(551533, 5172483, 456196 ,29544 ,29544,916409200001 ),
T_JBV(492918, 5172782, 456201 ,29544 ,29544,916410500001 ),
T_JBV(510755, 5172665, 496508 ,29544 ,29544,916519000001 ),
T_JBV(528553, 5172351, 452586 ,29544 ,29544,916604300001 ),
T_JBV(557797, 5170265, 497330 ,29544 ,29544,916711400003 ),
T_JBV(539013, 5169791, 464892 ,29544 ,29544,916724100001 ),
T_JBV(541105, 5170003, 459818 ,29544 ,29544,916726300001 ),
T_JBV(515376, 5170495, 457355 ,29544 ,29544,916727200001 ),
T_JBV(546457, 5169895, 446368 ,29544 ,29544,916729800001 ),
T_JBV(526514, 5170007, 466439 ,29544 ,29544,916730200001 ),
T_JBV(511454, 5169451, 462145 ,29544 ,29544,916769400001 ),
T_JBV(551518, 5169618, 456176 ,29544 ,29544,916828100001 ),
T_JBV(557924, 5170668, 456139 ,29544 ,29544,916828600001 ),
T_JBV(511041, 5169819, 456112 ,29544 ,29544,916829000001 ),
T_JBV(511064, 5169824, 456134 ,29544 ,29544,916829600001 ),
T_JBV(557938, 5170032, 456152 ,29544 ,29544,916834400001 ),
T_JBV(557774, 5170212, 456096 ,29544 ,29544,916836700001 ),
T_JBV(552671, 5171443, 445690 ,29544 ,29544,916845100001 ),
T_JBV(547497, 5172111, 491487 ,29544 ,29544,916883200001 ),
T_JBV(489138, 5171900, 491511 ,29544 ,29544,916884100001 ),
T_JBV(514406, 5171285, 494022 ,29544 ,29544,916900800001 )

		); 
	V_TMP_JBV T_JBV;
    
BEGIN	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ACTUALIZACION TRAMITES Y TAREAS');

	FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);
	
  	TRA_ID := TRIM(V_TMP_JBV(1));
  	
  	TAR_ID := TRIM(V_TMP_JBV(2));

	ACT_ID := TRIM(V_TMP_JBV(3));

	USU_ID := TRIM(V_TMP_JBV(4));

	PRO_ID := TRIM(V_TMP_JBV(5));
  	
  	NUM_TBJ := TRIM(V_TMP_JBV(6));


	--SACAMOS EL ID DEL NUEVO USUARIO DESTINO DE LAS TAREAS
	
	V_SQL := 'SELECT USU_ID FROM '||V_ESQUEMA_M||'.USU_USUARIOS WHERE USU_USERNAME = ''acierta.divarian''';

	EXECUTE IMMEDIATE V_SQL INTO V_USUARIO;

	--COMPROBAMOS SI EXISTE TRABAJO

	V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO WHERE TBJ_NUM_TRABAJO = '||NUM_TBJ;
	
	EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS;
	
	IF V_NUM_FILAS > 0 THEN 
	
	--COMPROBAMOS SI EXISTE TAREA

		DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZANDO TRAMITE DE TRABAJO '||NUM_TBJ||'');

		V_SQL := 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS WHERE TRA_ID = '||TRA_ID||' AND TAR_ID = '||TAR_ID||' AND ACT_ID = '||ACT_ID||'';
	
		EXECUTE IMMEDIATE V_SQL INTO V_NUM_FILAS_1;
	
		IF V_NUM_FILAS_1 > 0 THEN
	
			V_MSQL := 'UPDATE '||V_ESQUEMA||'.TAC_TAREAS_ACTIVOS 
					   SET USU_ID = '||V_USUARIO||',
					   USUARIOMODIFICAR = '''||V_USR||''',
					   FECHAMODIFICAR = SYSDATE 
					   WHERE TRA_ID = '||TRA_ID||' AND TAR_ID = '||TAR_ID||' AND ACT_ID = '||ACT_ID||'';
	

			EXECUTE IMMEDIATE V_MSQL;
	    
			DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO CON TRA_ID: '||TRA_ID||' ACTUALIZADO');
		
			V_COUNT_UPDATE_1 := V_COUNT_UPDATE_1 + 1;
		
		ELSE
		
			DBMS_OUTPUT.PUT_LINE('[INFO] REGISTRO NO EXISTE');
		
		END IF;
        
   	ELSE
		
	DBMS_OUTPUT.PUT_LINE('[INFO] TRABAJO NO EXISTE');
		
	END IF; 

   	END LOOP;

	COMMIT;

	DBMS_OUTPUT.PUT_LINE('********************************************************************');

	DBMS_OUTPUT.PUT_LINE('[FIN] Se han updateado en total '||V_COUNT_UPDATE_1||' registros EN TAC_TAREAS_ACTIVOS');

	DBMS_OUTPUT.PUT_LINE('********************************************************************');

	DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZAMOS PROVEEDOR A TRABAJOS DE CASER ASISTENCIA -> ACIERTA ASISTENCIA');

	V_MSQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_TBJ_TRABAJO T1
	    USING (SELECT TBJ_NUM_TRABAJO FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO TBJ 
		   INNER JOIN '||V_ESQUEMA||'.AUX_REMVIP_7529 AUX ON TBJ.TBJ_NUM_TRABAJO = AUX.NUM_TRABAJO
		  ) T2
	    ON (T1.TBJ_NUM_TRABAJO = T2.TBJ_NUM_TRABAJO)
	  WHEN MATCHED THEN
	    UPDATE 
	       SET T1.USUARIOMODIFICAR = ''REMVIP-7529'',
		   T1.FECHAMODIFICAR = SYSDATE,
	   	   T1.PVC_ID = 204177';
		
	EXECUTE IMMEDIATE V_MSQL;  
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Actualizados '||SQL%ROWCOUNT||' registros EN ACT_TBJ_TRABAJO ');  

	V_MSQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_TBJ_TRABAJO T1
	    USING (SELECT TBJ_ID FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO TBJ 
		   WHERE TBJ_NUM_TRABAJO IN (916950100939,
				916950101159,
				916950101739,
				916950101745,
				916950102424,
				916950102858,
				916950102874,
				916950102913,
				916950102952,
				916950102984,
				916950103009,
				916950103046,
				916950103427,
				916950103528,
				916950106002,
				916950106618,
				916950107035,
				916964300630,
				916964300782,
				916964300792,
				916964300796,
				916964300797,
				916964301396,
				916964301503,
				916964302442,
				916964302506,
				916964302987,
				916964304213,
				916964304812,
				916964305049)
		  ) T2
	    ON (T1.TBJ_ID = T2.TBJ_ID)
	  WHEN MATCHED THEN
	    UPDATE 
	       SET T1.USUARIOMODIFICAR = ''REMVIP-7529'',
		   T1.FECHAMODIFICAR = SYSDATE,
	   	   T1.PVC_ID = 196411';
		
	EXECUTE IMMEDIATE V_MSQL;  
	
	DBMS_OUTPUT.PUT_LINE('[INFO] Actualizados '||SQL%ROWCOUNT||' registros EN ACT_TBJ_TRABAJO ');  

	DBMS_OUTPUT.PUT_LINE('[FIN] ');

	COMMIT;

EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecuci√≥n:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
