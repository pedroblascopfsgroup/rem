--/*
--#########################################
--## AUTOR=VIOREL REMUS OVIDIU
--## FECHA_CREACION=20200724
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-7838
--## PRODUCTO=NO
--## 
--## Finalidad: Dar de baja agrupaciones
--##
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE



	V_ESQUEMA VARCHAR2(10 CHAR) := 'REM01';
	V_ESQUEMA_MASTER VARCHAR2(15 CHAR) := 'REMMASTER';
	V_SQL VARCHAR2(32000 CHAR) := '';
	V_NUM NUMBER(25);
	TABLE_COUNT NUMBER(10,0) := 0;
	


BEGIN

      DBMS_OUTPUT.PUT_LINE('[INFO] COMIENZA EL PROCESO ');
      
 
      V_SQL := '
       UPDATE REM01.ACT_AGR_AGRUPACION AGR
		SET AGR.AGR_ELIMINADO = 1,
		AGR.AGR_FECHA_BAJA = SYSDATE,
		BORRADO = 1,
		USUARIOBORRAR = ''REMVIP-7838'',
		FECHABORRAR = SYSDATE
		WHERE AGR_NUM_AGRUP_REM IN (1000013985,
1000020931,
1000020932,
1000020916,
1000020919,
1000020920,
1000020923,
1000020924,
1000020820,
1000020821,
1000020822,
1000020823,
1000020824,
1000020825,
1000020826,
1000020827,
1000020828,
1000020829,
1000020830,
1000020831,
1000020832,
1000020833,
1000020834,
1000020835,
1000020836,
1000020837,
1000020838,
1000020839,
1000020840,
1000020841,
1000020842,
1000020843,
1000020844,
1000020845,
1000020848,
1000020849,
1000020850,
1000020851,
1000020853,
1000020854,
1000020855,
1000020856,
1000020857,
1000020858,
1000020859,
1000020861,
1000020862,
1000020863,
1000020865,
1000020866,
1000020867,
1000020868,
1000020869,
1000020870,
1000020871,
1000020872,
1000020873,
1000020874,
1000020875,
1000020876,
1000020877,
1000020878,
1000020880,
1000020881,
1000020882,
1000020883,
1000020884,
1000020885,
1000020886,
1000020887,
1000020888,
1000020889,
1000020890,
1000020891,
1000020892,
1000020893,
1000020894,
1000020895,
1000020896,
1000020897,
1000020898,
1000020900,
1000020905,
1000020906,
1000020909,
1000020910,
1000020908,
1000020769,
1000020774,
1000020775,
1000020776,
1000020777,
1000020779,
1000020781,
1000020782,
1000020783,
1000020784,
1000020786,
1000020787,
1000020788,
1000020789,
1000020790,
1000020792,
1000020793,
1000020794,
1000020795,
1000020796,
1000020797,
1000020798,
1000020799,
1000020800,
1000020801,
1000020802,
1000020803,
1000020804,
1000020805,
1000020806,
1000020807,
1000020808,
1000020809,
1000020810,
1000020812,
1000020813,
1000020814,
1000020815,
1000020816,
1000020817,
1000020818,
1000020819)';


      EXECUTE IMMEDIATE V_SQL;
      
      DBMS_OUTPUT.PUT_LINE('[INFO] DADAS DE BAJA  '||SQL%ROWCOUNT||' AGRUPACIONES.');
       
   COMMIT;
        
EXCEPTION
      WHEN OTHERS THEN
            DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
            DBMS_OUTPUT.put_line('-----------------------------------------------------------');
            DBMS_OUTPUT.put_line(SQLERRM);
            ROLLBACK;
            RAISE;
END;

/

EXIT;
