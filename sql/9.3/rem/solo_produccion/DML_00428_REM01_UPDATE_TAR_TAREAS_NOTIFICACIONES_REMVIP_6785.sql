--/*
--##########################################
--## AUTOR=Juan Beltrán
--## FECHA_CREACION=20200814
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-6785
--## PRODUCTO=NO
--##
--## Finalidad: Actualizar instrucciones
--## INSTRUCCIONES: 
--## VERSIONES:
--##        0.1 Version inicial
--##########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
  V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
  V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
  V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
  ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
  ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
  V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
  V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
  V_USUARIO VARCHAR2(100 CHAR) := 'REMVIP-6785';
  ECO_ID  NUMBER(16);
	
  
BEGIN	
	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ');	

	V_MSQL := 'UPDATE '||V_ESQUEMA||'.TAR_TAREAS_NOTIFICACIONES TAR
    SET BORRADO = 1,
    	USUARIOBORRAR = ''REMVIP-6785'',
    	FECHABORRAR = SYSDATE
    WHERE TAR.TAR_ID IN (                
            SELECT TAR_ID
            	FROM '||V_ESQUEMA||'.VTAR_TAREA_VS_USUARIO
            WHERE GESTOR = ''RUIZ ÁVILA, ANTONIO''
            	AND TAR_TAREA =''Notificación''
            	AND TAR_FECHA_VENC IN(            
	                 TO_TIMESTAMP(''2017-09-19 16:01:32.644'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-21 09:31:57.086'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-21 09:41:08.067'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-21 09:52:59.376'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-22 13:52:19.769'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-25 09:55:40.402'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-25 09:55:40.48'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-25 10:24:04.449'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-25 10:24:04.524'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-27 17:44:44.355'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-28 09:52:25.961'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-28 16:55:34.527'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-09-28 16:55:34.654'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-10-02 14:35:07.376'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-11-29 10:53:45.548'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-12-01 14:06:11.112'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-12-14 13:17:09.097'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-12-19 12:52:55.203'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2017-12-19 15:18:33.73'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-03 08:49:29.154'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-03 13:07:27.619'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-05 13:55:13.684'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-10 13:00:55.156'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-17 14:30:58.148'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-18 10:45:28.387'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-22 08:31:48.381'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-29 13:37:59.007'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-01-30 14:19:07.121'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-02-07 08:58:00.77'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-02-12 16:44:50.002'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-02-13 19:16:24.051'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-02-20 12:56:22.302'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-02-28 13:16:54.29'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-01 15:58:55.059'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-02 14:01:28.719'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-08 22:25:09.197'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-19 11:35:47.224'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-20 11:20:23.599'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-21 10:38:06.439'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-21 13:13:23.392'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-23 10:40:35.074'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-03-28 08:47:21.158'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-04-09 12:34:35.998'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-04-09 14:23:52.885'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-04-12 08:14:25.638'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-04-12 08:14:25.788'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-04-12 08:14:25.954'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-04-16 13:09:34.806'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-04-17 18:40:50.011'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-08-27 15:25:30.762'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-08-29 09:18:12.08'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-08-29 09:39:29.113'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-10-31 12:47:46.805'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-11-07 18:26:59.354'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-11-22 14:08:14.018'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-11-23 12:22:54.518'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-11-26 13:39:43.887'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-12-07 11:41:34.702'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-12-12 09:55:08.554'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-12-19 13:35:38.259'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2018-12-19 13:35:38.551'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-01-29 10:14:06.432'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-01-29 11:16:43.598'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-01-29 11:26:01.782'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-01-30 13:35:15.769'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-01-30 16:54:28.058'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-02-04 16:29:37.955'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-02-11 09:32:10.639'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-02-11 13:13:52.538'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-02-20 13:49:46.828'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-03-08 14:33:02.142'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-03-12 13:52:25.73'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-03-12 13:58:50.84'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-03-14 10:16:52.371'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-03-14 11:55:14.387'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-03 12:22:22.272'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-03 23:37:47.754'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-04 13:37:52.407'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-12 16:12:29.629'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-16 15:42:12.21'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-17 12:16:44.883'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-25 11:44:37.08'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-26 12:26:36.06'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-04-26 13:39:16.822'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-05-08 17:20:58.889'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-05-09 17:29:01.205'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-05-09 18:10:25.61'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-12-11 11:50:28.048'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-12-12 17:20:41.279'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2019-12-20 09:55:28.954'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2020-02-13 16:10:32.482'', ''YYYY-MM-DD HH24:MI:SS,FF9''),
					 TO_TIMESTAMP(''2020-02-19 08:53:06.611'', ''YYYY-MM-DD HH24:MI:SS,FF9'')
                )            
        ) AND BORRADO = 0';
        
	EXECUTE IMMEDIATE V_MSQL;
	
	DBMS_OUTPUT.put_line('[INFO] Actualizado '||SQL%ROWCOUNT||' registros ');
    COMMIT;
   
   	DBMS_OUTPUT.PUT_LINE('[FIN] ');

EXCEPTION

   WHEN OTHERS THEN
        err_num := SQLCODE;
        err_msg := SQLERRM;

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);

        ROLLBACK;
        RAISE;          

END;

/

EXIT
