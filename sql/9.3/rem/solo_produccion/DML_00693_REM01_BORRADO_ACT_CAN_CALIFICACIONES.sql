--/*
--###########################################
--## AUTOR=PIER GOTTA
--## FECHA_CREACION=20210222
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-9006
--## PRODUCTO=NO
--## 
--## Finalidad: ACTUALIZAR GASTOS A PAGADO
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--###########################################
----*/


WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE
  V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
  V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
  V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
  V_SQL VARCHAR2(4000 CHAR); -- Vble. para consulta que valida la existencia de una tabla.
  V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
  V_NUM_TABLAS_2 NUMBER(16); -- Vble. para validar la existencia de una tabla.   
  ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
  ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
  GPV_NUM_GASTO NUMBER(16);
  GDE_FECHA_PAGO VARCHAR2(50 CHAR);
  V_COUNT_UPDATE NUMBER(16):= 0; -- Vble. para contar updates
  V_COUNT_INSERT NUMBER(16):= 0; -- Vble. para contar inserts
  V_USUARIO VARCHAR2(100 CHAR) := 'REMVIP-9043';
	
   V_PAR VARCHAR( 32000 CHAR );
   V_RET VARCHAR( 1024 CHAR );  
  
    TYPE T_JBV IS TABLE OF VARCHAR2(32000);
    TYPE T_ARRAY_JBV IS TABLE OF T_JBV; 

   V_JBV T_ARRAY_JBV := T_ARRAY_JBV(
    --GPV_NUM_GASTO_HAYA, GDE_FECHA_PAGO
T_JBV('7305014'),
T_JBV('7305213'),
T_JBV('7305427'),
T_JBV('7305814'),
T_JBV('7306351'),
T_JBV('7306378'),
T_JBV('7306555'),
T_JBV('7304374'),
T_JBV('7304384'),
T_JBV('7304394'),
T_JBV('7304403'),
T_JBV('7304490'),
T_JBV('7304954'),
T_JBV('7315907'),
T_JBV('7316173'),
T_JBV('7316402'),
T_JBV('7317427'),
T_JBV('7306576'),
T_JBV('7306579'),
T_JBV('7307499'),
T_JBV('7307515'),
T_JBV('7307520'),
T_JBV('7307522'),
T_JBV('7308017'),
T_JBV('7308037'),
T_JBV('7308066'),
T_JBV('7308075'),
T_JBV('7309157'),
T_JBV('7309877'),
T_JBV('7310627'),
T_JBV('7311449'),
T_JBV('7311618'),
T_JBV('7312220'),
T_JBV('7312305'),
T_JBV('7312786'),
T_JBV('7313028'),
T_JBV('7313320'),
T_JBV('7313460'),
T_JBV('7326527'),
T_JBV('7313777'),
T_JBV('7315139'),
T_JBV('7315173'),
T_JBV('7320428'),
T_JBV('7321706'),
T_JBV('7321708'),
T_JBV('7321713'),
T_JBV('7321714'),
T_JBV('7321730'),
T_JBV('7321749'),
T_JBV('7321873'),
T_JBV('7424093'),
T_JBV('7321908'),
T_JBV('7321922'),
T_JBV('7322016'),
T_JBV('7322018'),
T_JBV('7322021'),
T_JBV('7318300'),
T_JBV('7318825'),
T_JBV('7318945'),
T_JBV('7318971'),
T_JBV('7318972'),
T_JBV('7319268'),
T_JBV('7319562'),
T_JBV('7322345'),
T_JBV('7322901'),
T_JBV('7323424'),
T_JBV('7323434'),
T_JBV('7323437'),
T_JBV('7323462'),
T_JBV('7323480'),
T_JBV('7323581'),
T_JBV('7324282'),
T_JBV('7386686'),
T_JBV('7386695'),
T_JBV('7386700'),
T_JBV('7386710'),
T_JBV('7386713'),
T_JBV('7386718'),
T_JBV('7386726'),
T_JBV('7386730'),
T_JBV('7386734'),
T_JBV('7386737'),
T_JBV('7386741'),
T_JBV('7386755'),
T_JBV('7305314'),
T_JBV('7305803'),
T_JBV('7305848'),
T_JBV('7303669'),
T_JBV('7303821'),
T_JBV('7303857'),
T_JBV('7303938'),
T_JBV('7304054'),
T_JBV('7304313'),
T_JBV('7315392'),
T_JBV('7315900'),
T_JBV('7316168'),
T_JBV('7326824'),
T_JBV('7306581'),
T_JBV('7306644'),
T_JBV('7307503'),
T_JBV('7307509'),
T_JBV('7307524'),
T_JBV('7307536'),
T_JBV('7308081'),
T_JBV('7308740'),
T_JBV('7310361'),
T_JBV('7312294'),
T_JBV('7312302'),
T_JBV('7312307'),
T_JBV('7312493'),
T_JBV('7312907'),
T_JBV('7313303'),
T_JBV('7313322'),
T_JBV('7313724'),
T_JBV('7313968'),
T_JBV('7313972'),
T_JBV('7314749'),
T_JBV('7385752'),
T_JBV('7321002'),
T_JBV('7321009'),
T_JBV('7321700'),
T_JBV('7321702'),
T_JBV('7321710'),
T_JBV('7321737'),
T_JBV('7321738'),
T_JBV('7321748'),
T_JBV('7321753'),
T_JBV('7321774'),
T_JBV('7321841'),
T_JBV('7321845'),
T_JBV('7321860'),
T_JBV('7321924'),
T_JBV('7322020'),
T_JBV('7318106'),
T_JBV('7318122'),
T_JBV('7318860'),
T_JBV('7319877'),
T_JBV('7385625'),
T_JBV('7322196'),
T_JBV('7322477'),
T_JBV('7322492'),
T_JBV('7322645'),
T_JBV('7322869'),
T_JBV('7322976'),
T_JBV('7323418'),
T_JBV('7323430'),
T_JBV('7323438'),
T_JBV('7323440'),
T_JBV('7323441'),
T_JBV('7323449'),
T_JBV('7323460'),
T_JBV('7323471'),
T_JBV('7323481'),
T_JBV('7386684'),
T_JBV('7386691'),
T_JBV('7386701'),
T_JBV('7386717'),
T_JBV('7386723'),
T_JBV('7386733'),
T_JBV('7386739'),
T_JBV('7386757'),
T_JBV('7386760'),
T_JBV('7305139'),
T_JBV('7305163'),
T_JBV('7305166'),
T_JBV('7305714'),
T_JBV('7305727'),
T_JBV('7305737'),
T_JBV('7305984'),
T_JBV('7306030'),
T_JBV('7306240'),
T_JBV('7306267'),
T_JBV('7306489'),
T_JBV('7303923'),
T_JBV('7304571'),
T_JBV('7304957'),
T_JBV('7316353'),
T_JBV('7316454'),
T_JBV('7316767'),
T_JBV('7306827'),
T_JBV('7307496'),
T_JBV('7307497'),
T_JBV('7308038'),
T_JBV('7308061'),
T_JBV('7308068'),
T_JBV('7308079'),
T_JBV('7308083'),
T_JBV('7311734'),
T_JBV('7311863'),
T_JBV('7311943'),
T_JBV('7312221'),
T_JBV('7312330'),
T_JBV('7326228'),
T_JBV('7312651'),
T_JBV('7312878'),
T_JBV('7313098'),
T_JBV('7313235'),
T_JBV('7313408'),
T_JBV('7313668'),
T_JBV('7313799'),
T_JBV('7313969'),
T_JBV('7314144'),
T_JBV('7314240'),
T_JBV('7314710'),
T_JBV('7314748'),
T_JBV('7314750'),
T_JBV('7314827'),
T_JBV('7314853'),
T_JBV('7315172'),
T_JBV('7320253'),
T_JBV('7320430'),
T_JBV('7320431'),
T_JBV('7320984'),
T_JBV('7321716'),
T_JBV('7321724'),
T_JBV('7321729'),
T_JBV('7321736'),
T_JBV('7321741'),
T_JBV('7321745'),
T_JBV('7321839'),
T_JBV('7321844'),
T_JBV('7322017'),
T_JBV('7318075'),
T_JBV('7318706'),
T_JBV('7318949'),
T_JBV('7318958'),
T_JBV('7319267'),
T_JBV('7319275'),
T_JBV('7319302'),
T_JBV('7319309'),
T_JBV('7322193'),
T_JBV('7323419'),
T_JBV('7323439'),
T_JBV('7323443'),
T_JBV('7323448'),
T_JBV('7323457'),
T_JBV('7323472'),
T_JBV('7323477'),
T_JBV('7386690'),
T_JBV('7386696'),
T_JBV('7386716'),
T_JBV('7386719'),
T_JBV('7386724'),
T_JBV('7386735'),
T_JBV('7386743'),
T_JBV('7386744'),
T_JBV('7386750'),
T_JBV('7386762'),
T_JBV('7305161'),
T_JBV('7305170'),
T_JBV('7305234'),
T_JBV('7305271'),
T_JBV('7305335'),
T_JBV('7305520'),
T_JBV('7305523'),
T_JBV('7305822'),
T_JBV('7325787'),
T_JBV('7305907'),
T_JBV('7305939'),
T_JBV('7306282'),
T_JBV('7303614'),
T_JBV('7303637'),
T_JBV('7303933'),
T_JBV('7304211'),
T_JBV('7304767'),
T_JBV('7304933'),
T_JBV('7315176'),
T_JBV('7315178'),
T_JBV('7315415'),
T_JBV('7315552'),
T_JBV('7316166'),
T_JBV('7316400'),
T_JBV('7316453'),
T_JBV('7316977'),
T_JBV('7306575'),
T_JBV('7306577'),
T_JBV('7306578'),
T_JBV('7306828'),
T_JBV('7307504'),
T_JBV('7307511'),
T_JBV('7307518'),
T_JBV('7307523'),
T_JBV('7307533'),
T_JBV('7308062'),
T_JBV('7308063'),
T_JBV('7308065'),
T_JBV('7308070'),
T_JBV('7310703'),
T_JBV('7311845'),
T_JBV('7312301'),
T_JBV('7312567'),
T_JBV('7312822'),
T_JBV('7313085'),
T_JBV('7313168'),
T_JBV('7313269'),
T_JBV('7313773'),
T_JBV('7313774'),
T_JBV('7314143'),
T_JBV('7314798'),
T_JBV('7315174'),
T_JBV('7320267'),
T_JBV('7386367'),
T_JBV('7320421'),
T_JBV('7320528'),
T_JBV('7320810'),
T_JBV('7320815'),
T_JBV('7320834'),
T_JBV('7321698'),
T_JBV('7321704'),
T_JBV('7321711'),
T_JBV('7321728'),
T_JBV('7321739'),
T_JBV('7321740'),
T_JBV('7321746'),
T_JBV('7321747'),
T_JBV('7321752'),
T_JBV('7321911'),
T_JBV('7321936'),
T_JBV('7322019'),
T_JBV('7317606'),
T_JBV('7318092'),
T_JBV('7318241'),
T_JBV('7318946'),
T_JBV('7318950'),
T_JBV('7318952'),
T_JBV('7318953'),
T_JBV('7319477'),
T_JBV('7319923'),
T_JBV('7322347'),
T_JBV('7322369'),
T_JBV('7322384'),
T_JBV('7323127'),
T_JBV('7323429'),
T_JBV('7323451'),
T_JBV('7323453'),
T_JBV('7323468'),
T_JBV('7323479'),
T_JBV('7323580'),
T_JBV('7323582'),
T_JBV('7324973'),
T_JBV('7386680'),
T_JBV('7386693'),
T_JBV('7386694'),
T_JBV('7386699'),
T_JBV('7386708'),
T_JBV('7386711'),
T_JBV('7386712'),
T_JBV('7386715'),
T_JBV('7386720'),
T_JBV('7386722'),
T_JBV('7386727'),
T_JBV('7386728'),
T_JBV('7386745'),
T_JBV('7386748'),
T_JBV('7386751'),
T_JBV('7386753'),
T_JBV('7386754'),
T_JBV('7305040'),
T_JBV('7305202'),
T_JBV('7305863'),
T_JBV('7306229'),
T_JBV('7306249'),
T_JBV('7306385'),
T_JBV('7306497'),
T_JBV('7304375'),
T_JBV('7304575'),
T_JBV('7304591'),
T_JBV('7304621'),
T_JBV('7304797'),
T_JBV('7304956'),
T_JBV('7315175'),
T_JBV('7315177'),
T_JBV('7316177'),
T_JBV('7316284'),
T_JBV('7316457'),
T_JBV('7306571'),
T_JBV('7306713'),
T_JBV('7307246'),
T_JBV('7307505'),
T_JBV('7307507'),
T_JBV('7307512'),
T_JBV('7307513'),
T_JBV('7307516'),
T_JBV('7307519'),
T_JBV('7307535'),
T_JBV('7307983'),
T_JBV('7308040'),
T_JBV('7308073'),
T_JBV('7308076'),
T_JBV('7308082'),
T_JBV('7308134'),
T_JBV('7309502'),
T_JBV('7310994'),
T_JBV('7311600'),
T_JBV('7312185'),
T_JBV('7312303'),
T_JBV('7312315'),
T_JBV('7312589'),
T_JBV('7312661'),
T_JBV('7312983'),
T_JBV('7313048'),
T_JBV('7313060'),
T_JBV('7313078'),
T_JBV('7313157'),
T_JBV('7313489'),
T_JBV('7313520'),
T_JBV('7313749'),
T_JBV('7313783'),
T_JBV('7313814'),
T_JBV('7314316'),
T_JBV('7314940'),
T_JBV('7314991'),
T_JBV('7320088'),
T_JBV('7385639'),
T_JBV('7320419'),
T_JBV('7320426'),
T_JBV('7320429'),
T_JBV('7320500'),
T_JBV('7320792'),
T_JBV('7320852'),
T_JBV('7321695'),
T_JBV('7321696'),
T_JBV('7321701'),
T_JBV('7321703'),
T_JBV('7321712'),
T_JBV('7321720'),
T_JBV('7321727'),
T_JBV('7321731'),
T_JBV('7321734'),
T_JBV('7321735'),
T_JBV('7321840'),
T_JBV('7321843'),
T_JBV('7321920'),
T_JBV('7317574'),
T_JBV('7318091'),
T_JBV('7318935'),
T_JBV('7318955'),
T_JBV('7318962'),
T_JBV('7319297'),
T_JBV('7319373'),
T_JBV('7323425'),
T_JBV('7323431'),
T_JBV('7323433'),
T_JBV('7323446'),
T_JBV('7323455'),
T_JBV('7323456'),
T_JBV('7323467'),
T_JBV('7323469'),
T_JBV('7323474'),
T_JBV('7324281'),
T_JBV('7386681'),
T_JBV('7386685'),
T_JBV('7386698'),
T_JBV('7386749'),
T_JBV('7305162'),
T_JBV('7305280'),
T_JBV('7305413'),
T_JBV('7305545'),
T_JBV('7305802'),
T_JBV('7306074'),
T_JBV('7306131'),
T_JBV('7303748'),
T_JBV('7303761'),
T_JBV('7304254'),
T_JBV('7304421'),
T_JBV('7304489'),
T_JBV('7304859'),
T_JBV('7304958'),
T_JBV('7315975'),
T_JBV('7316401'),
T_JBV('7316458'),
T_JBV('7316488'),
T_JBV('7316489'),
T_JBV('7316505'),
T_JBV('7306574'),
T_JBV('7325866'),
T_JBV('7306676'),
T_JBV('7307521'),
T_JBV('7307525'),
T_JBV('7307528'),
T_JBV('7307531'),
T_JBV('7307532'),
T_JBV('7307537'),
T_JBV('7308072'),
T_JBV('7309029'),
T_JBV('7309829'),
T_JBV('7311679'),
T_JBV('7311898'),
T_JBV('7312299'),
T_JBV('7312304'),
T_JBV('7313045'),
T_JBV('7313144'),
T_JBV('7313413'),
T_JBV('7313517'),
T_JBV('7313642'),
T_JBV('7326611'),
T_JBV('7314145'),
T_JBV('7314253'),
T_JBV('7314325'),
T_JBV('7314483'),
T_JBV('7314495'),
T_JBV('7314885'),
T_JBV('7434369'),
T_JBV('7320770'),
T_JBV('7321709'),
T_JBV('7321715'),
T_JBV('7321718'),
T_JBV('7321721'),
T_JBV('7321723'),
T_JBV('7321742'),
T_JBV('7321743'),
T_JBV('7321819'),
T_JBV('7321842'),
T_JBV('7321938'),
T_JBV('7321951'),
T_JBV('7322015'),
T_JBV('7318826'),
T_JBV('7318951'),
T_JBV('7318956'),
T_JBV('7318957'),
T_JBV('7318959'),
T_JBV('7319133'),
T_JBV('7319581'),
T_JBV('7319594'),
T_JBV('7319941'),
T_JBV('7322371'),
T_JBV('7322479'),
T_JBV('7322868'),
T_JBV('7323216'),
T_JBV('7323272'),
T_JBV('7323423'),
T_JBV('7323427'),
T_JBV('7323428'),
T_JBV('7323444'),
T_JBV('7323450'),
T_JBV('7323454'),
T_JBV('7323461'),
T_JBV('7323463'),
T_JBV('7323475'),
T_JBV('7323476'),
T_JBV('7323478'),
T_JBV('7324949'),
T_JBV('7386682'),
T_JBV('7386687'),
T_JBV('7386692'),
T_JBV('7386704'),
T_JBV('7386742'),
T_JBV('7386752'),
T_JBV('7305039'),
T_JBV('7305169'),
T_JBV('7305612'),
T_JBV('7305742'),
T_JBV('7306048'),
T_JBV('7306056'),
T_JBV('7306268'),
T_JBV('7306512'),
T_JBV('7303638'),
T_JBV('7303681'),
T_JBV('7303790'),
T_JBV('7303806'),
T_JBV('7304048'),
T_JBV('7304676'),
T_JBV('7304775'),
T_JBV('7304955'),
T_JBV('7316482'),
T_JBV('7316490'),
T_JBV('7316503'),
T_JBV('7316504'),
T_JBV('7316515'),
T_JBV('7317196'),
T_JBV('7306580'),
T_JBV('7306809'),
T_JBV('7307245'),
T_JBV('7307500'),
T_JBV('7307501'),
T_JBV('7307506'),
T_JBV('7307510'),
T_JBV('7307514'),
T_JBV('7307526'),
T_JBV('7307529'),
T_JBV('7307530'),
T_JBV('7308036'),
T_JBV('7308041'),
T_JBV('7308060'),
T_JBV('7308067'),
T_JBV('7308071'),
T_JBV('7308074'),
T_JBV('7308080'),
T_JBV('7308621'),
T_JBV('7309824'),
T_JBV('7309825'),
T_JBV('7311567'),
T_JBV('7311846'),
T_JBV('7312300'),
T_JBV('7312329'),
T_JBV('7312376'),
T_JBV('7312392'),
T_JBV('7312768'),
T_JBV('7313071'),
T_JBV('7313179'),
T_JBV('7313276'),
T_JBV('7313351'),
T_JBV('7386368'),
T_JBV('7320351'),
T_JBV('7320989'),
T_JBV('7321699'),
T_JBV('7321744'),
T_JBV('7321750'),
T_JBV('7321751'),
T_JBV('7321754'),
T_JBV('7321846'),
T_JBV('7321861'),
T_JBV('7321917'),
T_JBV('7317468'),
T_JBV('7317469'),
T_JBV('7318970'),
T_JBV('7319273'),
T_JBV('7322382'),
T_JBV('7322909'),
T_JBV('7323421'),
T_JBV('7323432'),
T_JBV('7323435'),
T_JBV('7323447'),
T_JBV('7323459'),
T_JBV('7323465'),
T_JBV('7323466'),
T_JBV('7323473'),
T_JBV('7324950'),
T_JBV('7325257'),
T_JBV('7386688'),
T_JBV('7386689'),
T_JBV('7386702'),
T_JBV('7386703'),
T_JBV('7386706'),
T_JBV('7386709'),
T_JBV('7386721'),
T_JBV('7386725'),
T_JBV('7386729'),
T_JBV('7386732'),
T_JBV('7386736'),
T_JBV('7386740'),
T_JBV('7386747'),
T_JBV('7386756'),
T_JBV('7386761'),
T_JBV('7305012'),
T_JBV('7305066'),
T_JBV('7305118'),
T_JBV('7305130'),
T_JBV('7305165'),
T_JBV('7305261'),
T_JBV('7305272'),
T_JBV('7305367'),
T_JBV('7305445'),
T_JBV('7305598'),
T_JBV('7305771'),
T_JBV('7305813'),
T_JBV('7305844'),
T_JBV('7305859'),
T_JBV('7306040'),
T_JBV('7306075'),
T_JBV('7306570'),
T_JBV('7303847'),
T_JBV('7304126'),
T_JBV('7304164'),
T_JBV('7304193'),
T_JBV('7304437'),
T_JBV('7304574'),
T_JBV('7325635'),
T_JBV('7304943'),
T_JBV('7326792'),
T_JBV('7326795'),
T_JBV('7316167'),
T_JBV('7316399'),
T_JBV('7316480'),
T_JBV('7316481'),
T_JBV('7317077'),
T_JBV('7317130'),
T_JBV('7306572'),
T_JBV('7306573'),
T_JBV('7306582'),
T_JBV('7307498'),
T_JBV('7307502'),
T_JBV('7307508'),
T_JBV('7307517'),
T_JBV('7307527'),
T_JBV('7307534'),
T_JBV('7308053'),
T_JBV('7308064'),
T_JBV('7311346'),
T_JBV('7312207'),
T_JBV('7312257'),
T_JBV('7312295'),
T_JBV('7312306'),
T_JBV('7312932'),
T_JBV('7313058'),
T_JBV('7313158'),
T_JBV('7313160'),
T_JBV('7313400'),
T_JBV('7313409'),
T_JBV('7313824'),
T_JBV('7314090'),
T_JBV('7314890'),
T_JBV('7320154'),
T_JBV('7320501'),
T_JBV('7320988'),
T_JBV('7321697'),
T_JBV('7321705'),
T_JBV('7321707'),
T_JBV('7321717'),
T_JBV('7321719'),
T_JBV('7321722'),
T_JBV('7321725'),
T_JBV('7321726'),
T_JBV('7321732'),
T_JBV('7321733'),
T_JBV('7321755'),
T_JBV('7321838'),
T_JBV('7321919'),
T_JBV('7318657'),
T_JBV('7318947'),
T_JBV('7318948'),
T_JBV('7318954'),
T_JBV('7318960'),
T_JBV('7318961'),
T_JBV('7319221'),
T_JBV('7319232'),
T_JBV('7319670'),
T_JBV('7322381'),
T_JBV('7322473'),
T_JBV('7322731'),
T_JBV('7322870'),
T_JBV('7322966'),
T_JBV('7323212'),
T_JBV('7323223'),
T_JBV('7323420'),
T_JBV('7323422'),
T_JBV('7323436'),
T_JBV('7323442'),
T_JBV('7323445'),
T_JBV('7323452'),
T_JBV('7323458'),
T_JBV('7323464'),
T_JBV('7323470'),
T_JBV('7323583'),
T_JBV('7324957'),
T_JBV('7325122'),
T_JBV('7325235'),
T_JBV('7386683'),
T_JBV('7386697'),
T_JBV('7386705'),
T_JBV('7386707'),
T_JBV('7386714'),
T_JBV('7386731'),
T_JBV('7386738'),
T_JBV('7386746'),
T_JBV('7386758'),
T_JBV('7386759')

	); 
	V_TMP_JBV T_JBV;
    
BEGIN	
	
	DBMS_OUTPUT.PUT_LINE('[INICIO] ');

	 
    -- LOOP  -----------------------------------------------------------------
    DBMS_OUTPUT.PUT_LINE('[INFO]: BORRAR CALIFICACIONES NEGATIVAS');
   FOR I IN V_JBV.FIRST .. V_JBV.LAST
	
	LOOP
 
	V_TMP_JBV := V_JBV(I);

  	GPV_NUM_GASTO := TRIM(V_TMP_JBV(1));


       	  V_MSQL := 'MERGE INTO '||V_ESQUEMA||'.ACT_CAN_CALIFICACION_NEG NEG USING(
				SELECT ACT_CAN_ID FROM (SELECT NEG.ACT_CAN_ID, ROW_NUMBER() OVER(
       						PARTITION BY TIT.TIT_ID
        						ORDER BY AHT.AHT_FECHA_CALIFICACION DESC 
    							) ROW_NUM FROM '||V_ESQUEMA||'.ACT_CAN_CALIFICACION_NEG NEG 
				JOIN '||V_ESQUEMA||'.ACT_ACTIVO ACT ON ACT.ACT_ID = NEG.ACT_ID
				JOIN '||V_ESQUEMA||'.act_aht_hist_tram_titulo AHT ON AHT.AHT_ID = NEG.AHT_ID
				JOIN '||V_ESQUEMA||'.ACT_TIT_TITULO TIT ON TIT.TIT_ID = AHT.TIT_ID
				WHERE ACT.ACT_NUM_ACTIVO = '''||GPV_NUM_GASTO||''') WHERE ROW_NUM = 1
				) AUX ON (AUX.ACT_CAN_ID = NEG.ACT_CAN_ID)
				WHEN MATCHED THEN UPDATE SET
				NEG.USUARIOBORRAR = ''REMVIP-9043'',
				NEG.BORRADO =1,
				NEG.FECHABORRAR = SYSDATE';
				
	EXECUTE IMMEDIATE V_MSQL;
	
	DBMS_OUTPUT.PUT_LINE('[INFO]: BORRADO CORRECTAMENTE UNA CALIFICACION NEGATIVA DEL ACTIVO '''||GPV_NUM_GASTO||''' ');
 
	V_COUNT_UPDATE := V_COUNT_UPDATE + 1;
			
		
    END LOOP;
    COMMIT;
   
	DBMS_OUTPUT.PUT_LINE('********************************************************************');

	DBMS_OUTPUT.PUT_LINE('[FIN] Se han borrado en total '||V_COUNT_UPDATE||' CALIFICACIONES NEGATIVAS ');

	DBMS_OUTPUT.PUT_LINE('********************************************************************');


   DBMS_OUTPUT.PUT_LINE('[FIN] ');

EXCEPTION

   WHEN OTHERS THEN
        err_num := SQLCODE;
        err_msg := SQLERRM;

        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
        DBMS_OUTPUT.put_line(err_msg);

        ROLLBACK;
        RAISE;          

END;

/
