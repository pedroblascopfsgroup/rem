--/*
--#########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20210825
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-10371
--## PRODUCTO=NO
--## 
--## Finalidad: RECALCULAR SITUACION COMERCIAL 
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE

	V_MSQL VARCHAR(4000 CHAR);
	TABLE_COUNT NUMBER(1,0) := 0;
	V_ESQUEMA VARCHAR2(25 CHAR):= 'REM01'; -- Configuracion Esquema
	V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
	V_USUARIO VARCHAR2(200 CHAR);
	V_USUARIOMODIFICAR VARCHAR(100 CHAR):= 'REMVIP-10371';
   	PL_OUTPUT VARCHAR2(32000 CHAR);
    	P_ACT_ID NUMBER;
    	P_ALL_ACTIVOS NUMBER;
   	V_MAX_PTO_ID NUMBER(16,0);
    	V_EJE_ID NUMBER(16,0);
    	V_COUNT NUMBER(16):= 0;
    	V_COUNT2 NUMBER(16):= 0;
    	HORA_INI TIMESTAMP;
    	HORA_FIN TIMESTAMP;
    	v_n  INTERVAL DAY TO SECOND ;
      

BEGIN			
	
	DBMS_OUTPUT.PUT_LINE('[INICIO] Recalcular Situacion comercial '); 

	DBMS_OUTPUT.PUT_LINE('	[INFO] Se procede a borrar la situación comercial de los activos migrados.'); 
	
	V_MSQL := 'UPDATE '||V_ESQUEMA||'.ACT_ACTIVO SET DD_SCM_ID = NULL 
				WHERE ACT_NUM_ACTIVO IN (66177,
67078,
69122,
69220,
74289,
106056,
114697,
123711,
130269,
134700,
139559,
141010,
141399,
142676,
148218,
150777,
151523,
153255,
153702,
164477,
186799,
194614,
194867,
194868,
198719,
198720,
199114,
201026,
201275,
203228,
5876719,
6351632,
6351635,
6351636,
6351637,
6351639,
6351640,
6351641,
6351642,
6351643,
6351644,
6351645,
6351647,
6351648,
6351649,
6351650,
6351651,
6351652,
6351653,
6351654,
6351656,
6351657,
6351658,
6351659,
6351660,
6351661,
6351662,
6351663,
6351664,
6351665,
6351666,
6351669,
6351670,
6351671,
6351672,
6351673,
6351674,
6351675,
6351677,
6351678,
6351679,
6351681,
6351682,
6351683,
6351685,
6351686,
6351687,
6351688,
6351689,
6351690,
6351691,
6351729,
6351730,
6351731,
6351732,
6351733,
6351734,
6351735,
6351736,
6351737,
6351738,
6351739,
6351740,
6351741,
6351744,
6351745,
6351746,
6351747,
6351748,
6351749,
6351750,
6351751,
6351753,
6351754,
6351756,
6351757,
6351758,
6351759,
6351760,
6351761,
6351762,
6351763,
6351764,
6351765,
6351766,
6351767,
6351768,
6351769,
6351770,
6775775,
6775776,
6775777,
6775778,
6775779,
6775780,
6775781,
6775782,
6775783,
6775784,
6775785,
7010649,
7010662,
7010666,
7010673,
7010681,
7010685,
7010686,
7010690,
7010698,
7010701,
7010702,
7010703,
7010705,
7010709,
7010718,
7010722,
7010723,
7010724,
7010727,
7010729,
7010730,
7010731,
7010732,
7010734,
7010737,
7010749,
7010750,
7010752,
7010756,
7010761,
7010762,
7010764,
7010771,
7074151,
7074152,
7074153,
7074154,
7074155,
7074156,
7074157,
7074158)';

	EXECUTE IMMEDIATE V_MSQL;

	DBMS_OUTPUT.PUT_LINE('[INFO]: '||SQL%ROWCOUNT||' ACTUALIZADOS');
				
	COMMIT;
	
	DBMS_OUTPUT.PUT_LINE('[INICIO] Comienza el proceso de recalcular Situacion comercial'); 
	
	REM01.SP_ASC_ACT_SIT_COM_VACIOS_V2(0);
	
	DBMS_OUTPUT.PUT_LINE('[FIN] Recalcular Situacion comercial');

  	COMMIT;
	
EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
        ROLLBACK;
        RAISE;
END;
/
EXIT
