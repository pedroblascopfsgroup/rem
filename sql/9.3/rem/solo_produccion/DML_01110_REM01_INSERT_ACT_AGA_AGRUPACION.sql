--/*
--##########################################
--## AUTOR=Juan Bautista Alfonso
--## FECHA_CREACION=20211224
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-10977
--## PRODUCTO=NO
--##
--## Finalidad: Script Añade activos a agrupacion
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;

DECLARE

    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar.
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema.
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_USU VARCHAR2(30 CHAR) := 'REMVIP-10977'; -- Vble. auxiliar para almacenar el nombre de usuario que modifica los registros.
	V_COUNT NUMBER(16);
    V_COUNT2 NUMBER(16);
    V_ACT_ID NUMBER(16);
    V_AGR_ID NUMBER(16);

	TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
T_TIPO_DATA('7486239','1000037807'),
T_TIPO_DATA('7486256','1000037896'),
T_TIPO_DATA('7486272','1000037844'),
T_TIPO_DATA('7486290','1000037823'),
T_TIPO_DATA('7486317','1000037816'),
T_TIPO_DATA('7486319','1000037798'),
T_TIPO_DATA('7486348','1000037806'),
T_TIPO_DATA('7486355','1000037896'),
T_TIPO_DATA('7486368','1000037804'),
T_TIPO_DATA('7486416','1000037888'),
T_TIPO_DATA('7486512','1000037800'),
T_TIPO_DATA('7486544','1000037802'),
T_TIPO_DATA('7486553','1000037816'),
T_TIPO_DATA('7486621','1000037796'),
T_TIPO_DATA('7486636','1000037796'),
T_TIPO_DATA('7486661','1000037814'),
T_TIPO_DATA('7486682','1000037796'),
T_TIPO_DATA('7486695','1000037823'),
T_TIPO_DATA('7486750','1000037814'),
T_TIPO_DATA('7486807','1000037791'),
T_TIPO_DATA('7486849','1000037823'),
T_TIPO_DATA('7486851','1000037822'),
T_TIPO_DATA('7486888','1000037864'),
T_TIPO_DATA('7486898','1000037851'),
T_TIPO_DATA('7486909','1000037911'),
T_TIPO_DATA('7486934','1000037804'),
T_TIPO_DATA('7486964','1000037809'),
T_TIPO_DATA('7487006','1000037910'),
T_TIPO_DATA('7487019','1000037791'),
T_TIPO_DATA('7487061','1000037821'),
T_TIPO_DATA('7487112','1000037855'),
T_TIPO_DATA('7487120','1000037906'),
T_TIPO_DATA('7490002','1000037790'),
T_TIPO_DATA('7490053','1000037809'),
T_TIPO_DATA('7490091','1000037852'),
T_TIPO_DATA('7490150','1000037908'),
T_TIPO_DATA('7490151','1000037908'),
T_TIPO_DATA('7490153','1000037916'),
T_TIPO_DATA('7490154','1000037908'),
T_TIPO_DATA('7490156','1000037908'),
T_TIPO_DATA('7490164','1000037908'),
T_TIPO_DATA('7490167','1000037908'),
T_TIPO_DATA('7490168','1000037908'),
T_TIPO_DATA('7490169','1000037908'),
T_TIPO_DATA('7490170','1000037908'),
T_TIPO_DATA('7490171','1000037908'),
T_TIPO_DATA('7490172','1000037908'),
T_TIPO_DATA('7490173','1000037908'),
T_TIPO_DATA('7490174','1000037908'),
T_TIPO_DATA('7490175','1000037908'),
T_TIPO_DATA('7490176','1000037908'),
T_TIPO_DATA('7490184','1000037836'),
T_TIPO_DATA('7490185','1000037790'),
T_TIPO_DATA('7490200','1000037851'),
T_TIPO_DATA('7490206','1000037891'),
T_TIPO_DATA('7490216','1000037900'),
T_TIPO_DATA('7490237','1000037873'),
T_TIPO_DATA('7490247','1000037894'),
T_TIPO_DATA('7490270','1000037855'),
T_TIPO_DATA('7490283','1000037905'),
T_TIPO_DATA('7490284','1000037901'),
T_TIPO_DATA('7490301','1000037886'),
T_TIPO_DATA('7490308','1000037845'),
T_TIPO_DATA('7490315','1000037811'),
T_TIPO_DATA('7490316','1000037822'),
T_TIPO_DATA('7490319','1000037889'),
T_TIPO_DATA('7490330','1000037835'),
T_TIPO_DATA('7490331','1000037825'),
T_TIPO_DATA('7490332','1000037829'),
T_TIPO_DATA('7490333','1000037903'),
T_TIPO_DATA('7490335','1000037833'),
T_TIPO_DATA('7490336','1000037831'),
T_TIPO_DATA('7490365','1000037902'),
T_TIPO_DATA('7490374','1000037885'),
T_TIPO_DATA('7490375','1000037832'),
T_TIPO_DATA('7490400','1000037904'),
T_TIPO_DATA('7490414','1000037899'),
T_TIPO_DATA('7490440','1000037824'),
T_TIPO_DATA('7490445','1000037907'),
T_TIPO_DATA('7490450','1000037875'),
T_TIPO_DATA('7490461','1000037813'),
T_TIPO_DATA('7490463','1000037808'),
T_TIPO_DATA('7487171','1000037921'),
T_TIPO_DATA('7487177','1000037806'),
T_TIPO_DATA('7487205','1000037802'),
T_TIPO_DATA('7487213','1000037892'),
T_TIPO_DATA('7487256','1000037918'),
T_TIPO_DATA('7487272','1000037829'),
T_TIPO_DATA('7487283','1000037842'),
T_TIPO_DATA('7487322','1000037889'),
T_TIPO_DATA('7487417','1000037852'),
T_TIPO_DATA('7487437','1000037920'),
T_TIPO_DATA('7487445','1000037865'),
T_TIPO_DATA('7487448','1000037890'),
T_TIPO_DATA('7487472','1000037825'),
T_TIPO_DATA('7487475','1000037873'),
T_TIPO_DATA('7487489','1000037866'),
T_TIPO_DATA('7487508','1000037895'),
T_TIPO_DATA('7487555','1000037905'),
T_TIPO_DATA('7487565','1000037804'),
T_TIPO_DATA('7487615','1000037810'),
T_TIPO_DATA('7487632','1000037899'),
T_TIPO_DATA('7487652','1000037885'),
T_TIPO_DATA('7487671','1000037835'),
T_TIPO_DATA('7487688','1000037917'),
T_TIPO_DATA('7487697','1000037867'),
T_TIPO_DATA('7487717','1000037801'),
T_TIPO_DATA('7487746','1000037848'),
T_TIPO_DATA('7487766','1000037847'),
T_TIPO_DATA('7487776','1000037831'),
T_TIPO_DATA('7487788','1000037879'),
T_TIPO_DATA('7487823','1000037866'),
T_TIPO_DATA('7487842','1000037849'),
T_TIPO_DATA('7487850','1000037818'),
T_TIPO_DATA('7487885','1000037888'),
T_TIPO_DATA('7487889','1000037800'),
T_TIPO_DATA('7487932','1000037850'),
T_TIPO_DATA('7487941','1000037834'),
T_TIPO_DATA('7487943','1000037791'),
T_TIPO_DATA('7487944','1000037791'),
T_TIPO_DATA('7488021','1000037897'),
T_TIPO_DATA('7488032','1000037894'),
T_TIPO_DATA('7488044','1000037878'),
T_TIPO_DATA('7488045','1000037837'),
T_TIPO_DATA('7488071','1000037904'),
T_TIPO_DATA('7488099','1000037833'),
T_TIPO_DATA('7488116','1000037913'),
T_TIPO_DATA('7488134','1000037794'),
T_TIPO_DATA('7488134','1000037854'),
T_TIPO_DATA('7488135','1000037794'),
T_TIPO_DATA('7488135','1000037854'),
T_TIPO_DATA('7488144','1000037794'),
T_TIPO_DATA('7488144','1000037854'),
T_TIPO_DATA('7488145','1000037794'),
T_TIPO_DATA('7488145','1000037854'),
T_TIPO_DATA('7488155','1000037811'),
T_TIPO_DATA('7488157','1000037817'),
T_TIPO_DATA('7488165','1000037815'),
T_TIPO_DATA('7488174','1000037791'),
T_TIPO_DATA('7488176','1000037898'),
T_TIPO_DATA('7488180','1000037870'),
T_TIPO_DATA('7488207','1000037900'),
T_TIPO_DATA('7488218','1000037860'),
T_TIPO_DATA('7488228','1000037880'),
T_TIPO_DATA('7488233','1000037828'),
T_TIPO_DATA('7488238','1000037797'),
T_TIPO_DATA('7488246','1000037797'),
T_TIPO_DATA('7488251','1000037826'),
T_TIPO_DATA('7488270','1000037836'),
T_TIPO_DATA('7488274','1000037797'),
T_TIPO_DATA('7488276','1000037797'),
T_TIPO_DATA('7488307','1000037839'),
T_TIPO_DATA('7488357','1000037791'),
T_TIPO_DATA('7488383','1000037791'),
T_TIPO_DATA('7488400','1000037791'),
T_TIPO_DATA('7488401','1000037791'),
T_TIPO_DATA('7488430','1000037791'),
T_TIPO_DATA('7488462','1000037791'),
T_TIPO_DATA('7488467','1000037794'),
T_TIPO_DATA('7488467','1000037854'),
T_TIPO_DATA('7488506','1000037874'),
T_TIPO_DATA('7488623','1000037791'),
T_TIPO_DATA('7488627','1000037871'),
T_TIPO_DATA('7488628','1000037791'),
T_TIPO_DATA('7488636','1000037794'),
T_TIPO_DATA('7488636','1000037854'),
T_TIPO_DATA('7488637','1000037794'),
T_TIPO_DATA('7488637','1000037854'),
T_TIPO_DATA('7488650','1000037824'),
T_TIPO_DATA('7488672','1000037803'),
T_TIPO_DATA('7488677','1000037794'),
T_TIPO_DATA('7488677','1000037854'),
T_TIPO_DATA('7488688','1000037857'),
T_TIPO_DATA('7488691','1000037794'),
T_TIPO_DATA('7488691','1000037854'),
T_TIPO_DATA('7488692','1000037794'),
T_TIPO_DATA('7488692','1000037854'),
T_TIPO_DATA('7488708','1000037832'),
T_TIPO_DATA('7488734','1000037887'),
T_TIPO_DATA('7488777','1000037846'),
T_TIPO_DATA('7488786','1000037791'),
T_TIPO_DATA('7488799','1000037791'),
T_TIPO_DATA('7488826','1000037838'),
T_TIPO_DATA('7488836','1000037791'),
T_TIPO_DATA('7488847','1000037843'),
T_TIPO_DATA('7488850','1000037841'),
T_TIPO_DATA('7488932','1000037914'),
T_TIPO_DATA('7488934','1000037791'),
T_TIPO_DATA('7488944','1000037791'),
T_TIPO_DATA('7488996','1000037845'),
T_TIPO_DATA('7488998','1000037791'),
T_TIPO_DATA('7489007','1000037909'),
T_TIPO_DATA('7489017','1000037791'),
T_TIPO_DATA('7489030','1000037914'),
T_TIPO_DATA('7489054','1000037886'),
T_TIPO_DATA('7489055','1000037877'),
T_TIPO_DATA('7489141','1000037860'),
T_TIPO_DATA('7489175','1000037860'),
T_TIPO_DATA('7489181','1000037876'),
T_TIPO_DATA('7489202','1000037808'),
T_TIPO_DATA('7489219','1000037807'),
T_TIPO_DATA('7489242','1000037794'),
T_TIPO_DATA('7489242','1000037854'),
T_TIPO_DATA('7489248','1000037875'),
T_TIPO_DATA('7489251','1000037819'),
T_TIPO_DATA('7489285','1000037901'),
T_TIPO_DATA('7489303','1000037867'),
T_TIPO_DATA('7489308','1000037893'),
T_TIPO_DATA('7489320','1000037902'),
T_TIPO_DATA('7489405','1000037812'),
T_TIPO_DATA('7489407','1000037860'),
T_TIPO_DATA('7489446','1000037903'),
T_TIPO_DATA('7489472','1000037840'),
T_TIPO_DATA('7489534','1000037893'),
T_TIPO_DATA('7489543','1000037794'),
T_TIPO_DATA('7489543','1000037854'),
T_TIPO_DATA('7489558','1000037805'),
T_TIPO_DATA('7489597','1000037909'),
T_TIPO_DATA('7489650','1000037794'),
T_TIPO_DATA('7489650','1000037854'),
T_TIPO_DATA('7489702','1000037859'),
T_TIPO_DATA('7489757','1000037856'),
T_TIPO_DATA('7489766','1000037812'),
T_TIPO_DATA('7489803','1000037805'),
T_TIPO_DATA('7489820','1000037890'),
T_TIPO_DATA('7489838','1000037864'),
T_TIPO_DATA('7490498','1000037818'),
T_TIPO_DATA('7490530','1000037821'),
T_TIPO_DATA('7490535','1000037906'),
T_TIPO_DATA('7490539','1000037922'),
T_TIPO_DATA('7490540','1000037922'),
T_TIPO_DATA('7490542','1000037922'),
T_TIPO_DATA('7490543','1000037922'),
T_TIPO_DATA('7490544','1000037922'),
T_TIPO_DATA('7490545','1000037922'),
T_TIPO_DATA('7490546','1000037922'),
T_TIPO_DATA('7490547','1000037922'),
T_TIPO_DATA('7490548','1000037922'),
T_TIPO_DATA('7490549','1000037922'),
T_TIPO_DATA('7490550','1000037922'),
T_TIPO_DATA('7490551','1000037922'),
T_TIPO_DATA('7490555','1000037876'),
T_TIPO_DATA('7490556','1000037849'),
T_TIPO_DATA('7490558','1000037840'),
T_TIPO_DATA('7490559','1000037847'),
T_TIPO_DATA('7490560','1000037838'),
T_TIPO_DATA('7490561','1000037880'),
T_TIPO_DATA('7490562','1000037878'),
T_TIPO_DATA('7490563','1000037879'),
T_TIPO_DATA('7490564','1000037841'),
T_TIPO_DATA('7490565','1000037828'),
T_TIPO_DATA('7490567','1000037846'),
T_TIPO_DATA('7490568','1000037850'),
T_TIPO_DATA('7490609','1000037898'),
T_TIPO_DATA('7490621','1000037895'),
T_TIPO_DATA('7490622','1000037826'),
T_TIPO_DATA('7490649','1000037792'),
T_TIPO_DATA('7490650','1000037792'),
T_TIPO_DATA('7490651','1000037792'),
T_TIPO_DATA('7490652','1000037792'),
T_TIPO_DATA('7490653','1000037792'),
T_TIPO_DATA('7490654','1000037792'),
T_TIPO_DATA('7490666','1000037788'),
T_TIPO_DATA('7490692','1000037917'),
T_TIPO_DATA('7490709','1000037839'),
T_TIPO_DATA('7490833','1000037842'),
T_TIPO_DATA('7490881','1000037788'),
T_TIPO_DATA('7490882','1000037788'),
T_TIPO_DATA('7490883','1000037788'),
T_TIPO_DATA('7490884','1000037788'),
T_TIPO_DATA('7490885','1000037788'),
T_TIPO_DATA('7490886','1000037788'),
T_TIPO_DATA('7490887','1000037788'),
T_TIPO_DATA('7490920','1000037817'),
T_TIPO_DATA('7490926','1000037837'),
T_TIPO_DATA('7490930','1000037834'),
T_TIPO_DATA('7490933','1000037910'),
T_TIPO_DATA('7490935','1000037911'),
T_TIPO_DATA('7490946','1000037897'),
T_TIPO_DATA('7490950','1000037801'),
T_TIPO_DATA('7490962','1000037843'),
T_TIPO_DATA('7490963','1000037819'),
T_TIPO_DATA('7490965','1000037887'),
T_TIPO_DATA('7490976','1000037872'),
T_TIPO_DATA('7490988','1000037871'),
T_TIPO_DATA('7490994','1000037857'),
T_TIPO_DATA('7491014','1000037815'),
T_TIPO_DATA('7491020','1000037918'),
T_TIPO_DATA('7491023','1000037865'),
T_TIPO_DATA('7491032','1000037848'),
T_TIPO_DATA('7491033','1000037913'),
T_TIPO_DATA('7491047','1000037803'),
T_TIPO_DATA('7491052','1000037870'),
T_TIPO_DATA('7491090','1000037795'),
T_TIPO_DATA('7491096','1000037795'),
T_TIPO_DATA('7491098','1000037795'),
T_TIPO_DATA('7491099','1000037795'),
T_TIPO_DATA('7491100','1000037795'),
T_TIPO_DATA('7491101','1000037795'),
T_TIPO_DATA('7491104','1000037795'),
T_TIPO_DATA('7491105','1000037795'),
T_TIPO_DATA('7491106','1000037795'),
T_TIPO_DATA('7491119','1000037789'),
T_TIPO_DATA('7491120','1000037789'),
T_TIPO_DATA('7491122','1000037789'),
T_TIPO_DATA('7491123','1000037789'),
T_TIPO_DATA('7491138','1000037799'),
T_TIPO_DATA('7491139','1000037799'),
T_TIPO_DATA('7491140','1000037799'),
T_TIPO_DATA('7491141','1000037799'),
T_TIPO_DATA('7491142','1000037799'),
T_TIPO_DATA('7491143','1000037799'),
T_TIPO_DATA('7491144','1000037799'),
T_TIPO_DATA('7491145','1000037799'),
T_TIPO_DATA('7491146','1000037799'),
T_TIPO_DATA('7491147','1000037799'),
T_TIPO_DATA('7491148','1000037799'),
T_TIPO_DATA('7491149','1000037799'),
T_TIPO_DATA('7491150','1000037799'),
T_TIPO_DATA('7491151','1000037799'),
T_TIPO_DATA('7491152','1000037799'),
T_TIPO_DATA('7491153','1000037799'),
T_TIPO_DATA('7491154','1000037799'),
T_TIPO_DATA('7491155','1000037799'),
T_TIPO_DATA('7491156','1000037799'),
T_TIPO_DATA('7491157','1000037799'),
T_TIPO_DATA('7491158','1000037799'),
T_TIPO_DATA('7491159','1000037799'),
T_TIPO_DATA('7491160','1000037799'),
T_TIPO_DATA('7491161','1000037799'),
T_TIPO_DATA('7491162','1000037799'),
T_TIPO_DATA('7491224','1000037920'),
T_TIPO_DATA('7491323','1000037856'),
T_TIPO_DATA('7491328','1000037844'),
T_TIPO_DATA('7491329','1000037844'),
T_TIPO_DATA('7491330','1000037844'),
T_TIPO_DATA('7491331','1000037844'),
T_TIPO_DATA('7491332','1000037844'),
T_TIPO_DATA('7491339','1000037844'),
T_TIPO_DATA('7491340','1000037813'),
T_TIPO_DATA('7491342','1000037859'),
T_TIPO_DATA('7491374','1000037803'),
T_TIPO_DATA('7491424','1000037872'),
T_TIPO_DATA('7491428','1000037891'),
T_TIPO_DATA('7491432','1000037810'),
T_TIPO_DATA('7491441','1000037793'),
T_TIPO_DATA('7491442','1000037793'),
T_TIPO_DATA('7491452','1000037793'),
T_TIPO_DATA('7491471','1000037892'),
T_TIPO_DATA('7491496','1000037918'),
T_TIPO_DATA('7491504','1000037907'),
T_TIPO_DATA('7491554','1000037919'),
T_TIPO_DATA('7491671','1000037919'),
T_TIPO_DATA('7491739','1000037912'),
T_TIPO_DATA('7491740','1000037912'),
T_TIPO_DATA('7491741','1000037912'),
T_TIPO_DATA('7491742','1000037912'),
T_TIPO_DATA('7491743','1000037912'),
T_TIPO_DATA('7491744','1000037912'),
T_TIPO_DATA('7491745','1000037912'),
T_TIPO_DATA('7491828','1000037853'),
T_TIPO_DATA('7491829','1000037853'),
T_TIPO_DATA('7491860','1000037858'),
T_TIPO_DATA('7491861','1000037858')
            ); 
    V_TMP_TIPO_DATA T_TIPO_DATA;

    
BEGIN		

	DBMS_OUTPUT.PUT_LINE('[INICIO]');
	
	FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
	LOOP
	V_TMP_TIPO_DATA := V_TIPO_DATA(I);

		V_MSQL:= 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE 
					ACT_NUM_ACTIVO = '''||V_TMP_TIPO_DATA(1)||''' AND BORRADO = 0';
		EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;

        V_MSQL:= 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION WHERE 
					AGR_NUM_AGRUP_REM = '''||V_TMP_TIPO_DATA(2)||''' AND BORRADO = 0';
		EXECUTE IMMEDIATE V_MSQL INTO V_COUNT2;

		IF V_COUNT = 1 AND V_COUNT2 = 1 THEN

            V_MSQL:= 'SELECT ACT_ID FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE 
					ACT_NUM_ACTIVO = '''||V_TMP_TIPO_DATA(1)||''' AND BORRADO = 0';
		    EXECUTE IMMEDIATE V_MSQL INTO V_ACT_ID;

            V_MSQL:= 'SELECT AGR_ID FROM '||V_ESQUEMA||'.ACT_AGR_AGRUPACION WHERE 
                    AGR_NUM_AGRUP_REM = '''||V_TMP_TIPO_DATA(2)||''' AND BORRADO = 0';
            EXECUTE IMMEDIATE V_MSQL INTO V_AGR_ID;

            V_MSQL := 'INSERT INTO '||V_ESQUEMA||'.ACT_AGA_AGRUPACION_ACTIVO (
            AGA_ID, AGR_ID, ACT_ID, AGA_FECHA_INCLUSION, USUARIOCREAR, FECHACREAR, BORRADO
            ) VALUES (
            '||V_ESQUEMA||'.S_ACT_AGA_AGRUPACION_ACTIVO.NEXTVAL,
            '||V_AGR_ID||',
            '||V_ACT_ID||',
            TO_DATE(SYSDATE,''DD/MM/RRRR''),
            '''||V_USU||''',
            SYSDATE,
            0
            )';
            EXECUTE IMMEDIATE V_MSQL;        

			DBMS_OUTPUT.PUT_LINE('[INFO]: ACTIVO '||V_TMP_TIPO_DATA(1)||' INSERTADO EN AGRUPACION '||V_TMP_TIPO_DATA(2)||'');

		ELSE

			DBMS_OUTPUT.PUT_LINE('[INFO]: NO EXISTE ACTIVO O AGRUPACION: '||V_TMP_TIPO_DATA(1)||' - '||V_TMP_TIPO_DATA(2)||' ');

		END IF;

	END LOOP;

	COMMIT;

	DBMS_OUTPUT.PUT_LINE('[FIN]');


EXCEPTION
		WHEN OTHERS THEN
			err_num := SQLCODE;
			err_msg := SQLERRM;

			DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
			DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
			DBMS_OUTPUT.put_line(err_msg);

			ROLLBACK;
			RAISE;          

END;

/

EXIT