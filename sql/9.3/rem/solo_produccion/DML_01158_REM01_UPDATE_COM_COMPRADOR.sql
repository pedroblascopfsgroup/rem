--/*
--##########################################
--## AUTOR=Cristian Montoya
--## FECHA_CREACION=20220318
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-11353
--## PRODUCTO=NO
--##
--## Finalidad: Script que actualiza datos de compradores
--## INSTRUCCIONES:
--## VERSIONES:
--##        0.1 Versión inicial
--##########################################
--*/

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON; 
SET DEFINE OFF;


DECLARE

    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar.
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema.
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master.
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
    V_TEXT_TABLA VARCHAR2(27 CHAR) := 'COM_COMPRADOR'; -- Vble. auxiliar para almacenar el nombre de la tabla de ref.
    V_USU VARCHAR2(30 CHAR) := 'REMVIP-11353'; -- Vble. auxiliar para almacenar el nombre de usuario que modifica los registros.
	V_COM_ID NUMBER(16);
	V_ECO_ID NUMBER(16);
	V_COUNT NUMBER(16);

	TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
		-- 			numOferta, tipoPersona, documento, paisNac, provNac, municipNac, nacionalidad, paisResi, provResi, municipResi
		T_TIPO_DATA(90191538,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90265604,'2','54754013Y','104','','','28','28','25','25040'),
		T_TIPO_DATA(90265604,'2','X3884368J','104','','','104','28','25','25040'),
		T_TIPO_DATA(90273625,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90274620,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90274627,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90279136,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90283478,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90283494,'1','Q0801820B','','','','','28','8','08019'),
		T_TIPO_DATA(90293302,'2','74694927N','28','18','18183','28','28','7','07040'),
		T_TIPO_DATA(90295779,'2','54952733Y','95','','','28','28','46','46244'),
		T_TIPO_DATA(90295779,'2','Y5963639Y','28','46','46244','29','28','46','46250'),
		T_TIPO_DATA(90297090,'2','15415116X','28','3','03015','28','28','3','03015'),
		T_TIPO_DATA(90297090,'2','73998818K','28','3','03015','28','28','3','03015'),
		T_TIPO_DATA(90302270,'2','04199701Q','28','45','45165','28','28','28','28079'),
		T_TIPO_DATA(90305737,'2','40357542V','28','17','17199','28','28','17','17142'),
		T_TIPO_DATA(90305737,'2','77920521V','28','17','17204','28','28','17','17142'),
		T_TIPO_DATA(90306444,'2','45988520C','28','8','08291','28','28','8','08291'),
		T_TIPO_DATA(90314250,'2','Y2030139N','13','','','13','28','43','43013'),
		T_TIPO_DATA(90315780,'1','B05314364','28','46','46250','','28','46','46250'),
		T_TIPO_DATA(90322665,'1','B05419593','','','46190','','28','46','46190'),
		T_TIPO_DATA(90324666,'2','48254004G','28','25','25234','28','28','25','25234'),
		T_TIPO_DATA(90324670,'2','48254004G','28','25','25234','28','28','25','25234'),
		T_TIPO_DATA(90327341,'2','X3302621M','104','','','','28','12','12027'),
		T_TIPO_DATA(90327893,'2','46226549E','28','8','08019','28','28','8','08019'),
		T_TIPO_DATA(90330675,'1','B07997760','28','28','28079','','28','28','28079'),
		T_TIPO_DATA(90331401,'1','B55766000','','','','','28','43','43123'),
		T_TIPO_DATA(90332541,'1','B01679927','','','28079','','28','28','28079'),
		T_TIPO_DATA(90335655,'2','71217154T','28','13','13053','28','28','13','13079'),
		T_TIPO_DATA(90337752,'2','03935632X','28','45','45168','28','28','45','45163'),
		T_TIPO_DATA(90338024,'1','B55252795','28','17','17062','','28','17','17062'),
		T_TIPO_DATA(90338890,'1','P0824500C','28','','','','28','8','08245'),
		T_TIPO_DATA(90339279,'2','44517313P','28','46','46250','28','28','46','46250'),
		T_TIPO_DATA(90339279,'2','44878661A','28','46','46250','28','28','46','46250'),
		T_TIPO_DATA(90339651,'2','14632774J','28','18','18089','28','28','18','18089'),
		T_TIPO_DATA(90339651,'2','14632779H','28','18','18089','28','28','18','18089'),
		T_TIPO_DATA(90339859,'2','55446932G','104','','','28','28','46','46244'),
		T_TIPO_DATA(90339859,'2','55446081G','62','','','28','28','46','46244'),
		T_TIPO_DATA(90340393,'2','20901541S','28','12','12040','28','28','12','12009'),
		T_TIPO_DATA(90340393,'2','X8848719K','72','','','72','28','12','12009'),
		T_TIPO_DATA(90341438,'2','74733707Z','28','18','18184','28','28','18','18184'),
		T_TIPO_DATA(90342267,'1','B30918494','28','30','30016','','28','30','30016'),
		T_TIPO_DATA(90342294,'2','35605301J','89','','','28','28','46','46070'),
		T_TIPO_DATA(90342294,'2','35605300N','89','','','','28','46','46070'),
		T_TIPO_DATA(90342294,'2','44532960S','28','28','28079','28','28','46','46070'),
		T_TIPO_DATA(90342294,'2','44532961Q','89','','','','28','46','46070'),
		T_TIPO_DATA(90344502,'1','B02804037','','','28079','','28','28','28079'),
		T_TIPO_DATA(90344627,'2','53241577G','28','3','03014','28','28','48','48020'),
		T_TIPO_DATA(90344735,'2','05713733G','28','13','13034','28','28','13','13062'),
		T_TIPO_DATA(90344735,'2','05692144N','28','13','13034','28','28','13','13062'),
		T_TIPO_DATA(90344815,'2','48520128H','28','30','30030','28','28','30','30030'),
		T_TIPO_DATA(90344815,'2','74245880V','28','3','03065','28','28','30','30030'),
		T_TIPO_DATA(90345127,'2','08873217R','28','45','45168','28','28','10','10014'),
		T_TIPO_DATA(90345127,'2','44404938B','28','10','10148','28','28','10','10014'),
		T_TIPO_DATA(90346661,'2','33907101H','28','8','08187','28','28','8','08252'),
		T_TIPO_DATA(90347377,'2','30303826S','82','','','28','28','30','30010'),
		T_TIPO_DATA(90347479,'2','X7760344Y','72','','','28','28','46','46190'),
		T_TIPO_DATA(90347539,'2','33465144Y','28','46','46250','','28','46','46135'),
		T_TIPO_DATA(90347539,'2','47549208C','28','41','41091','','28','46','46135'),
		T_TIPO_DATA(90348223,'2','25352161C','28','29','29015','28','28','29','29015'),
		T_TIPO_DATA(90348223,'2','25351150K','28','29','29015','28','28','29','29015'),
		T_TIPO_DATA(90349231,'2','Y3362709P','12','','','12','28','46','46205'),
		T_TIPO_DATA(90349231,'2','Y0313565C','62','','','62','28','46','46205'),
		T_TIPO_DATA(90349333,'2','47538238K','28','41','41091','28','28','41','41092'),
		T_TIPO_DATA(90349333,'2','29510711D','28','41','41091','28','28','41','41092'),
		T_TIPO_DATA(90349911,'2','40960714Z','28','8','08019','28','28','8','08096'),
		T_TIPO_DATA(90349911,'2','77101193H','28','8','08042','28','28','8','08096'),
		T_TIPO_DATA(90350473,'2','48493569R','28','30','30030','28','28','30','30030'),
		T_TIPO_DATA(90350473,'2','X3585112X','09','','','09','28','30','30024'),
		T_TIPO_DATA(90351012,'2','Y0375367K','104','','','104','28','8','08194'),
		T_TIPO_DATA(90351196,'2','45868958N','28','18','18023','28','28','18','18145'),
		T_TIPO_DATA(90351227,'2','30952197Q','28','14','14073','28','28','14','14073'),
		T_TIPO_DATA(90351413,'2','77475148Q','28','8','08298','28','28','8','08233'),
		T_TIPO_DATA(90351468,'2','Y1585471A','104','','','104','28','21','21041'),
		T_TIPO_DATA(90351468,'2','X2807223G','104','','','104','28','21','21041'),
		T_TIPO_DATA(90351714,'2','20927502D','89','','','','28','12','12009'),
		T_TIPO_DATA(90351714,'2','24477623B','89','','','28','28','12','12009'),
		T_TIPO_DATA(90351779,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90351959,'2','03465717P','28','40','40194','28','28','5','05019'),
		T_TIPO_DATA(90352066,'2','15442149H','28','11','11012','28','28','11','11023'),
		T_TIPO_DATA(90352066,'2','48968548F','28','11','11012','28','28','11','11023'),
		T_TIPO_DATA(90353860,'2','42894332E','111','','','28','28','35','35002'),
		T_TIPO_DATA(90353860,'2','45348374X','29','','','28','28','35','35002'),
		T_TIPO_DATA(90353937,'2','70251430T','28','28','28079','28','28','40','40203'),
		T_TIPO_DATA(90356104,'2','72533205Z','28','8','08019','28','28','17','17213'),
		T_TIPO_DATA(90356104,'2','47273210E','28','8','08019','28','28','17','17213'),
		T_TIPO_DATA(90356762,'2','Y5225081R','82','','','82','28','4','04902'),
		T_TIPO_DATA(90356762,'2','54140787Y','28','4','04902','28','28','4','04902'),
		T_TIPO_DATA(90357245,'2','44430408C','28','24','24115','28','28','3','03061'),
		T_TIPO_DATA(90357245,'2','74365062J','28','3','03061','28','28','3','03061'),
		T_TIPO_DATA(90361334,'2','38765335P','28','8','08007','28','28','8','08007'),
		T_TIPO_DATA(90361334,'2','77531116W','28','8','08006','','28','8','08007'),
		T_TIPO_DATA(90362777,'1','A08663619','28','46','46250','','28','46','46250'),
		T_TIPO_DATA(90370763,'2','75721423H','28','4','04013','28','28','4','04013'),
		T_TIPO_DATA(90371713,'1','B91884486','28','41','41091','','28','41','41081'),
		T_TIPO_DATA(90379891,'2','X8155683K','47','','','47','28','8','08176'),
		T_TIPO_DATA(90380914,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90380916,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90382685,'1','Q0801820B','28','8','08019','','28','8','08019'),
		T_TIPO_DATA(90385087,'2','71721238Q','28','13','13053','28','28','13','13053'),
		T_TIPO_DATA(90385087,'2','71224889F','28','13','13053','28','28','13','13053'),
		T_TIPO_DATA(90385209,'2','48637797L','28','30','30038','28','28','30','30038'),
		T_TIPO_DATA(90385209,'2','49306646M','28','30','30038','28','28','30','30038'),
		T_TIPO_DATA(90385231,'2','Y7505705Z','72','','','72','28','25','25120'),
		T_TIPO_DATA(90385231,'2','Y0581886T','72','','','72','28','25','25204'),
		T_TIPO_DATA(90385736,'1','B09733205','42','99','','','28','11','11004'),
		T_TIPO_DATA(90385880,'2','Y6731030W','104','','','104','28','30','30002'),
		T_TIPO_DATA(90385880,'2','X6783271L','104','','','104','28','30','30002'),
		T_TIPO_DATA(90386016,'2','76653495S','28','18','18087','28','28','18','18134'),
		T_TIPO_DATA(90386016,'2','24204051R','28','18','18101','28','28','18','18134'),
		T_TIPO_DATA(90386016,'2','24215513D','28','18','18011','28','28','18','18134'),
		T_TIPO_DATA(90386987,'2','79151117K','28','38','38038','28','28','38','38038'),
		T_TIPO_DATA(90386987,'2','Y7414091D','48','','','28','28','38','38038'),
		T_TIPO_DATA(90387219,'2','34820794J','28','30','30030','28','28','30','30030'),
		T_TIPO_DATA(90387219,'2','34817469T','28','30','30030','28','28','30','30030'),
		T_TIPO_DATA(90387256,'2','25323343K','28','8','08019','28','28','29','29015'),
		T_TIPO_DATA(90387256,'2','25329918H','28','29','29067','28','28','29','29015'),
		T_TIPO_DATA(90388129,'2','40367174N','28','8','08019','28','28','8','08019'),
		T_TIPO_DATA(90388129,'2','44729293C','28','35','35016','28','28','20','20069'),
		T_TIPO_DATA(90388203,'2','50761414T','89','','','28','28','45','45064'),
		T_TIPO_DATA(90388203,'2','X1378388K','89','','','89','28','45','45064'),
		T_TIPO_DATA(90388445,'2','26241361V','28','23','23055','28','28','28','28079'),
		T_TIPO_DATA(90388445,'2','50903194P','28','28','28079','28','28','28','28079')	
    ); 
    V_TMP_TIPO_DATA T_TIPO_DATA;

    
BEGIN		

	DBMS_OUTPUT.PUT_LINE('[INICIO]');
	
	FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
    LOOP
        V_TMP_TIPO_DATA := V_TIPO_DATA(I);
		V_COM_ID := NULL;

		V_MSQL:= 'SELECT COUNT(*) FROM '||V_ESQUEMA||'.'||V_TEXT_TABLA||' COM
					INNER JOIN '||V_ESQUEMA||'.CEX_COMPRADOR_EXPEDIENTE CEX ON CEX.COM_ID = COM.COM_ID
					INNER JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL ECO ON ECO.ECO_ID = CEX.ECO_ID AND ECO.BORRADO = 0
					INNER JOIN '||V_ESQUEMA||'.OFR_OFERTAS OFR ON OFR.OFR_ID = ECO.OFR_ID AND OFR.BORRADO = 0
					WHERE OFR.OFR_NUM_OFERTA = '||V_TMP_TIPO_DATA(1)||'
					AND COM.COM_DOCUMENTO = '''||V_TMP_TIPO_DATA(3)||'''';
		EXECUTE IMMEDIATE V_MSQL INTO V_COUNT;
		
		IF V_COUNT = 1 THEN

			V_MSQL:= 'SELECT COM.COM_ID FROM '||V_ESQUEMA||'.'||V_TEXT_TABLA||' COM
						INNER JOIN '||V_ESQUEMA||'.CEX_COMPRADOR_EXPEDIENTE CEX ON CEX.COM_ID = COM.COM_ID
						INNER JOIN '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL ECO ON ECO.ECO_ID = CEX.ECO_ID AND ECO.BORRADO = 0
						INNER JOIN '||V_ESQUEMA||'.OFR_OFERTAS OFR ON OFR.OFR_ID = ECO.OFR_ID AND OFR.BORRADO = 0
						WHERE OFR.OFR_NUM_OFERTA = '||V_TMP_TIPO_DATA(1)||'
						AND COM.COM_DOCUMENTO = '''||V_TMP_TIPO_DATA(3)||'''';
			EXECUTE IMMEDIATE V_MSQL INTO V_COM_ID;
			
				
			V_MSQL:= 'SELECT ECO_ID FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL ECO
						INNER JOIN '||V_ESQUEMA||'.OFR_OFERTAS OFR ON OFR.OFR_ID = ECO.OFR_ID AND OFR.BORRADO = 0
						WHERE OFR.OFR_NUM_OFERTA = '||V_TMP_TIPO_DATA(1);
			EXECUTE IMMEDIATE V_MSQL INTO V_ECO_ID;	
			
					
			V_MSQL:= 'UPDATE '||V_ESQUEMA||'.'||V_TEXT_TABLA||' SET
						DD_TPE_ID = (SELECT DD_TPE_ID FROM '||V_ESQUEMA||'.DD_TPE_TIPO_PERSONA WHERE DD_TPE_CODIGO = '''||V_TMP_TIPO_DATA(2)||'''),
						DD_PAI_NAC_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(4)||'''),
						DD_PRV_NAC_ID = (SELECT DD_PRV_ID FROM '||V_ESQUEMA_M||'.DD_PRV_PROVINCIA WHERE DD_PRV_CODIGO = '''||V_TMP_TIPO_DATA(5)||'''),
						DD_LOC_NAC_ID = (SELECT DD_LOC_ID FROM '||V_ESQUEMA_M||'.DD_LOC_LOCALIDAD WHERE DD_LOC_CODIGO = '''||V_TMP_TIPO_DATA(6)||'''),
						--DD_PAI_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(8)||'''),
						DD_PRV_ID = (SELECT DD_PRV_ID FROM '||V_ESQUEMA_M||'.DD_PRV_PROVINCIA WHERE DD_PRV_CODIGO = '''||V_TMP_TIPO_DATA(9)||'''),
						DD_LOC_ID = (SELECT DD_LOC_ID FROM '||V_ESQUEMA_M||'.DD_LOC_LOCALIDAD WHERE DD_LOC_CODIGO = '''||V_TMP_TIPO_DATA(10)||'''),
						USUARIOMODIFICAR = '''||V_USU||''',
						FECHAMODIFICAR = SYSDATE
						WHERE COM_ID = '||V_COM_ID;
			EXECUTE IMMEDIATE V_MSQL;
			
			DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZADOS DATOS DE COM_COMPRADOR PARA EL COMPRADOR CON DOCUMENTO '||V_TMP_TIPO_DATA(3));
			
			V_MSQL:= 'UPDATE '||V_ESQUEMA||'.IAP_INFO_ADC_PERSONA SET
						DD_PAI_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(7)||'''),
						USUARIOMODIFICAR = '''||V_USU||''',
						FECHAMODIFICAR = SYSDATE
						WHERE IAP_ID = (SELECT IAP_ID FROM '||V_ESQUEMA||'.'||V_TEXT_TABLA||' WHERE COM_ID = '||V_COM_ID||')';
			EXECUTE IMMEDIATE V_MSQL;
			
			DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZADOS DATOS DE IAP_INFO_ADC_PERSONA PARA EL COMPRADOR CON DOCUMENTO '||V_TMP_TIPO_DATA(3));
			
			V_MSQL:= 'UPDATE '||V_ESQUEMA||'.CEX_COMPRADOR_EXPEDIENTE SET
						DD_PAI_ID_ISO = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(7)||'''),
						DD_PAI_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(8)||'''),
						USUARIOMODIFICAR = '''||V_USU||''',
						FECHAMODIFICAR = SYSDATE
						WHERE ECO_ID = '||V_ECO_ID||'
						AND COM_ID = '||V_COM_ID;
			EXECUTE IMMEDIATE V_MSQL;
			
			DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZADOS DATOS DE CEX_COMPRADOR_EXPEDIENTE PARA EL COMPRADOR CON DOCUMENTO '||V_TMP_TIPO_DATA(3));
	
			V_MSQL:= 'UPDATE '||V_ESQUEMA||'.CLC_CLIENTE_COMERCIAL SET
						DD_TPE_ID = (SELECT DD_TPE_ID FROM '||V_ESQUEMA||'.DD_TPE_TIPO_PERSONA WHERE DD_TPE_CODIGO = '''||V_TMP_TIPO_DATA(2)||'''),
						DD_PAI_NAC_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(4)||'''),
						DD_PRV_NAC_ID = (SELECT DD_PRV_ID FROM '||V_ESQUEMA_M||'.DD_PRV_PROVINCIA WHERE DD_PRV_CODIGO = '''||V_TMP_TIPO_DATA(5)||'''),
						DD_LOC_NAC_ID = (SELECT DD_LOC_ID FROM '||V_ESQUEMA_M||'.DD_LOC_LOCALIDAD WHERE DD_LOC_CODIGO = '''||V_TMP_TIPO_DATA(6)||'''),
						DD_PAI_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(8)||'''),
						DD_PRV_ID = (SELECT DD_PRV_ID FROM '||V_ESQUEMA_M||'.DD_PRV_PROVINCIA WHERE DD_PRV_CODIGO = '''||V_TMP_TIPO_DATA(9)||'''),
						DD_LOC_ID = (SELECT DD_LOC_ID FROM '||V_ESQUEMA_M||'.DD_LOC_LOCALIDAD WHERE DD_LOC_CODIGO = '''||V_TMP_TIPO_DATA(10)||'''),
						USUARIOMODIFICAR = '''||V_USU||''',
						FECHAMODIFICAR = SYSDATE
						WHERE CLC_ID = (SELECT CLC_ID FROM '||V_ESQUEMA||'.OFR_OFERTAS WHERE OFR_NUM_OFERTA = '||V_TMP_TIPO_DATA(1)||')';
			EXECUTE IMMEDIATE V_MSQL;
			
			DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZADOS DATOS DE CLC_CLIENTE_COMERCIAL PARA EL COMPRADOR CON DOCUMENTO '||V_TMP_TIPO_DATA(3));
			
			
			V_MSQL:= 'UPDATE '||V_ESQUEMA||'.OFR_TIA_TITULARES_ADICIONALES SET
						DD_PAI_NAC_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(4)||'''),
						DD_PRV_NAC_ID = (SELECT DD_PRV_ID FROM '||V_ESQUEMA_M||'.DD_PRV_PROVINCIA WHERE DD_PRV_CODIGO = '''||V_TMP_TIPO_DATA(5)||'''),
						DD_LOC_NAC_ID = (SELECT DD_LOC_ID FROM '||V_ESQUEMA_M||'.DD_LOC_LOCALIDAD WHERE DD_LOC_CODIGO = '''||V_TMP_TIPO_DATA(6)||'''),
						DD_PAI_ID = (SELECT DD_PAI_ID FROM '||V_ESQUEMA||'.DD_PAI_PAISES WHERE DD_PAI_CODIGO = '''||V_TMP_TIPO_DATA(8)||'''),
						DD_PRV_ID = (SELECT DD_PRV_ID FROM '||V_ESQUEMA_M||'.DD_PRV_PROVINCIA WHERE DD_PRV_CODIGO = '''||V_TMP_TIPO_DATA(9)||'''),
						DD_LOC_ID = (SELECT DD_LOC_ID FROM '||V_ESQUEMA_M||'.DD_LOC_LOCALIDAD WHERE DD_LOC_CODIGO = '''||V_TMP_TIPO_DATA(10)||'''),
						USUARIOMODIFICAR = '''||V_USU||''',
						FECHAMODIFICAR = SYSDATE
						WHERE OFR_ID = (SELECT OFR_ID FROM '||V_ESQUEMA||'.ECO_EXPEDIENTE_COMERCIAL WHERE ECO_ID = '||V_ECO_ID||')
						AND TIA_DOCUMENTO = '''||V_TMP_TIPO_DATA(3)||'''';
			EXECUTE IMMEDIATE V_MSQL;
			
			DBMS_OUTPUT.PUT_LINE('[INFO] ACTUALIZADOS DATOS DE OFR_TIA_TITULARES_ADICIONALES PARA EL COMPRADOR CON DOCUMENTO '||V_TMP_TIPO_DATA(3));
			
		ELSE

			DBMS_OUTPUT.PUT_LINE('[INFO]: NO SE HA ENCONTRADO COMPRADOR CON DOCUMENTO '||V_TMP_TIPO_DATA(3)||' RELACIONADO A LA OFERTA '||V_TMP_TIPO_DATA(1));

		END IF;

	END LOOP;

	COMMIT;

	DBMS_OUTPUT.PUT_LINE('[FIN]');


EXCEPTION
		WHEN OTHERS THEN
			err_num := SQLCODE;
			err_msg := SQLERRM;

			DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(err_num));
			DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
			DBMS_OUTPUT.put_line(err_msg);

			ROLLBACK;
			RAISE;          

END;

/

EXIT