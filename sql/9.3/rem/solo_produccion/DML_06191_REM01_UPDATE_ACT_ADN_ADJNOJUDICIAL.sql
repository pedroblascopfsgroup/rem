--/*
--######################################### 
--## AUTOR=REMUS OVIDIU
--## FECHA_CREACION=20221230
--## ARTEFACTO=online
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-13048
--## PRODUCTO=NO
--##            
--## INSTRUCCIONES:UPDATE fecha posesion ACT_ADN_ADJNOJUDICIAL
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;


DECLARE
    V_MSQL VARCHAR2(32000 CHAR); -- Sentencia a ejecutar     
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_NUM_TABLAS NUMBER(16); -- Vble. para validar la existencia de una tabla.   
    ERR_NUM NUMBER(25);  -- Vble. auxiliar para registrar errores en el script.
    ERR_MSG VARCHAR2(1024 CHAR); -- Vble. auxiliar para registrar errores en el script.
	V_TEXT_TABLA VARCHAR2(2400 CHAR) := 'ACT_ADN_ADJNOJUDICIAL'; -- Vble. auxiliar para almacenar el nombre de la tabla de ref.
	V_USUARIO VARCHAR2(32 CHAR) := 'REMVIP-13048';

    
    TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
    TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
    	T_TIPO_DATA(7489468,'10/21/2020'),
T_TIPO_DATA(7489762,'3/28/2019'),
T_TIPO_DATA(7489791,'6/27/2011'),
T_TIPO_DATA(7486968,'12/30/2010'),
T_TIPO_DATA(7487179,'4/24/2015'),
T_TIPO_DATA(7488495,'2/26/2015'),
T_TIPO_DATA(7489574,'9/13/2017'),
T_TIPO_DATA(7489349,'12/31/1899'),
T_TIPO_DATA(7489376,'2/13/2020'),
T_TIPO_DATA(7486987,'5/31/2012'),
T_TIPO_DATA(7488503,'11/14/2014'),
T_TIPO_DATA(7489817,'1/16/2018'),
T_TIPO_DATA(7486576,'5/6/2015'),
T_TIPO_DATA(7488881,'9/12/2011'),
T_TIPO_DATA(7486869,'2/11/2014'),
T_TIPO_DATA(7489686,'4/3/2018'),
T_TIPO_DATA(7488921,'3/21/2013'),
T_TIPO_DATA(7522973,'8/2/2010'),
T_TIPO_DATA(7489745,'6/30/2015'),
T_TIPO_DATA(7489833,'11/13/2018'),
T_TIPO_DATA(7489127,'2/6/2013'),
T_TIPO_DATA(7488546,'12/31/1899'),
T_TIPO_DATA(7488393,'9/26/2019'),
T_TIPO_DATA(7488542,'6/20/2014'),
T_TIPO_DATA(7487351,'10/19/2017'),
T_TIPO_DATA(7487971,'12/31/1899'),
T_TIPO_DATA(7489740,'3/12/2018'),
T_TIPO_DATA(7488978,'11/28/2019'),
T_TIPO_DATA(7488781,'8/7/2018'),
T_TIPO_DATA(7488076,'12/2/2020'),
T_TIPO_DATA(7489173,'1/25/2012'),
T_TIPO_DATA(7489401,'11/10/2016'),
T_TIPO_DATA(7488910,'12/27/2018'),
T_TIPO_DATA(7486503,'10/17/2016'),
T_TIPO_DATA(7488377,'10/6/2014'),
T_TIPO_DATA(7489621,'1/8/2013'),
T_TIPO_DATA(7488324,'5/27/2014'),
T_TIPO_DATA(7487224,'5/11/2009'),
T_TIPO_DATA(7489779,'10/17/2011'),
T_TIPO_DATA(7488588,'1/18/2011'),
T_TIPO_DATA(7491983,'4/1/2021'),
T_TIPO_DATA(7487836,'5/11/2009'),
T_TIPO_DATA(7489660,'10/17/2018'),
T_TIPO_DATA(7489595,'12/11/2013'),
T_TIPO_DATA(7489394,'10/28/2020'),
T_TIPO_DATA(7491801,'7/11/2017'),
T_TIPO_DATA(7489664,'12/2/2019'),
T_TIPO_DATA(7489006,'7/24/2018'),
T_TIPO_DATA(7488440,'4/25/2018'),
T_TIPO_DATA(7489319,'11/8/2013'),
T_TIPO_DATA(7488500,'11/6/2012'),
T_TIPO_DATA(7488328,'10/6/2014'),
T_TIPO_DATA(7489059,'6/28/2016'),
T_TIPO_DATA(7487998,'1/20/2015'),
T_TIPO_DATA(7487939,'6/18/2009'),
T_TIPO_DATA(7489624,'10/23/2015'),
T_TIPO_DATA(7489771,'1/23/2020'),
T_TIPO_DATA(7487959,'6/28/2012'),
T_TIPO_DATA(7489294,'7/10/2009'),
T_TIPO_DATA(7489647,'9/30/2011'),
T_TIPO_DATA(7488559,'8/19/2019'),
T_TIPO_DATA(7486423,'12/10/2014'),
T_TIPO_DATA(7487877,'3/20/2018'),
T_TIPO_DATA(7489236,'12/21/2013'),
T_TIPO_DATA(7486985,'8/4/2017'),
T_TIPO_DATA(7489732,'3/12/2018'),
T_TIPO_DATA(7488528,'2/21/2011'),
T_TIPO_DATA(7486703,'3/16/2016'),
T_TIPO_DATA(7486881,'12/30/2010'),
T_TIPO_DATA(7489265,'5/29/2018'),
T_TIPO_DATA(7491967,'3/26/2021'),
T_TIPO_DATA(7486892,'12/23/2016'),
T_TIPO_DATA(7487014,'8/13/2019'),
T_TIPO_DATA(7487188,'12/14/2018'),
T_TIPO_DATA(7489802,'12/4/2018'),
T_TIPO_DATA(7489812,'7/12/2022'),
T_TIPO_DATA(7489095,'12/31/1899'),
T_TIPO_DATA(7486494,'1/12/2012'),
T_TIPO_DATA(7489061,'10/22/2021'),
T_TIPO_DATA(7487359,'5/2/2014'),
T_TIPO_DATA(7487742,'3/15/2016'),
T_TIPO_DATA(7489826,'12/31/1899'),
T_TIPO_DATA(7491899,'2/12/2021'),
T_TIPO_DATA(7486886,'8/9/2017'),
T_TIPO_DATA(7489003,'4/21/2021'),
T_TIPO_DATA(7488482,'2/9/2018'),
T_TIPO_DATA(7486365,'12/14/2017'),
T_TIPO_DATA(7489618,'12/1/2014'),
T_TIPO_DATA(7488748,'9/14/2012'),
T_TIPO_DATA(7488871,'2/26/2015'),
T_TIPO_DATA(7522972,'7/29/2010'),
T_TIPO_DATA(7489790,'11/4/2016'),
T_TIPO_DATA(7489309,'5/25/2012'),
T_TIPO_DATA(7488271,'9/13/2021'),
T_TIPO_DATA(7488565,'11/13/2015'),
T_TIPO_DATA(7489593,'4/24/2020'),
T_TIPO_DATA(7488943,'2/9/2012'),
T_TIPO_DATA(7486594,'7/24/2017'),
T_TIPO_DATA(7489255,'12/31/1899'),
T_TIPO_DATA(7488832,'6/30/2012'),
T_TIPO_DATA(7486470,'9/22/2017'),
T_TIPO_DATA(7489112,'2/15/2021'),
T_TIPO_DATA(7487809,'2/11/2020'),
T_TIPO_DATA(7488068,'6/25/2019'),
T_TIPO_DATA(7487430,'7/5/2017'),
T_TIPO_DATA(7489609,'12/22/2014'),
T_TIPO_DATA(7491551,'1/25/2017'),
T_TIPO_DATA(7489669,'11/9/2017'),
T_TIPO_DATA(7487654,'2/20/2019'),
T_TIPO_DATA(7489044,'10/22/2019'),
T_TIPO_DATA(7486899,'12/16/2014'),
T_TIPO_DATA(7486591,'6/25/2019'),
T_TIPO_DATA(7488416,'10/28/2020'),
T_TIPO_DATA(7489322,'8/10/2015'),
T_TIPO_DATA(7489859,'7/13/2016'),
T_TIPO_DATA(7487441,'9/25/2013'),
T_TIPO_DATA(7487296,'2/9/2018'),
T_TIPO_DATA(7491536,'1/11/2017'),
T_TIPO_DATA(7488292,'2/21/2018'),
T_TIPO_DATA(7491964,'3/22/2021'),
T_TIPO_DATA(7489517,'12/31/1899'),
T_TIPO_DATA(7487863,'10/15/2019'),
T_TIPO_DATA(7488167,'4/11/2019'),
T_TIPO_DATA(7487343,'1/27/2014'),
T_TIPO_DATA(7489815,'9/22/2016'),
T_TIPO_DATA(7487681,'12/21/2018'),
T_TIPO_DATA(7487783,'12/27/2011'),
T_TIPO_DATA(7489857,'10/20/2014'),
T_TIPO_DATA(7487294,'3/8/2018'),
T_TIPO_DATA(7486951,'8/20/2019'),
T_TIPO_DATA(7486450,'9/28/2021'),
T_TIPO_DATA(7489466,'3/22/2019'),
T_TIPO_DATA(7487375,'7/13/2018'),
T_TIPO_DATA(7488441,'2/26/2015'),
T_TIPO_DATA(7486436,'5/14/2020'),
T_TIPO_DATA(7487758,'5/30/2011'),
T_TIPO_DATA(7488456,'3/7/2011'),
T_TIPO_DATA(7489356,'9/22/2016'),
T_TIPO_DATA(7488557,'10/26/2016'),
T_TIPO_DATA(7488075,'12/2/2020'),
T_TIPO_DATA(7487787,'5/18/2016'),
T_TIPO_DATA(7491941,'2/18/2022'),
T_TIPO_DATA(7486318,'4/30/2011'),
T_TIPO_DATA(7486472,'4/15/2021'),
T_TIPO_DATA(7522974,'4/25/2012'),
T_TIPO_DATA(7488481,'10/26/2016'),
T_TIPO_DATA(7486994,'4/30/2011'),
T_TIPO_DATA(7487757,'1/15/2018'),
T_TIPO_DATA(7488970,'1/22/2014'),
T_TIPO_DATA(7487440,'9/25/2013'),
T_TIPO_DATA(7487176,'3/15/2018'),
T_TIPO_DATA(7488182,'10/8/2020'),
T_TIPO_DATA(7487590,'2/22/2022'),
T_TIPO_DATA(7487491,'5/12/2022'),
T_TIPO_DATA(7489590,'10/25/2019'),
T_TIPO_DATA(7491638,'10/13/2015'),
T_TIPO_DATA(7487710,'6/16/2016'),
T_TIPO_DATA(7489107,'4/26/2018'),
T_TIPO_DATA(7489734,'7/12/2018'),
T_TIPO_DATA(7489682,'11/10/2017')
    ); 
    V_TMP_TIPO_DATA T_TIPO_DATA;
    
BEGIN
DBMS_OUTPUT.PUT_LINE('[INICIO]');


    DBMS_OUTPUT.PUT_LINE('[INFO]: UPDATE EN '||V_TEXT_TABLA);
    FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
    LOOP

        V_TMP_TIPO_DATA := V_TIPO_DATA(I);

        V_MSQL := 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.ACT_ACTIVO WHERE ACT_NUM_ACTIVO = '||TRIM(V_TMP_TIPO_DATA(1))||' AND BORRADO = 0';
        EXECUTE IMMEDIATE V_MSQL INTO V_NUM_TABLAS;
        -- Si existe se modifica.
        IF V_NUM_TABLAS > 0 THEN				
            
            DBMS_OUTPUT.PUT_LINE('[INFO]: MODIFICAR EL ACTIVO '||V_TMP_TIPO_DATA(1)||'');
            V_MSQL := 'UPDATE '|| V_ESQUEMA ||'.'||V_TEXT_TABLA||'
                        SET FECHA_POSESION = TO_DATE('''||TRIM(V_TMP_TIPO_DATA(2))||''',''MM/DD/YYYY'')
                            , USUARIOMODIFICAR = '''||V_USUARIO||''' 
                            , FECHAMODIFICAR = SYSDATE 
                        WHERE ACT_ID = (SELECT ACT_ID FROM '|| V_ESQUEMA ||'.ACT_ACTIVO 
                            WHERE ACT_NUM_ACTIVO = '||V_TMP_TIPO_DATA(1)||')';
            EXECUTE IMMEDIATE V_MSQL;
            DBMS_OUTPUT.PUT_LINE('[INFO]: REGISTRO MODIFICADO CORRECTAMENTE');

        ELSE

          DBMS_OUTPUT.PUT_LINE('[INFO]: NO EXISTE EL ACTIVO:  '||V_TMP_TIPO_DATA(1)||'');

        END IF;
    END LOOP;
      
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('[FIN]: TABLA '||V_TEXT_TABLA||' ACTUALIZADO CORRECTAMENTE ');

EXCEPTION
     WHEN OTHERS THEN
          ERR_NUM := SQLCODE;
          ERR_MSG := SQLERRM;
          DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecución:'||TO_CHAR(ERR_NUM));
          DBMS_OUTPUT.put_line('-----------------------------------------------------------'); 
          DBMS_OUTPUT.put_line(ERR_MSG);
          ROLLBACK;
          RAISE;   
END;
/
EXIT;
