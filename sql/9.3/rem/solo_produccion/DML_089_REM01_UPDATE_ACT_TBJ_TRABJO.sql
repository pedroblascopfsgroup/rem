--/*
--#########################################
--## AUTOR=Viorel Remus Ovidiu
--## FECHA_CREACION=20191022
--## ARTEFACTO=batch
--## VERSION_ARTEFACTO=9.3
--## INCIDENCIA_LINK=REMVIP-5404
--## PRODUCTO=NO
--## 
--## Finalidad: 
--##			
--## INSTRUCCIONES:  
--## VERSIONES:
--##        0.1 Versión inicial
--#########################################
--*/

--Para permitir la visualización de texto en un bloque PL/SQL utilizando DBMS_OUTPUT.PUT_LINE

WHENEVER SQLERROR EXIT SQL.SQLCODE;
SET SERVEROUTPUT ON;
SET DEFINE OFF;
alter session set NLS_NUMERIC_CHARACTERS = '.,';

DECLARE
	
    err_num NUMBER; -- Numero de error.
    err_msg VARCHAR2(2048); -- Mensaje de error.
    V_ESQUEMA VARCHAR2(25 CHAR):= '#ESQUEMA#';-- '#ESQUEMA#'; -- Configuracion Esquema
    V_ESQUEMA_M VARCHAR2(25 CHAR):= '#ESQUEMA_MASTER#';-- '#ESQUEMA_MASTER#'; -- Configuracion Esquema Master
    V_USUARIOMODIFICAR VARCHAR(100 CHAR):= 'REMVIP-5404';
    V_SQL VARCHAR2(4000 CHAR);
    V_NUM_TABLAS NUMBER;
    V_COUNT NUMBER(16):= 0; -- Vble. para contar updates

  TYPE T_TIPO_DATA IS TABLE OF VARCHAR2(150);
  TYPE T_ARRAY_DATA IS TABLE OF T_TIPO_DATA;
    
    V_TIPO_DATA T_ARRAY_DATA := T_ARRAY_DATA(
		T_TIPO_DATA(157631, 18),
		T_TIPO_DATA(168872, 18),
		T_TIPO_DATA(169938, 25),
		T_TIPO_DATA(168554, 25),
		T_TIPO_DATA(166978, 25),
		T_TIPO_DATA(170856, 25),
		T_TIPO_DATA(167512, 25),
		T_TIPO_DATA(166577, 25),
		T_TIPO_DATA(169639, 25),
		T_TIPO_DATA(162154, 25),
		T_TIPO_DATA(166879, 25),
		T_TIPO_DATA(168288, 25),
		T_TIPO_DATA(170933, 25),
		T_TIPO_DATA(167089, 25),
		T_TIPO_DATA(170212, 25),
		T_TIPO_DATA(154315, 25),
		T_TIPO_DATA(167891, 25),
		T_TIPO_DATA(168860, 25),
		T_TIPO_DATA(162979, 25),
		T_TIPO_DATA(170436, 25),
		T_TIPO_DATA(169424, 25),
		T_TIPO_DATA(162149, 25),
		T_TIPO_DATA(162366, 25),
		T_TIPO_DATA(168405, 25),
		T_TIPO_DATA(159413, 25),
		T_TIPO_DATA(167440, 25),
		T_TIPO_DATA(168145, 25),
		T_TIPO_DATA(170456, 25),
		T_TIPO_DATA(159994, 25),
		T_TIPO_DATA(169164, 25),
		T_TIPO_DATA(168899, 25),
		T_TIPO_DATA(162158, 25),
		T_TIPO_DATA(162045, 25),
		T_TIPO_DATA(166685, 25),
		T_TIPO_DATA(165637, 25),
		T_TIPO_DATA(168854, 25),
		T_TIPO_DATA(170220, 25),
		T_TIPO_DATA(169390, 25),
		T_TIPO_DATA(167521, 25),
		T_TIPO_DATA(167435, 25),
		T_TIPO_DATA(163094, 25),
		T_TIPO_DATA(162713, 25),
		T_TIPO_DATA(170622, 25),
		T_TIPO_DATA(160645, 25),
		T_TIPO_DATA(156057, 25),
		T_TIPO_DATA(159594, 25),
		T_TIPO_DATA(170213, 25),
		T_TIPO_DATA(168550, 25),
		T_TIPO_DATA(170216, 25),
		T_TIPO_DATA(168013, 25),
		T_TIPO_DATA(166884, 25),
		T_TIPO_DATA(165280, 25),
		T_TIPO_DATA(166573, 25),
		T_TIPO_DATA(161643, 25),
		T_TIPO_DATA(168548, 25),
		T_TIPO_DATA(169160, 25),
		T_TIPO_DATA(165578, 29.45),
		T_TIPO_DATA(169026, 29.45),
		T_TIPO_DATA(165880, 29.45),
		T_TIPO_DATA(169422, 29.45),
		T_TIPO_DATA(157962, 29.45),
		T_TIPO_DATA(168228, 29.45),
		T_TIPO_DATA(161833, 29.45),
		T_TIPO_DATA(163922, 29.45),
		T_TIPO_DATA(169025, 29.45),
		T_TIPO_DATA(170640, 29.45),
		T_TIPO_DATA(168398, 29.45),
		T_TIPO_DATA(168706, 31.35),
		T_TIPO_DATA(170232, 31.35),
		T_TIPO_DATA(162991, 36.76),
		T_TIPO_DATA(9000124185, 36.76),
		T_TIPO_DATA(9000129535, 36.76),
		T_TIPO_DATA(9000129753, 36.76),
		T_TIPO_DATA(9000101458, 36.76),
		T_TIPO_DATA(9000105259, 36.76),
		T_TIPO_DATA(9000105216, 36.76),
		T_TIPO_DATA(9000101252, 36.76),
		T_TIPO_DATA(9000099062, 36.76),
		T_TIPO_DATA(9000125941, 36.76),
		T_TIPO_DATA(9000126404, 36.76),
		T_TIPO_DATA(162353, 36.76),
		T_TIPO_DATA(9000103345, 36.76),
		T_TIPO_DATA(9000125786, 36.76),
		T_TIPO_DATA(9000100328, 36.76),
		T_TIPO_DATA(9000129134, 36.76),
		T_TIPO_DATA(158219, 37.19),
		T_TIPO_DATA(168407, 37.19),
		T_TIPO_DATA(168012, 37.19),
		T_TIPO_DATA(169162, 37.19),
		T_TIPO_DATA(169702, 37.19),
		T_TIPO_DATA(167436, 37.19),
		T_TIPO_DATA(170458, 37.19),
		T_TIPO_DATA(158757, 37.19),
		T_TIPO_DATA(166463, 37.19),
		T_TIPO_DATA(158140, 37.19),
		T_TIPO_DATA(166680, 37.19),
		T_TIPO_DATA(167999, 37.19),
		T_TIPO_DATA(169398, 37.19),
		T_TIPO_DATA(169718, 37.19),
		T_TIPO_DATA(167281, 37.19),
		T_TIPO_DATA(154093, 37.19),
		T_TIPO_DATA(168406, 37.19),
		T_TIPO_DATA(166281, 37.19),
		T_TIPO_DATA(9000101239, 41),
		T_TIPO_DATA(168552, 43),
		T_TIPO_DATA(167657, 43),
		T_TIPO_DATA(167178, 43),
		T_TIPO_DATA(167740, 55.1),
		T_TIPO_DATA(166032, 55.1),
		T_TIPO_DATA(167432, 55.19),
		T_TIPO_DATA(166585, 55.19),
		T_TIPO_DATA(167274, 62.19),
		T_TIPO_DATA(155378, 70.25),
		T_TIPO_DATA(156108, 70.25),
		T_TIPO_DATA(166878, 70.25),
		T_TIPO_DATA(167169, 70.25),
		T_TIPO_DATA(154994, 70.25),
		T_TIPO_DATA(165734, 70.25),
		T_TIPO_DATA(169788, 70.25),
		T_TIPO_DATA(167744, 70.25),
		T_TIPO_DATA(169169, 70.25),
		T_TIPO_DATA(170733, 70.25),
		T_TIPO_DATA(170623, 70.25),
		T_TIPO_DATA(169577, 70.25),
		T_TIPO_DATA(169519, 70.25),
		T_TIPO_DATA(162712, 70.25),
		T_TIPO_DATA(168856, 70.25),
		T_TIPO_DATA(169939, 70.25),
		T_TIPO_DATA(168140, 70.25),
		T_TIPO_DATA(162152, 70.25),
		T_TIPO_DATA(161398, 70.25),
		T_TIPO_DATA(161391, 70.25),
		T_TIPO_DATA(159161, 70.25),
		T_TIPO_DATA(167268, 70.25),
		T_TIPO_DATA(167360, 70.25),
		T_TIPO_DATA(155545, 70.25),
		T_TIPO_DATA(167594, 70.25),
		T_TIPO_DATA(168870, 70.25),
		T_TIPO_DATA(167168, 70.25),
		T_TIPO_DATA(157277, 70.25),
		T_TIPO_DATA(161902, 70.25),
		T_TIPO_DATA(169790, 70.25),
		T_TIPO_DATA(156365, 70.25),
		T_TIPO_DATA(169167, 70.25),
		T_TIPO_DATA(161908, 70.25),
		T_TIPO_DATA(165737, 70.25),
		T_TIPO_DATA(169035, 71.81),
		T_TIPO_DATA(170358, 71.81),
		T_TIPO_DATA(165813, 74.28),
		T_TIPO_DATA(165741, 74.38),
		T_TIPO_DATA(165431, 74.38),
		T_TIPO_DATA(166326, 74.38),
		T_TIPO_DATA(9000152154, 75),
		T_TIPO_DATA(169894, 78.28),
		T_TIPO_DATA(166861, 81.74),
		T_TIPO_DATA(168420, 81.74),
		T_TIPO_DATA(166855, 81.74),
		T_TIPO_DATA(157666, 81.74),
		T_TIPO_DATA(166905, 81.74),
		T_TIPO_DATA(166377, 81.74),
		T_TIPO_DATA(166904, 81.74),
		T_TIPO_DATA(167478, 81.74),
		T_TIPO_DATA(167707, 81.74),
		T_TIPO_DATA(166412, 81.74),
		T_TIPO_DATA(165836, 81.74),
		T_TIPO_DATA(168946, 81.74),
		T_TIPO_DATA(168414, 81.74),
		T_TIPO_DATA(166937, 81.74),
		T_TIPO_DATA(9000129791, 83),
		T_TIPO_DATA(170609, 83.52),
		T_TIPO_DATA(167890, 88.25),
		T_TIPO_DATA(166457, 88.25),
		T_TIPO_DATA(153785, 88.25),
		T_TIPO_DATA(158216, 88.25),
		T_TIPO_DATA(9000052503, 91.3486),
		T_TIPO_DATA(168360, 91.55),
		T_TIPO_DATA(156338, 95.25),
		T_TIPO_DATA(167443, 95.38),
		T_TIPO_DATA(168889, 107.44),
		T_TIPO_DATA(167986, 107.44),
		T_TIPO_DATA(168857, 107.44),
		T_TIPO_DATA(169717, 107.44),
		T_TIPO_DATA(170427, 107.44),
		T_TIPO_DATA(170735, 107.44),
		T_TIPO_DATA(169951, 111.36),
		T_TIPO_DATA(170853, 111.57),
		T_TIPO_DATA(9000129071, 116.4),
		T_TIPO_DATA(9000128313, 123.21),
		T_TIPO_DATA(9000128319, 123.21),
		T_TIPO_DATA(166193, 126.73),
		T_TIPO_DATA(168141, 129.57),
		T_TIPO_DATA(165847, 137.78),
		T_TIPO_DATA(165844, 137.78),
		T_TIPO_DATA(165846, 137.78),
		T_TIPO_DATA(166872, 140.5),
		T_TIPO_DATA(158155, 140.5),
		T_TIPO_DATA(168877, 140.5),
		T_TIPO_DATA(167362, 140.5),
		T_TIPO_DATA(168290, 140.5),
		T_TIPO_DATA(166198, 140.5),
		T_TIPO_DATA(170864, 140.5),
		T_TIPO_DATA(167270, 140.5),
		T_TIPO_DATA(166670, 140.5),
		T_TIPO_DATA(168917, 143.48),
		T_TIPO_DATA(166578, 144.63),
		T_TIPO_DATA(168411, 148.76),
		T_TIPO_DATA(169744, 149.47),
		T_TIPO_DATA(169397, 151.24),
		T_TIPO_DATA(167992, 151.24),
		T_TIPO_DATA(166061, 151.24),
		T_TIPO_DATA(166877, 151.24),
		T_TIPO_DATA(157491, 151.24),
		T_TIPO_DATA(171069, 156.75),
		T_TIPO_DATA(168898, 156.75),
		T_TIPO_DATA(167516, 158.5),
		T_TIPO_DATA(168300, 160.96),
		T_TIPO_DATA(170069, 160.96),
		T_TIPO_DATA(9000112294, 164.21),
		T_TIPO_DATA(9000093251, 164.21),
		T_TIPO_DATA(9000096227, 164.21),
		T_TIPO_DATA(170712, 170.7),
		T_TIPO_DATA(167515, 177.69),
		T_TIPO_DATA(170967, 180.68),
		T_TIPO_DATA(166590, 190.13),
		T_TIPO_DATA(166614, 190.41),
		T_TIPO_DATA(169432, 194.23),
		T_TIPO_DATA(167962, 198.17),
		T_TIPO_DATA(9000108738, 205.59),
		T_TIPO_DATA(168786, 209.34),
		T_TIPO_DATA(169786, 210.75),
		T_TIPO_DATA(159727, 210.75),
		T_TIPO_DATA(169395, 210.75),
		T_TIPO_DATA(9000101048, 215.3),
		T_TIPO_DATA(168782, 217.04),
		T_TIPO_DATA(169528, 217.04),
		T_TIPO_DATA(170217, 221.49),
		T_TIPO_DATA(158654, 221.49),
		T_TIPO_DATA(166105, 222.73),
		T_TIPO_DATA(165826, 222.73),
		T_TIPO_DATA(168354, 224.19),
		T_TIPO_DATA(169719, 228.75),
		T_TIPO_DATA(9000130231, 232.8),
		T_TIPO_DATA(169954, 240.1),
		T_TIPO_DATA(168623, 240.1),
		T_TIPO_DATA(167612, 246.48),
		T_TIPO_DATA(170425, 246.48),
		T_TIPO_DATA(170715, 253.87),
		T_TIPO_DATA(167231, 256.34),
		T_TIPO_DATA(167133, 263.85),
		T_TIPO_DATA(170254, 263.85),
		T_TIPO_DATA(168593, 267.83),
		T_TIPO_DATA(170745, 281),
		T_TIPO_DATA(170989, 281.23),
		T_TIPO_DATA(168324, 298.6),
		T_TIPO_DATA(169127, 302.48),
		T_TIPO_DATA(167429, 305.78),
		T_TIPO_DATA(168326, 312.98),
		T_TIPO_DATA(166671, 322.32),
		T_TIPO_DATA(160417, 323.2),
		T_TIPO_DATA(169643, 351.25),
		T_TIPO_DATA(169509, 378.52),
		T_TIPO_DATA(167716, 393.73),
		T_TIPO_DATA(169952, 393.73),
		T_TIPO_DATA(168321, 398.48),
		T_TIPO_DATA(170076, 411.1),
		T_TIPO_DATA(169560, 412.6),
		T_TIPO_DATA(170048, 428.48),
		T_TIPO_DATA(171006, 428.48),
		T_TIPO_DATA(169555, 461.7),
		T_TIPO_DATA(168075, 481.7),
		T_TIPO_DATA(9000093191, 492.63),
		T_TIPO_DATA(170461, 534.33),
		T_TIPO_DATA(170452, 534.33),
		T_TIPO_DATA(165695, 534.33),
		T_TIPO_DATA(168319, 534.33),
		T_TIPO_DATA(170760, 551),
		T_TIPO_DATA(168601, 551.7),
		T_TIPO_DATA(169592, 551.7),
		T_TIPO_DATA(167430, 572.74),
		T_TIPO_DATA(9000112187, 609.03),
		T_TIPO_DATA(170049, 626.4),
		T_TIPO_DATA(165104, 636.034),
		T_TIPO_DATA(167645, 664.47),
		T_TIPO_DATA(157490, 668.25),
		T_TIPO_DATA(168111, 753.72),
		T_TIPO_DATA(9000114283, 765),
		T_TIPO_DATA(170639, 770.18),
		T_TIPO_DATA(170421, 802.85),
		T_TIPO_DATA(167700, 889.85),
		T_TIPO_DATA(165141, 920.89),
		T_TIPO_DATA(166777, 960.1872),
		T_TIPO_DATA(154827, 987.2),
		T_TIPO_DATA(169284, 1015.85),
		T_TIPO_DATA(9000095140, 1026.64),
		T_TIPO_DATA(162921, 1157.58),
		T_TIPO_DATA(166248, 1199.9629),
		T_TIPO_DATA(168960, 1205.64),
		T_TIPO_DATA(163484, 1352.37),
		T_TIPO_DATA(9000058054, 1692.13)

	); 
    V_TMP_TIPO_DATA T_TIPO_DATA;
    
BEGIN	

    DBMS_OUTPUT.PUT_LINE('[INICIO]');
    DBMS_OUTPUT.PUT_LINE('[INFO]: ACTUALIZAR IMPORTE TOTAL TRABAJOS');

    FOR I IN V_TIPO_DATA.FIRST .. V_TIPO_DATA.LAST
      LOOP
      
        V_TMP_TIPO_DATA := V_TIPO_DATA(I);

	EXECUTE IMMEDIATE 'SELECT COUNT(1) FROM '||V_ESQUEMA||'.ACT_TBJ_TRABAJO WHERE TBJ_NUM_TRABAJO = '||V_TMP_TIPO_DATA(1)||'' INTO V_NUM_TABLAS;

	IF V_NUM_TABLAS > 0 THEN

		V_SQL := ' UPDATE '||V_ESQUEMA||'.ACT_TBJ_TRABAJO 
			    SET TBJ_IMPORTE_TOTAL = '''||TRIM(V_TMP_TIPO_DATA(2))||''',
		    		USUARIOMODIFICAR = ''' || V_USUARIOMODIFICAR || ''',
			    	FECHAMODIFICAR   = SYSDATE
			    WHERE TBJ_NUM_TRABAJO = '''||TRIM(V_TMP_TIPO_DATA(1))||'''';	

		EXECUTE IMMEDIATE V_SQL;

        	V_COUNT := V_COUNT + 1;

	ELSE

		DBMS_OUTPUT.PUT_LINE('[INFO] El trabajo no existe!');
				
	END IF;
			    
		
     END LOOP;
    
     DBMS_OUTPUT.PUT_LINE('[INFO] '||V_COUNT||' REGISTROS ACTUALIZADOS.');  

     COMMIT;

     DBMS_OUTPUT.PUT_LINE('[FIN]');

EXCEPTION

    WHEN OTHERS THEN
        DBMS_OUTPUT.put_line('[ERROR] Se ha producido un error en la ejecucion:'||TO_CHAR(SQLCODE));
        DBMS_OUTPUT.put_line('-----------------------------------------------------------');
        DBMS_OUTPUT.put_line(SQLERRM);
        ROLLBACK;
        RAISE;
END;
/
EXIT
