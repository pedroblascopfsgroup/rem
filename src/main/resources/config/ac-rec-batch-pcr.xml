<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:si="http://www.springframework.org/schema/integration"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd 
                        http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-1.0.xsd 
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd"
	default-merge="true" default-autowire="byName">

	<!-- Sobreescribimos el batch.simpleJob para heredar de PFSStoppableSimpleJob en lugar de StoppableSimpleJob -->
	<bean id="batch.simpleJob" class="es.capgemini.pfs.batch.PFSStoppableSimpleJob" abstract="true">
		<property name="jobRepository" ref="batch.jobRepository" />
		<property name="restartable" value="true" />
	</bean>

    <bean id="pcrFileSourceGenerator" parent="batch.FolderFileSourceGenerator">
        <property name="inDir" value="${batch.pcr.in}" />
        <property name="filePattern" value="${batch.pcr.semaphore}" />
        <property name="period" value="${batch.pcr.period}" />
        <property name="channel" value="pcrFileInputChannel" />
        <property name="fileHandlerBeanName" value="pcrFileHandler" />
        <property name="fileHandlerMethodName" value="handle" />
        <property name="entityConcurrent" value="true" />
    </bean>
    
	<bean id="pcrFileHandler" class="es.capgemini.pfs.batch.load.pcr.PcrFileHandler" scope="prototype">
		<property name="cronExpression" value="0 0/1 * * * ?" />
		<property name="window" value="1" />
		<property name="channel" value="pcrFileInputChannel" />
	</bean>
	
	<!-- Reinsert files Subscriptor -->
	<bean id="validacionQueueSubscriptor"		parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="validacionPCRChannel" />
		<property name="beanName" value="validacionPCRHandler" />
		<property name="methodName" value="handle" />
	</bean>

	<bean id="validacionPCRHandler" class="es.capgemini.pfs.batch.load.pcr.ValidacionPCRHandler" scope="prototype">
		<property name="channel" value="validacionPCRChannel" />
	</bean>

	<!-- Subscribir un bean "pasajeProduccionHandler" por cada entidad al canal "pasajeProduccionChannel" -->
	<bean id="pasajeQueueSubscriptor" parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="pasajeProduccionChannel" />
		<property name="beanName" value="pasajeProduccionHandler" />
		<property name="methodName" value="handle" />
	</bean>


	<bean id="pasajeProduccionHandler"
		class="es.capgemini.pfs.batch.load.pcr.PasajeProduccionHandler"
		scope="prototype">
		<property name="channel" value="pasajeProduccionChannel" />
	</bean>

   <!-- Precalculo de valores estÃ¡ticos de la persona y contrato -->
   <bean id="precalculoQueueSubscriptor" parent="batch.QueueSubscriptorByFolderGenerator">
      <property name="channel" value="precalculoPCRProduccionChannel" />
      <property name="beanName" value="precalculoPCRProduccionHandler" />
      <property name="methodName" value="handle" />
   </bean>


   <bean id="precalculoPCRProduccionHandler" class="es.capgemini.pfs.batch.load.pcr.PrecalculoJobLauncher" scope="prototype">
      <property name="channel" value="precalculoPCRProduccionChannel" />
   </bean>

  <bean id="personasBatchDao" class="es.capgemini.pfs.batch.revisar.personas.dao.impl.PersonasBatchDaoImpl">
    <property name="dataSource" ref="entityDataSource" />
    <property name="updateFormulasPrecalculoPersonaQuery">
      <bean parent="sql" p:key="personas.precalculoFormulasQuery" />
    </property>
    <property name="updateFormulasPrecalculoGrupoQuery">
      <bean parent="sql" p:key="grupos.precalculoFormulasQuery" />
    </property>
    <property name="buscarArquetipoCalculadoQuery">
      <bean parent="sql" p:key="personas.buscarArquetipoCalculadoQuery" />
    </property>  
    <property name="buscarFuturosClientesSeguimientoQuery">
      <bean parent="sql" p:key="personas.buscarFuturosClientesSeguimientoQuery" />
    </property>      
    <property name="historificaPrepoliticasQuery">
      <bean parent="sql" p:key="personas.historificarPrepoliticasQuery" />
    </property>
    <property name="updateArquetiposPorCalculados">
      <bean parent="sql" p:key="personas.updateArquetiposPorCalculados" />
    </property>    
    <property name="buscarPersonasActivasQuery">
      <bean parent="sql" p:key="personas.buscarPersonasActivas" />
    </property>    
    <property name="buscarContratosQuery">
      <bean parent="sql" p:key="personas.buscarContratosActivos" />
    </property>           
  </bean>




	
	<bean id="analizeQueueSubscriptor" parent="batch.QueueSubscriptorByFolderGenerator">
		<property name="channel" value="analizePCRProduccionChannel" />
		<property name="beanName" value="analizePCRProduccionHandler" />
		<property name="methodName" value="handle" />
	</bean>


	<bean id="analizePCRProduccionHandler"
		class="es.capgemini.pfs.batch.load.pcr.AnalizePCRProduccionHandler"
		scope="prototype">
		<property name="channel" value="analizePCRProduccionChannel" />
	</bean>

</beans>