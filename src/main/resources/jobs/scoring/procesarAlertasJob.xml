<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:p="http://www.springframework.org/schema/p" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"
    default-autowire="byName" default-merge="true">

  <!-- Author: Andres Esteban -->
    <bean id="procesarAlertasJob" parent="batch.simpleJob" scope="prototype">
        <property name="steps">
            <list>
             	<bean id="procesar.alertas.valdidator" parent="batch.taskletStep" scope="prototype">
                    <property name="tasklet">
                        <bean parent="common.validator" scope="prototype">
                            <property name="validaciones">
                                <list>
                                    <ref bean="ale-31.existeRango" />
                                    <ref bean="ale-32.metricaValidas" />
                                </list>
                            </property>
                        </bean>
                    </property>
                </bean>
                <bean id="procesarAlertas.procesar" parent="batch.taskletStep" scope="prototype">
                    <property name="tasklet">
                        <bean class="es.capgemini.pfs.batch.scoring.ProcesarAlertasTasklet"/>
                    </property>
                </bean>
            </list>
        </property>
    </bean>
    
    <bean id="ale-31.existeRango" class="es.capgemini.pfs.batch.common.NumericResultValidatorTasklet" scope="prototype">
        <property name="dataSource" ref="entityDataSource" />
        <property name="query">
            <bean parent="sql" p:key="ale-31.existeRango" />
        </property>
        <property name="expectedNumber" value="1" />
        <property name="message" value="ale-31.existeRango" />
        <property name="severidad" value="error" />
    </bean>
    
     <bean id="ale-32.metricaValidas" class="es.capgemini.pfs.batch.common.BatchValidatorTasklet" scope="prototype">
        <property name="dataSource" ref="entityDataSource" />
        <property name="query">
            <bean parent="sql" p:key="ale-32.metricaValidas" />
        </property>
        <property name="expectedNumber" value="0" />
        <property name="message" value="ale-32.metricaValidas" />
        <property name="severidad" value="error" />
    </bean>
</beans>