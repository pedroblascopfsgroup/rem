-- NUEVAS COLUMNAS PARA LA TABLA TAR_TAREAS_NOTIFICACIONES PARA EL CONTROL DE LAS ALERTAS
ALTER TABLE PFS01.TAR_TAREAS_NOTIFICACIONES ADD (NFA_TAR_REVISADA NUMBER(1) );
ALTER TABLE PFS01.TAR_TAREAS_NOTIFICACIONES ADD (NFA_TAR_FECHA_REVIS_ALER TIMESTAMP(6));
ALTER TABLE PFS01.TAR_TAREAS_NOTIFICACIONES ADD (NFA_TAR_COMENTARIOS_ALERTA VARCHAR2(255 CHAR));

CREATE SEQUENCE PFS01.S_NFA_DD_TRA_TIPO_REVI_ALE
  START WITH 1
  MAXVALUE 999999999999999;
  
CREATE TABLE PFS01.NFA_DD_TRA_TIPO_REVI_ALE
(
  DD_TRA_ID                 NUMBER(16)          NOT NULL,
  DD_TRA_CODIGO             VARCHAR2(20 CHAR)   NOT NULL,
  DD_TRA_DESCRIPCION        VARCHAR2(50 CHAR),
  DD_TRA_DESCRIPCION_LARGA  VARCHAR2(250 CHAR),
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL,
  CONSTRAINT PK_DD_TRA_TIPO_REVI_ALE PRIMARY KEY (DD_TRA_ID),
  CONSTRAINT UK_DD_TRA_TIPO_REVI_ALE UNIQUE (DD_TRA_CODIGO)
);


-- NUEVAS COLUMNAS PARA LA TABLA TAR_TAREAS_NOTIFICACIONES PARA EL CONTROL DE LAS ALERTAS
ALTER TABLE PFS01.TAR_TAREAS_NOTIFICACIONES ADD (DD_TRA_ID NUMBER(16) );
ALTER TABLE PFS01.TAR_TAREAS_NOTIFICACIONES ADD (
  CONSTRAINT FK_TAR_DD_TRA_ID 
 FOREIGN KEY (DD_TRA_ID) 
 REFERENCES PFS01.NFA_DD_TRA_TIPO_REVI_ALE (DD_TRA_ID));
 
-- entradas en el dd
insert into PFS01.NFA_DD_TRA_TIPO_REVI_ALE(DD_TRA_ID,DD_TRA_CODIGO,DD_TRA_DESCRIPCION,DD_TRA_DESCRIPCION_LARGA,USUARIOCREAR,FECHACREAR)
values(PFS01.S_NFA_DD_TRA_TIPO_REVI_ALE.nextVal,'T01','Llamada', 'Llamada', 'DIA',SYSDATE );

insert into PFS01.NFA_DD_TRA_TIPO_REVI_ALE(DD_TRA_ID,DD_TRA_CODIGO,DD_TRA_DESCRIPCION,DD_TRA_DESCRIPCION_LARGA,USUARIOCREAR,FECHACREAR)
values(PFS01.S_NFA_DD_TRA_TIPO_REVI_ALE.nextVal,'T02','Envío mail', 'Envío mail', 'DIA',SYSDATE );

insert into PFS01.NFA_DD_TRA_TIPO_REVI_ALE(DD_TRA_ID,DD_TRA_CODIGO,DD_TRA_DESCRIPCION,DD_TRA_DESCRIPCION_LARGA,USUARIOCREAR,FECHACREAR)
values(PFS01.S_NFA_DD_TRA_TIPO_REVI_ALE.nextVal,'T03','Otros', 'Otros', 'DIA',SYSDATE );


-- PFS02

ALTER TABLE PFS02.TAR_TAREAS_NOTIFICACIONES ADD (NFA_TAR_REVISADA NUMBER(1) );
ALTER TABLE PFS02.TAR_TAREAS_NOTIFICACIONES ADD (NFA_TAR_FECHA_REVIS_ALER TIMESTAMP(6));
ALTER TABLE PFS02.TAR_TAREAS_NOTIFICACIONES ADD (NFA_TAR_COMENTARIOS_ALERTA VARCHAR2(255 CHAR));

CREATE SEQUENCE PFS02.S_NFA_DD_TRA_TIPO_REVI_ALE
  START WITH 1000000000000000
  MAXVALUE 9999999999999999;
  
CREATE TABLE PFS02.NFA_DD_TRA_TIPO_REVI_ALE
(
  DD_TRA_ID                 NUMBER(16)          NOT NULL,
  DD_TRA_CODIGO             VARCHAR2(20 CHAR)   NOT NULL,
  DD_TRA_DESCRIPCION        VARCHAR2(50 CHAR),
  DD_TRA_DESCRIPCION_LARGA  VARCHAR2(250 CHAR),
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL,
  CONSTRAINT PK_DD_TRA_TIPO_REVI_ALE PRIMARY KEY (DD_TRA_ID),
  CONSTRAINT UK_DD_TRA_TIPO_REVI_ALE UNIQUE (DD_TRA_CODIGO)
);


-- NUEVAS COLUMNAS PARA LA TABLA TAR_TAREAS_NOTIFICACIONES PARA EL CONTROL DE LAS ALERTAS
ALTER TABLE PFS02.TAR_TAREAS_NOTIFICACIONES ADD (DD_TRA_ID NUMBER(16) );
ALTER TABLE PFS02.TAR_TAREAS_NOTIFICACIONES ADD (
  CONSTRAINT FK_TAR_DD_TRA_ID 
 FOREIGN KEY (DD_TRA_ID) 
 REFERENCES PFS02.NFA_DD_TRA_TIPO_REVI_ALE (DD_TRA_ID));
 
-- entradas en el dd
insert into PFS02.NFA_DD_TRA_TIPO_REVI_ALE(DD_TRA_ID,DD_TRA_CODIGO,DD_TRA_DESCRIPCION,DD_TRA_DESCRIPCION_LARGA,USUARIOCREAR,FECHACREAR)
values(PFS02.S_NFA_DD_TRA_TIPO_REVI_ALE.nextVal,'T01','Llamada', 'Llamada', 'DIA',SYSDATE );

insert into PFS02.NFA_DD_TRA_TIPO_REVI_ALE(DD_TRA_ID,DD_TRA_CODIGO,DD_TRA_DESCRIPCION,DD_TRA_DESCRIPCION_LARGA,USUARIOCREAR,FECHACREAR)
values(PFS02.S_NFA_DD_TRA_TIPO_REVI_ALE.nextVal,'T02','Envío mail', 'Envío mail', 'DIA',SYSDATE );

insert into PFS02.NFA_DD_TRA_TIPO_REVI_ALE(DD_TRA_ID,DD_TRA_CODIGO,DD_TRA_DESCRIPCION,DD_TRA_DESCRIPCION_LARGA,USUARIOCREAR,FECHACREAR)
values(PFS02.S_NFA_DD_TRA_TIPO_REVI_ALE.nextVal,'T03','Otros', 'Otros', 'DIA',SYSDATE );

-- PFSMASTER

insert into PFSMASTER.fun_funciones (fun_id,fun_descripcion,fun_descripcion_larga,version,usuariocrear,fechacrear,borrado) values 
(PFSMASTER.s_fun_funciones.nextval, 'ROLE_REVISAR_ALERTA', 'Permiso para revisar y ver revisión de una tarea alertada',0,'AAS',sysdate,0);

insert into PFSMASTER.fun_funciones (fun_id,fun_descripcion,fun_descripcion_larga,version,usuariocrear,fechacrear,borrado) values 
(PFSMASTER.s_fun_funciones.nextval, 'ROLE_REVISAR_TAREA', 'Permiso para revisar y ver revisión de una tarea',0,'AAS',sysdate,0);

insert into PFSMASTER.fun_funciones (fun_id,fun_descripcion,fun_descripcion_larga,version,usuariocrear,fechacrear,borrado) values 
(PFSMASTER.s_fun_funciones.nextval, 'ROLE_REVISAR_NOTIFICACION', 'Permiso para revisar y ver revisión de una notificacion',0,'AAS',sysdate,0);

insert into PFSMASTER.fun_funciones (fun_id,fun_descripcion,fun_descripcion_larga,version,usuariocrear,fechacrear,borrado) values 
(PFSMASTER.s_fun_funciones.nextval, 'ROLE_REVISAR_ESPERA', 'Permiso para revisar y ver revisión de una tarea en espera',0,'AAS',sysdate,0);
