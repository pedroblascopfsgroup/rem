
-- INSERTAR COLUMNA DE PERMITIR AUTOPRORROGA EN TAREA-PROCEDIMIENTO

ALTER TABLE TAP_TAREA_PROCEDIMIENTO ADD (TAP_AUTOPRORROGA NUMBER(1) DEFAULT 1 NOT NULL);

ALTER TABLE TAP_TAREA_PROCEDIMIENTO ADD (DTYPE VARCHAR2 (30 CHAR) DEFAULT 'MEJTareaProcedimiento' NOT NULL);

UPDATE TAP_TAREA_PROCEDIMIENTO SET TAP_AUTOPRORROGA = 0;

-- en ciudad real ejecutar esto-----
--update tap_tarea_procedimiento set tap_autoprorroga=1 where tap_descripcion like '%Confirmar admisión de la demanda%';
--update tap_tarea_procedimiento set tap_autoprorroga=1 where tap_descripcion = 'Auto despachando ejecución';
--update tap_tarea_procedimiento set tap_autoprorroga=1 where tap_descripcion = 'Confirmar notificación demandado';

--update tap_tarea_procedimiento set tap_autoprorroga=0 where tap_descripcion = 'Confirmar notificación demandado';


-- REGISTRO DE EVENTOS
-- borrar tablas de registros

--DROP SEQUENCE S_MEJ_IRG_INFO_REGISTRO;
--DROP SEQUENCE S_MEJ_REG_REGISTRO;
--DROP SEQUENCE S_MEJ_DD_TRG_TIPO_REGISTRO;

--DROP TABLE MEJ_IRG_INFO_REGISTRO;
--DROP TABLE MEJ_REG_REGISTRO;
--DROP TABLE MEJ_DD_TRG_TIPO_REGISTRO;

--
-- Tipo de registro
CREATE SEQUENCE S_MEJ_DD_TRG_TIPO_REGISTRO
  START WITH 1
  MAXVALUE 999999999999999999999999999;
  
CREATE TABLE MEJ_DD_TRG_TIPO_REGISTRO
(
  DD_TRG_ID                 NUMBER(16)          NOT NULL,
  DD_TRG_CODIGO             VARCHAR2(20 CHAR)   NOT NULL,
  DD_TRG_DESCRIPCION        VARCHAR2(50 CHAR),
  DD_TRG_DESCRIPCION_LARGA  VARCHAR2(250 CHAR),
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0                     NOT NULL,
  CONSTRAINT PK_DD_TRG_TIPO_REGISTRO PRIMARY KEY (DD_TRG_ID),
  CONSTRAINT UK_DD_TRG_TIPO_REGISTRO UNIQUE (DD_TRG_CODIGO)
);

-- Registro
CREATE SEQUENCE S_MEJ_REG_REGISTRO
  START WITH 1
  MAXVALUE 999999999999999999999999999;
CREATE TABLE MEJ_REG_REGISTRO
(
  REG_ID                         NUMBER(16)     NOT NULL,
  DD_TRG_ID                      NUMBER(16)     NOT NULL,
  TRG_EIN_CODIGO                 VARCHAR2(20 CHAR)   NOT NULL,
  TRG_EIN_ID                     NUMBER(16)     NOT NULL,
  USU_ID                         NUMBER(16)     NOT NULL,
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0,
  CONSTRAINT PK_MEJ_REG_REGISTRO PRIMARY KEY (REG_ID),
  CONSTRAINT FK_MEJ_REG_FK_DD_TRG FOREIGN KEY (DD_TRG_ID) REFERENCES MEJ_DD_TRG_TIPO_REGISTRO (DD_TRG_ID),
  CONSTRAINT FK_MEJ_REG_USU_ID  FOREIGN KEY (USU_ID) REFERENCES PFSMASTER.USU_USUARIOS (USU_ID)
);

-- Info del registro
CREATE SEQUENCE S_MEJ_IRG_INFO_REGISTRO
  START WITH 1
  MAXVALUE 999999999999999999999999999;
CREATE TABLE MEJ_IRG_INFO_REGISTRO
(
  IRG_ID                         NUMBER(16)     NOT NULL,
  REG_ID                         NUMBER(16)     NOT NULL,
  IRG_CLAVE                      VARCHAR2(20 CHAR)   NOT NULL,
  IRG_VALOR                      VARCHAR2(100 CHAR),
  IRG_VALOR_CLOB                 CLOB,
  VERSION                   INTEGER             DEFAULT 0                     NOT NULL,
  USUARIOCREAR              VARCHAR2(10 CHAR)   NOT NULL,
  FECHACREAR                TIMESTAMP(6)        NOT NULL,
  USUARIOMODIFICAR          VARCHAR2(10 CHAR),
  FECHAMODIFICAR            TIMESTAMP(6),
  USUARIOBORRAR             VARCHAR2(10 CHAR),
  FECHABORRAR               TIMESTAMP(6),
  BORRADO                   NUMBER(1)           DEFAULT 0,
  CONSTRAINT PK_MEJ_IRG_INFO_REGISTRO PRIMARY KEY (IRG_ID),
  CONSTRAINT FK_MEJ_IRG_REG_ID  FOREIGN KEY (REG_ID) REFERENCES MEJ_REG_REGISTRO (REG_ID)
);

INSERT INTO MEJ_DD_TRG_TIPO_REGISTRO (DD_TRG_ID,DD_TRG_CODIGO,DD_TRG_DESCRIPCION,DD_TRG_DESCRIPCION_LARGA,VERSION,USUARIOCREAR,FECHACREAR,BORRADO) 
	VALUES(S_MEJ_DD_TRG_TIPO_REGISTRO.nextval,'EML','Envío correo','Envío correo',0,'MEJ',SYSDATE,0);

INSERT INTO MEJ_DD_TRG_TIPO_REGISTRO (DD_TRG_ID,DD_TRG_CODIGO,DD_TRG_DESCRIPCION,DD_TRG_DESCRIPCION_LARGA,VERSION,USUARIOCREAR,FECHACREAR,BORRADO) 
	VALUES(S_MEJ_DD_TRG_TIPO_REGISTRO.nextval,'ECA','Edición Cabecera Asunto','Editar Cabecera Asunto',0,'MEJ',SYSDATE,0);
	
INSERT INTO MEJ_DD_TRG_TIPO_REGISTRO (DD_TRG_ID,DD_TRG_CODIGO,DD_TRG_DESCRIPCION,DD_TRG_DESCRIPCION_LARGA,VERSION,USUARIOCREAR,FECHACREAR,BORRADO) 
	VALUES(S_MEJ_DD_TRG_TIPO_REGISTRO.nextval,'ECP','Edición Cabecera Procedimiento','Editar Cabecera Procedimiento',0,'MEJ',SYSDATE,0);

INSERT INTO MEJ_DD_TRG_TIPO_REGISTRO (DD_TRG_ID,DD_TRG_CODIGO,DD_TRG_DESCRIPCION,DD_TRG_DESCRIPCION_LARGA,VERSION,USUARIOCREAR,FECHACREAR,BORRADO) 
	VALUES(S_MEJ_DD_TRG_TIPO_REGISTRO.nextval,'AP','Auto prórroga','Auto prórroga',0,'MEJ',SYSDATE,0);

		
--  Añadir fecha vencimiento real a TareaNotificacion
ALTER TABLE TAR_TAREAS_NOTIFICACIONES ADD (TAR_FECHA_VENC_REAL TIMESTAMP(6));

UPDATE TAR_TAREAS_NOTIFICACIONES SET TAR_FECHA_VENC_REAL = TAR_FECHA_VENC;

ALTER TABLE TAR_TAREAS_NOTIFICACIONES ADD (DTYPE VARCHAR2 (30 CHAR) DEFAULT 'EXTTareaNotificacion' NOT NULL);

--UPDATE TAR_TAREAS_NOTIFICACIONES SET TAR_FECHA_VENC_REAL = TAR_FECHA_VENC where DTYPE ='TareaNotificacion';
--UPDATE TAR_TAREAS_NOTIFICACIONES SET DTYPE = 'EXTTareaNotificacion' where DTYPE ='TareaNotificacion';


--
-- DIAS FESTIVOS
--
CREATE SEQUENCE S_FES_FESTIVOS
  START WITH 1
  MAXVALUE 999999999999999999999999999;
CREATE TABLE FES_FESTIVOS
(
  FES_ID            NUMBER(16)              NOT NULL,
  FES_YEAR			NUMBER(16)              NOT NULL,
  FES_MONTH         NUMBER(16)              NOT NULL,
  FES_DAY_START     NUMBER(16)              NOT NULL,
  FES_DAY_END       NUMBER(16)              NOT NULL,
  VERSION               INTEGER                 DEFAULT 0                     NOT NULL,
  USUARIOCREAR          VARCHAR2(10 CHAR)       NOT NULL,
  FECHACREAR            TIMESTAMP(6)            NOT NULL,
  USUARIOMODIFICAR      VARCHAR2(10 CHAR),
  FECHAMODIFICAR        TIMESTAMP(6),
  USUARIOBORRAR         VARCHAR2(10 CHAR),
  FECHABORRAR           TIMESTAMP(6),
  BORRADO               NUMBER(1)               DEFAULT 0                     NOT NULL,
  CONSTRAINT PK_FES_FESTIVOS PRIMARY KEY (FES_ID)
);

	
