--******************************
-- ALIMENTACIÃ“N TABLA DE CONTRATOS
--******************************
INSERT INTO REC_FICHERO_CONTRATOS
SELECT DISTINCT
  TMP.RCF_AGE_ID
  , TMP.RCF_SCA_ID
  , CRC.CRC_ID_ENVIO AS ID_ENVIO
  , TMP.EXP_ID AS ID_EXPEDIENTE
  , CAR.RCF_CAR_ID AS ID_CARTERA
  , CAR.RCF_CAR_NOMBRE AS CARTERA_EXPEDIENTE
  , CNT.CNT_COD_ENTIDAD AS CODIGO_ENTIDAD
  , LPAD(OFI_AD.OFI_CODIGO_ENTIDAD_OFICINA, 5, '0')||LPAD(OFI_AD.OFI_CODIGO_OFICINA,4,'0')||LPAD(OFI_AD.OFI_CODIGO_SUBSECCION_OFICINA,2,'0') COD_ENTIDAD_OFI_ADMIN
  , OFI_AD.OFI_CODIGO COD_OFI_ADMIN
  , NVL(TRIM(REPLACE(TVD.DD_TVD_DESCRIPCION||' '||OFI_AD.OFI_DOMICILIO||' '||OFI_AD.OFI_NUM_DOMICILIO||' '||OFI_AD.OFI_CODIGO_POSTAL,'  ',' ')),'DESCONOCIDO') DIR_OFI_ADMIN						
  , INFO.CODIGO_PROPIETARIO CODIGO_PROPIETARIO	
  , INFO.TIPO_PRODUCTO TIPO_PRODUCTO
  , INFO.NUMERO_CONTRATO NUMERO_CONTRATO
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'NUMERO_ESPEC')) NUM_ESPEC
  , CNT.CNT_IBAN IBAN_CONTRATO			
  , CNT.CNT_CCC_DOMICILIACION CNT_DOMICILIACION
  , CNT.CNT_CCC_DOMICILIACION IBAN_CNT_DOMICILIACION
  , EFC.DD_EFC_CODIGO CD_SITUACION_CONTABLE
  , EFC.DD_EFC_DESCRIPCION SITUACION_CONTABLE
  , NVL(MOV.MOV_POS_VIVA_NO_VENCIDA,0) POS_VIVA_NO_VENCIDA
  , NVL(MOV.MOV_POS_VIVA_VENCIDA,0) POS_VIVA_VENCIDA	
  , NVL(MOV.MOV_INT_REMUNERATORIOS,0) INT_ORDIN_DEVEN		
  , NVL(MOV.MOV_INT_MORATORIOS,0) INT_MORAT_DEVEN		
  , NVL(MOV.MOV_COMISIONES,0) COMISIONES			
  , NVL(MOV.MOV_GASTOS,0) GASTOS
  , NVL(MOV.MOV_IMPUESTOS,0) IMPUESTOS				
  , NVL(MOV.MOV_ENTREGAS_A_CUENTA,0) ENTREGAS				
  , NVL(MOV.MOV_INTERESES_ENTREGAS,0) INT_ENTREGAS	
  , NVL(MOV.MOV_DEUDA_IRREGULAR,0) DEUDA_IRREGULAR	
  , NVL(CNT.CNT_LIMITE_INI,0) LIMITE_INICIAL		
  , NVL(CNT.CNT_LIMITE_FIN,0) LIMITE_ACTUAL			
  , TRUNC(CNT.CNT_FECHA_CREACION)  FECHA_CREACION
  , TRUNC(MOV.MOV_CNT_FECHA_INI_EPI_IRREG) FECHA_INI_IRREGU	
  , TRUNC(MOV.MOV_FECHA_POS_VENCIDA)  FECHA_POS_VENCIDA
  , CT1.DD_CT1_CODIGO CD_PRODUCTO_COMERCIAL
  , CT1.DD_CT1_DESCRIPCION CATALOGO1	
  , TPE.DD_TPE_CODIGO CATALOGO2
  , GC1.DD_GCN_CODIGO CD_GARANTIA1
  , GC1.DD_GCN_DESCRIPCION GARANTIA1
  , GC2.DD_GCN_CODIGO CD_GARANTIA2
  , GC2.DD_GCN_DESCRIPCION GARANTIA2
  , SAGER.SAGER_NOM_APE CONTACTO_ENTIDAD_NOMBRE	
  , SAGER.SAGER_TELEFONO CONTACTO_ENTIDAD_TEL	
  , SAGER.SAGER_EMAIL CONTACTO_ENTIDAD_EMAIL	
  , ${ddSituacionGestion.GestVencidos.codigo} SITUACION_GESTION
  , CNT.CNT_CUOTA_IMPORTE CUOTA_IMPORTE			
  , CNT.CNT_CUOTA_PERIODICIDAD CUOTA_PERIODICIDAD
  , FNO.DD_FNO_CODIGO CD_FINALIDAD
  , FNO.DD_FNO_DESCRIPCION DESC_OFICIAL_FINALIDAD	
  , TRUNC(CNT.CNT_FECHA_VENC) FECHA_VENCIMIENTO			
  , SAM.DD_SAM_CODIGO CD_SISTEMA_AMORTIZACION	
  , SAM.DD_SAM_DESCRIPCION_LARGA SISTEMA_AMORTIZACION	
  , NVL(CNT.CNT_TIPO_INTERES,0) TIPO_INTERES
  , CASE WHEN ITV.RCF_ITV_NO_GEST IS NOT NULL THEN TRUNC(CRE.CRE_FECHA_ALTA + ITV.RCF_ITV_NO_GEST) ELSE NULL END FECHA_PLAZO_MINIMO_GESTION
  , CASE WHEN CBP.RCF_MVL_DIAS_ENT IS NOT NULL THEN TRUNC(CRC.CRC_FECHA_ALTA + CBP.RCF_MVL_DIAS_ENT) ELSE NULL END FECHA_MAX_COBRO_PARCIAL
  , CASE WHEN CBT.RCF_MVL_DIAS_ENT IS NOT NULL THEN TRUNC(CRC.CRC_FECHA_ALTA + CBT.RCF_MVL_DIAS_ENT) ELSE TRUNC(SYSDATE + 60) END FECHA_MAX_REGULARIZACION
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra1')),'dd/MM/rrrr') FECHA_EXTRA1		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra2')),'dd/MM/rrrr') FECHA_EXTRA2		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra3')),'dd/MM/rrrr') FECHA_EXTRA3		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra4')),'dd/MM/rrrr') FECHA_EXTRA4		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra5')),'dd/MM/rrrr') FECHA_EXTRA5		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra6')),'dd/MM/rrrr') FECHA_EXTRA6	
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra7')),'dd/MM/rrrr') FECHA_EXTRA7		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra8')),'dd/MM/rrrr') FECHA_EXTRA8		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra9')),'dd/MM/rrrr') FECHA_EXTRA9		
  , TO_DATE((SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'date_extra10')),'dd/MM/rrrr') FECHA_EXTRA10		
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra1')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''') NUMERO_EXTRA1
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra2')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA2
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra3')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA3
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra4')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA4
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra5')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA5
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra6')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA6
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra7')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA7
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra8')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA8
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra9')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA9
  , TO_NUMBER((SELECT REPLACE(IAC_VALUE,',','.') FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra10')),'99999999D999999','NLS_NUMERIC_CHARACTERS = ''.,''')NUMERO_EXTRA10
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra1')) LCHAR_EXTRA1
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra2')) LCHAR_EXTRA2
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra3')) LCHAR_EXTRA3
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra4')) LCHAR_EXTRA4
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra5')) LCHAR_EXTRA5
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra6')) LCHAR_EXTRA6
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra7')) LCHAR_EXTRA7
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra8')) LCHAR_EXTRA8
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra9')) LCHAR_EXTRA9
  , (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'lchar_extra10')) LCHAR_EXTRA10
FROM (SELECT DISTINCT RCF_AGE_ID, RCF_SCA_ID, EXP_ID, CNT_ID, GES_ID FROM TMP_REC_EXP_AGE_CNT_EXC) TMP
    JOIN CRE_CICLO_RECOBRO_EXP CRE ON TMP.EXP_ID = CRE.EXP_ID AND CRE.CRE_FECHA_BAJA IS NULL AND CRE.BORRADO = ${borrado.no.id}
    JOIN CRC_CICLO_RECOBRO_CNT CRC ON CRE.CRE_ID = CRC.CRE_ID AND TMP.CNT_ID = CRC.CNT_ID AND CRC.CRC_FECHA_BAJA IS NULL AND CRC.BORRADO = ${borrado.no.id}
    JOIN RCF_ESC_ESQUEMA_CARTERAS ESC ON CRE.RCF_ESC_ID = ESC.RCF_ESC_ID
    JOIN RCF_CAR_CARTERA CAR ON ESC.RCF_CAR_ID = CAR.RCF_CAR_ID
    JOIN CNT_CONTRATOS CNT ON TMP.CNT_ID = CNT.CNT_ID
		LEFT JOIN DD_SAM_SIST_AMORT_CONTRATO SAM ON SAM.BORRADO = ${borrado.no.id} AND SAM.DD_SAM_ID = CNT.CNT_SISTEMA_AMORTIZACION    
    JOIN RCF_SCA_SUBCARTERA SCA ON CRE.RCF_SCA_ID = SCA.RCF_SCA_ID
    JOIN RCF_ITV_ITI_METAS_VOLANTES ITV ON SCA.RCF_ITV_ID = ITV.RCF_ITV_ID
    LEFT JOIN (SELECT * FROM RCF_MVL_META_VOLANTE WHERE RCF_DD_MET_ID IN (SELECT RCF_DD_MET_ID FROM RCF_DD_MET_META_VOLANTE WHERE RCF_DD_MET_CODIGO = 'CBP')) CBP ON ITV.RCF_ITV_ID = CBP.RCF_ITV_ID
    LEFT JOIN (SELECT * FROM RCF_MVL_META_VOLANTE WHERE RCF_DD_MET_ID IN (SELECT RCF_DD_MET_ID FROM RCF_DD_MET_META_VOLANTE WHERE RCF_DD_MET_CODIGO = 'CBT')) CBT ON ITV.RCF_ITV_ID = CBT.RCF_ITV_ID
    JOIN MOV_MOVIMIENTOS MOV ON CNT.CNT_ID = MOV.CNT_ID AND CNT.CNT_FECHA_EXTRACCION = MOV.MOV_FECHA_EXTRACCION
    JOIN OFI_OFICINAS OFI_AD ON CNT.OFI_ID_ADMIN = OFI_AD.OFI_ID
      LEFT JOIN DD_TVD_TIPO_VIA_DIRECCION TVD ON TVD.BORRADO = ${borrado.no.id} AND OFI_AD.DD_TIPO_VIA = TVD.DD_TVD_ID    
    JOIN DD_EFC_ESTADO_FINAN_CNT EFC ON CNT.DD_EFC_ID = EFC.DD_EFC_ID
    JOIN DD_TPE_TIPO_PROD_ENTIDAD TPE ON CNT.DD_TPE_ID = TPE.DD_TPE_ID
    JOIN DD_CT1_CATALOGO_1 CT1 ON CNT.DD_CT1_ID = CT1.DD_CT1_ID
    JOIN DD_CT2_CATALOGO_2 CT2 ON CNT.DD_CT2_ID = CT2.DD_CT2_ID
    JOIN BATCH_DATOS_CNT_INFO INFO ON CNT.CNT_ID = INFO.CNT_ID
    LEFT JOIN DD_CT3_CATALOGO_3 CT3 ON CNT.DD_CT3_ID = CT3.DD_CT3_ID
    LEFT JOIN DD_CT4_CATALOGO_4 CT4 ON CNT.DD_CT4_ID = CT4.DD_CT4_ID
    LEFT JOIN DD_CT5_CATALOGO_5 CT5 ON CNT.DD_CT5_ID = CT5.DD_CT5_ID
    LEFT JOIN DD_CT6_CATALOGO_6 CT6 ON CNT.DD_CT6_ID = CT6.DD_CT6_ID
    LEFT JOIN DD_GCN_GARANTIA_CONTRATO GC1 ON CNT.DD_GC1_ID = GC1.DD_GCN_ID
    LEFT JOIN DD_GCN_GARANTIA_CONTRATO GC2 ON CNT.DD_GC2_ID = GC2.DD_GCN_ID
    LEFT JOIN DD_FNO_FINALIDAD_OFICIAL FNO ON CNT.DD_FNO_ID = FNO.DD_FNO_ID
    JOIN TMP_SAGER_INFO SAGER ON TMP.EXP_ID = SAGER.EXP_ID;
    
--******************************
-- ALIMENTACIÃ“N TABLA DE PERSONAS
--******************************
INSERT INTO REC_FICHERO_PERSONAS
SELECT distinct 
    TMP.RCF_AGE_ID			
    , PRO.DD_PRO_CODIGO CODIGO_PROPIETARIO	
    , PER.PER_COD_CLIENTE_ENTIDAD CODIGO_PERSONA			
    , TO_NUMBER(TPE.DD_TPE_CODIGO) TIPO_PERSONA			
    , TDI.DD_TDI_CODIGO TIPO_DOCUMENTO	
    , TDI.DD_TDI_DESCRIPCION DS_TIPO_DOCUMENTO		
    , PER.PER_DOC_ID NIF_CIF_PASAP_NIE		
    , PER.PER_NOMBRE NOMBRE				
    , PER.PER_APELLIDO1 APELLIDO1			
    , PER.PER_APELLIDO2 APELLIDO2
    , SCE.DD_SCE_CODIGO CD_SEGMENTO_CLIENTE_1	
    , SCE.DD_SCE_DESCRIPCION SEGMENTO_CLIENTE_1	
    , PER.PER_FECHA_CONSTITUCION FECHA_CONSTITUCION	
    , PER.PER_FECHA_NACIMIENTO FECHA_NACIMIENTO		
    , CIC.DD_CIC_CODIGO CD_NACIONALIDAD	  
    , CIC.DD_CIC_DESCRIPCION NACIONALIDAD		
    , PER.PER_SEXO SEXO	
    , PER.PER_EMAIL CORREO_ELECTRONICO			
    , NVL(PER.PER_PASIVO_VISTA,0) SALDO_PASIVO
    , NVL(PER.PER_RIESGO,0) RIESGO_DIRECTO_CLIENTE	
    , NVL(PER.PER_RIESGO_IND,0) RIESGO_INDIRECTO_CLIENTE		
    , NVL(PER.PER_RIESGO,0) - NVL(PER.PER_RIESGO_DIR_VENCIDO,0) RIESGO_DIRECTO_IRREGULAR_CLI		
    , NVL(PER.PER_RIESGO_DIR_VENCIDO,0) RIESGO_INDIRECTO_IRREGULAR_CLI		
    , (SELECT SUM(GCL.GCL_RIESGO_DIR_VENCIDO) FROM PER_GCL PERGCL LEFT JOIN GCL_GRUPOS_CLIENTES GCL ON GCL.BORRADO = 0 AND GCL.GCL_ID = PERGCL.GCL_ID WHERE PERGCL.BORRADO = ${borrado.no.id} AND PERGCL.PER_ID = PER.PER_ID) RIESG_DIRECT_IRREG_GRUPO		
    , (SELECT SUM(GCL.GCL_RIESGO_INDIR) FROM PER_GCL PERGCL LEFT JOIN GCL_GRUPOS_CLIENTES GCL ON GCL.BORRADO = 0 AND GCL.GCL_ID = PERGCL.GCL_ID WHERE PERGCL.BORRADO = ${borrado.no.id} AND PERGCL.PER_ID = PER.PER_ID) RIESG_INDIRECT_IRREG_GRUPO		
    , to_char(NVL(PER.PER_FECHA_DATO,PER.PER_FECHA_EXTRACCION),'ddMMyyyy') ULTIMA_ACTUACION		
    , TMP.GES_ID GESTION_COMPARTIDA	
    , TO_DATE((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'date_extra1')),'dd/MM/rrrr') FECHA_EXTRA1		
    , TO_DATE((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'date_extra2')),'dd/MM/rrrr') FECHA_EXTRA2		
    , TO_DATE((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'date_extra3')),'dd/MM/rrrr') FECHA_EXTRA3		
    , TO_DATE((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'date_extra4')),'dd/MM/rrrr') FECHA_EXTRA4		
    , TO_DATE((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'date_extra5')),'dd/MM/rrrr') FECHA_EXTRA5
	, TO_NUMBER((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'num_extra1'))) NUMERO_EXTRA1
    , TO_NUMBER((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'num_extra2'))) NUMERO_EXTRA2
    , TO_NUMBER((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'num_extra3'))) NUMERO_EXTRA3
    , TO_NUMBER((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'num_extra4'))) NUMERO_EXTRA4
    , TO_NUMBER((SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'num_extra5'))) NUMERO_EXTRA5
	, (SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'lchar_extra1')) LCHAR_EXTRA1
    , (SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'lchar_extra2')) LCHAR_EXTRA2
    , (SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'lchar_extra3')) LCHAR_EXTRA3
    , (SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'lchar_extra4')) LCHAR_EXTRA4
    , (SELECT ICC_VALUE FROM EXT_ICC_INFO_EXTRA_CLI WHERE PER_ID = PER.PER_ID AND DD_IFX_ID = (SELECT DD_IFX_ID FROM EXT_DD_IFX_INFO_EXTRA_CLI WHERE DD_IFX_CODIGO = 'lchar_extra5')) LCHAR_EXTRA5
FROM TMP_REC_EXP_AGE_MAR_GES TMP
  JOIN PER_PERSONAS PER ON TMP.PER_ID = PER.PER_ID
  LEFT JOIN ${master.schema}.DD_CIC_CODIGO_ISO_CIRBE CIC ON CIC.BORRADO = ${borrado.no.id} AND PER.PER_NACIONALIDAD = CIC.DD_CIC_ID  
  JOIN DD_PRO_PROPIETARIOS PRO ON PER.DD_PRO_ID = PRO.DD_PRO_ID
  JOIN CRE_CICLO_RECOBRO_EXP CRE ON TMP.EXP_ID = CRE.EXP_ID AND CRE.CRE_FECHA_BAJA IS NULL AND CRE.BORRADO = ${borrado.no.id}
  JOIN CRP_CICLO_RECOBRO_PER CRP ON CRE.CRE_ID = CRP.CRE_ID AND TMP.PER_ID = CRP.PER_ID AND CRP.CRP_FECHA_BAJA IS NULL  AND CRP.BORRADO = ${borrado.no.id}
  JOIN ${master.schema}.DD_TPE_TIPO_PERSONA TPE ON PER.DD_TPE_ID = TPE.DD_TPE_ID
  JOIN DD_TDI_TIPO_DOCUMENTO_ID TDI ON PER.DD_TDI_ID = TDI.DD_TDI_ID
  JOIN DD_SCE_SEGTO_CLI_ENTIDAD SCE ON PER.DD_SCE_ID = SCE.DD_SCE_ID;
  
  
--*****************************************
-- ALIMENTACIÃ“N TABLA DE CONTRATOS_PERSONAS
--*****************************************
INSERT INTO REC_FICHERO_CONTRATOS_PERSONAS
SELECT DISTINCT
    CRE.RCF_AGE_ID
    , CRC.CRC_ID_ENVIO ID_ENVIO
    , REC_CNT.CODIGO_PROPIETARIO
    , PER.PER_COD_CLIENTE_ENTIDAD CODIGO_PERSONA
    , TIN.DD_TIN_CODIGO CD_TIPO_INTERVENCION
    , TIN.DD_TIN_DESCRIPCION TIPO_INTERVENCION
    , CPE.CPE_ORDEN ORDEN
	  , NULL FECHA_EXTRA1
	  , NULL FECHA_EXTRA2
	  , NULL FECHA_EXTRA3
	  , NULL FECHA_EXTRA4
	  , NULL FECHA_EXTRA5
	  , NULL NUMERO_EXTRA1
	  , NULL NUMERO_EXTRA2
    , NULL NUMERO_EXTRA3
    , NULL NUMERO_EXTRA4
    , NULL NUMERO_EXTRA5
	  , NULL LCHAR_EXTRA1
	  , NULL LCHAR_EXTRA2
	  , NULL LCHAR_EXTRA3
	  , NULL LCHAR_EXTRA4
	  , NULL LCHAR_EXTRA5
FROM (SELECT DISTINCT RCF_AGE_ID, RCF_SCA_ID, EXP_ID, CNT_ID FROM TMP_REC_EXP_AGE_CNT_EXC) TMP
    JOIN CRE_CICLO_RECOBRO_EXP CRE ON TMP.EXP_ID = CRE.EXP_ID AND CRE.CRE_FECHA_BAJA IS NULL AND CRE.BORRADO = 0
    JOIN CRC_CICLO_RECOBRO_CNT CRC ON CRE.CRE_ID = CRC.CRE_ID AND TMP.CNT_ID = CRC.CNT_ID AND CRC.CRC_FECHA_BAJA IS NULL AND CRC.BORRADO = 0
    -- cex es para validar que el contrto estÃ© en el expediente
    JOIN CEX_CONTRATOS_EXPEDIENTE CEX ON CRC.CNT_ID = CEX.CNT_ID AND TMP.EXP_ID = CEX.EXP_ID AND CEX.BORRADO = 0
    JOIN REC_FICHERO_CONTRATOS REC_CNT ON CRC.CRC_ID_ENVIO = REC_CNT.ID_ENVIO
    JOIN CPE_CONTRATOS_PERSONAS CPE ON TMP.CNT_ID = CPE.CNT_ID AND CPE.BORRADO = 0
    -- pex es para validar que la persona tambiÃ©n estÃ¡ asociada al expediente
    JOIN PEX_PERSONAS_EXPEDIENTE PEX ON CPE.PER_ID = PEX.PER_ID AND TMP.EXP_ID = PEX.EXP_ID AND PEX.BORRADO = 0
    JOIN CRP_CICLO_RECOBRO_PER CRP ON PEX.PER_ID = CRP.PER_ID AND CRP.CRE_ID = CRE.CRE_ID AND CRP.CRP_FECHA_BAJA IS NULL AND CRP.BORRADO = 0
    JOIN PER_PERSONAS PER ON CPE.PER_ID = PER.PER_ID
    JOIN REC_FICHERO_PERSONAS REC_PER ON PER.PER_COD_CLIENTE_ENTIDAD = REC_PER.CODIGO_PERSONA
    JOIN DD_TIN_TIPO_INTERVENCION TIN ON CPE.DD_TIN_ID = TIN.DD_TIN_ID;  


--******************************
-- ALIMENTACIÃ“N TABLA DE BAJAS
--******************************
INSERT INTO REC_FICHERO_CONTRATOS_BAJAS 
SELECT
  TMP.RCF_AGE_ID
	, to_number(to_char(TRUNC(sysdate-(40 + DBMS_RANDOM.VALUE(1, 30))), 'yyyyMMdd') || TMP.CNT_ID) ID_ENVIO
	, TRUNC(SYSDATE) FECHA_BAJA
	, MOB.DD_MOB_CODIGO MOTIVO_BAJA
  , NULL FECHA_EXTRA1
  , NULL FECHA_EXTRA2
	, NULL FECHA_EXTRA3
	, NULL FECHA_EXTRA4
	, NULL FECHA_EXTRA5
	, NULL NUMERO_EXTRA1
	, NULL NUMERO_EXTRA2
  , NULL NUMERO_EXTRA3
  , NULL NUMERO_EXTRA4
  , NULL NUMERO_EXTRA5
	, NULL LCHAR_EXTRA1
	, NULL LCHAR_EXTRA2
	, NULL LCHAR_EXTRA3
	, NULL LCHAR_EXTRA4
	, NULL LCHAR_EXTRA5
FROM TMP_REC_CONTRATOS_BAJA_MOT TMP
  JOIN ${master.schema}.DD_MOB_MOTIVOS_BAJA MOB ON TMP.DD_MOB_ID = MOB.DD_MOB_ID;


--******************************
-- ALIMENTACIÃ“N TABLA DE DIRECCIONES
--******************************
INSERT INTO REC_FICHERO_DIRECCIONES
SELECT DISTINCT 
  TMP.RCF_AGE_ID
	, REC_PER.CODIGO_PROPIETARIO
	, REC_PER.CODIGO_PERSONA
	, DIR.DIR_COD_DIRECCION CODIGO_DIRECCION
  , TVI.DD_TVI_CODIGO CD_TIPO_VIA
  , TVI.DD_TVI_DESCRIPCION TIPO_VIA
	, DIR.DIR_DOMICILIO NOMBRE_VIA
	, DIR.DIR_DOM_N NUM_DOMICILIO
	, DIR.DIR_DOM_PORTAL PORTAL
	, DIR.DIR_DOM_PISO PISO
	, DIR.DIR_DOM_ESC ESCALERA
	, DIR.DIR_DOM_PUERTA PUERTA
	, LOC.DD_LOC_CODIGO CODIGO_POSTAL
  , UPPER(PRV.DD_PRV_CODIGO) CD_PROVINCIA
	, UPPER(PRV.DD_PRV_DESCRIPCION) PROVINCIA
  , UPPER(LOC.DD_LOC_CODIGO) CD_POBLACION
	, UPPER(LOC.DD_LOC_DESCRIPCION) POBLACION
  , UPPER(LOC.DD_LOC_CODIGO)  CD_MUNICIPIO
	, UPPER(LOC.DD_LOC_DESCRIPCION)  MUNICIPIO
	, NULL DIRECCION_PRINCIPAL
	, NULL CD_ESTADO_DIRECCION
  , NULL ESTADO_DIRECCION
  , TPD.TPD_CODIGO CD_TIPO_DIRECCION
	, TPD.TPD_DESCRIPCION TIPO_DIRECCION
	, NULL DIRECCION_BLOQUEADA
	, NULL FECHA_EXTRA1
  , NULL FECHA_EXTRA2
	, NULL FECHA_EXTRA3
	, NULL FECHA_EXTRA4
	, NULL FECHA_EXTRA5
	, NULL NUMERO_EXTRA1
	, NULL NUMERO_EXTRA2
  , NULL NUMERO_EXTRA3
  , NULL NUMERO_EXTRA4
  , NULL NUMERO_EXTRA5
	, NULL LCHAR_EXTRA1
	, NULL LCHAR_EXTRA2
	, NULL LCHAR_EXTRA3
	, NULL LCHAR_EXTRA4
	, NULL LCHAR_EXTRA5
FROM TMP_REC_EXP_AGE_MAR_GES TMP
    JOIN PER_PERSONAS PER ON TMP.PER_ID = PER.PER_ID
    JOIN CRE_CICLO_RECOBRO_EXP CRE ON TMP.EXP_ID = CRE.EXP_ID AND CRE.CRE_FECHA_BAJA IS NULL AND CRE.BORRADO = ${borrado.no.id}
    JOIN CRP_CICLO_RECOBRO_PER CRP ON CRE.CRE_ID = CRP.CRE_ID AND TMP.PER_ID = CRP.PER_ID AND CRP.CRP_FECHA_BAJA IS NULL  AND CRP.BORRADO = ${borrado.no.id}
    JOIN DIR_PER ON PER.PER_ID = DIR_PER.PER_ID AND DIR_PER.BORRADO = ${borrado.no.id}
    JOIN DIR_DIRECCIONES DIR ON DIR_PER.DIR_ID = DIR.DIR_ID AND DIR.BORRADO = ${borrado.no.id}
		LEFT JOIN TPD_TIPO_DIRECCIONES TPD ON TPD.BORRADO = ${borrado.no.id} AND TPD.TPD_ID = DIR.TPD_ID    
    JOIN REC_FICHERO_PERSONAS REC_PER ON PER.PER_COD_CLIENTE_ENTIDAD = REC_PER.CODIGO_PERSONA
    JOIN ${master.schema}.DD_LOC_LOCALIDAD LOC ON LOC.DD_LOC_ID = DIR.DD_LOC_ID
    JOIN ${master.schema}.DD_PRV_PROVINCIA PRV ON LOC.DD_PRV_ID = PRV.DD_PRV_ID
    JOIN ${master.schema}.DD_TVI_TIPO_VIA TVI ON DIR.DD_TVI_ID = TVI.DD_TVI_ID;


--******************************
-- ALIMENTACIÃ“N TABLA DE TELEFONOS
--******************************
INSERT INTO REC_FICHERO_TELEFONOS
SELECT 
  TMP.RCF_AGE_ID
	, REC_PER.CODIGO_PROPIETARIO
	, REC_PER.CODIGO_PERSONA CODIGO_PERSONA
	, TEL.TEL_TELEFONO TELEFONO
	, TTE.DD_TTE_CODIGO CD_TIPO_TELEFONO
  , TTE.DD_TTE_DESCRIPCION TIPO_TELEFONO
	, CASE TEL.TEL_CONSENTIMIENTO WHEN 0 THEN 1 ELSE 0 END TELEFONO_BLOQUEADO
	, NULL ULTIMO_CONTACTO
	, OTE.DD_OTE_CODIGO ORIGEN_TELEFONO
	, NULL BBDD_ORIGEN_TELEFONO
	, NULL FECHA_EXP_VIGENCIA_TEL4   
	, NULL FECHA_EXTRA1
  , NULL FECHA_EXTRA2
	, NULL FECHA_EXTRA3
	, NULL FECHA_EXTRA4
	, NULL FECHA_EXTRA5
	, NULL NUMERO_EXTRA1
	, NULL NUMERO_EXTRA2
  , NULL NUMERO_EXTRA3
  , NULL NUMERO_EXTRA4
  , NULL NUMERO_EXTRA5
	, NULL LCHAR_EXTRA1
	, NULL LCHAR_EXTRA2
	, NULL LCHAR_EXTRA3
	, NULL LCHAR_EXTRA4
	, NULL LCHAR_EXTRA5
FROM TMP_REC_EXP_AGE_MAR_GES TMP
    JOIN PER_PERSONAS PER ON TMP.PER_ID = PER.PER_ID
    JOIN CRE_CICLO_RECOBRO_EXP CRE ON TMP.EXP_ID = CRE.EXP_ID AND CRE.CRE_FECHA_BAJA IS NULL AND CRE.BORRADO = 0
    JOIN CRP_CICLO_RECOBRO_PER CRP ON CRE.CRE_ID = CRP.CRE_ID AND TMP.PER_ID = CRP.PER_ID AND CRP.CRP_FECHA_BAJA IS NULL  AND CRP.BORRADO = 0
    JOIN DIR_PER ON PER.PER_ID = DIR_PER.PER_ID AND DIR_PER.BORRADO = 0
    JOIN TEL_PER ON PER.PER_ID = TEL_PER.PER_ID AND TEL_PER.BORRADO = 0
    JOIN TEL_TELEFONOS TEL ON TEL_PER.TEL_ID = TEL.TEL_ID AND TEL.BORRADO = 0
    JOIN REC_FICHERO_PERSONAS REC_PER ON PER.PER_COD_CLIENTE_ENTIDAD = REC_PER.CODIGO_PERSONA
    LEFT JOIN DD_TTE_TIPO_TELEFONO TTE ON TEL.DD_TTE_ID = TTE.DD_TTE_ID
    LEFT JOIN DD_OTE_ORIGEN_TELEFONO OTE ON TEL.DD_OTE_ID = OTE.DD_OTE_ID;


--******************************
-- ALIMENTACIÃ“N TABLA DE RECIBOS
--******************************
INSERT INTO REC_FICHERO_RECIBOS
SELECT DISTINCT AG.RCF_AGE_ID
  , REC.REC_ID ID_RECIBO
  , CRC.CRC_ID_ENVIO ID_ENVIO
  , REC.REC_CODIGO_RECIBO CODIGO_RECIBO
  , REC.REC_FECHA_VENCIMIENTO FECHA_VENCIMIENTO
  , REC.REC_FECHA_FACTURACION FECHA_FACTURACION
  , TRE.DD_TRE_CODIGO CD_TIPO_DE_RECIBO
  , TRE.DD_TRE_DESCRIPCION TIPO_DE_RECIBO
  , REC.REC_TIPO_INTERES TIPO_INTERES
  , SIR.DD_SIR_CODIGO CD_SITUACION_RECIBO
  , SIR.DD_SIR_DESCRIPCION SITUACION_RECIBO
  , REC.REC_IMPORTE_RECIBO IMPORTE_RECIBO
  , REC.REC_IMPORTE_IMPAGADO IMPORTE_IMPAGADO
  , REC.REC_CAPITAL CAPITAL
  , REC.REC_INTERESES_ORDINAR INT_ORDIN_DEVEN
  , REC.REC_INTERESES_MORATOR INT_MORAT_DEVEN
  , REC.REC_COMISIONES COMISIONES
  , REC.REC_GASTOS_NO_COBRADOS GASTOS_NO_COBRADOS
  , REC.REC_IMPUESTOS
  , REC.REC_DATE_EXTRA1 FECHA_EXTRA1
  , REC.REC_DATE_EXTRA2 FECHA_EXTRA2
  , NULL FECHA_EXTRA3
  , NULL FECHA_EXTRA4
  , NULL FECHA_EXTRA5
  , REC.REC_NUM_EXTRA1 NUM_EXTRA1
  , REC.REC_NUM_EXTRA2 NUM_EXTRA2
  , NULL NUM_EXTRA3
  , NULL NUM_EXTRA4
  , NULL NUM_EXTRA5
  , REC.REC_CHAR_EXTRA1 LCHAR_EXTRA1
  , REC.REC_CHAR_EXTRA2 LCHAR_EXTRA2
  , NULL LCHAR_EXTRA3
  , NULL LCHAR_EXTRA4
  , NULL LCHAR_EXTRA5
FROM REC_FICHERO_CONTRATOS AG
  JOIN CRC_CICLO_RECOBRO_CNT CRC ON AG.ID_ENVIO = CRC.CRC_ID_ENVIO AND CRC.BORRADO = 0 AND CRC.CRC_FECHA_BAJA IS NULL
  JOIN REC_RECIBOS REC ON CRC.CNT_ID = REC.CNT_ID
  LEFT JOIN DD_TRE_TIPO_RECIBO TRE ON REC.DD_TRE_ID = TRE.DD_TRE_ID
  LEFT JOIN DD_SIR_SITUACION_RECIBO SIR ON REC.DD_SIR_ID = SIR.DD_SIR_ID
WHERE REC.BORRADO = 0;
  

--******************************
-- ALIMENTACIÃ“N TABLA DE EFECTOS
--******************************
INSERT INTO REC_FICHERO_EFECTOS
SELECT DISTINCT AG.RCF_AGE_ID
  , CRC.CRC_ID_ENVIO ID_ENVIO
  , EFC.EFC_ID ID_EFECTO
  , EFC.EFC_CODIGO_LINEA CODIGO_LINEA
  , EFC.EFC_CODIGO_ACUERDO CODIGO_ACUERDO
  , TEF.DD_TEF_CODIGO CD_TIPO_EFECTO
  , TEF.DD_TEF_DESCRIPCION TIPO_EFECTO
  , SEF.DD_SEF_CODIGO CD_SITUACION_EFECTO
  , SEF.DD_SEF_DESCRIPCION SITUACION_EFECTO
  , MON.DD_MON_CODIGO CD_MONEDA_EFECTO
  , MON.DD_MON_DESCRIPCION MONEDA_EFECTO
  , EFC.EFC_IMPORTE_EFECTO IMPORTE_EFECTO
  , EFC.EFC_CAPITAL CAPITAL
  , EFC.EFC_INT_ORDIN_DEVEN INT_ORDIN_DEVEN_HASTA_DIA
  , EFC.EFC_INT_ORDIN_MORAT INT_MORAT_DEVEN_HASTA_DIA
  , EFC.EFC_COMISIONES COMISIONES
  , EFC.EFC_GASTOS_NO_COBRADOS GASTOS_INCURRIDOS_NO_COBRADOS
  , EFC.EFC_IMPUESTOS IMPUESTOS
  , EFC.EFC_FECHA_DESCUENTO FECHA_DESCUENTO_EFECTO
  , TFV.DD_TFV_CODIGO CD_TIPO_FECHA_VENCIMIENTO
  , TFV.DD_TFV_DESCRIPCION TIPO_FECHA_VENCIMIENTO
  , EFC.EFC_FECHA_VENCIMIENTO FECHA_VENCIMIENTO_EFECTO
  , EFC.EFC_CHAR_EXTRA1 CHAR_EXTRA1
  , EFC.EFC_CHAR_EXTRA2 CHAR_EXTRA2
  , EFC.EFC_FLAG_EXTRA1 FLAG_EXTRA1
  , EFC.EFC_FLAG_EXTRA2 FLAG_EXTRA2
  , EFC.EFC_DATE_EXTRA1 DATE_EXTRA1
  , EFC.EFC_DATE_EXTRA2 DATE_EXTRA2
  , EFC.EFC_NUM_EXTRA1 NUM_EXTRA1
  , EFC.EFC_NUM_EXTRA2 NUM_EXTRA2
FROM REC_FICHERO_CONTRATOS AG
  JOIN CRC_CICLO_RECOBRO_CNT CRC ON AG.ID_ENVIO = CRC.CRC_ID_ENVIO AND CRC.BORRADO = 0 AND CRC.CRC_FECHA_BAJA IS NULL
  JOIN EFC_EFECTOS_CNT EFC ON CRC.CNT_ID = EFC.CNT_ID
  JOIN DD_TEF_TIPO_EFECTO TEF ON EFC.DD_TEF_ID = TEF.DD_TEF_ID
  JOIN DD_MON_MONEDAS MON ON EFC.DD_MON_ID = MON.DD_MON_ID
  LEFT JOIN DD_SEF_SITUACION_EFECTO SEF ON EFC.DD_SEF_ID = SEF.DD_SEF_ID
  LEFT JOIN DD_TFV_TIPO_FECHA_VENC TFV ON EFC.DD_TFV_ID = TFV.DD_TFV_ID
WHERE EFC.BORRADO = 0;
  
--**************************************
-- ALIMENTACIÃ“N TABLA DE EFECTOS PERSONA
--**************************************
INSERT INTO REC_FICHERO_EFECTOS_PERSONAS
SELECT DISTINCT AG.RCF_AGE_ID
  , AG.ID_EFECTO ID_EFECTO
  , TO_NUMBER(TPE.DD_TPE_CODIGO) TIPO_PERSONA
  , TDI.DD_TDI_CODIGO TIPO_DOCUMENTO
  , TDI.DD_TDI_DESCRIPCION DS_TIPO_DOCUMENTO
  , EFP.EFP_NIF_CIF NIF_CIF_PASAP_NIE
  , EFP.EFP_NOMBRE NOMBRE
  , EFP.EFP_APELLIDO1 APELLIDO1
  , EFP.EFP_APELLIDO2 APELLIDO2
  , TIE.DD_TIE_CODIGO CD_TIPO_DE_RELACION
  , TIE.DD_TIE_DESCRIPCION TIPO_DE_RELACION
  , EFP.EFP_CHAR_EXTRA1 CHAR_EXTRA1
  , EFP.EFP_CHAR_EXTRA2 CHAR_EXTRA2
  , EFP.EFP_FLAG_EXTRA1 FLAG_EXTRA1
  , EFP.EFP_FLAG_EXTRA2 FLAG_EXTRA2
  , EFP.EFP_DATE_EXTRA1 DATE_EXTRA1
  , EFP.EFP_DATE_EXTRA2 DATE_EXTRA2
  , EFP.EFP_NUM_EXTRA1 NUM_EXTRA1
  , EFP.EFP_NUM_EXTRA2 NUM_EXTRA2
FROM REC_FICHERO_EFECTOS AG
  JOIN EFP_EFECTOS_PER EFP ON AG.ID_EFECTO = EFP.EFC_ID
  JOIN BANKMASTER.DD_TPE_TIPO_PERSONA TPE ON EFP.DD_TPE_ID = TPE.DD_TPE_ID
  JOIN DD_TDI_TIPO_DOCUMENTO_ID TDI ON EFP.DD_TDI_ID = TDI.DD_TDI_ID
  JOIN DD_TIE_TIPO_INTERV_EFECTO TIE ON EFP.DD_TIE_ID = TIE.DD_TIE_ID
WHERE EFP.BORRADO = 0;
  
--**************************************
-- ALIMENTACIÃ“N TABLA DE DISPOSICIONES
--**************************************  
INSERT INTO REC_FICHERO_DISPOSICIONES
SELECT DISTINCT AG.RCF_AGE_ID
  , CRC.CRC_ID_ENVIO ID_ENVIO
  , DSP.DSP_CODIGO_DISPOSICION CODIGO_DISPOSICION
  , DTI.DD_DTI_CODIGO CD_TIPO_DISPOSICION
  , DTI.DD_DTI_DESCRIPCION TIPO_DISPOISICION
  , DST.DD_DST_CODIGO CD_SUBTIPO_DISPOSICION
  , DST.DD_DST_DESCRIPCION SUBTIPO_DISPOSICION
  , DSI.DD_DSI_CODIGO CD_SITUACION_DISPOSICION
  , DSI.DD_DSI_DESCRIPCION SITUACION_DISPOSICION
  , MON.DD_MON_CODIGO CD_MONEDA_DISPOSICION
  , MON.DD_MON_DESCRIPCION MONEDA_DISPOSICION
  , DSP.DSP_IMPORTE_DISPOSICION IMPORTE_DISPOSICION
  , DSP.DSP_CAPITAL CAPITAL
  , DSP.DSP_INT_ORDIN_DEVEN INT_ORDIN_EVEN
  , DSP.DSP_INT_ORDIN_MORAT INT_MORAT_DEVN
  , DSP.DSP_COMISIONES COMISIONES
  , DSP.DSP_GASTOS_NO_COBRADOS GASTOS_INCURRIDOS_NO_COBRADOS
  , DSP.DSP_IMPUESTOS IMPUESTOS
  , DSP.DSP_FECHA_VENCIMIENTO FECHA_VENCIMIENTO_DISPOSICION
  , DSP.DSP_CHAR_EXTRA1 CHAR_EXTRA1
  , DSP.DSP_CHAR_EXTRA2 CHAR_EXTRA2
  , DSP.DSP_FLAG_EXTRA1 FLAG_EXTRA1
  , DSP.DSP_FLAG_EXTRA2 FLAG_EXTRA2
  , DSP.DSP_DATE_EXTRA1 DATE_EXTRA1
  , DSP.DSP_DATE_EXTRA2 DATE_EXTRA2
  , DSP.DSP_NUM_EXTRA1 NUM_EXTRA1
  , DSP.DSP_NUM_EXTRA2 NUM_EXTRA2
FROM REC_FICHERO_CONTRATOS AG
  JOIN CRC_CICLO_RECOBRO_CNT CRC ON AG.ID_ENVIO = CRC.CRC_ID_ENVIO AND CRC.BORRADO = 0 AND CRC.CRC_FECHA_BAJA IS NULL
  JOIN DSP_DISPOSICIONES DSP ON CRC.CNT_ID = DSP.CNT_ID
  JOIN DD_DTI_TIPO_DISPOSICION DTI ON DSP.DD_DTI_ID = DTI.DD_DTI_ID
  JOIN DD_DSI_SITUACION_DISPOSICION DSI ON DSP.DD_DSI_ID = DSI.DD_DSI_ID
  JOIN DD_MON_MONEDAS MON ON DSP.DD_MON_ID = MON.DD_MON_ID
  LEFT JOIN DD_DST_SUBTIPO_DISPOSICION DST ON DSP.DD_DST_ID = DST.DD_DST_ID
WHERE DSP.BORRADO = 0;

--**************************************
-- ALIMENTACIÃ“N TABLA DE PALANCAS
--************************************** 
INSERT INTO REC_FICHERO_PALANCAS
SELECT DISTINCT AGC.RCF_AGE_ID
  , AGP.CODIGO_PROPIETARIO CD_PROPIETARIO
  , AGP.CODIGO_PERSONA CD_PERSONA
  , CRE.EXP_ID ID_EXPEDIENTE
  , PAA.RCF_PAA_ID ID_PALANCA_PERMITIDA
  , TPP.RCF_TPP_CODIGO CD_TIPO_PALANCA
  , TPP.RCF_TPP_DESCRIPCION TIPO_PALANCA
  , STP.RCF_STP_CODIGO CD_SUBTIPO_PALANCA
  , STP.RCF_STP_DESCRIPCION SUBTIPO_PALANCA
  , CASE SIN.DD_SIN_CODIGO 
      WHEN '01' THEN 1
      ELSE 0
    END PALANCA_DELEGADA 
  , PAA.RCF_PAA_PRIORIDAD PRIORIDAD_PALANCA
  , NULL DATE_EXTRA1
  , NULL DATE_EXTRA2
  , NULL DATE_EXTRA3
  , NULL DATE_EXTRA4
  , NULL DATE_EXTRA5
  , NULL NUM_EXTRA1
  , NULL NUM_EXTRA2
  , NULL NUM_EXTRA3
  , NULL NUM_EXTRA4
  , NULL NUM_EXTRA5
  , NULL LCHAR_EXTRA1
  , NULL LCHAR_EXTRA2
  , NULL LCHAR_EXTRA3
  , NULL LCHAR_EXTRA4
  , NULL LCHAR_EXTRA5
FROM REC_FICHERO_CONTRATOS AGC
  JOIN REC_FICHERO_CONTRATOS_PERSONAS AGCP on AGC.ID_ENVIO = AGCP.ID_ENVIO
  JOIN REC_FICHERO_PERSONAS AGP ON AGCP.CODIGO_PERSONA = AGP.CODIGO_PERSONA
  JOIN PER_PERSONAS PER ON AGP.CODIGO_PERSONA = PER.PER_COD_CLIENTE_ENTIDAD
  JOIN CRC_CICLO_RECOBRO_CNT CRC ON AGC.ID_ENVIO = CRC.CRC_ID_ENVIO AND CRC.BORRADO = 0 AND CRC.CRC_FECHA_BAJA IS NULL
  JOIN CRE_CICLO_RECOBRO_EXP CRE ON CRC.CRE_ID = CRE.CRE_ID AND CRE.BORRADO = 0
  JOIN CRP_CICLO_RECOBRO_PER CRP ON CRE.CRE_ID = CRP.CRE_ID AND PER.PER_ID = CRP.PER_ID AND CRP.CRP_FECHA_BAJA IS NULL AND CRP.BORRADO = 0
  --TODO Join con subcartera para obtener la polÃ­tica de acuerdos
  JOIN RCF_SCA_SUBCARTERA SCA ON CRE.RCF_SCA_ID = SCA.RCF_SCA_ID
  JOIN RCF_POA_POLITICA_ACUERDOS POA ON SCA.RCF_POA_ID = POA.RCF_POA_ID
  JOIN RCF_PAA_POL_ACUERDOS_PALANCAS PAA ON POA.RCF_POA_ID = PAA.RCF_POA_ID
  JOIN RCF_STP_SUBTIPO_PALANCA STP ON PAA.RCF_STP_ID = STP.RCF_STP_ID
  JOIN RCF_TPP_TIPO_PALANCA TPP ON STP.RCF_TPP_ID = TPP.RCF_TPP_ID
  LEFT JOIN ${master.schema}.DD_SIN_SINO SIN ON PAA.DD_SIN_ID = SIN.DD_SIN_ID;
  
  
--**************************************
-- ALIMENTACIÃ“N TABLA DE ADECUACIONES
--************************************** 
INSERT INTO REC_FICHERO_ADECUACIONES
SELECT DISTINCT AGC.RCF_AGE_ID
  , CRC.CRC_ID_ENVIO ID_ENVIO
  , ADC.DD_CODIGO_RECOMENDACION COD_RECOMENDACION
  , ADC.ADC_IMPORTE_FINANCIAR ADE_IMPORTE_FINANCIAR
  , ADC.ADC_GASTOS_INCLUIDOS ADE_GASTOS_INCLUIDOS
  , ADC.ADC_TIPO ADE_TIPO
  , ADC.ADC_DIFERENCIAL ADE_DIFERENCIAL
  , ADC.ADC_PLAZO ADE_PLAZO
  , ADC.ADC_CUOTA ADE_CUOTA
  , ADC.ADC_CUOTA_TRAS_CARENCIA ADE_CUOTA_TRAS_CARENCIA
  , ADC.ADC_SISTEMA_AMORTIZACION ADE_SISTEMA_AMORTIZACION 
  , ADC.ADC_RAZON_PROGRESION ADE_RAZON_PROGRESION
  , ADC.ADC_PERIODICIDAD_RECIBOS ADE_PERIODICIDAD_RECIBOS
  , ADC.ADC_PERIODICIDAD_TIPO ADE_PERIODICIDAD_REVISION_TIPO
  , ADC.ADC_PROXIMA_REVISION ADE_PROXIMA_REVISION_TIPO
  , ADC.ADC_REVISION_CUOTA ADE_REVISION_CUOTA
  , ADC.ADC_LCHAR_EXTRA LCHAR_EXTRA1
  , NULL LCHAR_EXTRA2
  , NULL LCHAR_EXTRA3
  , NULL LCHAR_EXTRA4
  , NULL LCHAR_EXTRA5
  , NULL LCHAR_EXTRA6
  , NULL LCHAR_EXTRA7
  , NULL LCHAR_EXTRA8
  , NULL LCHAR_EXTRA9
  , NULL LCHAR_EXTRA10
  , ADC.ADC_CHAR_EXTRA1
  , ADC.ADC_CHAR_EXTRA2
  , ADC.ADC_CHAR_EXTRA3
  , ADC.ADC_CHAR_EXTRA4
  , ADC.ADC_CHAR_EXTRA5
  , NULL CHAR_EXTRA6
  , NULL CHAR_EXTRA7
  , NULL CHAR_EXTRA8
  , NULL CHAR_EXTRA9
  , NULL CHAR_EXTRA10
  , ADC.ADC_FLAG_EXTRA1
  , ADC.ADC_FLAG_EXTRA2
  , ADC.ADC_FLAG_EXTRA3
  , ADC.ADC_FLAG_EXTRA4
  , ADC.ADC_FLAG_EXTRA5
  , ADC.ADC_FLAG_EXTRA6
  , ADC.ADC_FLAG_EXTRA7
  , ADC.ADC_FLAG_EXTRA8
  , ADC.ADC_FLAG_EXTRA9
  , ADC.ADC_FLAG_EXTRA10
  , ADC.ADC_DATE_EXTRA1
  , ADC.ADC_DATE_EXTRA2
  , ADC.ADC_DATE_EXTRA3
  , ADC.ADC_DATE_EXTRA4
  , ADC.ADC_DATE_EXTRA5
  , ADC.ADC_DATE_EXTRA6
  , ADC.ADC_DATE_EXTRA7
  , ADC.ADC_DATE_EXTRA8
  , ADC.ADC_DATE_EXTRA9
  , ADC.ADC_DATE_EXTRA10
  , ADC.ADC_NUM_EXTRA1
  , ADC.ADC_NUM_EXTRA2
  , ADC.ADC_NUM_EXTRA3
  , ADC.ADC_NUM_EXTRA4
  , ADC.ADC_NUM_EXTRA5
  , ADC.ADC_NUM_EXTRA6
  , ADC.ADC_NUM_EXTRA7
  , ADC.ADC_NUM_EXTRA8
  , ADC.ADC_NUM_EXTRA9
  , ADC.ADC_NUM_EXTRA10
  , NULL NUM_EXTRA11
  , NULL NUM_EXTRA12
  , NULL NUM_EXTRA13
  , NULL NUM_EXTRA14
  , NULL NUM_EXTRA15
FROM REC_FICHERO_CONTRATOS AGC
  JOIN CRC_CICLO_RECOBRO_CNT CRC ON AGC.ID_ENVIO = CRC.CRC_ID_ENVIO AND CRC.BORRADO = 0 AND CRC.CRC_FECHA_BAJA IS NULL
  JOIN ADC_ADECUACIONES_CNT ADC ON CRC.CNT_ID = ADC.CNT_ID
WHERE ADC.BORRADO = 0;