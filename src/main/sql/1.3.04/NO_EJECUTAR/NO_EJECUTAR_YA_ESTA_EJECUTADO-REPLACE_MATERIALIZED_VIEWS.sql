--Script de Bruno que utilizó cuándo integramos lo de Bankia con Haya por primera vez.
--Con este script quitamos las vistas materializadas y se quedan como vistas.
DECLARE
  PROCEDURE REPLACE_VISTA (V_NOMBRE VARCHAR2) AS 
    V_QUERY VARCHAR2(30000);
    V_COUNT NUMBER;
  BEGIN
    SELECT COUNT(1) INTO V_COUNT FROM USER_MVIEWS WHERE MVIEW_NAME = V_NOMBRE;
    
    IF (V_COUNT <> 0) THEN
      SELECT QUERY INTO V_QUERY FROM USER_MVIEWS WHERE MVIEW_NAME = V_NOMBRE;
      
      EXECUTE IMMEDIATE 'DROP MATERIALIZED VIEW '||V_NOMBRE;
      EXECUTE IMMEDIATE 'CREATE OR REPLACE VIEW '||V_NOMBRE||' AS '||V_QUERY;
  END IF;
END;
/
BEGIN
  REPLACE_VISTA('V42_BUSQUEDA_TAREAS');
  REPLACE_VISTA('VASU_SALDO_TOTAL');
  REPLACE_VISTA('VTAR_ASUNTO_GESTOR');
  REPLACE_VISTA('VTAR_ASU_VS_USU');
  REPLACE_VISTA('VTMP_CUMPLIMINETOS_REG_2');
  REPLACE_VISTA('V_BUSQUEDA_ASUNTOS_FILTRO_AGEN');
  REPLACE_VISTA('V_CVE_CLIENTES_VENCIDOS_USU');
  REPLACE_VISTA('0V_DD_EST_ESTADOS_ITINERARIOS');
  REPLACE_VISTA('V_DD_STA_SUBTIPO_TAREA_BASE');
  REPLACE_VISTA('V_JUZ_PLA');
  REPLACE_VISTA('V_PC_COT_EXP_TAR');
  REPLACE_VISTA('V_PC_COT_EXP_TAR_RESUMEN');
  REPLACE_VISTA('V_PC_ZONAS_JUDICIAL');
  REPLACE_VISTA('V_PP_ACTUALIZACION_ASUNTOS');
  REPLACE_VISTA('V_TAREA_TIPOANOTACION');
  REPLACE_VISTA('V_TAREA_USUPENDIENTE');
  REPLACE_VISTA('V_DD_EST_ESTADOS_ITINERARIOS');
  REPLACE_VISTA('V_USU_USUARIOS');
  REPLACE_VISTA('V_VALORES_PROCEDIMIENTOS');
  REPLACE_VISTA('V_VARIACIONES_DE_SALDO');
  
  commit;
  
END;
/