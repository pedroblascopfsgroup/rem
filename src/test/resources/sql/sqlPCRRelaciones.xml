<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

  <!--     INSERTAR RELACIONES EN TABLAS DE PRODUCCION      -->
  <entry key="pcr.borrar.relaciones">
    <![CDATA[ TRUNCATE TABLE cpe_contratos_personas]]>
  </entry>
  <entry key="pcr.insert.relaciones.MySQLDialect">
    <![CDATA[    
           INSERT into cpe_contratos_personas(
              PER_ID,
              CNT_ID,
              DD_TIN_ID,
              CPE_ORDEN,
           CPE_TIPO_INTERV_ORIGINAL,
              USUARIOCREAR,
              FECHACREAR,
              USUARIOMODIFICAR,
              FECHAMODIFICAR,
              USUARIOBORRAR,
              FECHABORRAR,
              BORRADO)
                  SELECT
                      (SELECT p.PER_ID FROM per_personas p WHERE p.PER_COD_CLIENTE_ENTIDAD = TRIM(t.TMP_CNT_PER_COD_CLIENTE)) AS PER_ID,
                      (SELECT c.CNT_ID FROM cnt_contratos c WHERE c.CNT_CONTRATO = TRIM(t.TMP_CNT_PER_CONTRATO) and c.CNT_COD_OFICINA = t.TMP_CNT_PER_COD_OFICINA) AS CNT_ID,
                      (SELECT tin.DD_TIN_ID FROM dd_tin_tipo_intervencion tin WHERE tin.DD_TIN_CODIGO = TRIM(t.TMP_CNT_PER_TIPO_INTERVENCION)) AS DD_TIN_ID,
                      t.TMP_CNT_PER_ORDEN,
                 t.TMP_CNT_PER_TIPO_INTERVENCION,
                      t.USUARIOCREAR,
                      now(),
                      t.USUARIOMODIFICAR,
                      t.FECHAMODIFICAR,
                      t.USUARIOBORRAR,
                      t.FECHABORRAR,
                      t.BORRADO
                  FROM tmp_cnt_per t                  
        ]]>
  </entry>
  <entry key="pcr.insert.relaciones.Oracle9iDialect">
    <![CDATA[
            insert into cpe_contratos_personas(CPE_ID,
              PER_ID,
              CNT_ID,
              DD_TIN_ID,
              CPE_ORDEN,
              CPE_TIPO_INTERV_ORIGINAL,
              USUARIOCREAR,
              FECHACREAR,
              USUARIOMODIFICAR,
              FECHAMODIFICAR,
              USUARIOBORRAR,
              FECHABORRAR,
              BORRADO)
                  SELECT S_CPE_CONTRATOS_PERSONAS.nextVal AS CPE_ID,
                      p.per_id,
                      c.CNT_ID AS CNT_ID,
                      (SELECT tin.DD_TIN_ID FROM dd_tin_tipo_intervencion tin WHERE UPPER(tin.DD_TIN_CODIGO) = UPPER(TRIM(t.TMP_CNT_PER_TIPO_INTERVENCION))) AS DD_TIN_ID,
                      t.TMP_CNT_PER_ORDEN,
                      t.TMP_CNT_PER_TIPO_INTERVENCION,
                      '${PasajeAProducciÃ³nUser}',
                      systimestamp,
                      t.USUARIOMODIFICAR,
                      t.FECHAMODIFICAR,
                      t.USUARIOBORRAR,
                      t.FECHABORRAR,
                      t.BORRADO
                  FROM tmp_cnt_per t, per_personas p, cnt_contratos c
                                  WHERE      p.PER_COD_CLIENTE_ENTIDAD = t.TMP_CNT_PER_COD_CLIENTE
                       AND                c.CNT_CONTRATO = t.TMP_CNT_PER_CONTRATO
                       AND                c.CNT_COD_OFICINA = t.TMP_CNT_PER_COD_OFICINA
        ]]>
  </entry>
  <entry key="pcr.analize.relaciones">
      <![CDATA[
        ANALYZE TABLE cpe_contratos_personas ${sql.analyze}
         ]]>
  </entry>
  
  <entry key="cnt-per-01.entityValidator">
        <![CDATA[SELECT (''||tcp.TMP_CNT_PER_COD_ENTIDAD) as ERROR_FIELD, (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
                    FROM tmp_cnt_per tcp
                    WHERE TMP_CNT_PER_COD_ENTIDAD <> ?]]></entry>

  <entry key="cnt-per-02.loadDateValidator.MySQLDialect">
                <![CDATA[SELECT (''||tcp.TMP_CNT_PER_COD_ENTIDAD) as ERROR_FIELD, (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
                            FROM TMP_CNT_PER tcp
                            WHERE TMP_CNT_PER_FECHA_EXTRACCION <> str_to_date(?,'%Y%m%d')]]></entry>
  <entry key="cnt-per-02.loadDateValidator.Oracle9iDialect">
                <![CDATA[SELECT (''||tcp.TMP_CNT_PER_COD_ENTIDAD) as ERROR_FIELD, (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
                            FROM TMP_CNT_PER tcp
                            WHERE TMP_CNT_PER_FECHA_EXTRACCION <> to_date(?,'YYYYMMDD')]]></entry>


  <entry key="cnt-per-03.intervencionValidator">
    <![CDATA[
        SELECT (''||TRIM(UPPER(tcp.TMP_CNT_PER_TIPO_INTERVENCION))) as ERROR_FIELD, (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
        FROM tmp_cnt_per tcp
        WHERE not exists (SELECT * FROM dd_tin_tipo_intervencion tin WHERE TRIM(UPPER(tin.DD_TIN_CODIGO)) = TRIM(UPPER(tcp.TMP_CNT_PER_TIPO_INTERVENCION)))
        ]]>
  </entry>

  <entry key="cnt-per-04.integridadValidator.MySQLDialect">
    <![CDATA[
        SELECT (
          ''||tcp.TMP_CNT_PER_COD_CLIENTE||TMP_CNT_PER_CONTRATO) as ERROR_FIELD,
          (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
        FROM TMP_CNT_PER tcp
        WHERE TMP_CNT_PER_COD_CLIENTE NOT IN (
            SELECT TMP_PER_COD_CLIENTE_ENTIDAD
                FROM TMP_PER_PERSONAS
          )
            OR (TMP_CNT_PER_CONTRATO, TMP_CNT_PER_COD_OFICINA) NOT IN (
            SELECT TMP_CNT_CONTRATO, TMP_CNT_COD_OFICINA
                FROM TMP_CNT_CONTRATOS
          )
        ]]>
  </entry>
  <entry key="cnt-per-04.integridadValidator.Oracle9iDialect">
    <![CDATA[
        SELECT (
          ''||tcp.TMP_CNT_PER_COD_CLIENTE||TMP_CNT_PER_CONTRATO) as ERROR_FIELD,
          (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
        FROM TMP_CNT_PER tcp
        WHERE TMP_CNT_PER_COD_CLIENTE NOT IN (
            SELECT TMP_PER_COD_CLIENTE_ENTIDAD
                FROM TMP_PER_PERSONAS
          )
            OR (TMP_CNT_PER_CONTRATO, TMP_CNT_PER_COD_OFICINA) NOT IN (
            SELECT TMP_CNT_CONTRATO, TMP_CNT_COD_OFICINA
                FROM TMP_CNT_CONTRATOS
  )
        ]]>
  </entry>

  <entry key="cnt-per-05.integridadCodOficinaValidator.MySQLDialect">
    <![CDATA[
        SELECT (''||tcp.TMP_CNT_PER_CONTRATO||TMP_CNT_PER_COD_OFICINA) as ERROR_FIELD, (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
        FROM TMP_CNT_PER tcp,tmp_cnt_contratos c
        WHERE    tcp.TMP_CNT_PER_CONTRATO =  c.TMP_CNT_CONTRATO
        AND tcp.TMP_CNT_PER_COD_OFICINA <> c.TMP_CNT_COD_OFICINA
        ]]>
  </entry>
  <entry key="cnt-per-05.integridadCodOficinaValidator.Oracle9iDialect">
    <![CDATA[
        SELECT (''||tcp.TMP_CNT_PER_CONTRATO||TMP_CNT_PER_COD_OFICINA) as ERROR_FIELD, (tcp.TMP_CNT_PER_COD_CLIENTE ||'-'|| tcp.TMP_CNT_PER_CONTRATO) as ENTITY_CODE
        FROM TMP_CNT_PER tcp
        WHERE    (tcp.TMP_CNT_PER_CONTRATO, tcp.TMP_CNT_PER_COD_OFICINA) 
                       not in (select c.TMP_CNT_CONTRATO, c.TMP_CNT_COD_OFICINA  from tmp_cnt_contratos c)
        ]]>
  </entry>
  
</properties>
