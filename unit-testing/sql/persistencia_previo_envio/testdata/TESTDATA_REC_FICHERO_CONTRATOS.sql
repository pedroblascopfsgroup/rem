/*
 * INSERT TMP_REC_EXP_AGE_CNT_EXC
 */

INSERT INTO TMP_REC_EXP_AGE_CNT_EXC 
SELECT 1, 1, 1+CNT_ID, PER_ID, CNT_ID, 1 FROM CPE_CONTRATOS_PERSONAS WHERE MOD(CNT_ID,4) = 0 AND ROWNUM <= 10
UNION
SELECT 2, 2, 1+CNT_ID, PER_ID, CNT_ID, 2 FROM CPE_CONTRATOS_PERSONAS WHERE MOD(CNT_ID,4) = 1 AND ROWNUM <= 10
UNION
SELECT 3, 3, 1+CNT_ID, PER_ID, CNT_ID, 3 FROM CPE_CONTRATOS_PERSONAS WHERE MOD(CNT_ID,4) = 2 AND ROWNUM <= 10
UNION
SELECT 4, 4, 1+CNT_ID, PER_ID, CNT_ID, 4 FROM CPE_CONTRATOS_PERSONAS WHERE MOD(CNT_ID,4) = 3 AND ROWNUM <= 10;

COMMIT;


/*
 SETEAR VALORES DEL CONTRATO
 */
 -- OFI_ID_ADMIN

UPDATE CNT_CONTRATOS CNT SET OFI_ID_ADMIN = 7101
WHERE CNT.CNT_ID IN (SELECT CNT_ID FROM TMP_REC_EXP_AGE_CNT_EXC) AND CNT.OFI_ID_ADMIN IS NULL
AND MOD(CNT.CNT_ID,4) = 0;

UPDATE CNT_CONTRATOS CNT SET OFI_ID_ADMIN = 7102
WHERE CNT.CNT_ID IN (SELECT CNT_ID FROM TMP_REC_EXP_AGE_CNT_EXC) AND CNT.OFI_ID_ADMIN IS NULL
AND MOD(CNT.CNT_ID,4) = 1;

UPDATE CNT_CONTRATOS CNT SET OFI_ID_ADMIN = 7103
WHERE CNT.CNT_ID IN (SELECT CNT_ID FROM TMP_REC_EXP_AGE_CNT_EXC) AND CNT.OFI_ID_ADMIN IS NULL
AND MOD(CNT.CNT_ID,4) = 2;

UPDATE CNT_CONTRATOS CNT SET OFI_ID_ADMIN = 7104
WHERE CNT.CNT_ID IN (SELECT CNT_ID FROM TMP_REC_EXP_AGE_CNT_EXC) AND CNT.OFI_ID_ADMIN IS NULL
AND MOD(CNT.CNT_ID,4) = 3;

COMMIT;

--CNT_COD_ENTIDAD_PROPIETARIA
UPDATE CNT_CONTRATOS CNT SET CNT_COD_ENTIDAD_PROPIETARIA = 2038
WHERE CNT.CNT_ID IN (SELECT CNT_ID FROM TMP_REC_EXP_AGE_CNT_EXC) AND CNT.CNT_COD_ENTIDAD_PROPIETARIA IS NULL;

COMMIT;

-- NUM_ESPEC
INSERT INTO EXT_IAC_INFO_ADD_CONTRATO (IAC_ID,DD_IFC_ID,CNT_ID, IAC_VALUE, VERSION, USUARIOCREAR, FECHACREAR, BORRADO)
SELECT S_EXT_IAC_INFO_ADD_CONTRATO.NEXTVAL,
  (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'NUM_ESPEC'),
  CNT_ID,
  123456789,
  0, 'TEST', SYSDATE, 0
FROM CNT_CONTRATOS CNT
WHERE CNT.CNT_ID IN (SELECT CNT_ID FROM TMP_REC_EXP_AGE_CNT_EXC)
AND NOT EXISTS (SELECT IAC_VALUE FROM EXT_IAC_INFO_ADD_CONTRATO WHERE CNT_ID = CNT.CNT_ID AND DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'NUM_ESPEC'));

COMMIT;

-- REPLACE DE EXTRAS
UPDATE EXT_IAC_INFO_ADD_CONTRATO SET IAC_VALUE = REPLACE(',','.') WHERE DD_IFC_ID = (SELECT DD_IFC_ID FROM EXT_DD_IFC_INFO_CONTRATO WHERE DD_IFC_CODIGO = 'num_extra3');

