SELECT * FROM BATCH_DATOS_EXP;

SELECT * FROM REC_FICHERO_CONTRATOS;

SELECT * FROM REC_FICHERO_PERSONAS;

SELECT CRE.EXP_ID, CRC.CRC_ID_ENVIO, CRC.CNT_ID
FROM CRC_CICLO_RECOBRO_CNT CRC
  JOIN CRE_CICLO_RECOBRO_EXP CRE ON CRC.CRE_ID = CRE.CRE_ID
WHERE CRC.CRC_FECHA_BAJA IS NULL
ORDER BY CRE.EXP_ID;

SELECT * FROM EXC_EXCEPTUACION;

SELECT * FROM ECO_EXCEPTUACION_CONTRATO;

DELETE FROM EPE_EXCEPTUACION_PERSONA WHERE EXC_ID IN (SELECT EXC_ID FROM EXC_EXCEPTUACION WHERE USUARIOCREAR='TEXCNT');

DELETE FROM ECO_EXCEPTUACION_CONTRATO WHERE EXC_ID IN (SELECT EXC_ID FROM EXC_EXCEPTUACION WHERE USUARIOCREAR='TEXCNT');

DELETE FROM EXC_EXCEPTUACION WHERE USUARIOCREAR='TEXCNT';

COMMIT;


INSERT INTO EXC_EXCEPTUACION (EXC_ID, EXC_FECHA_HASTA, DD_MOE_ID, VERSION, USUARIOCREAR, FECHACREAR, BORRADO)
VALUES(
  S_EXC_EXCEPTUACION.NEXTVAL, TRUNC(SYSDATE + 1), (SELECT MIN(DD_MOE_ID) FROM DD_MOE_MOTIVO_EXCEPTUACION), 0, 'TEXCNT', SYSDATE, 0 
);
INSERT INTO EXC_EXCEPTUACION (EXC_ID, EXC_FECHA_HASTA, DD_MOE_ID, VERSION, USUARIOCREAR, FECHACREAR, BORRADO)
VALUES(
  S_EXC_EXCEPTUACION.NEXTVAL, TRUNC(SYSDATE + 1), (SELECT MIN(DD_MOE_ID) FROM DD_MOE_MOTIVO_EXCEPTUACION), 0, 'TEXCNT', SYSDATE, 0 
);
INSERT INTO EXC_EXCEPTUACION (EXC_ID, EXC_FECHA_HASTA, DD_MOE_ID, VERSION, USUARIOCREAR, FECHACREAR, BORRADO)
VALUES(
  S_EXC_EXCEPTUACION.NEXTVAL, TRUNC(SYSDATE + 1), (SELECT MIN(DD_MOE_ID) FROM DD_MOE_MOTIVO_EXCEPTUACION), 0, 'TEXCNT', SYSDATE, 0 
);

INSERT INTO EXC_EXCEPTUACION (EXC_ID, EXC_FECHA_HASTA, DD_MOE_ID, VERSION, USUARIOCREAR, FECHACREAR, BORRADO)
VALUES(
  S_EXC_EXCEPTUACION.NEXTVAL, TRUNC(SYSDATE + 1), (SELECT MIN(DD_MOE_ID) FROM DD_MOE_MOTIVO_EXCEPTUACION), 0, 'TEXCNT', SYSDATE, 0 
);

INSERT INTO ECO_EXCEPTUACION_CONTRATO 
SELECT MIN(EXC_ID), 2363938 FROM EXC_EXCEPTUACION WHERE EXC_ID NOT IN(SELECT EXC_ID FROM ECO_EXCEPTUACION_CONTRATO);

--INSERT INTO ECO_EXCEPTUACION_CONTRATO 
--SELECT MIN(EXC_ID), 2246989 FROM EXC_EXCEPTUACION WHERE EXC_ID NOT IN(SELECT EXC_ID FROM ECO_EXCEPTUACION_CONTRATO);

INSERT INTO ECO_EXCEPTUACION_CONTRATO 
SELECT MIN(EXC_ID), 2317069 FROM EXC_EXCEPTUACION WHERE EXC_ID NOT IN(SELECT EXC_ID FROM ECO_EXCEPTUACION_CONTRATO);

INSERT INTO EPE_EXCEPTUACION_PERSONA 
SELECT MIN(EXC_ID), 828327 FROM EXC_EXCEPTUACION WHERE EXC_ID NOT IN(SELECT EXC_ID FROM ECO_EXCEPTUACION_CONTRATO);




DELETE FROM ECO_EXCEPTUACION_CONTRATO WHERE EXC_ID IS NULL;

COMMIT;

SELECT * FROM BATCH_DATOS_EXCEPTUADOS;